"use strict";const VERSION="Exolve v0.36 October 22 2019 (w/reentrancy via DoctorBud)";let puzzleInstanceId=0,puzzleInstances={};const exolvePrefix="exolve-";class Puzzle{constructor(){const e=this;puzzleInstanceId+=1,this.id=puzzleInstanceId;const t=`exolve-${puzzleInstanceId}-`;puzzleInstances[t]=this;let n="exolve-grid",l=0,i=0,r=0,s=0,o=-1,u=-1,a=-1,c=-1,d=-1,f=-1,p=-1,h=-1,b=-1,g=-1,m=-1,x=-1,y=[],w=[],v=!1,L=[],A={},C=[],N=null,k=[],E=!1,I=!1,S=!1,$=!1,D=!1,z=!1,B=1,T={};const R=31,U=1.5;let H=[],P=[],M=-1,O=-1,V=!0,X=null,q=[],Z=[],F=0,j=[],G=[];const Y="⬛",_="mistyrose";let J=0;const K="eexxoollvvee";let W,Q,ee,te,ne,le,ie,re,se,oe,ue,ae,ce,de,fe,pe,he,be,ge,me,xe,ye,we,ve,Le,Ae,Ce,Ne=!1,ke=-1;function Ee(){for(;J<Q&&0!=W[J].trim().indexOf("exolve-");)J++;if(J>=Q)return null;let e=W[J].trim().substr(7),t=e.indexOf(":");return t<0&&(t=e.length),J++,{section:e.substr(0,t).trim().toLowerCase(),value:e.substr(t+1).trim()}}function Ie(e){let t=[],n=e.split(" ");for(let e of n){let n=He(e);n?t.push(n):t.push(e)}t.length>0&&y.push(t)}function Se(e){let t=e.split(" "),n="";for(let e of t){if(!n){n=e;continue}let t=He(e);if(!t)return void Be("Could not parse cell location in: "+e);C.push(t.concat(n))}}function $e(e){let t=Pe(e),n=t.len+t.hyphenAfter.length+t.wordEndAfter.length,l=t.afterEnum,i=e.substr(0,l),r=!1;if(n>0&&"*"==e.substr(l,1)){if(beforeEnum=e.lastIndexOf("(",l-1),beforeEnum<0)return void Be("Could not find open-paren strangely");i=e.substr(0,beforeEnum),l++,r=!0}let s=e.substr(l).trim();const o=document.createElement("div");o.setAttributeNS(null,"class","question");const u=document.createElement("span");u.innerHTML=i,o.appendChild(u),o.appendChild(document.createElement("br")),0==n&&(r=!0,n="30");let a=Math.floor(n/68);68*a<n&&a++;let c=a>1?68:n,d="input";a>1&&(d="textarea");const f=document.createElement(d);if(a>1?(f.setAttributeNS(null,"rows",""+a),f.setAttributeNS(null,"cols",""+c)):f.setAttributeNS(null,"size",""+c),f.setAttributeNS(null,"class","answer"),H.push({ans:s,input:f,hasEnum:n>0}),!r){let e="",n=0,l=0;for(let i=0;i<t.len;i++)e+="?",n<t.wordEndAfter.length&&i==t.wordEndAfter[n]&&(e+=" ",n++),l<t.hyphenAfter.length&&i==t.hyphenAfter[l]&&(e+="-",l++);f.setAttributeNS(null,"placeholder",""+e)}f.setAttributeNS(null,"class","answer"),1==a&&f.setAttributeNS(null,"type","text"),f.setAttributeNS(null,"maxlength",""+n),f.setAttributeNS(null,"autocomplete","off"),f.setAttributeNS(null,"spellcheck","false"),o.appendChild(f),le.appendChild(o),f.addEventListener("input",Xe)}function De(e){let t=e.split(" ");if(e.length<2)Be("Submit section must have a URL and a param name for the solution");else{N=t[0],k=[];for(let e=1;e<t.length;e++)k.push(t[e])}}function ze(e){let t=e.split(" ");for(let e of t){if(e=e.trim().toLowerCase(),"hide-inferred-numbers"==e){Ne=!0;continue}let t=e.split(":");if(2!=t.length)return void Be("Expected exolve-option: key:value, got: "+e);if("clues-panel-lines"!=t[0])return void Be("Unexpected exolve-option: "+e);ke=parseInt(t[1]),isNaN(ke)&&Be("Unexpected value in exolve-option: clue-panel-lines: "+t[1])}}function Be(e){document.getElementById(t+"errors").innerHTML=document.getElementById(t+"errors").innerHTML+"<br/>"+e,l=0}function Te(e,t){return!(!L[e][t].isLight||t>0&&L[e][t-1].isLight&&!L[e][t-1].hasBarAfter||L[e][t].hasBarAfter||t==l-1||!L[e][t+1].isLight)}function Re(e,t){return!(!L[e][t].isLight||e>0&&L[e-1][t].isLight&&!L[e-1][t].hasBarUnder||L[e][t].hasBarUnder||e==i-1||!L[e+1][t].isLight)}function Ue(e,t){let n=e.substr(t);for(;"</"==n.trim().substr(0,2);){let l=e.indexOf(">",t);if(l<0)return t;t=l+1,n=e.substr(t)}return t}function He(e){let t=(e=e.trim()).charCodeAt(0)-"a".charCodeAt(0),n=i-parseInt(e.substr(1));return isNaN(n)||isNaN(t)||n<0||n>=i||t<0||t>=l?null:[n,t]}function Pe(e){let t={len:0,wordEndAfter:[],hyphenAfter:[],afterEnum:e.length},n=e.search(/\([1-9]+[0-9\-,'’\s]*\)/);if(n<0){if(n=e.search(/\([^)]*(word|letter|\?)[^)]*\)/i),n>=0){let l=n+e.substr(n).indexOf(")");if(l<=n)return t;t.afterEnum=Ue(e,l+1)}return t}let l=n+e.substr(n).indexOf(")");if(l<=n)return t;t.afterEnum=Ue(e,l+1);let i,r=e.substring(n+1,l);for(;r&&(i=parseInt(r))&&!isNaN(i)&&i>0;){t.len=t.len+i,r=r.replace(/\s*\d+\s*/,"");let e=r.substr(0,1);if("-"==e)t.hyphenAfter.push(t.len-1),r=r.substr(1);else if(","==e)t.wordEndAfter.push(t.len-1),r=r.substr(1);else if("'"==e)r=r.substr(1);else{if(0!=r.indexOf("’"))break;r=r.substr(1)}}return t}function Me(e){let t={dir:"",hasChilden:!1,skip:0};const n=e.match(/^\s*[1-9]\d*/);if(n&&1==n.length){let e=parseInt(n[0]);t.clueLabel=""+e,t.isNonNum=!1,t.skip=n[0].length}else{let n=e.match(/^\s*\[/);if(!n||1!=n.length)return t.isFiller=!0,t;let l=n[0].length,i=e.indexOf("]");if(i<0)return t.error="Missing matching ] in clue label in "+e,t;t.clueLabel=e.substring(l,i).trim();let r=parseInt(t.clueLabel);if(!isNaN(r))return t.error="Numeric label not allowed in []: "+clueLabel,t;"."==t.clueLabel.charAt(t.clueLabel.length-1)&&(t.clueLabel=t.clueLabel.substr(0,t.clueLabel.length-1).trim()),t.isNonNum=!0,t.skip=i+1}const l=(e=e.substr(t.skip)).match(/^[aAdD]/);l&&1==l.length&&(t.dir=l[0].trim().toUpperCase(),t.skip+=l[0].length,e=e.substr(l[0].length));const i=e.match(/^\s*,/);i&&1==i.length&&(t.hasChildren=!0,t.skip+=i[0].length,e=e.substr(i[0].length));const r=e.match(/^\s*\./);return r&&1==r.length&&(t.hasChildren=!1,t.skip+=r[0].length,e=e.substr(r[0].length)),t}function Oe(e,t){let n={};if(0==(t=t.trim()).indexOf("#")){let e=He(t.substr(1));e&&(n.startCell=e),t=t.replace(/^#[a-z][0-9]*\s*/,"")}let l=Me(t);if(l.error)return n.error=l.error,n;if(l.isFiller)return n.isFiller=!0,n;if(l.dir&&l.dir!=e)return n.error="Explicit dir "+l.dir+" does not match "+e+" in clue: "+t,n;n.clueLabel=l.clueLabel,n.isNonNum=l.isNonNum;let i=e+n.clueLabel;if(n.isNonNum){let t=e+"#"+B++;T[n.clueLabel]||(T[n.clueLabel]=[]),T[n.clueLabel].push(t),i=t}for(n.clueIndex=i,t=t.substr(l.skip),n.children=[];l.hasChildren;){if(l=Me(t),l.error)return n.error="Error in linked clue number/label: "+l.error,n;n.children.push(l),t=t.substr(l.skip)}let r=Pe(t);return n.len=r.len,n.hyphenAfter=r.hyphenAfter,n.wordEndAfter=r.wordEndAfter,n.clue=t.substr(0,r.afterEnum).trim(),n.anno=t.substr(r.afterEnum).trim(),n}function Ve(e){return(e=e.replace(/<br\s*\/?>/gi," / ")).replace(/<\/br\s*>/gi,"")}function Xe(){let t=function(){let e=function(){let e="",t=0;for(let n=0;n<i;n++)for(let i=0;i<l;i++)if(L[n][i].isLight||L[n][i].isDiagramless){let l=L[n][i].currentLetter.trim();""==l?e+="0":(e+=l,t++)}else e+=".";return[e,t]}(),t=e[0],n=e[1];he.innerHTML=n;for(let e of H)e.hasEnum&&(e.input.value=e.input.value.toUpperCase());return me.disabled=0==q.length,ye.disabled=0==q.length,Le.disabled=0==q.length,Ce.disabled=n!=F,t}();for(let e of H)t=t+K+e.input.value;let r=new Date;r.setTime(r.getTime()+7776e6);let s="expires="+r.toUTCString();document.cookie=n+"="+t+";"+s+";path=/";let o=decodeURIComponent(location.hash.substr(1)).split("?"),u=[],a=[],c=!1;for(const e in o){const l=o[e];if(0===l.indexOf("exolve-")){const e=l.indexOf("="),i=l.slice(7,e);if(console.log("key",i,n,t,l,l.slice(e+1)),i==n){c=!0,a.push(`exolve-${n}=${t}`);break}u.push(l)}else u.push(l),a.push(l)}c||a.push(`exolve-${n}=${t}`);const d=a.join("?");location.hash="#"+u.join("?"),ge&&(ge.href=`${location.origin}${location.pathname}#${d}`),e.stateChangeListener&&e.stateChangeListener(t)}function qe(e){let t=function(e){let t=!1,n=[];if(""==e?(n.push("No saved state available"),t=!0):e.length<l*i&&(n.push("Not enough characters in state"),t=!0),t)return n;let r=0;for(let s=0;s<i&&!t;s++)for(let i=0;i<l&&!t;i++){const l=e.charAt(r++);if(L[s][i].isLight||L[s][i].isDiagramless){if(L[s][i].prefill)continue;if("0"==l);else if("1"==l){if(!L[s][i].isDiagramless){n.push("Unexpected ⬛ in non-diagramless location"),t=!0;break}}else if(l<"A"||l>"Z"){n.push("Unexpected letter "+l+" in state"),t=!0;break}}else if("."!=l){n.push("Unexpected letter "+l+" in state, expected ."),t=!0;break}}return n}(e=e.trim()),n=t.length>0;if(n)return t;let r=0;for(let t=0;t<i&&!n;t++)for(let i=0;i<l&&!n;i++){const l=e.charAt(r++);if(L[t][i].isLight||L[t][i].isDiagramless){if(L[t][i].prefill){L[t][i].currentLetter=L[t][i].solution;continue}if("0"==l)L[t][i].currentLetter="";else if("1"==l){if(!L[t][i].isDiagramless){console.log("Unexpected ⬛ in non-diagramless location"),n=!0;break}L[t][i].currentLetter="1"}else{if(l<"A"||l>"Z"){console.log("Unexpected letter "+l+" in state"),n=!0;break}L[t][i].currentLetter=l}}else if("."!=l){console.log("Unexpected letter "+l+" in state, expected ."),n=!0;break}}if(n){for(let e=0;e<i;e++)for(let t=0;t<l;t++)if(L[e][t].isLight||L[e][t].isDiagramless){if(L[e][t].prefill){L[e][t].currentLetter=L[e][t].solution;continue}L[e][t].currentLetter=""}}else if(e.substr(r,12)==K){let t=e.substr(r+12).split(K);if(t.length==H.length)for(let e=0;e<t.length;e++)H[e].input.value=t[e]}for(let e=0;e<i;e++)for(let t=0;t<l;t++)(L[e][t].isLight||L[e][t].isDiagramless)&&("1"==L[e][t].currentLetter?L[e][t].textNode.nodeValue=Y:L[e][t].textNode.nodeValue=L[e][t].currentLetter,L[e][t].currentLetter);return Xe(),t}function Ze(){te.style.display="none";for(let e of q){let t=L[e[0]][e[1]].cellRect;L[e[0]][e[1]].colour?t.style.fill=L[e[0]][e[1]].colour:t.style.fill="white"}for(let e of Z)e.style.background="white";q=[],Z=[],X=null,de.innerHTML="",de.style.background="transparent",de.style.top="0",me.disabled=!0,ye.disabled=!0,Le.disabled=!0}function Fe(){const e=ne.getBoundingClientRect();if(e.top<0)return;let t=_e();if(!t||t<=0)return;if(e.bottom>=t)return void(de.style.top="0");de.getBoundingClientRect().top;const n=fe.getBoundingClientRect().top;de.style.top=n>=0?"0":0-n+"px"}function je(e,t){if(Ze(),M=e,O=t,e<0||e>=i||t<0||t>=l)return;if(!L[e][t].isLight&&!L[e][t].isDiagramless)return;if(te.style.width="31px",te.style.height="31px",te.style.left=L[e][t].cellLeft+"px",te.style.top=L[e][t].cellTop+"px",ne.value=L[e][t].prefill?"":L[e][t].currentLetter,te.style.display="",ne.focus(),ne.setSelectionRange){let e=ne.value.length;ne.setSelectionRange(e,e)}let n="",r="";if(V&&!L[e][t].isDiagramless&&!L[e][t].acrossClueLabel&&L[e][t].downClueLabel&&(V=!1),V||L[e][t].isDiagramless||L[e][t].downClueLabel||!L[e][t].acrossClueLabel||(V=!0),V?L[e][t].acrossClueLabel&&(r=L[e][t].acrossClueLabel,n="A"+r):L[e][t].downClueLabel&&(r=L[e][t].downClueLabel,n="D"+r),""!=n&&!A[n]){if(activeCluwIndex="",T[r])for(let e of T[r])if("X"==e.charAt(0)||e.charAt(0)==n.charAt(0)){n=e;break}A[n]||(n="")}me.disabled=!1,ye.disabled=!1,Le.disabled=I,n&&A[n]?Qe(n):(et(),L[e][t].cellRect.style.fill=_,q.push([e,t]))}function Ge(e,t){return function(){je(e,t)}}function Ye(e,t,n){return function(){V="A"==n,je(e,t)}}function _e(){return window.innerHeight&&document.documentElement.clientHeight?Math.min(window.innerHeight,document.documentElement.clientHeight):window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight}function Je(e){const t=e.getBoundingClientRect();if(t.bottom<0)return!1;let n=_e();return!(!n||n<=0||t.top>=n)}function Ke(e){let t=[e];if(A[e].parentClueIndex){let n=A[e].parentClueIndex;t=[n].concat(A[n].childrenClueIndices)}else A[e].childrenClueIndices&&(t=t.concat(A[e].childrenClueIndices));return t}function We(e){return function(){Ze(),Qe(e)}}function Qe(e){let t=Ke(e),n=t[0];for(let e of t){A[e].anno&&(Le.disabled=!1);for(let t of A[e].cells)L[t[0]][t[1]].cellRect.style.fill=_,q.push(t);A[e].clueTR&&(A[e].clueTR.style.background=_,ke>0&&Je(A[e].clueTR.parentElement)&&(A[e].clueTR.scrollIntoView(),ne.scrollIntoView()),Z.push(A[e].clueTR))}const l=A[n];l&&l.clue?(X=e,de.innerHTML=l.fullDisplayLabel+l.clue,de.style.background=_,Fe()):et()}function et(){if(0>=G.length)return;let e=G[0],t=A[e].fullDisplayLabel+A[e].clue;if(A[e].parentClueIndex){let n=A[e].parentClueIndex;t=A[n].fullDisplayLabel+A[n].clue}de.innerHTML='<span><button class="small-button" onclick="Puzzle.getInstance(\'${puzzlePrefix}\').orphanCluesBrowse(-1)">&lsaquo;</button><span title="You have to figure out which clue to use"> CLUES </span><button class="small-button" onclick="Puzzle.getInstance(\'${puzzlePrefix}\').orphanCluesBrowse(1)">&rsaquo;</button></span> '+t,de.style.background="white",Fe()}function tt(){M<0||M>=i||O<0||O>=l||(L[M][O].acrossClueLabel&&L[M][O].downClueLabel||L[M][O].isDiagramless)&&(V=!V,je(M,O))}function nt(e){if(!(M<0||M>=i||O<0||O>=l)){if(8==e){if(""!=L[M][O].currentLetter&&!L[M][O].prefill)return;e=V?37:38}if(13==e)tt();else if(39==e){let e=O+1;for(;e<l&&!L[M][e].isLight&&!L[M][e].isDiagramless;)e++;e<l&&je(M,e)}else if(37==e){let e=O-1;for(;e>=0&&!L[M][e].isLight&&!L[M][e].isDiagramless;)e--;e>=0&&je(M,e)}else if(40==e){let e=M+1;for(;e<i&&!L[e][O].isLight&&!L[e][O].isDiagramless;)e++;e<i&&je(e,O)}else if(38==e){let e=M-1;for(;e>=0&&!L[e][O].isLight&&!L[e][O].isDiagramless;)e--;e>=0&&je(e,O)}else if(221==e){if(X&&A[X]&&A[X].next){let e=A[X].next,t=A[e].cells;t&&t.length>0&&je(t[0][0],t[0][1])}}else if(219==e&&X&&A[X]&&A[X].prev){let e=A[X].prev,t=A[e].cells;t&&t.length>0&&je(t[0][0],t[0][1])}}}function lt(){let e="successor"+(V?"A":"D");if(L[M][O][e]){let t=L[M][O][e];return V="A"==t.direction,void je(t.cell[0],t.cell[1])}V?O+1<l&&L[M][O+1].acrossClueLabel==L[M][O].acrossClueLabel&&nt(39):M+1<i&&L[M+1][O].downClueLabel==L[M][O].downClueLabel&&nt(40)}function it(){if(M<0||M>=i||O<0||O>=l)return;if(!L[M][O].isLight&&!L[M][O].isDiagramless)return;if(L[M][O].prefill)return ne.value="",void lt();let e=ne.value;""!=L[M][O].currentLetter&&e!=L[M][O].currentLetter&&0==e.indexOf(L[M][O].currentLetter)&&(e=e.substr(1));let t=e.substr(0,1);" "==t&&L[M][O].isDiagramless?t=Y:(t=t.toUpperCase(),(t<"A"||t>"Z")&&(t=""));let n=t;n==Y&&(n="1");let r=L[M][O].currentLetter;if(L[M][O].currentLetter=n,L[M][O].textNode.nodeValue=t,ne.value=t,"1"==r||"1"==n){let e=i-1-M,t=l-1-O;if(L[e][t].isDiagramless){let l="1"==n?"1":"",i="1"==n?Y:"";L[e][t].currentLetter=l,L[e][t].textNode.nodeValue=i}}Xe(),(n>="A"&&n<="Z"||"1"==n)&&!L[M][O].isDiagramless&&lt()}function rt(){for(const e of w)e.element.style.backgroundColor=e.colour;pe.style.display="",ve.innerHTML="Hide ninas",v=!0}function st(){for(const e of w)e.element.style.backgroundColor="transparent";pe.style.display="none",ve.innerHTML="Show ninas",v=!1}function ot(e,t){let n=L[e][t].currentLetter;if(""!=n&&(L[e][t].currentLetter="",L[e][t].textNode.nodeValue="",e==M&&t==O&&(ne.value="")),"1"==n){let n=i-1-e,r=l-1-t;L[n][r].isDiagramless&&(L[n][r].currentLetter="",L[n][r].textNode.nodeValue="")}}function ut(e){if(!A[e]||!A[e].cells||A[e].cells.length<1)return!1;for(let t of A[e].cells){let e=t[0],n=t[1];if(!L[e][n].prefill&&""==L[e][n].currentLetter)return!1}return!0}function at(){for(let e of q){let t=e[0],n=e[1];if(L[t][n].prefill)continue;let r=L[t][n].currentLetter,s=L[t][n].solution;if(s&&r!=s){L[t][n].currentLetter=s;let e=s;"1"==e&&(e=Y),L[t][n].textNode.nodeValue=e,t==M&&n==O&&(ne.value=e)}if("1"==r||"1"==s){let e=i-1-t,r=l-1-n;if(L[e][r].isDiagramless){let t="1"==s?"1":"",n="1"==s?Y:"";L[e][r].currentLetter=t,L[e][r].textNode.nodeValue=n}}}if(X){let e=Ke(X);for(let t of e)A[t].annoSpan&&(A[t].annoSpan.style.display="")}Xe()}function ct(){if(confirm("Are you sure you want to reveal the whole solution!?")){for(let e=0;e<i;e++)for(let t=0;t<i;t++)if((L[e][t].isLight||L[e][t].isDiagramless)&&!L[e][t].prefill&&L[e][t].currentLetter!=L[e][t].solution){L[e][t].currentLetter=L[e][t].solution;let n=L[e][t].solution;"1"==n&&(n=Y),L[e][t].textNode.nodeValue=n,e==M&&t==O&&(ne.value=n)}for(let e of H)e.ans&&(e.input.value=e.ans);for(let e of P)e.style.display="";rt(),Xe()}}this.setState=qe,this.showNinas=rt.bind(this),this.hideNinas=st.bind(this),this.toggleNinas=function(){if(v)st();else{if(!confirm("Are you sure you want to reveal the nina(s)!?"))return;rt()}}.bind(this),this.clearCurrent=function(){let e=[];if(X){e=Ke(X);for(let t of e)A[t].annoSpan&&(A[t].annoSpan.style.display="none")}let t=[],n=[];for(let l of q){let i=l[0],r=l[1];if(!L[i][r].prefill&&""!=L[i][r].currentLetter)if(L[i][r].acrossClueLabel&&L[i][r].downClueLabel){let l="A"+L[i][r].acrossClueLabel,s="D"+L[i][r].downClueLabel,o="";e.includes(l)&&!e.includes(s)?o=s:!e.includes(l)&&e.includes(s)&&(o=l),o&&ut(o)?t.push([i,r]):n.push([i,r])}else n.push([i,r])}for(let e of n)ot(e[0],e[1]);if(0==n.length)for(let e of t)ot(e[0],e[1]);Xe()}.bind(this),this.clearAll=function(){if(confirm("Are you sure you want to clear the whole grid!?")){for(let e=0;e<i;e++)for(let t=0;t<l;t++)(L[e][t].isLight||L[e][t].isDiagramless)&&(L[e][t].prefill||(L[e][t].currentLetter="",L[e][t].textNode.nodeValue="",e==M&&t==O&&(ne.value="")));for(let e of H)e.input.value="";for(let e of P)e.style.display="none";st(),Xe()}}.bind(this),this.checkCurrent=function(){let e=!0;for(let t of q){let n=t[0],r=t[1],s=L[n][r].currentLetter;if(s!=L[n][r].solution&&(e=!1,L[n][r].currentLetter="",L[n][r].textNode.nodeValue="",n==M&&r==O&&(ne.value=""),"1"==s)){let e=i-1-n,t=l-1-r;L[e][t].isDiagramless&&(L[e][t].currentLetter="",L[e][t].textNode.nodeValue="")}}e?at():Xe()}.bind(this),this.checkAll=function(){if(!confirm("Are you sure you want to clear mistakes everywhere!?"))return;let e=!0;for(let t=0;t<i;t++)for(let n=0;n<l;n++)(L[t][n].isLight||L[t][n].isDiagramless)&&L[t][n].currentLetter!=L[t][n].solution&&(e=!1,L[t][n].currentLetter="",L[t][n].textNode.nodeValue="",t==M&&n==O&&(ne.value=""));e?ct():Xe()}.bind(this),this.revealCurrent=at.bind(this),this.revealAll=ct.bind(this),this.toggleShowControls=function(){let e=document.getElementById(t+"control-keys-list");"none"==e.style.display?e.style.display="":e.style.display="none"}.bind(this),this.createPuzzle=function(e){!function(e){W=[];let n=e.trim().split("\n");for(let e of n){let t=e.indexOf("#");for(;t>=0&&t+1<e.length&&" "!=e.charAt(t+1);)t=e.indexOf("#",t+1);t>=0&&(e=e.substr(0,t).trim()),e&&W.push(e)}Q=W.length,ee=document.getElementById(t+"grid"),te=document.getElementById(t+"grid-input-wrapper"),ne=document.getElementById(t+"grid-input"),le=document.getElementById(t+"questions"),ie=document.createElementNS("http://www.w3.org/2000/svg","rect"),ue=document.getElementById(t+"across-clues-panel"),ae=document.getElementById(t+"down-clues-panel"),ce=document.getElementById(t+"nodir-clues-panel"),re=document.getElementById(t+"across"),se=document.getElementById(t+"down"),oe=document.getElementById(t+"nodir"),de=document.getElementById(t+"current-clue"),fe=document.getElementById(t+"current-clue-parent"),pe=document.getElementById(t+"nina-group"),he=document.getElementById(t+"status-num-filled"),be=document.getElementById(t+"status-num-total"),ge=document.getElementById(t+"saving-url"),me=document.getElementById(t+"clear"),xe=document.getElementById(t+"clear-all"),ye=document.getElementById(t+"check"),we=document.getElementById(t+"check-all"),ve=document.getElementById(t+"ninas"),Le=document.getElementById(t+"reveal"),Ae=document.getElementById(t+"reveal-all"),Ce=document.getElementById(t+"submit");let l="Version: "+VERSION+", User Agent: "+navigator.userAgent;document.getElementById(t+"report-bug").href="https://github.com/viresh-ratnakar/exolve/issues/new?body="+encodeURIComponent(l)}(e),function(){let e=Ee();for(;e&&"end"!=e.section;){let y=J,w=Ee(),v=J-2;"begin"==e.section||("id"==e.section?n=e.value:"title"==e.section?document.getElementById(t+"title").innerHTML=e.value:"setter"==e.section?""!=e.value.trim()&&(document.getElementById(t+"setter").innerHTML="By "+e.value):"copyright"==e.section?document.getElementById(t+"copyright").innerHTML="Ⓒ "+e.value:"width"==e.section?(l=parseInt(e.value),r=R*l+l+1):"height"==e.section?(i=parseInt(e.value),s=R*i+i+1):"prelude"==e.section?(a=y,c=v):"grid"==e.section?(o=y,u=v):"nina"==e.section?Ie(e.value):"colour"==e.section||"color"==e.section?Se(e.value):"question"==e.section?$e(e.value):"submit"==e.section?De(e.value):"across"==e.section?(d=y,f=v):"down"==e.section?(p=y,h=v):"nodir"==e.section?(b=y,g=v):"option"==e.section?ze(e.value):"explanations"==e.section&&(m=y,x=v)),e=w}}(),function(){if(a>=0&&a<=c){let e=W[a],n=a+1;for(;n<=c;)e=e+"\n"+W[n],n++;document.getElementById(t+"prelude").innerHTML=e}}(),function(){if(m>=0&&m<=x){let e=W[m],n=m+1;for(;n<=x;)e=e+"\n"+W[n],n++;const l=document.getElementById(t+"explanations");l.innerHTML=e,P.push(l)}}(),function(){if(n.match(/[^a-zA-Z\d-]/))Be("Puzzle id should only have alphanumeric characters or -: "+n);else if(l<1||l>25||i<1||i>25)Be("Bad/missing width/height");else if(o<0||u<o||i!=u-o+1)Be("Mismatched width/height");else{for(let e=0;e<i;e++){let t=W[e+o].toUpperCase().replace(/[^A-Z.0]/g,"").length;if(l!=t)return void Be("Width in row "+e+" is "+t+", not "+l)}N&&k.length!=H.length+1&&Be("Have "+k.length+" submit paramater keys, need "+(H.length+1))}}(),function(){let e=!1;for(let t=0;t<i;t++){L[t]=new Array(l);let n=W[t+o].replace(/\s/g,"").toUpperCase(),i=0;for(let r=0;r<l;r++){L[t][r]={};let s=n.charAt(i);if("."!=s){if(L[t][r].isLight=!0,"0"!=s){if(s=s.toUpperCase(),s<"A"||s>"Z")return Be("Bad grid entry: "+s),void(l=0);L[t][r].solution=s}}else L[t][r].isLight=!1;L[t][r].hasBarAfter=!1,L[t][r].hasBarUnder=!1,L[t][r].hasCircle=!1,L[t][r].isDiagramless=!1,L[t][r].prefill=!1,i++;let o="";for(;i<n.length&&(o=n.charAt(i))&&("|"==o||"_"==o||"+"==o||"@"==o||"*"==o||"!"==o||" "==o);){if("|"==o)L[t][r].hasBarAfter=!0;else if("_"==o)L[t][r].hasBarUnder=!0;else if("+"==o)L[t][r].hasBarAfter=!0,L[t][r].hasBarUnder=!0;else if("@"==o)L[t][r].hasCircle=!0;else if("*"==o)L[t][r].isDiagramless=!0;else if("!"==o)L[t][r].prefill=!0;else if(" "!=o)return void Be("Should not happen! thisChar = "+o);i++}if(L[t][r].isDiagramless&&"."==s&&(L[t][r].solution="1"),L[t][r].prefill&&(!L[t][r].isLight||s<"A"||s>"Z"))return void Be("Bad pre-filled cell ("+t+","+r+") with letter: "+s);L[t][r].isDiagramless&&(E=!0),"0"==s&&(I=!0),s>="A"&&s<="Z"&&!L[t][r].prefill&&(e=!0)}}I&&e&&Be("Either all or no solutions should be provided")}(),function(){if(E&&I)return;let e=1;for(let t=0;t<i;t++)for(let n=0;n<l;n++)Te(t,n)&&(L[t][n].startsAcrossClue=!0,L[t][n].startsClueLabel=""+e,A["A"+e]={cells:[]}),Re(t,n)&&(L[t][n].startsDownClue=!0,L[t][n].startsClueLabel=""+e,A["D"+e]={cells:[]}),L[t][n].startsClueLabel&&e++}(),function(){for(let e of["A","D","X"]){let t,n;if("A"==e?(t=d,n=f):"D"==e?(t=p,n=h):(t=b,n=g),t<0||n<t)continue;let l=null,i="";for(let r=t;r<=n;r++){let t=W[r].trim();if(""==t)continue;let n=Oe(e,t);if(n.error)return void Be("Clue parsing error in: "+t+": "+n.error);if(n.isFiller)i=i+t+"\n";else{if(!n.clueIndex)return void Be("Could not parse clue: "+t);if(A[n.clueIndex]&&A[n.clueIndex].clue)return void Be("Clue entry already exists for clue: "+t);if(A[n.clueIndex]||(A[n.clueIndex]={cells:[]}),A[n.clueIndex].clue=n.clue,A[n.clueIndex].clueLabel=n.clueLabel,A[n.clueIndex].isNonNum=n.isNonNum,A[n.clueIndex].displayLabel=n.clueLabel,A[n.clueIndex].clueDirection=e,A[n.clueIndex].fullDisplayLabel=n.clueLabel,"X"!=e&&n.clueLabel&&(A[n.clueIndex].fullDisplayLabel=A[n.clueIndex].fullDisplayLabel+e.toLowerCase()),A[n.clueIndex].children=n.children,A[n.clueIndex].childrenClueIndices=[],A[n.clueIndex].len=n.len,A[n.clueIndex].hyphenAfter=n.hyphenAfter,A[n.clueIndex].wordEndAfter=n.wordEndAfter,A[n.clueIndex].anno=n.anno,n.anno&&(S=!0),n.startCell){let t=n.startCell[0],l=n.startCell[1];L[t][l].startsClueLabel=n.clueLabel,L[t][l].forcedClueLabel=!0,"A"==e?L[t][l].startsAcrossClue=!0:"D"==e&&(L[t][l].startsDownClue=!0)}A[n.clueIndex].prev=l,A[n.clueIndex].next=null,l&&(A[l].next=n.clueIndex),l=n.clueIndex,i&&(A[n.clueIndex].filler=i,i=""),n.clue&&j.push(n.clueIndex)}}if(i)return void Be("Filler line should not be at the end: "+i)}}(),function(){for(let e=0;e<i;e++){let t="";for(let n=0;n<l;n++){if(L[e][n].startsAcrossClue&&(t=L[e][n].startsClueLabel),!t)continue;if(!L[e][n].isLight||L[e][n].isDiagramless){t="";continue}if(!L[e][n].startsAcrossClue&&n>0&&L[e][n-1].hasBarAfter){t="";continue}L[e][n].acrossClueLabel=t;let l="A"+t;if(A[l]||(l="X"+t),!A[l]){if(!T[t]){t="";continue}for(ci of(l="",T[t]))if("A"==ci.charAt(0)||"X"==ci.charAt(0)){l=ci;break}if(!l){t="";continue}}A[l].cells.push([e,n])}}for(let e=0;e<l;e++){let t="";for(let n=0;n<i;n++){if(L[n][e].startsDownClue&&(t=L[n][e].startsClueLabel),!t)continue;if(!L[n][e].isLight||L[n][e].isDiagramless){t="";continue}if(!L[n][e].startsDownClue&&n>0&&L[n-1][e].hasBarUnder){t="";continue}L[n][e].downClueLabel=t;let l="D"+t;if(A[l]||(l="X"+t),!A[l]){if(!T[t]){t="";continue}for(ci of(l="",T[t]))if("D"==ci.charAt(0)||"X"==ci.charAt(0)){l=ci;break}if(!l){t="";continue}}A[l].cells.push([n,e])}}for(let e of j)A[e].cells&&A[e].len&&A[e].cells.length||G.push(e)}(),function(){for(let e of j){let t=A[e];if(!t.children)continue;let n=null;t.cells.length>0&&(n=t.cells[t.cells.length-1],(!t.len||t.len<=0)&&(n=null));let l=t.clueDirection;const i={},r=["A","D","X"];for(let s of t.children){if(s.error)return void Be("Bad child "+s+" in "+t.cluelabel+t.clueDirection);let o=t.clueDirection+s.clueLabel;if(s.isNonNum){if(!T[s.clueLabel]||T[s.clueLabel].length<1)return void Be("non-num child label "+s.clueLabel+" was not seen");o=T[s.clueLabel][0]}else{if(!A[o])for(let e of r)if(e!=t.clueDirection&&(o=e+s.clueLabel,A[o]))break;s.dir&&(o=s.dir+s.clueLabel)}if(!A[o]||o==e)return void Be("Invalid child "+o+" in "+t.cluelabel+t.clueDirection);if(i[o])return void Be("Duplicate child "+o+" in "+t.cluelabel+t.clueDirection);i[o]=!0,s.clueLabel&&(t.displayLabel=t.displayLabel+", "+s.clueLabel,s.dir&&s.dir!=t.clueDirection&&(t.displayLabel=t.displayLabel+s.dir.toLowerCase()),t.fullDisplayLabel=t.fullDisplayLabel+", "+s.clueLabel,"X"!=o.charAt(0)&&(t.fullDisplayLabel=t.fullDisplayLabel+o.charAt(0).toLowerCase())),t.childrenClueIndices.push(o);let u=A[o];if(u.parentClueIndex=e,n&&u.cells.length>0){let e=u.cells[0];if(n[0]==e[0]&&n[1]==e[1])return void Be("loop in successor for "+n);L[n[0]][n[1]]["successor"+l]={cell:e,direction:u.clueDirection}}n=null,u.cells.length>0&&(n=u.cells[u.cells.length-1],(!u.len||u.len<=0)&&(n=null)),l=u.clueDirection}if(E)continue;let s=t.cells.length,o=0;for(;o<t.wordEndAfter.length&&t.wordEndAfter[o]<s;)o++;let u=0;for(;u<t.hyphenAfter.length&&t.hyphenAfter[u]<s;)u++;for(let e of t.childrenClueIndices){let n=A[e].cells.length;for(;o<t.wordEndAfter.length&&t.wordEndAfter[o]<s+n;){let n=t.wordEndAfter[o]-s;A[e].wordEndAfter.push(n),o++}for(;u<t.hyphenAfter.length&&t.hyphenAfter[u]<s+n;){let n=t.hyphenAfter[u]-s;A[e].hyphenAfter.push(n),u++}s+=n}}}(),function(){for(let e of j)A[e].fullDisplayLabel&&(A[e].fullDisplayLabel=A[e].fullDisplayLabel+". ")}(),function(){if(!E){for(let e=0;e<i;e++){let t="",n="",i=-1;for(let r=0;r<l;r++)if(L[e][r].acrossClueLabel){if(t==L[e][r].acrossClueLabel)i++;else{if(t=L[e][r].acrossClueLabel,i=0,n="A"+t,!A[n]){if(!T[t]){t="",n="",i=-1;continue}for(ci of T[t])if("A"==ci.charAt(0)||"X"==ci.charAt(0)){n=ci;break}}if(!A[n]||!A[n].clue){t="",n="",i=-1;continue}}for(let t of A[n].wordEndAfter)if(i==t&&r<l-1){L[e][r].wordEndToRight=!0;break}for(let t of A[n].hyphenAfter)if(i==t&&r<l-1){L[e][r].hyphenToRight=!0;break}}else t="",n="",i=-1}for(let e=0;e<l;e++){let t="",n="",l=-1;for(let r=0;r<i;r++)if(L[r][e].downClueLabel){if(t==L[r][e].downClueLabel)l++;else{if(t=L[r][e].downClueLabel,l=0,n="D"+t,!A[n]){if(!T[t]){t="",n="",l=-1;continue}for(ci of T[t])if("D"==ci.charAt(0)||"X"==ci.charAt(0)){n=ci;break}}if(!A[n]||!A[n].clue){t="",n="",l=-1;continue}}for(let t of A[n].wordEndAfter)if(l==t&&r<i-1){L[r][e].wordEndBelow=!0;break}for(let t of A[n].hyphenAfter)if(l==t&&r<i-1){L[r][e].hyphenBelow=!0;break}}else t="",n="",l=-1}}}(),function(){for(let e of j){if(!A[e].clue&&!A[e].parentClueIndex)return void Be("Found no clue text nor a parent clue for "+e);let t=null;if("A"==A[e].clueDirection)t=re,$=!0;else if("D"==A[e].clueDirection)t=se,D=!0;else{if("X"!=A[e].clueDirection)return void Be("Unexpected clue direction "+A[e].clueDirection+" in "+e);t=oe,z=!0}if(A[e].filler){let n=document.createElement("tr"),l=document.createElement("td");l.setAttributeNS(null,"colspan","2"),l.setAttributeNS(null,"class","filler"),l.innerHTML=A[e].filler,n.appendChild(l),t.appendChild(n)}let n=document.createElement("tr"),l=document.createElement("td");l.innerHTML=`<div class="clue-label">${A[e].displayLabel}</div>`;let i=document.createElement("td");if(i.innerHTML=A[e].clue,A[e].clue.indexOf("<")>=0&&(A[e].clue=Ve(A[e].clue)),A[e].anno){let t=document.createElement("span");t.setAttributeNS(null,"class","anno-text"),t.innerHTML=" "+A[e].anno,t.style.display="none",P.push(t),i.appendChild(t),A[e].annoSpan=t}if(n.appendChild(l),n.appendChild(i),A[e].cells.length>0){let t=A[e].cells[0][0],l=A[e].cells[0][1];n.addEventListener("click",Ye(t,l,A[e].clueDirection))}else n.addEventListener("click",We(e));A[e].clueTR=n,t.appendChild(n)}if(ke>0){const e=1.4*ke+"em";ue.style.height=e,ae.style.height=e,ce&&(ce.style.height=e)}$&&(ue.style.display=""),D&&(ae.style.display=""),z&&(ce.style.display="")}(),ee.setAttributeNS(null,"viewBox","0 0 "+r+" "+s),ee.setAttributeNS(null,"width",r),ee.setAttributeNS(null,"height",s),ie.setAttributeNS(null,"x",0),ie.setAttributeNS(null,"y",0),ie.setAttributeNS(null,"width",r),ie.setAttributeNS(null,"height",s),ie.setAttributeNS(null,"class","background"),ee.appendChild(ie),ne.addEventListener("keyup",function(e){!function(e){nt(e.which||e.keyCode)}(e)}),ne.addEventListener("keydown",function(e){!function(e){let t=e.which||e.keyCode;9==t&&(e.preventDefault(),t=e.shiftKey?219:221,nt(t))}(e)}),ne.addEventListener("input",it),ne.addEventListener("click",tt),ie.addEventListener("click",Ge(-1,-1)),document.getElementById(t+"title").addEventListener("click",Ge(-1,-1)),window.addEventListener("scroll",Fe),function(){F=0;for(let e=0;e<i;e++)for(let t=0;t<l;t++){const n=document.createElementNS("http://www.w3.org/2000/svg","g");if(L[e][t].isLight||L[e][t].isDiagramless){F++;const l=document.createElementNS("http://www.w3.org/2000/svg","rect"),i=1+32*t,r=1+32*e;l.setAttributeNS(null,"x",1+32*t),l.setAttributeNS(null,"y",1+32*e),l.setAttributeNS(null,"width",R),l.setAttributeNS(null,"height",R),l.setAttributeNS(null,"class","cell"),n.appendChild(l);const s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttributeNS(null,"x",16.5+32*t),s.setAttributeNS(null,"y",21.925+32*e),s.setAttributeNS(null,"text-anchor","middle"),s.setAttributeNS(null,"editable","simple");let o="",u="cell-text";L[e][t].prefill&&(o=L[e][t].solution,u="cell-text prefill"),s.setAttributeNS(null,"class",u);const a=document.createTextNode(o);s.appendChild(a),n.appendChild(s),L[e][t].currentLetter=o,L[e][t].textNode=a,L[e][t].cellText=s,L[e][t].cellRect=l,L[e][t].cellLeft=i,L[e][t].cellTop=r,s.addEventListener("click",Ge(e,t)),l.addEventListener("click",Ge(e,t))}if(L[e][t].hasCircle){const l=document.createElementNS("http://www.w3.org/2000/svg","circle");l.setAttributeNS(null,"cx",16.5+32*t),l.setAttributeNS(null,"cy",16.5+32*e),l.setAttributeNS(null,"r",15.5),l.setAttributeNS(null,"stroke","gray"),l.setAttributeNS(null,"fill","rgba(255,255,255,0.0)"),n.appendChild(l),l.addEventListener("click",Ge(e,t))}if(L[e][t].startsClueLabel&&!L[e][t].isDiagramless&&(!Ne||L[e][t].forcedClueLabel)){const l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttributeNS(null,"x",2+32*t),l.setAttributeNS(null,"y",10+32*e),l.setAttributeNS(null,"class","cell-num");const i=document.createTextNode(L[e][t].startsClueLabel);l.appendChild(i),n.appendChild(l)}ee.appendChild(n)}for(let e of C){let t=e[0],n=e[1],l=e[2];L[t][n].colour=l,L[t][n].cellRect.style.fill=l}for(let e=0;e<i;e++)for(let t=0;t<l;t++){const n=document.createElementNS("http://www.w3.org/2000/svg","g");let l=!0;if(L[e][t].wordEndToRight){const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttributeNS(null,"x",1+32*(t+1)-U),i.setAttributeNS(null,"y",1+32*e),i.setAttributeNS(null,"width",2),i.setAttributeNS(null,"height",R),i.setAttributeNS(null,"class","wordend"),n.appendChild(i),l=!1}if(L[e][t].wordEndBelow){const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttributeNS(null,"x",1+32*t),i.setAttributeNS(null,"y",1+32*(e+1)-U),i.setAttributeNS(null,"width",R),i.setAttributeNS(null,"height",2),i.setAttributeNS(null,"class","wordend"),n.appendChild(i),l=!1}if(L[e][t].hyphenToRight){const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttributeNS(null,"x",1+32*(t+1)-5),i.setAttributeNS(null,"y",1+32*e+16-U),i.setAttributeNS(null,"width",9),i.setAttributeNS(null,"height",2),i.setAttributeNS(null,"class","wordend"),n.appendChild(i),l=!1}if(L[e][t].hyphenBelow){const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttributeNS(null,"x",1+32*t+16-U),i.setAttributeNS(null,"y",1+32*(e+1)-5),i.setAttributeNS(null,"width",2),i.setAttributeNS(null,"height",9),i.setAttributeNS(null,"class","wordend"),n.appendChild(i),l=!1}if(L[e][t].hasBarAfter){const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttributeNS(null,"x",1+32*(t+1)-2),i.setAttributeNS(null,"y",1+32*e),i.setAttributeNS(null,"width",3),i.setAttributeNS(null,"height",R),i.setAttributeNS(null,"class","background"),n.appendChild(i),l=!1}if(L[e][t].hasBarUnder){const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttributeNS(null,"x",1+32*t),i.setAttributeNS(null,"y",1+32*(e+1)-2),i.setAttributeNS(null,"width",R),i.setAttributeNS(null,"height",3),i.setAttributeNS(null,"class","background"),n.appendChild(i),l=!1}l||ee.appendChild(n)}be.innerHTML=F}(),function(){const e=["rgba(0,0,255,0.2)","rgba(0,255,0,0.2)","rgba(0,255,255,0.2)","rgba(255,0,255,0.2)","rgba(255,255,0,0.2)","rgba(255,50,50,0.2)","rgba(50,255,50,0.2)","rgba(50,50,255,0.2)","rgba(50,200,200,0.2)","rgba(200,50,200,0.2)","rgba(200,200,50,0.2)"];let t=0;for(let n of y){for(let l of n){if(!Array.isArray(l)){const n=document.getElementsByClassName(l);if(!n||0==n.length)return void Be("Nina "+l+" is not a cell location nor a class with html tags");for(const l of n)w.push({element:l,colour:e[t]});continue}const n=l[0],i=l[1],r=document.createElement("div");r.style.left=L[n][i].cellLeft+"px",r.style.top=L[n][i].cellTop+"px",r.style.width="31px",r.style.height="31px",r.style.backgroundColor=e[t],r.setAttributeNS(null,"class","nina"),r.addEventListener("click",Ge(n,i)),pe.appendChild(r)}t=(t+1)%e.length}}(),me.disabled=!0,I||(ye.style.display="",we.style.display="",Ae.style.display="",ye.disabled=!0,Ce.disabled=!0),I&&!S||(Le.style.display="",Le.disabled=!0),y.length>0&&(ve.style.display=""),N&&(Ce.style.display=""),function(){let e=decodeURIComponent(location.hash.substr(1)),t=e.split("?"),l=!1;for(const i in t){const r=t[i];if(0===r.indexOf("exolve-")){l=!0;const t=r.indexOf("=");if(r.slice(7,t)===n){e=r.slice(t+1);break}}}if(l||(e=""),!e){let t=n+"=",l=decodeURIComponent(document.cookie).split(";");for(let n=0;n<l.length;n++){let i=l[n];for(;" "==i.charAt(0);)i=i.substring(1);0==i.indexOf(t)&&(e=i.substring(t.length,i.length))}}qe(e)}(),"function"==typeof customizePuzzle&&customizePuzzle()}.bind(this),this.getCSS=function(){return`\n/*\nMIT License\n\nCopyright (c) 2019 Viresh Ratnakar\n\nSee the full license notice in exolve-m.js.\n\nVersion: Exolve v0.36 October 22 2019\n*/\n\n.background {\n  fill: black;\n}\n.cell {\n  fill: white;\n  cursor: pointer;\n}\n.cell-num {\n  font-size: 9px;\n  font-family: sans-serif;\n}\n.cell-text {\n  font-size: 16px;\n  font-family: sans-serif;\n  cursor: text;\n}\n.prefill {\n  fill: blue;\n}\n.wordend {\n  fill: rgb(0,0,255);\n}\ntable {\n  border-collapse: collapse;\n  border-spacing: 0;\n}\ntd {\n  padding: 4px 6px 0 0;\n  vertical-align: top;\n}\ntd:first-child:not(.filler) {\n  max-width: 45px;\n  font-weight: bold;\n}\n.anno-text {\n  font-style: italic;\n  color: darkgreen;\n}\n.flex-row {\n  display: flex;\n  flex-flow: row wrap;\n  align-items: flex-start;\n}\n.flex-col {\n  display: flex;\n  flex-flow: column wrap;\n}\n.wide-box {\n  width: 481px;\n}\n#${t}title {\n  text-align: center;\n  font-weight: bold;\n}\n#${t}setter {\n  text-align: center;\n  color: darkgreen;\n  margin: 0 0 8px 0;\n}\n#${t}prelude {\n  margin: 8px 8px 0 8px;\n  padding: 0;\n}\n#${t}small-print {\n  font-size: small;\n  margin: 0 0 4px 0;\n}\n#${t}small-print > a {\n  padding: 0 4px 0 0;\n}\n#${t}errors {\n  font-weight: bold;\n  color: red;\n}\n#${t}current-clue-parent {\n  height: 40px;\n  width: 100%;\n  position:relative;\n  margin: 8px 8px 8px 0;\n}\n#${t}current-clue {\n  position: absolute;\n  z-index: 2;\n  word-wrap: break-word;\n  font-weight: bold;\n  margin: 0 0 0 8px;\n  padding: 4px 4px 4px 0;\n}\n#${t}grid-panel {\n  margin: 0 8px 0 8px;\n}\n#${t}grid-parent-centerer {\n  text-align: center;\n}\n#${t}grid-parent {\n  position: relative;\n  margin: 0 20px 0 0;\n  display: inline-block;\n}\n#${t}grid-input-wrapper {\n  position: absolute;\n  border: none;\n  border-width:0;\n}\n#${t}grid-input {\n  text-align: center;\n  text-anchor: middle;\n  border: 0;\n  width: 100%;\n  height: 100%;\n  padding: 0;\n  background: rgba(255,255,255,0.0);\n}\n#${t}controls-etc {\n  padding: 8px 0 6px 0;\n}\n.controls-row {\n  margin: 6px 0 6px 0;\n}\n#${t}clues {\n  max-width: 940px;\n}\n.clues-box {\n  width: 45%;\n  font-size: 0.9em;\n  margin: 0 auto 20px auto;\n  overflow-y: auto;\n}\n#${t}explanations {\n  margin: 10px 0 0 0;\n}\nhr {\n  margin: 0 0 4px 0;\n  background-color: lightgreen;\n}\n.button {\n  background-color: #4CAF50; /* Green */\n  border: none;\n  outline: none;\n  color: white;\n  padding: 8px 8px;\n  text-align: center;\n  text-decoration: none;\n  display: inline-block;\n  border-radius: 12px;\n  font-family: monospace;\n  font-size: 14px;\n}\n.button:hover {\n  background-color: darkgreen;\n  cursor: pointer;\n}\n.button:disabled {\n  background-color: gray;\n  cursor: not-allowed;\n}\n.small-button {\n  background-color: mistyrose;\n  border: 1px solid lightpink;\n  outline: none;\n  padding: 4px 8px;\n  text-align: center;\n  text-decoration: none;\n  display: inline-block;\n  border-radius: 4px;\n  font-family: monospace;\n  font-weight: bold;\n  font-size: 14px;\n}\n.small-button:hover {\n  background-color: lightpink;\n  cursor: pointer;\n}\n#${t}nina-group {\n  position: absolute;\n  border: none;\n  border-width:0;\n  outline: none;\n}\n.nina {\n  position: absolute;\n  border: none;\n  border-width:0;\n  outline: none;\n  cursor: pointer;\n}\n#status {\n  font-family: monospace;\n  font-size: 12px;\n  margin: 6px 0 6px 0;\n  color: darkgreen;\n}\n#${t}saving {\n  font-size: x-small;\n  font-family: monospace;\n  color: gray;\n  margin: 0px 0 6px 0;\n}\n.question {\n  margin: 20px 0 20px 0;\n}\n.answer {\n  border: none;\n  padding: 0 0 6px 0;\n  outline: none;\n  font-family: monospace;\n  font-size: 12px;\n  color: darkgreen;\n  background-image:\n    repeating-linear-gradient(to bottom, white, white 13px, black 14px);\n}\n#${t}scratchpad {\n  border: 1px solid darkgreen;\n  padding: 8px;\n  outline: none;\n  font-family: monospace;\n  font-size: 12px;\n  color: darkgreen;\n}\n#${t}shuffle {\n  font-family: monospace;\n  font-size: 12px;\n  cursor: pointer;\n}\n@media print {\n  @page {\n    margin: 0.5in;\n  }\n  body {\n    zoom: 100%;\n  }\n  #${t}controls-etc {\n    display: none;\n  }\n  .clues-box {\n    overflow-y: visible;\n  }\n}\n`}.bind(this),this.getHtml=function(){return`\n<div class="flex-col" id="${t}outermost-stack">\n  <h2 id="${t}title">Title</h2>\n  <div id="${t}setter"></div>\n  <div id="${t}prelude"></div>\n  <div id="${t}current-clue-parent">\n    <div id="${t}current-clue"></div>\n  </div>\n  <div class="flex-row">\n    <div id="${t}grid-panel">\n      <div id="${t}grid-parent-centerer">\n        <div id="${t}grid-parent">\n          <svg id="${t}grid" zoomAndPan="disable"></svg>\n          <div id="${t}grid-input-wrapper" style="display:none;left:0;top:0"><input id="${t}grid-input" type="text" maxlength="2" autocomplete="off" spellcheck="false" class="cell-text"/></div>\n          <div id="${t}nina-group" style="display:none;left:0;top:0"></div>\n        </div> \x3c!-- #grid-parent --\x3e\n      </div> \x3c!-- #grid-parent-centerer --\x3e\n      <div id="${t}controls-etc">\n        <div id="${t}controls" class="wide-box">\n          <div id="${t}button-row-1" class="controls-row">\n            <button id="${t}clear" class="button"\n                onclick="Puzzle.getInstance('${t}').clearCurrent()">Clear this</button>\n            <button id="${t}clear-all" class="button"\n                onclick="Puzzle.getInstance('${t}').clearAll()">Clear all!</button>\n            <button id="${t}check" class="button" style="display:none"\n                onclick="Puzzle.getInstance('${t}').checkCurrent()">Check this</button>\n            <button id="${t}check-all" class="button" style="display:none"\n                onclick="Puzzle.getInstance('${t}').checkAll()">Check all!</button>\n          </div> \x3c!-- #button-row-1 --\x3e\n          <div id="${t}button-row-2" class="controls-row">\n            <button id="${t}reveal" class="button" style="display:none"\n                onclick="Puzzle.getInstance('${t}').revealCurrent()">Reveal this</button>\n            <button id="${t}ninas" class="button" style="display:none"\n                onclick="Puzzle.getInstance('${t}').toggleNinas()">Show ninas</button>\n            <button id="${t}reveal-all" class="button" style="display:none"\n                onclick="Puzzle.getInstance('${t}').revealAll()">Reveal all!</button>\n          </div> \x3c!-- #button-row-2 --\x3e\n        </div> \x3c!-- #controls --\x3e\n        <div id="${t}errors"></div>\n        <div id="${t}status">\n          Squares filled:\n          <span id="${t}status-num-filled">0</span>/<span\n                id="${t}status-num-total"></span>\n        </div> \x3c!-- #status --\x3e\n        <div id="${t}saving" class="wide-box">\n          Your entries are saved automatically in a cookie, for the most\n          recent puzzle that you open from this site. Bookmark/save the\n          <a id="${t}saving-url" href="">URL</a> for more reliable recovery.\n        </div> \x3c!-- #saving --\x3e\n        <div id="${t}small-print" class="wide-box">\n          <div id="${t}control-keys-list" style="display:none">\n            <ul>\n              <li>\n                <b>Tab/Shift-Tab:</b>\n                Jump to the next/previous clue in the current direction\n              </li>\n              <li>\n                <b>Enter, Click/Tap:</b>\n                Toggle current direction\n              </li>\n              <li>\n                <b>Arrow keys:</b>\n                Move to the nearest light square in that direction\n              </li>\n              <li>\n                <b>Spacebar:</b>\n                Place/clear block in the current square if it's diagramless\n              </li>\n            </ul>\n            <div>\n              <span id="${t}shuffle"\n                title="Shuffle selected text (or all text, if none selected)"\n                onclick="Puzzle.getInstance('${t}').scratchPadShuffle()">\n                Scratch pad: (click here to shuffle)\n              </span>\n              <textarea oninput="scratchPadInput()"\n                id="${t}scratchpad" spellcheck="false"\n                rows="2" cols="60"></textarea>\n            </div>\n          </div>\n          <a id="${t}show-control-keys" href=""\n            title="Show/hide tools: list of control keys and scratch pad"\n            onclick="Puzzle.getInstance('${t}').toggleShowControls();return false">Tools</a>\n          <a id="${t}report-bug"\n            href="https://github.com/viresh-ratnakar/exolve/issues/new">Report\n            bug</a>\n          <a id="${t}exolve-link"\n            href="https://github.com/viresh-ratnakar/exolve">Exolve on\n            GitHub</a>\n          <span id="${t}copyright"></span>\n        </div> \x3c!-- #small-print --\x3e\n        <div id="${t}questions" class="wide-box"></div>\n        <div id="${t}submit-parent">\n          <button id="${t}submit" class="button" style="display:none"\n              onclick="Puzzle.getInstance('${t}').submitSolution()">Submit!</button>\n        </div> \x3c!-- submit-parent --\x3e\n        <div id="${t}explanations" class="wide-box" style="display:none"></div>\n      </div> \x3c!-- #controls-etc --\x3e\n      <br/>\n    </div> \x3c!-- #grid-panel --\x3e\n\n    <div id="${t}clues" class="flex-row">\n      <div id="${t}across-clues-panel" class="clues-box" style="display:none">\n        <hr/>\n        <b>Across</b>\n        <table id="${t}across"></table>\n      </div> \x3c!-- #across-clues-panel --\x3e\n      <div id="${t}down-clues-panel" class="clues-box" style="display:none">\n        <hr/>\n        <b>Down</b>\n        <table id="${t}down"></table>\n      </div> \x3c!-- #down-clues-panel --\x3e\n      <div id="${t}nodir-clues-panel" class="clues-box" style="display:none">\n        <table id="${t}nodir"></table>\n      </div> \x3c!-- #nodir-clues-panel --\x3e\n    </div> \x3c!-- #clues --\x3e\n\n  </div>\n</div> \x3c!-- #outermost-stack --\x3e\n`}.bind(this)}static getInstance(e){return puzzleInstances[e]}}!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var n={exports:{}};t(n.exports),e.example=n.exports}}(this,function(e){e.Puzzle=Puzzle,e.getInstance=Puzzle.getInstance});