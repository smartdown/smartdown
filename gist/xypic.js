!function(){var t=MathJax.Extension.fp={version:"0.1"};t.Matcher=MathJax.Object.Subclass({Init:function(){this.cases=[]},Case:function(t,e){return this.cases.push([t,e]),this},match:function(e){var n,i,r,a;if(e instanceof Object&&"isa"in e)for(n=0,i=this.cases.length;n<i;){if(r=this.cases[n][0],e.isa(r)&&(a=r.unapply(e)).isDefined)return this.cases[n][1](a.get);n+=1}throw t.MatchError(e)}}),t.Option=MathJax.Object.Subclass({}),t.Option.Some=t.Option.Subclass({Init:function(t){this.get=t},isEmpty:!1,isDefined:!0,getOrElse:function(t){return this.get},flatMap:function(t){return t(this.get)},map:function(e){return t.Option.Some(e(this.get))},foreach:function(t){t(this.get)},toString:function(){return"Some("+this.get+")"}},{unapply:function(e){return t.Option.Some(e.get)}}),t.Option.None=t.Option.Subclass({Init:function(){},isEmpty:!0,isDefined:!1,getOrElse:function(t){return t},flatMap:function(t){return this},foreach:function(t){},map:function(t){return this},toString:function(){return"None"}},{unapply:function(e){return t.Option.Some(e)}}),t.Option.Augment({},{empty:t.Option.None()}),t.List=MathJax.Object.Subclass({}),t.List.Cons=t.List.Subclass({Init:function(t,e){this.head=t,this.tail=e},isEmpty:!1,at:function(t){if(t<0||t>=this.length())throw Error("no such element at "+t+". index must be lower than "+this.length()+".");for(var e=this,n=0;n<t;n++)e=e.tail;return e.head},length:function(){for(var t=this,e=0;!t.isEmpty;)e++,t=t.tail;return e},prepend:function(e){return t.List.Cons(e,this)},append:function(e){var n=t.List.Cons(e,t.List.empty);return this.reverse().foreach((function(e){n=t.List.Cons(e,n)})),n},concat:function(e){var n=e;return this.reverse().foreach((function(e){n=t.List.Cons(e,n)})),n},foldLeft:function(t,e){var n,i;for(n=e(t,this.head),i=this.tail;!i.isEmpty;)n=e(n,i.head),i=i.tail;return n},foldRight:function(t,e){return this.tail.isEmpty?e(this.head,t):e(this.head,this.tail.foldRight(t,e))},map:function(e){return t.List.Cons(e(this.head),this.tail.map(e))},flatMap:function(t){return t(this.head).concat(this.tail.flatMap(t))},foreach:function(t){for(var e=this;!e.isEmpty;)t(e.head),e=e.tail},reverse:function(){var e=t.List.empty;return this.foreach((function(n){e=t.List.Cons(n,e)})),e},mkString:function(){var e,n,i,r,a;switch(arguments.length){case 0:e=n=i="";break;case 1:n=arguments[0],e=i="";break;case 2:e=arguments[0],n=arguments[1],i="";break;default:e=arguments[0],n=arguments[1],i=arguments[2]}for(r=e+this.head.toString(),a=this.tail;a.isa(t.List.Cons);)r+=n+a.head.toString(),a=a.tail;return r+i},toString:function(){return this.mkString("[",", ","]")}},{unapply:function(e){return t.Option.Some([e.head,e.tail])}}),t.List.Nil=t.List.Subclass({isEmpty:!0,at:function(t){throw Error("cannot get element from an empty list.")},length:function(){return 0},prepend:function(e){return t.List.Cons(e,t.List.empty)},append:function(e){return t.List.Cons(e,t.List.empty)},concat:function(t){return t},foldLeft:function(t,e){return t},foldRight:function(t,e){return t},flatMap:function(t){return this},map:function(t){return this},foreach:function(t){},reverse:function(){return this},mkString:function(){switch(arguments.length){case 0:case 1:return"";case 2:return arguments[0];default:return arguments[0]+arguments[2]}},toString:function(){return"[]"}},{unapply:function(e){return t.Option.Some(e)}}),t.List.Augment({},{empty:t.List.Nil(),fromArray:function(e){var n,i;for(n=t.List.empty,i=e.length-1;i>=0;)n=t.List.Cons(e[i],n),i-=1;return n}}),t.MatchError=MathJax.Object.Subclass({Init:function(t){this.obj=t},toString:function(){return"MatchError("+this.obj+")"}}),t.OffsetPosition=MathJax.Object.Subclass({Init:function(t,e){this.source=t,this.offset=void 0===e?0:e,this._index=null,this._line=null},index:function(){if(null!==this._index)return this._index;this._index=[],this._index.push(0);for(var t=0;t<this.source.length;)"\n"===this.source.charAt(t)&&this._index.push(t+1),t+=1;return this._index.push(this.source.length),this._index},line:function(){var t,e,n;if(null!==this._line)return this._line;for(t=0,e=this.index().length-1;t+1<e;)n=e+t>>1,this.offset<this.index()[n]?e=n:t=n;return this._line=t+1,this._line},column:function(){return this.offset-this.index()[this.line()-1]+1},lineContents:function(){var t,e;return t=this.index(),e=this.line(),this.source.substring(t[e-1],t[e])},toString:function(){return this.line().toString()+"."+this.column()},longString:function(){var t,e;for(t=this.lineContents()+"\n",e=0;e<this.column();)"\t"===this.lineContents().charAt(e)?t+="\t":t+=" ",e+=1;return t+"^"},isLessThan:function(e){return e.isa(t.OffsetPosition)?this.offset<e.offset:this.line()<e.line()||this.line()===e.line()&&this.column()<e.column()}}),t.StringReader=MathJax.Object.Subclass({Init:function(t,e,n){this.source=t,this.offset=e,this.context=n},first:function(){return this.offset<this.source.length?this.source.charAt(this.offset):t.StringReader.EofCh},rest:function(){return this.offset<this.source.length?t.StringReader(this.source,this.offset+1,this.context):this},pos:function(){return t.OffsetPosition(this.source,this.offset)},atEnd:function(){return this.offset>=this.source.length},drop:function(t){var e,n;for(e=this,n=t;n>0;)e=e.rest(),n-=1;return e}},{EofCh:""}),t.Parsers=MathJax.Object.Subclass({},{parse:function(t,e){return t.apply(e)},parseAll:function(e,n){return e.andl((function(){return t.Parsers.eos()})).apply(n)},parseString:function(e,n){var i=t.StringReader(n,0,{lastNoSuccess:void 0});return t.Parsers.parse(e,i)},parseAllString:function(e,n){var i=t.StringReader(n,0,{lastNoSuccess:void 0});return t.Parsers.parseAll(e,i)},_handleWhiteSpace:function(t){var e=t.context.whiteSpaceRegex,n=t.source,i=t.offset,r=e.exec(n.substring(i,n.length));return null!==r?i+r[0].length:i},literal:function(e){return t.Parsers.Parser((function(n){var i,r,a,o,s,h;for(i=n.source,r=n.offset,o=0,s=a=t.Parsers._handleWhiteSpace(n);o<e.length&&s<i.length&&e.charAt(o)===i.charAt(s);)o+=1,s+=1;return o===e.length?t.Parsers.Success(e,n.drop(s-r)):(h=a===i.length?"end of source":"`"+i.charAt(a)+"'",t.Parsers.Failure("`"+e+"' expected but "+h+" found",n.drop(a-r)))}))},regex:function(e){if("/^"!==e.toString().substring(0,2))throw"regex must start with `^' but "+e;return t.Parsers.Parser((function(n){var i,r,a,o;return i=n.source,r=n.offset,null!==(a=e.exec(i.substring(r,i.length)))?t.Parsers.Success(a[0],n.drop(a[0].length)):(o=r===i.length?"end of source":"`"+i.charAt(r)+"'",t.Parsers.Failure("string matching regex "+e+" expected but "+o+" found",n))}))},regexLiteral:function(e){if("/^"!==e.toString().substring(0,2))throw"regex must start with `^' but "+e;return t.Parsers.Parser((function(n){var i,r,a,o,s;return i=n.source,r=n.offset,a=t.Parsers._handleWhiteSpace(n),null!==(o=e.exec(i.substring(a,i.length)))?t.Parsers.Success(o[0],n.drop(a+o[0].length-r)):(s=a===i.length?"end of source":"`"+i.charAt(a)+"'",t.Parsers.Failure("string matching regex "+e+" expected but "+s+" found",n.drop(a-r)))}))},eos:function(){return t.Parsers.Parser((function(e){var n,i;return n=e.source,e.offset,i=t.Parsers._handleWhiteSpace(e),n.length===i?t.Parsers.Success("",e):t.Parsers.Failure("end of source expected but `"+n.charAt(i)+"' found",e)}))},commit:function(e){return t.Parsers.Parser((function(n){var i=e()(n);return t.Matcher().Case(t.Parsers.Success,(function(t){return i})).Case(t.Parsers.Error,(function(t){return i})).Case(t.Parsers.Failure,(function(e){return t.Parsers.Error(e[0],e[1])})).match(i)}))},elem:function(e){return t.Parsers.accept(e).named('"'+e+'"')},accept:function(e){return t.Parsers.acceptIf((function(t){return t===e}),(function(t){return"`"+e+"' expected but `"+t+"' found"}))},acceptIf:function(e,n){return t.Parsers.Parser((function(i){return e(i.first())?t.Parsers.Success(i.first(),i.rest()):t.Parsers.Failure(n(i.first()),i)}))},failure:function(e){return t.Parsers.Parser((function(n){return t.Parsers.Failure(e,n)}))},err:function(e){return t.Parsers.Parser((function(n){return t.Parsers.Error(e,n)}))},success:function(e){return t.Parsers.Parser((function(n){return t.Parsers.Success(e,n)}))},log:function(e,n){return t.Parsers.Parser((function(t){console.log("trying "+n+" at "+t);var i=e().apply(t);return console.log(n+" --\x3e "+i),i}))},rep:function(e){var n=t.Parsers.success(t.List.empty);return t.Parsers.rep1(e).or((function(){return n}))},rep1:function(e){return t.Parsers.Parser((function(n){var i,r,a,o;if(i=[],r=n,(o=(a=e()).apply(n)).isa(t.Parsers.Success)){for(;o.isa(t.Parsers.Success);)i.push(o.result),r=o.next,o=a.apply(r);return t.Parsers.Success(t.List.fromArray(i),r)}return o}))},repN:function(e,n){return 0===e?t.Parsers.success(t.List.empty):t.Parsers.Parser((function(i){var r,a,o,s;for(r=[],a=i,s=(o=n()).apply(a);s.isa(t.Parsers.Success);){if(r.push(s.result),a=s.next,e===r.length)return t.Parsers.Success(t.List.fromArray(r),a);s=o.apply(a)}return s}))},repsep:function(e,n){var i=t.Parsers.success(t.List.empty);return t.Parsers.rep1sep(e,n).or((function(){return i}))},rep1sep:function(e,n){return e().and(t.Parsers.rep(n().andr(e))).to((function(e){return t.List.Cons(e.head,e.tail)}))},chainl1:function(e,n,i){return e().and(t.Parsers.rep(i().and(n))).to((function(t){return t.tail.foldLeft(t.head,(function(t,e){return e.head(t,e.tail)}))}))},chainr1:function(e,n,i,r){return e().and(this.rep(n().and(e))).to((function(e){return t.List.Cons(t.Parsers.Pair(i,e.head),e.tail).foldRight(r,(function(t,e){return t.head(t.tail,e)}))}))},opt:function(e){return e().to((function(e){return t.Option.Some(e)})).or((function(){return t.Parsers.success(t.Option.empty)}))},not:function(e){return t.Parsers.Parser((function(n){return e().apply(n).successful?t.Parsers.Failure("Expected failure",n):t.Parsers.Success(t.Option.empty,n)}))},guard:function(e){return t.Parsers.Parser((function(n){var i=e().apply(n);return i.successful?t.Parsers.Success(i.result,n):i}))},mkList:function(e){return t.List.Cons(e.head,e.tail)},fun:function(t){return function(){return t}},lazyParser:function(e){var n,i;return e instanceof String||"string"==typeof e?(n=t.Parsers.literal(e),function(){return n}):e instanceof Function?e:e instanceof Object?"isa"in e&&e.isa(t.Parsers.Parser)?function(){return e}:e instanceof RegExp?(i=t.Parsers.regexLiteral(e),function(){return i}):t.Parsers.err("unhandlable type"):t.Parsers.err("unhandlable type")},seq:function(){var e,n,i;if(0===(e=arguments.length))return t.Parsers.err("at least one element must be specified");for(n=t.Parsers.lazyParser(arguments[0])(),i=1;i<e;)n=n.and(t.Parsers.lazyParser(arguments[i])),i+=1;return n},or:function(){var e,n,i;if(0===(e=arguments.length))return t.Parsers.err("at least one element must be specified");for(n=t.Parsers.lazyParser(arguments[0])(),i=1;i<e;)n=n.or(t.Parsers.lazyParser(arguments[i])),i+=1;return n}}),t.Parsers.Pair=MathJax.Object.Subclass({Init:function(t,e){this.head=t,this.tail=e},toString:function(){return"("+this.head+"~"+this.tail+")"}},{unapply:function(e){return t.Option.Some([e.head,e.tail])}}),t.Parsers.ParseResult=MathJax.Object.Subclass({Init:function(){},isEmpty:function(){return!this.successful},getOrElse:function(t){return this.isEmpty?t():this.get()}}),t.Parsers.Success=t.Parsers.ParseResult.Subclass({Init:function(t,e){this.result=t,this.next=e},map:function(e){return t.Parsers.Success(e(this.result),this.next)},mapPartial:function(e,n){try{return t.Parsers.Success(e(this.result),this.next)}catch(e){if("isa"in e&&e.isa(t.MatchError))return t.Parsers.Failure(n(this.result),this.next);throw e}},flatMapWithNext:function(t){return t(this.result).apply(this.next)},append:function(t){return this},get:function(){return this.result},successful:!0,toString:function(){return"["+this.next.pos()+"] parsed: "+this.result}},{unapply:function(e){return t.Option.Some([e.result,e.next])}}),t.Parsers.NoSuccess=t.Parsers.ParseResult.Subclass({Init:function(){},_setLastNoSuccess:function(){var t=this.next.context;void 0!==t.lastNoSuccess&&this.next.pos().isLessThan(t.lastNoSuccess.next.pos())||(t.lastNoSuccess=this)},map:function(t){return this},mapPartial:function(t,e){return this},flatMapWithNext:function(t){return this},get:function(){return t.Parsers.error("No result when parsing failed")},successful:!1}),t.Parsers.Failure=t.Parsers.NoSuccess.Subclass({Init:function(t,e){this.msg=t,this.next=e,this._setLastNoSuccess()},append:function(e){var n=e();if(n.isa(t.Parsers.Success))return n;if(n.isa(t.Parsers.NoSuccess))return n.next.pos().isLessThan(this.next.pos())?this:n;throw t.MatchError(n)},toString:function(){return"["+this.next.pos()+"] failure: "+this.msg+"\n\n"+this.next.pos().longString()}},{unapply:function(e){return t.Option.Some([e.msg,e.next])}}),t.Parsers.Error=t.Parsers.NoSuccess.Subclass({Init:function(t,e){this.msg=t,this.next=e,this._setLastNoSuccess()},append:function(t){return this},toString:function(){return"["+this.next.pos()+"] error: "+this.msg+"\n\n"+this.next.pos().longString()}},{unapply:function(e){return t.Option.Some([e.msg,e.next])}}),t.Parsers.Parser=MathJax.Object.Subclass({Init:function(t){this.apply=t},name:"",named:function(t){return this.name=t,this},toString:function(){return"Parser ("+this.name+")"},flatMap:function(e){var n=this.apply;return t.Parsers.Parser((function(t){return n(t).flatMapWithNext(e)}))},map:function(e){var n=this.apply;return t.Parsers.Parser((function(t){return n(t).map(e)}))},append:function(e){var n=this.apply;return t.Parsers.Parser((function(t){return n(t).append((function(){return e().apply(t)}))}))},and:function(e){return this.flatMap((function(n){return e().map((function(e){return t.Parsers.Pair(n,e)}))})).named("~")},andr:function(t){return this.flatMap((function(e){return t().map((function(t){return t}))})).named("~>")},andl:function(t){return this.flatMap((function(e){return t().map((function(t){return e}))})).named("<~")},or:function(t){return this.append(t).named("|")},andOnce:function(e){var n=this.flatMap;return t.Parsers.OnceParser((function(){return n((function(n){return t.Parsers.commit(e).map((function(e){return t.Parsers.Pair(n,e)}))})).named("~!")}))},longestOr:function(e){var n=this.apply;return t.Parsers.Parser((function(i){var r,a;return r=n(i),a=e()(i),r.successful?a.successful?a.next.pos().isLessThan(r.next.pos())?r:a:r:a.successful?a:r.isa(t.Parsers.Error)||a.next.pos().isLessThan(r.next.pos())?r:a})).named("|||")},to:function(t){return this.map(t).named(this.toString()+"^^")},ret:function(e){var n=this.apply;return t.Parsers.Parser((function(t){return n(t).map((function(t){return e()}))})).named(this.toString()+"^^^")},toIfPossible:function(e,n){void 0===n&&(n=function(t){return"Constructor function not defined at "+t});var i=this.apply;return t.Parsers.Parser((function(t){return i(t).mapPartial(e,n)})).named(this.toString()+"^?")},into:function(t){return this.flatMap(t)},rep:function(){var e=this;return t.Parsers.rep((function(){return e}))},chain:function(e){var n,i;return n=this,i=function(){return n},t.Parsers.chainl1(i,i,e)},rep1:function(){var e=this;return t.Parsers.rep1((function(){return e}))},opt:function(){var e=this;return t.Parsers.opt((function(){return e}))}}),t.Parsers.OnceParser=t.Parsers.Parser.Subclass({Init:function(t){this.apply=t},and:function(e){var n=this.flatMap;return t.Parsers.OnceParser((function(){return n((function(n){return t.Parsers.commit(e).map((function(e){return t.Parsers.Pair(n,e)}))}))})).named("~")}}),MathJax.Hub.Startup.signal.Post("Functional Programming library Ready")}(),MathJax.Extension.xypic={version:"0.1",constants:{whiteSpaceRegex:/^(\s+|%[^\r\n]*(\r\n|\r|\n)?)+/,unsupportedBrowserErrorMessage:"Unsupported Browser. Please open with Firefox/Safari/Chrome/Opera"},signalHandler:{signals:[],hookedSignals:[],chains:[],chainSignal:function(t,e){for(var n=0;n<e.length;n++)MathJax.Extension.xypic.signalHandler.addSignal(e[n]);MathJax.Extension.xypic.signalHandler.chains.push({succ:t,pred:e})},addSignal:function(t){for(var e=MathJax.Extension.xypic.signalHandler.signals,n=0;n<e.length;n++)if(e[n]===t)return;MathJax.Extension.xypic.signalHandler.signals.push(t);var i=MathJax.Extension.xypic.signalHandler.handleSignal(t);MathJax.Hub.Register.StartupHook(t,i)},handleSignal:function(t){return function(){MathJax.Extension.xypic.signalHandler.hookedSignals.push(t),MathJax.Extension.xypic.signalHandler.handleChains()}},handleChains:function(){for(var t=0,e=MathJax.Extension.xypic.signalHandler.chains,n=[],i=[];t<e.length;){for(var r=e[t],a=r.pred,o=!0,s=0;s<a.length;s++){var h=a[s];if(!MathJax.Extension.xypic.signalHandler.listenedSignal(h)){o=!1;break}}o?i.push(r.succ):n.push(r),t++}for(MathJax.Extension.xypic.signalHandler.chains=n,t=0;t<i.length;t++)MathJax.Hub.Startup.signal.Post(i[t])},listenedSignal:function(t){for(var e=MathJax.Extension.xypic.signalHandler.hookedSignals,n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}}},MathJax.Extension.xypic.signalHandler.chainSignal("TeX Xy-pic Require",["Functional Programming library Ready","TeX Jax Ready"]),MathJax.Extension.xypic.signalHandler.chainSignal("HTML-CSS Xy-pic Config Require",["TeX Xy-pic Ready","HTML-CSS Jax Ready"]),MathJax.Extension.xypic.signalHandler.chainSignal("SVG Xy-pic Config Require",["TeX Xy-pic Ready","SVG Jax Ready"]),MathJax.Extension.xypic.signalHandler.chainSignal("Device-Independent Xy-pic Require",["HTML-CSS Xy-pic Config Ready"]),MathJax.Extension.xypic.signalHandler.chainSignal("Device-Independent Xy-pic Require",["SVG Xy-pic Config Ready"]),MathJax.Extension.xypic.signalHandler.chainSignal("HTML-CSS Xy-pic Require",["HTML-CSS Xy-pic Config Ready","Device-Independent Xy-pic Ready"]),MathJax.Extension.xypic.signalHandler.chainSignal("SVG Xy-pic Require",["SVG Xy-pic Config Ready","Device-Independent Xy-pic Ready"]),MathJax.Hub.Register.StartupHook("TeX Xy-pic Require",(function(){var t=MathJax.Extension.fp,e=MathJax.ElementJax.mml,n=MathJax.InputJax.TeX,i=n.Definitions,r=MathJax.Extension.xypic,a=r.AST=MathJax.Object.Subclass({});MathJax.Hub.Insert(i,{macros:{hole:["Macro","{\\style{visibility:hidden}{x}}"],objectstyle:["Macro","\\textstyle"],labelstyle:["Macro","\\scriptstyle"],twocellstyle:["Macro","\\scriptstyle"],xybox:"Xybox",xymatrix:"Xymatrix",newdir:"XypicNewdir",includegraphics:"Xyincludegraphics"},environment:{xy:["ExtensionEnv",null,"XYpic"]}});var o=n.formatError;n.formatError=function(t,e,n,i){return void 0!==t.xyjaxError?t.toMML():o(t,e,n,i)},r.memoize=function(t,e){var n=t[e],i=function(){var i=n.call(this),a=function(){return i};return a.reset=r,t[e]=a,i},r=function(){t[e]=i};i.reset=r,r()},a.xypic=e.mbase.Subclass({Init:function(t){this.data=[],this.cmd=t},type:"xypic",inferRow:!1,defaults:{mathbackground:e.INHERIT,mathcolor:e.INHERIT,notation:e.NOTATION.LONGDIV,texClass:e.TEXCLASS.ORD},setTeXclass:e.mbase.setSeparateTeXclasses,toString:function(){return this.type+"("+this.cmd+")"}}),a.xypic.newdir=e.mbase.Subclass({Init:function(t){this.data=[],this.cmd=t},type:"newdir",inferRow:!1,defaults:{mathbackground:e.INHERIT,mathcolor:e.INHERIT,notation:e.NOTATION.LONGDIV,texClass:e.TEXCLASS.ORD},setTeXclass:e.mbase.setSeparateTeXclasses,toString:function(){return this.type+"("+this.cmd+")"}}),a.xypic.includegraphics=e.mbase.Subclass({Init:function(t){this.data=[],this.cmd=t},type:"includegraphics",inferRow:!1,defaults:{mathbackground:e.INHERIT,mathcolor:e.INHERIT,notation:e.NOTATION.LONGDIV,texClass:e.TEXCLASS.ORD},setTeXclass:e.mbase.setSeparateTeXclasses,toString:function(){return this.type+"("+this.cmd+")"}}),a.PosDecor=MathJax.Object.Subclass({Init:function(t,e){this.pos=t,this.decor=e},toString:function(){return this.pos.toString()+" "+this.decor}}),a.Pos=MathJax.Object.Subclass({}),a.Pos.Coord=MathJax.Object.Subclass({Init:function(t,e){this.coord=t,this.pos2s=e},toString:function(){return this.coord.toString()+" "+this.pos2s.mkString(" ")}}),a.Pos.Plus=MathJax.Object.Subclass({Init:function(t){this.coord=t},toString:function(){return"+("+this.coord+")"}}),a.Pos.Minus=MathJax.Object.Subclass({Init:function(t){this.coord=t},toString:function(){return"-("+this.coord+")"}}),a.Pos.Skew=MathJax.Object.Subclass({Init:function(t){this.coord=t},toString:function(){return"!("+this.coord+")"}}),a.Pos.Cover=MathJax.Object.Subclass({Init:function(t){this.coord=t},toString:function(){return".("+this.coord+")"}}),a.Pos.Then=MathJax.Object.Subclass({Init:function(t){this.coord=t},toString:function(){return",("+this.coord+")"}}),a.Pos.SwapPAndC=MathJax.Object.Subclass({Init:function(t){this.coord=t},toString:function(){return";("+this.coord+")"}}),a.Pos.SetBase=MathJax.Object.Subclass({Init:function(t){this.coord=t},toString:function(){return":("+this.coord+")"}}),a.Pos.SetYBase=MathJax.Object.Subclass({Init:function(t){this.coord=t},toString:function(){return"::("+this.coord+")"}}),a.Pos.ConnectObject=MathJax.Object.Subclass({Init:function(t){this.object=t},toString:function(){return"**("+this.object+")"}}),a.Pos.DropObject=MathJax.Object.Subclass({Init:function(t){this.object=t},toString:function(){return"*("+this.object+")"}}),a.Pos.Place=MathJax.Object.Subclass({Init:function(t){this.place=t},toString:function(){return"?("+this.place+")"}}),a.Pos.PushCoord=MathJax.Object.Subclass({Init:function(t){this.coord=t},toString:function(){return"@+("+this.coord+")"}}),a.Pos.EvalCoordThenPop=MathJax.Object.Subclass({Init:function(t){this.coord=t},toString:function(){return"@-("+this.coord+")"}}),a.Pos.LoadStack=MathJax.Object.Subclass({Init:function(t){this.coord=t},toString:function(){return"@=("+this.coord+")"}}),a.Pos.DoCoord=MathJax.Object.Subclass({Init:function(t){this.coord=t},toString:function(){return"@@("+this.coord+")"}}),a.Pos.InitStack=MathJax.Object.Subclass({Init:function(){},toString:function(){return"@i"}}),a.Pos.EnterFrame=MathJax.Object.Subclass({Init:function(){},toString:function(){return"@("}}),a.Pos.LeaveFrame=MathJax.Object.Subclass({Init:function(){},toString:function(){return"@)"}}),a.Pos.SavePos=MathJax.Object.Subclass({Init:function(t){this.id=t},toString:function(){return'="'+this.id+'"'}}),a.Pos.SaveMacro=MathJax.Object.Subclass({Init:function(t,e){this.macro=t,this.id=e},toString:function(){return"=("+this.macro+' "'+this.id+'")'}}),a.Pos.SaveBase=MathJax.Object.Subclass({Init:function(t){this.id=t},toString:function(){return'=:"'+this.id+'"'}}),a.Pos.SaveStack=MathJax.Object.Subclass({Init:function(t){this.id=t},toString:function(){return'=@"'+this.id+'"'}}),a.Coord=MathJax.Object.Subclass({}),a.Coord.Vector=MathJax.Object.Subclass({Init:function(t){this.vector=t},toString:function(){return this.vector.toString()}}),a.Coord.C=MathJax.Object.Subclass({toString:function(){return"c"}}),a.Coord.P=MathJax.Object.Subclass({toString:function(){return"p"}}),a.Coord.X=MathJax.Object.Subclass({toString:function(){return"x"}}),a.Coord.Y=MathJax.Object.Subclass({toString:function(){return"y"}}),a.Coord.Id=MathJax.Object.Subclass({Init:function(t){this.id=t},toString:function(){return'"'+this.id+'"'}}),a.Coord.Group=MathJax.Object.Subclass({Init:function(t){this.posDecor=t},toString:function(){return"{"+this.posDecor+"}"}}),a.Coord.StackPosition=MathJax.Object.Subclass({Init:function(t){this.number=t},toString:function(){return"s{"+this.number+"}"}}),a.Coord.DeltaRowColumn=MathJax.Object.Subclass({Init:function(t,e,n){this.prefix=t,this.dr=e,this.dc=n},toString:function(){return"["+(""===this.prefix?"":'"'+this.prefix+'"')+this.dr+","+this.dc+"]"}}),a.Coord.Hops=MathJax.Object.Subclass({Init:function(t,e){this.prefix=t,this.hops=e},toString:function(){return"["+(""===this.prefix?"":'"'+this.prefix+'"')+this.hops.mkString("")+"]"}}),a.Coord.HopsWithPlace=MathJax.Object.Subclass({Init:function(t,e,n){this.prefix=t,this.hops=e,this.place=n},toString:function(){return"["+(""===this.prefix?"":'"'+this.prefix+'"')+this.hops.mkString("")+this.place+"]"}}),a.Vector=MathJax.Object.Subclass({}),a.Vector.InCurBase=MathJax.Object.Subclass({Init:function(t,e){this.x=t,this.y=e},toString:function(){return"("+this.x+", "+this.y+")"}}),a.Vector.Abs=MathJax.Object.Subclass({Init:function(t,e){this.x=t,this.y=e},toString:function(){return"<"+this.x+", "+this.y+">"}}),a.Vector.Angle=MathJax.Object.Subclass({Init:function(t){this.degree=t},toString:function(){return"a("+this.degree+")"}}),a.Vector.Dir=MathJax.Object.Subclass({Init:function(t,e){this.dir=t,this.dimen=e},toString:function(){return"/"+this.dir+" "+this.dimen+"/"}}),a.Vector.Corner=MathJax.Object.Subclass({Init:function(t,e){this.corner=t,this.factor=e},toString:function(){return this.corner.toString()+"("+this.factor+")"}}),a.Corner=MathJax.Object.Subclass({}),a.Corner.L=MathJax.Object.Subclass({toString:function(){return"L"}}),a.Corner.R=MathJax.Object.Subclass({toString:function(){return"R"}}),a.Corner.D=MathJax.Object.Subclass({toString:function(){return"D"}}),a.Corner.U=MathJax.Object.Subclass({toString:function(){return"U"}}),a.Corner.CL=MathJax.Object.Subclass({toString:function(){return"CL"}}),a.Corner.CR=MathJax.Object.Subclass({toString:function(){return"CR"}}),a.Corner.CD=MathJax.Object.Subclass({toString:function(){return"CD"}}),a.Corner.CU=MathJax.Object.Subclass({toString:function(){return"CU"}}),a.Corner.LD=MathJax.Object.Subclass({toString:function(){return"LD"}}),a.Corner.RD=MathJax.Object.Subclass({toString:function(){return"RD"}}),a.Corner.LU=MathJax.Object.Subclass({toString:function(){return"LU"}}),a.Corner.RU=MathJax.Object.Subclass({toString:function(){return"RU"}}),a.Corner.NearestEdgePoint=MathJax.Object.Subclass({toString:function(){return"E"}}),a.Corner.PropEdgePoint=MathJax.Object.Subclass({toString:function(){return"P"}}),a.Corner.Axis=MathJax.Object.Subclass({toString:function(){return"A"}}),a.Place=MathJax.Object.Subclass({Init:function(t,e,n,i){this.shaveP=t,this.shaveC=e,this.factor=n,this.slide=i},compound:function(t){return a.Place(this.shaveP+t.shaveP,this.shaveC+t.shaveC,void 0===t.factor?this.factor:t.factor,t.slide)},toString:function(){for(var t="",e=0;e<this.shaveP;e++)t+="<";for(var n=0;n<this.shaveC;n++)t+=">";return void 0!==this.factor&&(t+="("+this.factor+")"),this.slide.dimen.foreach((function(e){t+="/"+e+"/"})),t}}),a.Place.Factor=MathJax.Object.Subclass({Init:function(t){this.factor=t},isIntercept:!1,toString:function(){return this.factor.toString()}}),a.Place.Intercept=MathJax.Object.Subclass({Init:function(t){this.pos=t},isIntercept:!0,toString:function(){return"!{"+this.pos+"}"}}),a.Slide=MathJax.Object.Subclass({Init:function(t){this.dimen=t},toString:function(){return this.dimen.getOrElse("")}}),a.Object=MathJax.Object.Subclass({Init:function(t,e){this.modifiers=t,this.object=e},dirVariant:function(){return this.object.dirVariant()},dirMain:function(){return this.object.dirMain()},isDir:function(){return this.object.isDir()},toString:function(){return this.modifiers.mkString()+this.object.toString()}}),a.ObjectBox=MathJax.Object.Subclass({dirVariant:function(){},dirMain:function(){},isDir:function(){return!1},isEmpty:!1}),a.ObjectBox.Text=a.ObjectBox.Subclass({Init:function(t){this.math=t},toString:function(){return"{"+this.math.toString()+"}"}}),a.ObjectBox.Empty=a.ObjectBox.Subclass({isEmpty:!0,toString:function(){return"{}"}}),a.ObjectBox.Xymatrix=a.ObjectBox.Subclass({Init:function(t){this.xymatrix=t},toString:function(){return this.xymatrix.toString()}}),a.ObjectBox.Txt=a.ObjectBox.Subclass({Init:function(t,e){this.width=t,this.textObject=e},toString:function(){return"\\txt"+this.width+"{"+this.textObject.toString()+"}"}}),a.ObjectBox.Txt.Width=a.ObjectBox.Subclass({}),a.ObjectBox.Txt.Width.Vector=a.ObjectBox.Subclass({Init:function(t){this.vector=t},toString:function(){return this.vector.toString()}}),a.ObjectBox.Txt.Width.Default=a.ObjectBox.Subclass({toString:function(){return""}}),a.ObjectBox.WrapUpObject=a.ObjectBox.Subclass({Init:function(t){this.object=t},toString:function(){return"\\object"+this.object.toString()}}),a.ObjectBox.CompositeObject=a.ObjectBox.Subclass({Init:function(t){this.objects=t},toString:function(){return"\\composite{"+this.objects.mkString(" * ")+"}"}}),a.ObjectBox.Xybox=a.ObjectBox.Subclass({Init:function(t){this.posDecor=t},toString:function(){return"\\xybox{"+this.posDecor.toString()+"}"}}),a.ObjectBox.Cir=a.ObjectBox.Subclass({Init:function(t,e){this.radius=t,this.cir=e},toString:function(){return"\\cir"+this.radius+"{"+this.cir+"}"}}),a.ObjectBox.Cir.Radius=MathJax.Object.Subclass({}),a.ObjectBox.Cir.Radius.Vector=MathJax.Object.Subclass({Init:function(t){this.vector=t},toString:function(){return this.vector.toString()}}),a.ObjectBox.Cir.Radius.Default=MathJax.Object.Subclass({toString:function(){return""}}),a.ObjectBox.Cir.Cir=MathJax.Object.Subclass({}),a.ObjectBox.Cir.Cir.Segment=MathJax.Object.Subclass({Init:function(t,e,n){this.startDiag=t,this.orient=e,this.endDiag=n},toString:function(){return this.startDiag.toString()+this.orient+this.endDiag}}),a.ObjectBox.Cir.Cir.Full=MathJax.Object.Subclass({toString:function(){return""}}),a.ObjectBox.Dir=a.ObjectBox.Subclass({Init:function(t,e){this.variant=t,this.main=e},dirVariant:function(){return this.variant},dirMain:function(){return this.main},isDir:function(){return!0},toString:function(){return"\\dir"+this.variant+"{"+this.main+"}"}}),a.ObjectBox.Curve=a.ObjectBox.Subclass({Init:function(t,e,n){this.modifiers=t,this.objects=e,this.poslist=n},dirVariant:function(){return""},dirMain:function(){return"-"},isDir:function(){return!1},toString:function(){return"\\curve"+this.modifiers.mkString("")+"{"+this.objects.mkString(" ")+" "+this.poslist.mkString("&")+"}"}}),a.ObjectBox.Curve.Modifier=MathJax.Object.Subclass({}),a.ObjectBox.Curve.Modifier.p=MathJax.Object.Subclass({toString:function(){return"~p"}}),a.ObjectBox.Curve.Modifier.P=MathJax.Object.Subclass({toString:function(){return"~P"}}),a.ObjectBox.Curve.Modifier.l=MathJax.Object.Subclass({toString:function(){return"~l"}}),a.ObjectBox.Curve.Modifier.L=MathJax.Object.Subclass({toString:function(){return"~L"}}),a.ObjectBox.Curve.Modifier.c=MathJax.Object.Subclass({toString:function(){return"~c"}}),a.ObjectBox.Curve.Modifier.C=MathJax.Object.Subclass({toString:function(){return"~C"}}),a.ObjectBox.Curve.Modifier.pc=MathJax.Object.Subclass({toString:function(){return"~pc"}}),a.ObjectBox.Curve.Modifier.pC=MathJax.Object.Subclass({toString:function(){return"~pC"}}),a.ObjectBox.Curve.Modifier.Pc=MathJax.Object.Subclass({toString:function(){return"~Pc"}}),a.ObjectBox.Curve.Modifier.PC=MathJax.Object.Subclass({toString:function(){return"~PC"}}),a.ObjectBox.Curve.Modifier.lc=MathJax.Object.Subclass({toString:function(){return"~lc"}}),a.ObjectBox.Curve.Modifier.lC=MathJax.Object.Subclass({toString:function(){return"~lC"}}),a.ObjectBox.Curve.Modifier.Lc=MathJax.Object.Subclass({toString:function(){return"~Lc"}}),a.ObjectBox.Curve.Modifier.LC=MathJax.Object.Subclass({toString:function(){return"~LC"}}),a.ObjectBox.Curve.Modifier.cC=MathJax.Object.Subclass({toString:function(){return"~cC"}}),a.ObjectBox.Curve.Object=MathJax.Object.Subclass({}),a.ObjectBox.Curve.Object.Drop=MathJax.Object.Subclass({Init:function(t){this.object=t},toString:function(){return"~*"+this.object}}),a.ObjectBox.Curve.Object.Connect=MathJax.Object.Subclass({Init:function(t){this.object=t},toString:function(){return"~**"+this.object}}),a.ObjectBox.Curve.PosList=MathJax.Object.Subclass({}),a.ObjectBox.Curve.PosList.CurPos=MathJax.Object.Subclass({toString:function(){return""}}),a.ObjectBox.Curve.PosList.Pos=MathJax.Object.Subclass({Init:function(t){this.pos=t},toString:function(){return this.pos.toString()}}),a.ObjectBox.Curve.PosList.AddStack=MathJax.Object.Subclass({toString:function(){return"~@"}}),a.Modifier=MathJax.Object.Subclass({}),a.Modifier.Vector=a.Modifier.Subclass({Init:function(t){this.vector=t},toString:function(){return"!"+this.vector}}),a.Modifier.RestoreOriginalRefPoint=a.Modifier.Subclass({toString:function(){return"!"}}),a.Modifier.AddOp=a.Modifier.Subclass({Init:function(t,e){this.op=t,this.size=e},toString:function(){return this.op.toString()+" "+this.size}}),a.Modifier.AddOp.Grow=MathJax.Object.Subclass({toString:function(){return"+"}}),a.Modifier.AddOp.Shrink=MathJax.Object.Subclass({toString:function(){return"-"}}),a.Modifier.AddOp.Set=MathJax.Object.Subclass({toString:function(){return"="}}),a.Modifier.AddOp.GrowTo=MathJax.Object.Subclass({toString:function(){return"+="}}),a.Modifier.AddOp.ShrinkTo=MathJax.Object.Subclass({toString:function(){return"-="}}),a.Modifier.AddOp.VactorSize=MathJax.Object.Subclass({Init:function(t){this.vector=t},isDefault:!1,toString:function(){return this.vector.toString()}}),a.Modifier.AddOp.DefaultSize=MathJax.Object.Subclass({isDefault:!0,toString:function(){return""}}),a.Modifier.Shape=MathJax.Object.Subclass({}),a.Modifier.Shape.Point=a.Modifier.Subclass({toString:function(){return"[.]"}}),a.Modifier.Shape.Rect=a.Modifier.Subclass({toString:function(){return"[]"}}),a.Modifier.Shape.Alphabets=a.Modifier.Subclass({Init:function(t){this.alphabets=t},toString:function(){return"["+this.alphabets+"]"}}),a.Modifier.Shape.DefineShape=a.Modifier.Subclass({Init:function(t){this.shape=t},toString:function(){return"["+this.shape+"]"}}),a.Modifier.Shape.Circle=a.Modifier.Subclass({toString:function(){return"[o]"}}),a.Modifier.Shape.L=a.Modifier.Subclass({toString:function(){return"[l]"}}),a.Modifier.Shape.R=a.Modifier.Subclass({toString:function(){return"[r]"}}),a.Modifier.Shape.U=a.Modifier.Subclass({toString:function(){return"[u]"}}),a.Modifier.Shape.D=a.Modifier.Subclass({toString:function(){return"[d]"}}),a.Modifier.Shape.C=a.Modifier.Subclass({toString:function(){return"[c]"}}),a.Modifier.Shape.ChangeColor=a.Modifier.Subclass({Init:function(t){this.colorName=t},toString:function(){return"["+this.colorName+"]"}}),a.Modifier.Shape.CompositeModifiers=a.Modifier.Subclass({Init:function(t){this.modifiers=t},toString:function(){return this.modifiers.mkString("")}}),a.Modifier.Shape.Frame=a.Modifier.Subclass({Init:function(t,e){this.main=t,this.options=e},toString:function(){return"[F"+this.main+this.options.mkString("")+"]"}}),a.Modifier.Shape.Frame.Radius=MathJax.Object.Subclass({Init:function(t){this.vector=t},toString:function(){return":"+this.vector}}),a.Modifier.Shape.Frame.Color=MathJax.Object.Subclass({Init:function(t){this.colorName=t},toString:function(){return":"+this.colorName}}),a.Modifier.Invisible=a.Modifier.Subclass({toString:function(){return"i"}}),a.Modifier.Hidden=a.Modifier.Subclass({toString:function(){return"h"}}),a.Modifier.Direction=a.Modifier.Subclass({Init:function(t){this.direction=t},toString:function(){return this.direction.toString()}}),a.Direction=MathJax.Object.Subclass({}),a.Direction.Compound=MathJax.Object.Subclass({Init:function(t,e){this.dir=t,this.rots=e},toString:function(){return this.dir.toString()+this.rots.mkString()}}),a.Direction.Diag=MathJax.Object.Subclass({Init:function(t){this.diag=t},toString:function(){return this.diag.toString()}}),a.Direction.Vector=MathJax.Object.Subclass({Init:function(t){this.vector=t},toString:function(){return"v"+this.vector.toString()}}),a.Direction.ConstructVector=MathJax.Object.Subclass({Init:function(t){this.posDecor=t},toString:function(){return"q{"+this.posDecor.toString()+"}"}}),a.Direction.RotVector=MathJax.Object.Subclass({Init:function(t){this.vector=t},toString:function(){return":"+this.vector.toString()}}),a.Direction.RotAntiCW=MathJax.Object.Subclass({toString:function(){return"_"}}),a.Direction.RotCW=MathJax.Object.Subclass({toString:function(){return"^"}}),a.Diag=MathJax.Object.Subclass({}),a.Diag.Default=MathJax.Object.Subclass({toString:function(){return""}}),a.Diag.Angle=MathJax.Object.Subclass({toString:function(){return this.symbol}}),a.Diag.LD=a.Diag.Angle.Subclass({symbol:"ld",ang:-3*Math.PI/4,turn:function(t){return"^"===t?a.Diag.RD():a.Diag.LU()}}),a.Diag.RD=a.Diag.Angle.Subclass({symbol:"rd",ang:-Math.PI/4,turn:function(t){return"^"===t?a.Diag.RU():a.Diag.LD()}}),a.Diag.LU=a.Diag.Angle.Subclass({symbol:"lu",ang:3*Math.PI/4,turn:function(t){return"^"===t?a.Diag.LD():a.Diag.RU()}}),a.Diag.RU=a.Diag.Angle.Subclass({symbol:"ru",ang:Math.PI/4,turn:function(t){return"^"===t?a.Diag.LU():a.Diag.RD()}}),a.Diag.L=a.Diag.Angle.Subclass({symbol:"l",ang:Math.PI,turn:function(t){return"^"===t?a.Diag.D():a.Diag.U()}}),a.Diag.R=a.Diag.Angle.Subclass({symbol:"r",ang:0,turn:function(t){return"^"===t?a.Diag.U():a.Diag.D()}}),a.Diag.D=a.Diag.Angle.Subclass({symbol:"d",ang:-Math.PI/2,turn:function(t){return"^"===t?a.Diag.R():a.Diag.L()}}),a.Diag.U=a.Diag.Angle.Subclass({symbol:"u",ang:Math.PI/2,turn:function(t){return"^"===t?a.Diag.L():a.Diag.R()}}),a.ObjectBox.Frame=a.ObjectBox.Subclass({Init:function(t,e){this.radius=t,this.main=e},toString:function(){return"\\frm"+this.radius+"{"+this.main+"}"}}),a.ObjectBox.Frame.Radius=MathJax.Object.Subclass({}),a.ObjectBox.Frame.Radius.Vector=MathJax.Object.Subclass({Init:function(t){this.vector=t},toString:function(){return this.vector.toString()}}),a.ObjectBox.Frame.Radius.Default=MathJax.Object.Subclass({toString:function(){return""}}),a.Decor=MathJax.Object.Subclass({Init:function(t){this.commands=t},toString:function(){return this.commands.mkString(" ")}}),a.Command=MathJax.Object.Subclass({}),a.Command.Save=MathJax.Object.Subclass({Init:function(t){this.pos=t},toString:function(){return"\\save "+this.pos}}),a.Command.Restore=MathJax.Object.Subclass({toString:function(){return"\\restore"}}),a.Command.Pos=MathJax.Object.Subclass({Init:function(t){this.pos=t},toString:function(){return"\\POS "+this.pos}}),a.Command.AfterPos=MathJax.Object.Subclass({Init:function(t,e){this.decor=t,this.pos=e},toString:function(){return"\\afterPOS{"+this.decor+"} "+this.pos}}),a.Command.Drop=MathJax.Object.Subclass({Init:function(t){this.object=t},toString:function(){return"\\drop "+this.object}}),a.Command.Connect=MathJax.Object.Subclass({Init:function(t){this.object=t},toString:function(){return"\\connect "+this.object}}),a.Command.Relax=MathJax.Object.Subclass({toString:function(){return"\\relax"}}),a.Command.Ignore=MathJax.Object.Subclass({Init:function(t,e){this.pos=t,this.decor=e},toString:function(){return"\\ignore{"+this.pos+" "+this.decor+"}"}}),a.Command.ShowAST=MathJax.Object.Subclass({Init:function(t,e){this.pos=t,this.decor=e},toString:function(){return"\\xyshowAST{"+this.pos+" "+this.decor+"}"}}),a.Command.Path=MathJax.Object.Subclass({Init:function(t){this.path=t},toString:function(){return"\\PATH "+this.path}}),a.Command.AfterPath=MathJax.Object.Subclass({Init:function(t,e){this.decor=t,this.path=e},toString:function(){return"\\afterPATH{"+this.decor+"} "+this.path}}),a.Command.Path.Path=MathJax.Object.Subclass({Init:function(t){this.pathElements=t},toString:function(){return this.pathElements.mkString("[",", ","]")}}),a.Command.Path.SetBeforeAction=MathJax.Object.Subclass({Init:function(t){this.posDecor=t},toString:function(){return"~={"+this.posDecor+"}"}}),a.Command.Path.SetAfterAction=MathJax.Object.Subclass({Init:function(t){this.posDecor=t},toString:function(){return"~/{"+this.posDecor+"}"}}),a.Command.Path.AddLabelNextSegmentOnly=MathJax.Object.Subclass({Init:function(t){this.labels=t},toString:function(){return"~<{"+this.labels+"}"}}),a.Command.Path.AddLabelLastSegmentOnly=MathJax.Object.Subclass({Init:function(t){this.labels=t},toString:function(){return"~>{"+this.labels+"}"}}),a.Command.Path.AddLabelEverySegment=MathJax.Object.Subclass({Init:function(t){this.labels=t},toString:function(){return"~+{"+this.labels+"}"}}),a.Command.Path.StraightSegment=MathJax.Object.Subclass({Init:function(t){this.segment=t},toString:function(){return"'"+this.segment}}),a.Command.Path.TurningSegment=MathJax.Object.Subclass({Init:function(t,e){this.turn=t,this.segment=e},toString:function(){return"`"+this.turn+" "+this.segment}}),a.Command.Path.LastSegment=MathJax.Object.Subclass({Init:function(t){this.segment=t},toString:function(){return this.segment.toString()}}),a.Command.Path.Turn=MathJax.Object.Subclass({}),a.Command.Path.Turn.Diag=MathJax.Object.Subclass({Init:function(t,e){this.diag=t,this.radius=e},toString:function(){return this.diag.toString()+" "+this.radius}}),a.Command.Path.Turn.Cir=MathJax.Object.Subclass({Init:function(t,e){this.cir=t,this.radius=e},toString:function(){return this.cir.toString()+" "+this.radius}}),a.Command.Path.TurnRadius=MathJax.Object.Subclass({}),a.Command.Path.TurnRadius.Default=MathJax.Object.Subclass({toString:function(){return""}}),a.Command.Path.TurnRadius.Dimen=MathJax.Object.Subclass({Init:function(t){this.dimen=t},toString:function(){return"/"+this.dimen}}),a.Command.Path.Segment=MathJax.Object.Subclass({Init:function(t,e,n){this.pos=t,this.slide=e,this.labels=n},toString:function(){return this.pos.toString()+" "+this.slide+" "+this.labels}}),a.Command.Path.Labels=MathJax.Object.Subclass({Init:function(t){this.labels=t},toString:function(){return this.labels.mkString(" ")}}),a.Command.Path.Label=MathJax.Object.Subclass({Init:function(t,e,n){this.anchor=t,this.it=e,this.aliasOption=n}}),a.Command.Path.Label.Above=a.Command.Path.Label.Subclass({toString:function(){return"^("+this.anchor+" "+this.it+" "+this.aliasOption+")"}}),a.Command.Path.Label.Below=a.Command.Path.Label.Subclass({toString:function(){return"_("+this.anchor+" "+this.it+" "+this.aliasOption+")"}}),a.Command.Path.Label.At=a.Command.Path.Label.Subclass({toString:function(){return"|("+this.anchor+" "+this.it+" "+this.aliasOption+")"}}),a.Command.Ar=MathJax.Object.Subclass({Init:function(t,e){this.forms=t,this.path=e},toString:function(){return"\\ar "+this.forms.mkString(" ")+" "+this.path}}),a.Command.Ar.Form=MathJax.Object.Subclass({}),a.Command.Ar.Form.BuildArrow=a.Command.Ar.Form.Subclass({Init:function(t,e,n,i){this.variant=t,this.tailTip=e,this.stemConn=n,this.headTip=i},toString:function(){return"@"+this.variant+"{"+this.tailTip.toString()+", "+this.stemConn.toString()+", "+this.headTip.toString()+"}"}}),a.Command.Ar.Form.ChangeVariant=a.Command.Ar.Form.Subclass({Init:function(t){this.variant=t},toString:function(){return"@"+this.variant}}),a.Command.Ar.Form.Tip=MathJax.Object.Subclass({}),a.Command.Ar.Form.Tip.Tipchars=MathJax.Object.Subclass({Init:function(t){this.tipchars=t},toString:function(){return this.tipchars}}),a.Command.Ar.Form.Tip.Object=MathJax.Object.Subclass({Init:function(t){this.object=t},toString:function(){return"*"+this.object}}),a.Command.Ar.Form.Tip.Dir=MathJax.Object.Subclass({Init:function(t){this.dir=t},toString:function(){return this.dir}}),a.Command.Ar.Form.Conn=MathJax.Object.Subclass({}),a.Command.Ar.Form.Conn.Connchars=MathJax.Object.Subclass({Init:function(t){this.connchars=t},toString:function(){return this.connchars}}),a.Command.Ar.Form.Conn.Object=MathJax.Object.Subclass({Init:function(t){this.object=t},toString:function(){return"*"+this.object}}),a.Command.Ar.Form.Conn.Dir=MathJax.Object.Subclass({Init:function(t){this.dir=t},toString:function(){return this.dir}}),a.Command.Ar.Form.ChangeStem=MathJax.Object.Subclass({Init:function(t){this.connchar=t},toString:function(){return"@"+this.connchar}}),a.Command.Ar.Form.DashArrowStem=MathJax.Object.Subclass({toString:function(){return"@!"}}),a.Command.Ar.Form.CurveArrow=MathJax.Object.Subclass({Init:function(t,e){this.direction=t,this.dist=e},toString:function(){return"@/"+this.direction+" "+this.dist+"/"}}),a.Command.Ar.Form.CurveFitToDirection=MathJax.Object.Subclass({Init:function(t,e){this.outDirection=t,this.inDirection=e},toString:function(){return"@("+this.outDirection+","+this.inDirection+")"}}),a.Command.Ar.Form.CurveWithControlPoints=MathJax.Object.Subclass({Init:function(t){this.coord=t},toString:function(){return"@`{"+this.coord+"}"}}),a.Command.Ar.Form.AddShape=MathJax.Object.Subclass({Init:function(t){this.shape=t},toString:function(){return"@["+this.shape+"]"}}),a.Command.Ar.Form.AddModifiers=MathJax.Object.Subclass({Init:function(t){this.modifiers=t},toString:function(){return"@*{"+this.modifiers.mkString(" ")+"}"}}),a.Command.Ar.Form.Slide=MathJax.Object.Subclass({Init:function(t){this.slideDimen=t},toString:function(){return"@<"+this.slideDimen+">"}}),a.Command.Ar.Form.LabelAt=MathJax.Object.Subclass({Init:function(t,e){this.anchor=t,this.it=e},toString:function(){return"|"+this.anchor+" "+this.it}}),a.Command.Ar.Form.LabelAbove=MathJax.Object.Subclass({Init:function(t,e){this.anchor=t,this.it=e},toString:function(){return"^"+this.anchor+" "+this.it}}),a.Command.Ar.Form.LabelBelow=MathJax.Object.Subclass({Init:function(t,e){this.anchor=t,this.it=e},toString:function(){return"_"+this.anchor+" "+this.it}}),a.Command.Ar.Form.ReverseAboveAndBelow=MathJax.Object.Subclass({toString:function(){return"@?"}}),a.Command.Xymatrix=MathJax.Object.Subclass({Init:function(t,e){this.setup=t,this.rows=e},toString:function(){return"\\xymatrix"+this.setup+"{\n"+this.rows.mkString("","\\\\\n","")+"\n}"}}),a.Command.Xymatrix.Setup=MathJax.Object.Subclass({}),a.Command.Xymatrix.Setup.Prefix=MathJax.Object.Subclass({Init:function(t){this.prefix=t},toString:function(){return'"'+this.prefix+'"'}}),a.Command.Xymatrix.Setup.ChangeSpacing=MathJax.Object.Subclass({Init:function(t,e){this.addop=t,this.dimen=e}}),a.Command.Xymatrix.Setup.ChangeSpacing.Row=a.Command.Xymatrix.Setup.ChangeSpacing.Subclass({toString:function(){return"@R"+this.addop+this.dimen}}),a.Command.Xymatrix.Setup.ChangeSpacing.Column=a.Command.Xymatrix.Setup.ChangeSpacing.Subclass({toString:function(){return"@C"+this.addop+this.dimen}}),a.Command.Xymatrix.Setup.ChangeSpacing.RowAndColumn=a.Command.Xymatrix.Setup.ChangeSpacing.Subclass({toString:function(){return"@"+this.addop+this.dimen}}),a.Command.Xymatrix.Setup.PretendEntrySize=MathJax.Object.Subclass({Init:function(t){this.dimen=t}}),a.Command.Xymatrix.Setup.PretendEntrySize.Height=a.Command.Xymatrix.Setup.PretendEntrySize.Subclass({toString:function(){return"@!R="+this.dimen}}),a.Command.Xymatrix.Setup.PretendEntrySize.Width=a.Command.Xymatrix.Setup.PretendEntrySize.Subclass({toString:function(){return"@!C="+this.dimen}}),a.Command.Xymatrix.Setup.PretendEntrySize.HeightAndWidth=a.Command.Xymatrix.Setup.PretendEntrySize.Subclass({toString:function(){return"@!="+this.dimen}}),a.Command.Xymatrix.Setup.FixGrid=MathJax.Object.Subclass({}),a.Command.Xymatrix.Setup.FixGrid.Row=a.Command.Xymatrix.Setup.FixGrid.Subclass({toString:function(){return"@!R"}}),a.Command.Xymatrix.Setup.FixGrid.Column=a.Command.Xymatrix.Setup.FixGrid.Subclass({toString:function(){return"@!C"}}),a.Command.Xymatrix.Setup.FixGrid.RowAndColumn=a.Command.Xymatrix.Setup.FixGrid.Subclass({toString:function(){return"@!"}}),a.Command.Xymatrix.Setup.AdjustEntrySize=MathJax.Object.Subclass({Init:function(t,e){this.addop=t,this.dimen=e}}),a.Command.Xymatrix.Setup.AdjustEntrySize.Margin=a.Command.Xymatrix.Setup.AdjustEntrySize.Subclass({toString:function(){return"@M"+this.addop+this.dimen}}),a.Command.Xymatrix.Setup.AdjustEntrySize.Width=a.Command.Xymatrix.Setup.AdjustEntrySize.Subclass({toString:function(){return"@W"+this.addop+this.dimen}}),a.Command.Xymatrix.Setup.AdjustEntrySize.Height=a.Command.Xymatrix.Setup.AdjustEntrySize.Subclass({toString:function(){return"@H"+this.addop+this.dimen}}),a.Command.Xymatrix.Setup.AdjustLabelSep=MathJax.Object.Subclass({Init:function(t,e){this.addop=t,this.dimen=e},toString:function(){return"@L"+this.addop+this.dimen}}),a.Command.Xymatrix.Setup.SetOrientation=MathJax.Object.Subclass({Init:function(t){this.direction=t},toString:function(){return"@"+this.direction}}),a.Command.Xymatrix.Setup.AddModifier=MathJax.Object.Subclass({Init:function(t){this.modifier=t},toString:function(){return"@*"+this.modifier}}),a.Command.Xymatrix.Row=MathJax.Object.Subclass({Init:function(t){this.entries=t},toString:function(){return this.entries.mkString(" & ")}}),a.Command.Xymatrix.Entry=MathJax.Object.Subclass({}),a.Command.Xymatrix.Entry.SimpleEntry=a.Command.Xymatrix.Entry.Subclass({Init:function(t,e,n){this.modifiers=t,this.objectbox=e,this.decor=n},isEmpty:!1,toString:function(){return this.modifiers.mkString("**{","","}")+" "+this.objectbox+" "+this.decor}}),a.Command.Xymatrix.Entry.ObjectEntry=a.Command.Xymatrix.Entry.Subclass({Init:function(t,e,n){this.object=t,this.pos=e,this.decor=n},isEmpty:!1,toString:function(){return"*"+this.object+" "+this.pos+" "+this.decor}}),a.Command.Xymatrix.Entry.EmptyEntry=a.Command.Xymatrix.Entry.Subclass({Init:function(t){this.decor=t},isEmpty:!0,toString:function(){return""+this.decor}}),a.Command.Twocell=MathJax.Object.Subclass({Init:function(t,e,n){this.twocell=t,this.switches=e,this.arrow=n},toString:function(){return this.twocell.toString()+this.switches.mkString("")+this.arrow}}),a.Command.Twocell.Hops2cell=MathJax.Object.Subclass({Init:function(t,e){this.hops=t,this.maybeDisplace=e}}),a.Command.Twocell.Twocell=a.Command.Twocell.Hops2cell.Subclass({toString:function(){return"\\xtwocell["+this.hops+"]"+this.maybeDisplace.getOrElse("{}")}}),a.Command.Twocell.UpperTwocell=a.Command.Twocell.Hops2cell.Subclass({toString:function(){return"\\xuppertwocell["+this.hops+"]"+this.maybeDisplace.getOrElse("{}")}}),a.Command.Twocell.LowerTwocell=a.Command.Twocell.Hops2cell.Subclass({toString:function(){return"\\xlowertwocell["+this.hops+"]"+this.maybeDisplace.getOrElse("{}")}}),a.Command.Twocell.CompositeMap=a.Command.Twocell.Hops2cell.Subclass({toString:function(){return"\\xcompositemap["+this.hops+"]"+this.maybeDisplace.getOrElse("{}")}}),a.Command.Twocell.Switch=MathJax.Object.Subclass({}),a.Command.Twocell.Switch.UpperLabel=MathJax.Object.Subclass({Init:function(t){this.label=t},toString:function(){return"^"+this.label}}),a.Command.Twocell.Switch.LowerLabel=MathJax.Object.Subclass({Init:function(t){this.label=t},toString:function(){return"_"+this.label}}),a.Command.Twocell.Switch.SetCurvature=MathJax.Object.Subclass({Init:function(t){this.nudge=t},toString:function(){return this.nudge.toString()}}),a.Command.Twocell.Switch.DoNotSetCurvedArrows=MathJax.Object.Subclass({toString:function(){return"\\omit"}}),a.Command.Twocell.Switch.PlaceModMapObject=MathJax.Object.Subclass({toString:function(){return"~!"}}),a.Command.Twocell.Switch.ChangeHeadTailObject=MathJax.Object.Subclass({Init:function(t,e){this.what=t,this.object=e},toString:function(){return"~"+this.what+"{"+this.object+"}"}}),a.Command.Twocell.Switch.ChangeCurveObject=MathJax.Object.Subclass({Init:function(t,e,n){this.what=t,this.spacer=e,this.maybeObject=n},toString:function(){return"~"+this.what+"{"+this.spacer+(this.maybeObject.isDefined?"~**"+this.maybeObject.get:"")+"}"}}),a.Command.Twocell.Label=MathJax.Object.Subclass({Init:function(t,e){this.maybeNudge=t,this.labelObject=e},toString:function(){return this.maybeNudge.toString()+this.labelObject}}),a.Command.Twocell.Nudge=MathJax.Object.Subclass({}),a.Command.Twocell.Nudge.Number=a.Command.Twocell.Nudge.Subclass({Init:function(t){this.number=t},toString:function(){return"<"+this.number+">"}}),a.Command.Twocell.Nudge.Omit=a.Command.Twocell.Nudge.Subclass({toString:function(){return"<\\omit>"}}),a.Command.Twocell.Arrow=MathJax.Object.Subclass({}),a.Command.Twocell.Arrow.WithOrientation=a.Command.Twocell.Arrow.Subclass({Init:function(t,e){this.tok=t,this.labelObject=e},toString:function(){return"{["+this.tok+"] "+this.labelObject+"}"}}),a.Command.Twocell.Arrow.WithPosition=a.Command.Twocell.Arrow.Subclass({Init:function(t,e){this.nudge=t,this.labelObject=e},toString:function(){return"{["+this.nudge+"] "+this.labelObject+"}"}}),a.Command.Newdir=MathJax.Object.Subclass({Init:function(t,e){this.dirMain=t,this.compositeObject=e},toString:function(){return"\\newdir{"+this.dirMain+"}{"+this.compositeObject+"}"}}),a.Pos.Xyimport=MathJax.Object.Subclass({}),a.Pos.Xyimport.TeXCommand=a.Pos.Xyimport.Subclass({Init:function(t,e,n,i,r){this.width=t,this.height=e,this.xOffset=n,this.yOffset=i,this.graphics=r},toString:function(){return"\\xyimport("+this.width+", "+this.height+")("+this.xOffset+", "+this.yOffset+"){"+this.graphics+"}"}}),a.Pos.Xyimport.Graphics=a.Pos.Xyimport.Subclass({Init:function(t,e,n,i,r){this.width=t,this.height=e,this.xOffset=n,this.yOffset=i,this.graphics=r},toString:function(){return"\\xyimport("+this.width+", "+this.height+")("+this.xOffset+", "+this.yOffset+"){"+this.graphics+"}"}}),a.Command.Includegraphics=MathJax.Object.Subclass({Init:function(t,e,n){this.isClipped=t,this.attributeList=e,this.filepath=n},isIncludegraphics:!0,toString:function(){return"\\includegraphics"+(this.isClipped?"*":"")+this.attributeList.mkString("[",",","]")+"{"+this.filepath+"}"}}),a.Command.Includegraphics.Attr=MathJax.Object.Subclass({}),a.Command.Includegraphics.Attr.Width=a.Command.Includegraphics.Attr.Subclass({Init:function(t){this.dimen=t},toString:function(){return"width="+this.dimen}}),a.Command.Includegraphics.Attr.Height=a.Command.Includegraphics.Attr.Subclass({Init:function(t){this.dimen=t},toString:function(){return"height="+this.dimen}});var s=t.Parsers.fun,h=t.Parsers.elem,c=function(e){return s(t.Parsers.elem(e))},u=t.Parsers.literal,p=t.Parsers.regex,l=t.Parsers.regexLiteral,d=function(e){return s(t.Parsers.literal(e))},m=t.Parsers.seq,x=t.Parsers.or,f=function(e){return t.Parsers.lazyParser(e)().rep()},g=function(e){return t.Parsers.lazyParser(e)().rep1()},S=function(e){return t.Parsers.lazyParser(e)().opt()},y=t.Parsers.success,v=function(t){return function(){var e=t.memo;return void 0===e&&(e=t.memo=t()),e}},b=t.Parsers.Subclass({xy:v((function(){return b.posDecor().into((function(e){return t.Parsers.guard((function(){return u("\\end").andl(d("{")).andl(d("xy")).andl(d("}")).to((function(){return e}))}))}))})),xybox:v((function(){return u("{").andr(b.posDecor).andl(d("}")).to((function(t){return t}))})),xymatrixbox:v((function(){return b.xymatrix().to((function(e){return a.PosDecor(a.Pos.Coord(a.Coord.C(),t.List.empty),a.Decor(t.List.empty.append(e)))}))})),posDecor:v((function(){return m(b.pos,b.decor).to((function(t){return a.PosDecor(t.head,t.tail)}))})),pos:v((function(){return m(b.coord,f(b.pos2)).to((function(t){return a.Pos.Coord(t.head,t.tail)}))})),nonemptyPos:v((function(){return x(m(b.nonemptyCoord,f(b.pos2)),m(b.coord,g(b.pos2))).to((function(t){return a.Pos.Coord(t.head,t.tail)}))})),pos2:v((function(){return x(u("+").andr(b.coord).to((function(t){return a.Pos.Plus(t)})),u("-").andr(b.coord).to((function(t){return a.Pos.Minus(t)})),u("!").andr(b.coord).to((function(t){return a.Pos.Skew(t)})),u(".").andr(b.coord).to((function(t){return a.Pos.Cover(t)})),u(",").andr(b.coord).to((function(t){return a.Pos.Then(t)})),u(";").andr(b.coord).to((function(t){return a.Pos.SwapPAndC(t)})),u("::").andr(b.coord).to((function(t){return a.Pos.SetYBase(t)})),u(":").andr(b.coord).to((function(t){return a.Pos.SetBase(t)})),u("**").andr(b.object).to((function(t){return a.Pos.ConnectObject(t)})),u("*").andr(b.object).to((function(t){return a.Pos.DropObject(t)})),u("?").andr(b.place).to((function(t){return a.Pos.Place(t)})),u("@+").andr(b.coord).to((function(t){return a.Pos.PushCoord(t)})),u("@-").andr(b.coord).to((function(t){return a.Pos.EvalCoordThenPop(t)})),u("@=").andr(b.coord).to((function(t){return a.Pos.LoadStack(t)})),u("@@").andr(b.coord).to((function(t){return a.Pos.DoCoord(t)})),u("@i").to((function(){return a.Pos.InitStack()})),u("@(").to((function(){return a.Pos.EnterFrame()})),u("@)").to((function(){return a.Pos.LeaveFrame()})),u("=:").andr(d('"')).andr(b.id).andl(c('"')).to((function(t){return a.Pos.SaveBase(t)})),u("=@").andr(d('"')).andr(b.id).andl(c('"')).to((function(t){return a.Pos.SaveStack(t)})),u("=").andr(d('"')).andr(b.id).andl(c('"')).to((function(t){return a.Pos.SavePos(t)})),u("=").andr(b.nonemptyCoord).andl(d('"')).and(b.id).andl(c('"')).to((function(t){return a.Pos.SaveMacro(t.head,t.tail)})),b.xyimport)})),coord:v((function(){return x(b.nonemptyCoord,y("empty").to((function(){return a.Coord.C()})))})),nonemptyCoord:v((function(){return x(u("c").to((function(){return a.Coord.C()})),u("p").to((function(){return a.Coord.P()})),u("x").to((function(){return a.Coord.X()})),u("y").to((function(){return a.Coord.Y()})),b.vector().to((function(t){return a.Coord.Vector(t)})),u('"').andr(b.id).andl(c('"')).to((function(t){return a.Coord.Id(t)})),u("{").andr(b.posDecor).andl(d("}")).to((function(t){return a.Coord.Group(t)})),u("s").andr(s(l(/^\d/))).to((function(t){return a.Coord.StackPosition(parseInt(t))})),u("s").andr(d("{")).and(b.nonnegativeNumber).andl(d("}")).to((function(t){return a.Coord.StackPosition(t)})),u("[").andr(s(S(u('"').andr(b.id).andl(c('"'))).to((function(t){return t.getOrElse("")})))).and(b.number).andl(d(",")).and(b.number).andl(d("]")).to((function(t){return a.Coord.DeltaRowColumn(t.head.head,t.head.tail,t.tail)})),u("[").andr(s(S(u('"').andr(b.id).andl(c('"'))).to((function(t){return t.getOrElse("")})))).and(s(f(p(/^[lrud]/)))).andl(d("]")).to((function(t){return a.Coord.Hops(t.head,t.tail)})),u("[").andr(s(S(u('"').andr(b.id).andl(c('"'))).to((function(t){return t.getOrElse("")})))).and(s(g(p(/^[lrud]/)))).and(b.place).andl(d("]")).to((function(t){return a.Coord.DeltaRowColumn(t.head.head,t.head.tail,a.Pos.Place(t.tail))})))})),vector:v((function(){return x(u("(").andr(b.factor).andl(d(",")).and(b.factor).andl(d(")")).to((function(t){return a.Vector.InCurBase(t.head,t.tail)})),u("<").andr(b.dimen).andl(d(",")).and(b.dimen).andl(d(">")).to((function(t){return a.Vector.Abs(t.head,t.tail)})),u("<").andr(b.dimen).andl(d(">")).to((function(t){return a.Vector.Abs(t,t)})),u("a").andr(d("(")).andr(b.number).andl(d(")")).to((function(t){return a.Vector.Angle(t)})),u("/").andr(b.direction).and(b.looseDimen).andl(d("/")).to((function(t){return a.Vector.Dir(t.head,t.tail)})),u("0").to((function(t){return a.Vector.Abs("0mm","0mm")})),(function(){return b.corner().and(s(t.Parsers.opt(s(u("(").andr(b.factor).andl(d(")")))).to((function(t){return t.getOrElse(1)})))).to((function(t){return a.Vector.Corner(t.head,t.tail)}))}))})),corner:v((function(){return x(l(/^(CL|LC)/).to((function(){return a.Corner.CL()})),l(/^(CR|RC)/).to((function(){return a.Corner.CR()})),l(/^(CD|DC)/).to((function(){return a.Corner.CD()})),l(/^(CU|UC)/).to((function(){return a.Corner.CU()})),l(/^(LD|DL)/).to((function(){return a.Corner.LD()})),l(/^(RD|DR)/).to((function(){return a.Corner.RD()})),l(/^(LU|UL)/).to((function(){return a.Corner.LU()})),l(/^(RU|UR)/).to((function(){return a.Corner.RU()})),u("L").to((function(){return a.Corner.L()})),u("R").to((function(){return a.Corner.R()})),u("D").to((function(){return a.Corner.D()})),u("U").to((function(){return a.Corner.U()})),u("E").to((function(){return a.Corner.NearestEdgePoint()})),u("P").to((function(){return a.Corner.PropEdgePoint()})),u("A").to((function(){return a.Corner.Axis()})))})),place:v((function(){return x(u("<").andr(b.place).to((function(t){return a.Place(1,0,void 0,void 0).compound(t)})),u(">").andr(b.place).to((function(t){return a.Place(0,1,void 0,void 0).compound(t)})),u("(").andr(b.factor).andl(d(")")).and(b.place).to((function(t){return a.Place(0,0,a.Place.Factor(t.head),void 0).compound(t.tail)})),u("!").andr(d("{")).andr(b.pos).andl(d("}")).and(b.slide).to((function(t){return a.Place(0,0,a.Place.Intercept(t.head),t.tail)})),(function(){return b.slide().to((function(t){return a.Place(0,0,void 0,t)}))}))})),slide:v((function(){return x(u("/").andr(b.dimen).andl(d("/")).to((function(e){return a.Slide(t.Option.Some(e))})),y("no slide").to((function(){return a.Slide(t.Option.empty)})))})),factor:v(s(l(/^[+\-]?(\d+(\.\d*)?|\d*\.\d+)/).to((function(t){return parseFloat(t)})))),number:v(s(l(/^[+\-]?\d+/).to((function(t){return parseInt(t)})))),nonnegativeNumber:v(s(l(/^\d+/).to((function(t){return parseInt(t)})))),unit:v(s(l(/^(em|ex|px|pt|pc|in|cm|mm|mu)/).to((function(t){return t})))),dimen:v((function(){return b.factor().and(b.unit).to((function(t){return t.head.toString()+t.tail}))})),looseDimen:v((function(){return b.looseFactor().and(b.unit).to((function(t){return t.head.toString()+t.tail}))})),looseFactor:v(s(x(l(/^(\d \d*(\.\d*))/).to((function(t){return parseFloat(t.replace(/ /,""))})),l(/^[+\-]?(\d+(\.\d*)?|\d*\.\d+)/).to((function(t){return parseFloat(t)}))))),id:v(s(p(/^[^"]+/))),object:v((function(){return x(f(b.modifier).and(b.objectbox).to((function(t){return a.Object(t.head,t.tail)})))})),objectbox:v((function(){return x(b.mathText,u("@").andr(b.dir),u("\\dir").andr(b.dir),u("\\cir").andr(b.cirRadius).andl(d("{")).and(b.cir).andl(d("}")).to((function(t){return a.ObjectBox.Cir(t.head,t.tail)})),u("\\frm").andr(b.frameRadius).andl(d("{")).and(b.frameMain).andl(d("}")).to((function(t){return a.ObjectBox.Frame(t.head,t.tail)})),u("\\object").andr(b.object).to((function(t){return a.ObjectBox.WrapUpObject(t)})),u("\\composite").and(d("{")).andr(b.compositeObject).andl(d("}")).to((function(t){return a.ObjectBox.CompositeObject(t)})),u("\\xybox").and(d("{")).andr(b.posDecor).andl(d("}")).to((function(t){return a.ObjectBox.Xybox(t)})),u("\\xymatrix").andr(b.xymatrix).to((function(t){return a.ObjectBox.Xymatrix(t)})),b.txt,b.curve,p(/^(\\[a-zA-Z@][a-zA-Z0-9@]+)/).andl(d("{")).and(b.text).andl(d("}")).to((function(t){return b.toMath(t.head+"{"+t.tail+"}")})))})),compositeObject:v((function(){return b.object().and(s(f(u("*").andr(b.object)))).to((function(t){return t.tail.prepend(t.head)}))})),mathText:v((function(){return u("{").andr(b.text).andl(c("}")).to((function(t){return b.toMath("\\hbox{$\\objectstyle{"+t+"}$}")}))})),toMath:function(t){var i=n.Parse(t).mml();return i=i.inferred?e.apply(MathJax.ElementJax,i.data):e(i),n.combineRelations(i.root),a.ObjectBox.Text(i.root)},text:v((function(){return p(/^[^{}\\%]*/).and((function(){return x(p(/^(\\\{|\\\}|\\%|\\)/).to((function(t){return t})),h("{").andr(b.text).andl(c("}")).to((function(t){return"{"+t+"}"})),p(/^%[^\r\n]*(\r\n|\r|\n)?/).to((function(t){return" "}))).and(s(p(/^[^{}\\%]*/))).rep().to((function(t){var e="";return t.foreach((function(t){e+=t.head+t.tail})),e}))})).to((function(t){return t.head+t.tail}))})),txt:v((function(){return u("\\txt").andr(b.txtWidth).and(s(p(/^(\\[a-zA-Z@][a-zA-Z0-9@]+)?/))).andl(d("{")).and(b.text).andl(d("}")).to((function(t){var e,n=t.head.head,i=t.head.tail,r=t.tail,o=r.split("\\\\");if(o.length<=1)e=i+"{\\hbox{"+r+"}}";else{e="\\hbox{$\\begin{array}{c}\n";for(var s=0;s<o.length;s++)e+=i+"{\\hbox{"+o[s].replace(/(^[\r\n\s]+)|([\r\n\s]+$)/g,"")+"}}",s!=o.length-1&&(e+="\\\\\n");e+="\\end{array}$}"}return a.ObjectBox.Txt(n,b.toMath(e))}))})),txtWidth:v((function(){return x(u("<").andr(b.dimen).andl(d(">")).to((function(t){return a.Vector.Abs(t,t)})).to((function(t){return a.ObjectBox.Txt.Width.Vector(t)})),y("default").to((function(){return a.ObjectBox.Txt.Width.Default()})))})),dir:v((function(){return l(/^[\^_0123]/).opt().andl(d("{")).and(b.dirMain).andl(d("}")).to((function(t){return a.ObjectBox.Dir(t.head.getOrElse(""),t.tail)}))})),dirMain:v((function(){return p(/^(-|\.|~|>|<|\(|\)|`|'|\||\*|\+|x|\/|o|=|:|[a-zA-Z@ ])+/).opt().to((function(t){return t.getOrElse("")}))})),cirRadius:v((function(){return x(b.vector().to((function(t){return a.ObjectBox.Cir.Radius.Vector(t)})),y("default").to((function(){return a.ObjectBox.Cir.Radius.Default()})))})),frameRadius:v((function(){return x(b.frameRadiusVector().to((function(t){return a.ObjectBox.Frame.Radius.Vector(t)})),y("default").to((function(){return a.ObjectBox.Frame.Radius.Default()})))})),frameRadiusVector:v((function(){return x(u("<").andr(b.dimen).andl(d(",")).and(b.dimen).andl(d(">")).to((function(t){return a.Vector.Abs(t.head,t.tail)})),u("<").andr(b.dimen).andl(d(">")).to((function(t){return a.Vector.Abs(t,t)})))})),frameMain:v((function(){return p(/^(((_|\^)?(\\\{|\\\}|\(|\)))|[\-=oe,\.\*]*)/)})),cir:v((function(){return x(b.nonemptyCir,y("full").to((function(){return a.ObjectBox.Cir.Cir.Full()})))})),nonemptyCir:v((function(){return b.diag().and(s(l(/^[_\^]/))).and(b.diag).to((function(t){return a.ObjectBox.Cir.Cir.Segment(t.head.head,t.head.tail,t.tail)}))})),curve:v((function(){return u("\\crv").andr(b.curveModifier).andl(d("{")).and(b.curveObject).and(b.curvePoslist).andl(d("}")).to((function(t){return a.ObjectBox.Curve(t.head.head,t.head.tail,t.tail)}))})),curveModifier:v((function(){return f(s(u("~").andr(b.curveOption)))})),curveOption:v((function(){return x(u("p").to((function(){return a.ObjectBox.Curve.Modifier.p()})),u("P").to((function(){return a.ObjectBox.Curve.Modifier.P()})),u("l").to((function(){return a.ObjectBox.Curve.Modifier.l()})),u("L").to((function(){return a.ObjectBox.Curve.Modifier.L()})),u("c").to((function(){return a.ObjectBox.Curve.Modifier.c()})),u("C").to((function(){return a.ObjectBox.Curve.Modifier.C()})),u("pc").to((function(){return a.ObjectBox.Curve.Modifier.pc()})),u("pC").to((function(){return a.ObjectBox.Curve.Modifier.pC()})),u("Pc").to((function(){return a.ObjectBox.Curve.Modifier.Pc()})),u("PC").to((function(){return a.ObjectBox.Curve.Modifier.PC()})),u("lc").to((function(){return a.ObjectBox.Curve.Modifier.lc()})),u("lC").to((function(){return a.ObjectBox.Curve.Modifier.lC()})),u("Lc").to((function(){return a.ObjectBox.Curve.Modifier.Lc()})),u("LC").to((function(){return a.ObjectBox.Curve.Modifier.LC()})),u("cC").to((function(){return a.ObjectBox.Curve.Modifier.cC()})))})),curveObject:v((function(){return f(x(u("~*").andr(b.object).to((function(t){return a.ObjectBox.Curve.Object.Drop(t)})),u("~**").andr(b.object).to((function(t){return a.ObjectBox.Curve.Object.Connect(t)}))))})),curvePoslist:v((function(){return x(u("&").andr(b.curvePoslist2).to((function(t){return t.prepend(a.ObjectBox.Curve.PosList.CurPos())})),u("~@").andr(d("&")).andr(b.curvePoslist2).to((function(t){return t.prepend(a.ObjectBox.Curve.PosList.AddStack())})),u("~@").to((function(){return t.List.empty.prepend(a.ObjectBox.Curve.PosList.AddStack())})),b.pos().andl(d("&")).and(b.curvePoslist2).to((function(t){return t.tail.prepend(a.ObjectBox.Curve.PosList.Pos(t.head))})),b.nonemptyPos().to((function(e){return t.List.empty.prepend(a.ObjectBox.Curve.PosList.Pos(e))})),y("empty").to((function(){return t.List.empty})))})),curvePoslist2:v((function(){return x(u("&").andr(b.curvePoslist2).to((function(t){return t.prepend(a.ObjectBox.Curve.PosList.CurPos())})),u("~@").andr(d("&")).andr(b.curvePoslist2).to((function(t){return t.prepend(a.ObjectBox.Curve.PosList.AddStack())})),u("~@").to((function(){return t.List.empty.prepend(a.ObjectBox.Curve.PosList.AddStack())})),b.nonemptyPos().andl(d("&")).and(b.curvePoslist2).to((function(t){return t.tail.prepend(a.ObjectBox.Curve.PosList.Pos(t.head))})),b.nonemptyPos().to((function(e){return t.List.empty.prepend(a.ObjectBox.Curve.PosList.Pos(e))})),y("empty").to((function(){return t.List.empty.prepend(a.ObjectBox.Curve.PosList.CurPos())})))})),modifier:v((function(){return x(u("!").andr(b.vector).to((function(t){return a.Modifier.Vector(t)})),u("!").to((function(t){return a.Modifier.RestoreOriginalRefPoint()})),u("[").andr(b.shape).andl(d("]")).to((function(t){return t})),u("i").to((function(t){return a.Modifier.Invisible()})),u("h").to((function(t){return a.Modifier.Hidden()})),b.addOp().and(b.size).to((function(t){return a.Modifier.AddOp(t.head,t.tail)})),b.nonemptyDirection().to((function(t){return a.Modifier.Direction(t)})))})),addOp:v((function(){return x(u("+=").to((function(){return a.Modifier.AddOp.GrowTo()})),u("-=").to((function(){return a.Modifier.AddOp.ShrinkTo()})),u("+").to((function(){return a.Modifier.AddOp.Grow()})),u("-").to((function(){return a.Modifier.AddOp.Shrink()})),u("=").to((function(){return a.Modifier.AddOp.Set()})))})),size:v((function(){return x((function(){return b.vector().to((function(t){return a.Modifier.AddOp.VactorSize(t)}))}),y("default size").to((function(){return a.Modifier.AddOp.DefaultSize()})))})),shape:v((function(){return x(u(".").to((function(){return a.Modifier.Shape.Point()})),b.frameShape,b.alphabets().to((function(t){return a.Modifier.Shape.Alphabets(t)})),u("=").andr(b.alphabets).to((function(t){return a.Modifier.Shape.DefineShape(t)})),y("rect").to((function(){return a.Modifier.Shape.Rect()})))})),frameShape:v((function(){return u("F").andr(b.frameMain).and(s(f(u(":").andr(s(x(b.frameRadiusVector().to((function(t){return a.Modifier.Shape.Frame.Radius(t)})),b.colorName().to((function(t){return a.Modifier.Shape.Frame.Color(t)})))))))).to((function(t){var e=t.head;return""===e&&(e="-"),a.Modifier.Shape.Frame(e,t.tail)}))})),alphabets:v((function(){return p(/^([a-zA-Z]+)/)})),colorName:v((function(){return p(/^([a-zA-Z][a-zA-Z0-9]*)/)})),direction:v((function(){return m(b.direction0,f(b.direction1)).to((function(t){return a.Direction.Compound(t.head,t.tail)}))})),direction0:v((function(){return x(b.direction2,b.diag().to((function(t){return a.Direction.Diag(t)})))})),direction1:v((function(){return x(u(":").andr(b.vector).to((function(t){return a.Direction.RotVector(t)})),u("_").to((function(t){return a.Direction.RotAntiCW()})),u("^").to((function(t){return a.Direction.RotCW()})))})),direction2:v((function(){return x(u("v").andr(b.vector).to((function(t){return a.Direction.Vector(t)})),u("q").andr(d("{")).andr(b.posDecor).andl(d("}")).to((function(t){return a.Direction.ConstructVector(t)})))})),nonemptyDirection:v((function(){return x(m(b.nonemptyDirection0,f(b.direction1)),m(b.direction0,g(b.direction1))).to((function(t){return a.Direction.Compound(t.head,t.tail)}))})),nonemptyDirection0:v((function(){return x(b.direction2,b.nonemptyDiag().to((function(t){return a.Direction.Diag(t)})))})),diag:v((function(){return x(b.nonemptyDiag,y("empty").to((function(t){return a.Diag.Default()})))})),nonemptyDiag:v((function(){return x(l(/^(ld|dl)/).to((function(t){return a.Diag.LD()})),l(/^(rd|dr)/).to((function(t){return a.Diag.RD()})),l(/^(lu|ul)/).to((function(t){return a.Diag.LU()})),l(/^(ru|ur)/).to((function(t){return a.Diag.RU()})),u("l").to((function(t){return a.Diag.L()})),u("r").to((function(t){return a.Diag.R()})),u("d").to((function(t){return a.Diag.D()})),u("u").to((function(t){return a.Diag.U()})))})),decor:v((function(){return b.command().rep().to((function(t){return a.Decor(t)}))})),command:v((function(){return x(u("\\ar").andr(s(f(b.arrowForm))).and(b.path).to((function(t){return a.Command.Ar(t.head,t.tail)})),u("\\xymatrix").andr(b.xymatrix),u("\\PATH").andr(b.path).to((function(t){return a.Command.Path(t)})),u("\\afterPATH").andr(d("{")).andr(b.decor).andl(d("}")).and(b.path).to((function(t){return a.Command.AfterPath(t.head,t.tail)})),u("\\save").andr(b.pos).to((function(t){return a.Command.Save(t)})),u("\\restore").to((function(){return a.Command.Restore()})),u("\\POS").andr(b.pos).to((function(t){return a.Command.Pos(t)})),u("\\afterPOS").andr(d("{")).andr(b.decor).andl(d("}")).and(b.pos).to((function(t){return a.Command.AfterPos(t.head,t.tail)})),u("\\drop").andr(b.object).to((function(t){return a.Command.Drop(t)})),u("\\connect").andr(b.object).to((function(t){return a.Command.Connect(t)})),u("\\relax").to((function(){return a.Command.Relax()})),u("\\xyignore").andr(d("{")).andr(b.pos).and(b.decor).andl(d("}")).to((function(t){return a.Command.Ignore(t.head,t.tail)})),u("\\xyshowAST").andr(d("{")).andr(b.pos).and(b.decor).andl(d("}")).to((function(t){return a.Command.ShowAST(t.head,t.tail)})),b.twocellCommand)})),arrowForm:v((function(){return x(u("@").andr(s(p(/^([\-\.~=:])/))).to((function(t){return a.Command.Ar.Form.ChangeStem(t)})),u("@").andr(d("!")).to((function(t){return a.Command.Ar.Form.DashArrowStem()})),u("@").andr(d("/")).andr(b.direction).and(s(S(b.looseDimen))).andl(d("/")).to((function(t){return a.Command.Ar.Form.CurveArrow(t.head,t.tail.getOrElse(".5pc"))})),u("@").andr(d("(")).andr(b.direction).andl(d(",")).and(b.direction).andl(d(")")).to((function(t){return a.Command.Ar.Form.CurveFitToDirection(t.head,t.tail)})),u("@").andr(d("`")).andr(b.coord).to((function(t){return a.Command.Ar.Form.CurveWithControlPoints(t)})),u("@").andr(d("[")).andr(b.shape).andl(d("]")).to((function(t){return a.Command.Ar.Form.AddShape(t)})),u("@").andr(d("*")).andr(d("{")).andr(s(f(b.modifier))).andl(d("}")).to((function(t){return a.Command.Ar.Form.AddModifiers(t)})),u("@").andr(d("<")).andr(b.dimen).andl(d(">")).to((function(t){return a.Command.Ar.Form.Slide(t)})),u("|").andr(b.anchor).and(b.it).to((function(t){return a.Command.Ar.Form.LabelAt(t.head,t.tail)})),u("^").andr(b.anchor).and(b.it).to((function(t){return a.Command.Ar.Form.LabelAbove(t.head,t.tail)})),u("_").andr(b.anchor).and(b.it).to((function(t){return a.Command.Ar.Form.LabelBelow(t.head,t.tail)})),u("@").andr(d("?")).to((function(){return a.Command.Ar.Form.ReverseAboveAndBelow()})),u("@").andr(s(p(/^([\^_0123])/).opt())).and(s(S(b.tipConnTip))).to((function(t){var e=t.head.getOrElse("");if(t.tail.isDefined){var n=t.tail.get;return a.Command.Ar.Form.BuildArrow(e,n.tail,n.stem,n.head)}return a.Command.Ar.Form.ChangeVariant(e)})))})),tipConnTip:v((function(){return u("{").andr(s(S(b.nonemptyTip))).and(s(S(b.nonemptyConn))).and(s(S(b.nonemptyTip))).andl(d("}")).to((function(t){var e,n,i,r=t.head.head,o=t.head.tail,s=t.tail,h=a.Command.Ar.Form.Tip.Tipchars("");return o.isDefined||s.isDefined?(e=r.getOrElse(h),n=o.getOrElse(a.Command.Ar.Form.Conn.Connchars("")),i=s.getOrElse(h)):r.isDefined?(e=h,n=a.Command.Ar.Form.Conn.Connchars("-"),i=r.getOrElse(h)):(e=h,n=a.Command.Ar.Form.Conn.Connchars(""),i=h),{tail:e,stem:n,head:i}}))})),nonemptyTip:v((function(){return x(p(/^([<>()|'`+\/a-zA-Z ]+)/).to((function(t){return a.Command.Ar.Form.Tip.Tipchars(t)})),u("*").andr(b.object).to((function(t){return a.Command.Ar.Form.Tip.Object(t)})),b.dir().to((function(t){return a.Command.Ar.Form.Tip.Dir(t)})))})),nonemptyConn:v((function(){return x(p(/^([\-\.~=:]+)/).to((function(t){return a.Command.Ar.Form.Conn.Connchars(t)})),u("*").andr(b.object).to((function(t){return a.Command.Ar.Form.Conn.Object(t)})),b.dir().to((function(t){return a.Command.Ar.Form.Conn.Dir(t)})))})),path:v((function(){return b.path2(t.List.empty).to((function(t){return a.Command.Path.Path(t)}))})),path2:function(e){var n=v((function(){return b.path2(e)}));return x(b.path3().and(n).to((function(t){return t.tail.prepend(t.head)})),m("~","{",n,"}").to((function(t){return t.head.tail})).into((function(t){return b.path2(t)})),b.segment().to((function(e){return t.List.empty.prepend(a.Command.Path.LastSegment(e))})),y(e).to((function(t){return t})))},path3:v((function(){return x(m("~","=","{",b.posDecor,"}").to((function(t){return a.Command.Path.SetBeforeAction(t.head.tail)})),m("~","/","{",b.posDecor,"}").to((function(t){return a.Command.Path.SetAfterAction(t.head.tail)})),m("~","<","{",b.labels,"}").to((function(t){return a.Command.Path.AddLabelNextSegmentOnly(t.head.tail)})),m("~",">","{",b.labels,"}").to((function(t){return a.Command.Path.AddLabelLastSegmentOnly(t.head.tail)})),m("~","+","{",b.labels,"}").to((function(t){return a.Command.Path.AddLabelEverySegment(t.head.tail)})),m("'",b.segment).to((function(t){return a.Command.Path.StraightSegment(t.tail)})),m("`",b.turn,b.segment).to((function(t){return a.Command.Path.TurningSegment(t.head.tail,t.tail)})))})),turn:v((function(){return x(b.nonemptyCir().and(b.turnRadius).to((function(t){return a.Command.Path.Turn.Cir(t.head,t.tail)})),b.diag().and(b.turnRadius).to((function(t){return a.Command.Path.Turn.Diag(t.head,t.tail)})))})),turnRadius:v((function(){return x(u("/").andr(b.dimen).to((function(t){return a.Command.Path.TurnRadius.Dimen(t)})),y("default").to((function(){return a.Command.Path.TurnRadius.Default()})))})),segment:v((function(){return b.nonemptyPos().and(b.pathSlide).and(b.labels).to((function(t){return a.Command.Path.Segment(t.head.head,t.head.tail,t.tail)}))})),pathSlide:v((function(){return x(u("<").andr(b.dimen).andl(d(">")).to((function(e){return a.Slide(t.Option.Some(e))})),y("no slide").to((function(){return a.Slide(t.Option.empty)})))})),labels:v((function(){return b.label().rep().to((function(t){return a.Command.Path.Labels(t)}))})),label:v((function(){return x(m("^",b.anchor,b.it,b.alias).to((function(t){return a.Command.Path.Label.Above(a.Pos.Place(t.head.head.tail),t.head.tail,t.tail)})),m("_",b.anchor,b.it,b.alias).to((function(t){return a.Command.Path.Label.Below(a.Pos.Place(t.head.head.tail),t.head.tail,t.tail)})),m("|",b.anchor,b.it,b.alias).to((function(t){return a.Command.Path.Label.At(a.Pos.Place(t.head.head.tail),t.head.tail,t.tail)})))})),anchor:v((function(){return x(u("-").andr(b.anchor).to((function(t){return a.Place(1,1,a.Place.Factor(.5),void 0).compound(t)})),b.place)})),it:v((function(){return f(u("[").andr(b.shape).andl(d("]")).to((function(t){return t}))).and(b.it2).to((function(t){return a.Object(t.head.concat(t.tail.modifiers),t.tail.object)}))})),it2:v((function(){return x(l(/^[0-9a-zA-Z]/).to((function(e){return a.Object(t.List.empty,b.toMath("\\labelstyle "+e))})),l(/^(\\[a-zA-Z][a-zA-Z0-9]*)/).to((function(e){return a.Object(t.List.empty,b.toMath("\\labelstyle "+e))})),u("{").andr(b.text).andl(c("}")).to((function(e){return a.Object(t.List.empty,b.toMath("\\labelstyle "+e))})),u("*").andr(b.object),u("@").andr(b.dir).to((function(e){return a.Object(t.List.empty,e)})))})),alias:v((function(){return m("=",'"',b.id,'"').opt().to((function(t){return t.map((function(t){return t.head.tail}))}))})),xymatrix:v((function(){return b.setup().andl(d("{")).and(b.rows).andl(d("}")).to((function(t){return a.Command.Xymatrix(t.head,t.tail)}))})),setup:v((function(){return f(s(x(u('"').andr(s(p(/^[^"]+/))).andl(c('"')).to((function(t){return a.Command.Xymatrix.Setup.Prefix(t)})),u("@!").andr(s(p(/^[RC]/).opt().to((function(t){return t.getOrElse("")})))).and(s(x(h("0").to((function(){return"0em"})),h("=").andr(b.dimen)))).to((function(t){var e=t.tail;switch(t.head){case"R":return a.Command.Xymatrix.Setup.PretendEntrySize.Height(e);case"C":return a.Command.Xymatrix.Setup.PretendEntrySize.Width(e);default:return a.Command.Xymatrix.Setup.PretendEntrySize.HeightAndWidth(e)}})),u("@!").andr(s(x(h("R").to((function(){return a.Command.Xymatrix.Setup.FixGrid.Row()})),h("C").to((function(){return a.Command.Xymatrix.Setup.FixGrid.Column()}))).opt().to((function(t){return t.getOrElse(a.Command.Xymatrix.Setup.FixGrid.RowAndColumn())})))),u("@").andr(s(p(/^[MWHL]/))).and(b.addOp).and(b.dimen).to((function(t){var e=t.head.tail,n=t.tail;switch(t.head.head){case"M":return a.Command.Xymatrix.Setup.AdjustEntrySize.Margin(e,n);case"W":return a.Command.Xymatrix.Setup.AdjustEntrySize.Width(e,n);case"H":return a.Command.Xymatrix.Setup.AdjustEntrySize.Height(e,n);case"L":return a.Command.Xymatrix.Setup.AdjustLabelSep(e,n)}})),u("@").andr(b.nonemptyDirection).to((function(t){return a.Command.Xymatrix.Setup.SetOrientation(t)})),u("@*[").andr(b.shape).andl(d("]")).to((function(t){return a.Command.Xymatrix.Setup.AddModifier(t)})),u("@*").andr(b.addOp).and(b.size).to((function(t){return a.Command.Xymatrix.Setup.AddModifier(a.Modifier.AddOp(t.head,t.tail))})),u("@").andr(s(p(/^[RC]/).opt().to((function(t){return t.getOrElse("")})))).and(b.addOp).and(b.dimen).to((function(t){var e=t.head.tail,n=t.tail;switch(t.head.head){case"R":return a.Command.Xymatrix.Setup.ChangeSpacing.Row(e,n);case"C":return a.Command.Xymatrix.Setup.ChangeSpacing.Column(e,n);default:return a.Command.Xymatrix.Setup.ChangeSpacing.RowAndColumn(e,n)}})),u("@1").to((function(){return a.Command.Xymatrix.Setup.AdjustEntrySize.Margin(a.Modifier.AddOp.Set(),"1pc")})))))})),rows:v((function(){return b.row().and(s(f(u("\\\\").andr(b.row)))).to((function(t){var e=t.tail.prepend(t.head);if(!e.isEmpty){var n=e.at(e.length()-1);1===n.entries.length()&&n.entries.at(0).isEmpty&&(e=e.reverse().tail.reverse())}return e}))})),row:v((function(){return b.entry().and(s(f(u("&").andr(b.entry)))).to((function(t){return a.Command.Xymatrix.Row(t.tail.prepend(t.head))}))})),entry:v((function(){return x(u("*").andr(b.object).and(b.pos).and(b.decor).to((function(t){var e=t.head.head,n=t.head.tail,i=t.tail;return a.Command.Xymatrix.Entry.ObjectEntry(e,n,i)})),b.entryModifier().rep().and(b.looseObjectbox).and(b.decor).to((function(e){var n=e.head.head.foldLeft(t.List.empty,(function(t,e){return e.concat(t)})),i=e.head.tail.isEmpty,r=e.head.tail.object,o=e.tail;return i&&n.isEmpty?a.Command.Xymatrix.Entry.EmptyEntry(o):a.Command.Xymatrix.Entry.SimpleEntry(n,r,o)})))})),entryModifier:v((function(){return x(u("**").andr(d("[")).andr(b.shape).andl(d("]")).to((function(e){return t.List.empty.append(e)})),u("**").andr(d("{")).andr(s(f(b.modifier))).andl(d("}")))})),looseObjectbox:v((function(){return x(b.objectbox().to((function(t){return{isEmpty:!1,object:t}})),p(/^[^\\{}%&]+/).opt().to((function(t){return t.getOrElse("")})).and(s(f(x(h("{").andr(b.text).andl(c("}")).to((function(t){return"{"+t+"}"})),h("\\").andr(s((e=p(/^(\\|ar|xymatrix|PATH|afterPATH|save|restore|POS|afterPOS|drop|connect|xyignore|([lrud]+(twocell|uppertwocell|lowertwocell|compositemap))|xtwocell|xuppertwocell|xlowertwocell|xcompositemap)/),t.Parsers.not(t.Parsers.lazyParser(e))))).andr(s(p(/^[{}%&]/).opt().to((function(t){return t.getOrElse("")})))).to((function(t){return"\\"+t})),p(/^%[^\r\n]*(\r\n|\r|\n)?/).to((function(t){return" "}))).and(s(p(/^[^\\{}%&]+/).opt().to((function(t){return t.getOrElse("")})))).to((function(t){return t.head+t.tail}))).to((function(t){return t.mkString("")})))).to((function(t){var e=t.head+t.tail;return{isEmpty:0===e.trim().length,object:b.toMath("\\hbox{$\\objectstyle{"+e+"}$}")}})));var e})),twocellCommand:v((function(){return b.twocell().and(s(f(b.twocellSwitch))).and(b.twocellArrow).to((function(t){return a.Command.Twocell(t.head.head,t.head.tail,t.tail)}))})),twocell:v((function(){return x(l(/^\\[lrud]+twocell/).to((function(e){var n=e.substring(1,e.length-"twocell".length);return a.Command.Twocell.Twocell(n,t.Option.empty)})),l(/^\\[lrud]+uppertwocell/).to((function(e){var n=e.substring(1,e.length-"uppertwocell".length);return a.Command.Twocell.UpperTwocell(n,t.Option.empty)})),l(/^\\[lrud]+lowertwocell/).to((function(e){var n=e.substring(1,e.length-"lowertwocell".length);return a.Command.Twocell.LowerTwocell(n,t.Option.empty)})),l(/^\\[lrud]+compositemap/).to((function(e){var n=e.substring(1,e.length-"compositemap".length);return a.Command.Twocell.CompositeMap(n,t.Option.empty)})),x(u("\\xtwocell").to((function(){return a.Command.Twocell.Twocell})),u("\\xuppertwocell").to((function(){return a.Command.Twocell.UpperTwocell})),u("\\xlowertwocell").to((function(){return a.Command.Twocell.LowerTwocell})),u("\\xcompositemap").to((function(){return a.Command.Twocell.CompositeMap}))).andl(d("[")).and(s(p(/^[lrud]+/))).andl(d("]")).andl(d("{")).and(b.text).andl(d("}")).to((function(e){var n=a.Object(t.List.empty,b.toMath("\\labelstyle "+e.tail));return e.head.head(e.head.tail,t.Option.Some(n))})))})),twocellSwitch:v((function(){return x(u("^").andr(b.twocellLabel).to((function(t){return a.Command.Twocell.Switch.UpperLabel(t)})),u("_").andr(b.twocellLabel).to((function(t){return a.Command.Twocell.Switch.LowerLabel(t)})),u("\\omit").to((function(){return a.Command.Twocell.Switch.DoNotSetCurvedArrows()})),u("~!").to((function(){return a.Command.Twocell.Switch.PlaceModMapObject()})),l(/^(~[`'])/).andl(d("{")).and(b.object).andl(d("}")).to((function(t){var e=t.head.substring(1);return a.Command.Twocell.Switch.ChangeHeadTailObject(e,t.tail)})),l(/^(~[\^_]?)/).andl(d("{")).and(b.object).and(s(S(u("~**").andr(b.object)))).andl(d("}")).to((function(t){var e=t.head.head.substring(1),n=t.head.tail,i=t.tail;return a.Command.Twocell.Switch.ChangeCurveObject(e,n,i)})),b.nudge().to((function(t){return a.Command.Twocell.Switch.SetCurvature(t)})))})),twocellLabel:v((function(){return x(l(/^[0-9a-zA-Z]/).to((function(e){var n=a.Object(t.List.empty,b.toMath("\\twocellstyle "+e));return a.Command.Twocell.Label(t.Option.empty,n)})),l(/^(\\[a-zA-Z][a-zA-Z0-9]*)/).to((function(e){var n=a.Object(t.List.empty,b.toMath("\\twocellstyle "+e));return a.Command.Twocell.Label(t.Option.empty,n)})),u("{").andr(s(S(b.nudge))).andl(d("*")).and(b.object).andl(d("}")).to((function(t){return a.Command.Twocell.Label(t.head,t.tail)})),u("{").andr(s(S(b.nudge))).and(b.text).andl(c("}")).to((function(e){var n=a.Object(t.List.empty,b.toMath("\\twocellstyle "+e.tail));return a.Command.Twocell.Label(e.head,n)})))})),nudge:v((function(){return x(u("<\\omit>").to((function(){return a.Command.Twocell.Nudge.Omit()})),u("<").andr(b.factor).andl(d(">")).to((function(t){return a.Command.Twocell.Nudge.Number(t)})))})),twocellArrow:v((function(){return x(u("{").andr(s(l(/^([\^_=`'"!]|\\omit)/))).and(b.twocellLabelEntry).andl(d("}")).to((function(t){return a.Command.Twocell.Arrow.WithOrientation(t.head,t.tail)})),u("{").andr(b.nudge).and(b.twocellLabelEntry).andl(d("}")).to((function(t){return a.Command.Twocell.Arrow.WithPosition(t.head,t.tail)})),u("{").andr(b.twocellLabelEntry).andl(d("}")).to((function(t){return a.Command.Twocell.Arrow.WithOrientation("",t)})),y("no arrow label").to((function(){return a.Command.Twocell.Arrow.WithOrientation("",a.Object(t.List.empty,b.toMath("\\twocellstyle{}")))})))})),twocellLabelEntry:v((function(){return x(u("*").andr(b.object),b.text().to((function(e){return a.Object(t.List.empty,b.toMath("\\twocellstyle "+e))})))})),newdir:v((function(){return u("{").andr(b.dirMain).andl(c("}")).andl(d("{")).and(b.compositeObject).andl(d("}")).to((function(t){return a.Command.Newdir(t.head,a.ObjectBox.CompositeObject(t.tail))}))})),xyimport:v((function(){return u("\\xyimport").andr(d("(")).andr(b.factor).andl(d(",")).and(b.factor).andl(d(")")).and(s(S(u("(").andr(b.factor).andl(d(",")).and(b.factor).andl(d(")"))))).andl(d("{")).and(s(x(u("\\includegraphics").andr(b.includegraphics),b.text().to((function(t){return b.toMath("\\hbox{$\\objectstyle{"+t+"}$}")}))))).andl(d("}")).to((function(t){var e,n,i=t.head.head.head,r=t.head.head.tail;t.head.tail.isDefined?(e=t.head.tail.get.head,n=t.head.tail.get.tail):(e=0,n=0);var o=t.tail;return void 0!==o.isIncludegraphics?a.Pos.Xyimport.Graphics(i,r,e,n,o):a.Pos.Xyimport.TeXCommand(i,r,e,n,o)}))})),includegraphics:v((function(){return u("[").andr(s(S(b.includegraphicsAttrList))).andl(d("]")).andl(d("{")).and(s(l(/^[^\s{}]+/))).andl(d("}")).to((function(e){var n=e.head.getOrElse(t.List.empty),i=e.tail;return a.Command.Includegraphics(!1,n,i)}))})),includegraphicsAttrList:v((function(){return b.includegraphicsAttr().and(s(f(u(",").andr(b.includegraphicsAttr)))).to((function(t){return t.tail.prepend(t.head)}))})),includegraphicsAttr:v((function(){return x(u("width").andr(d("=")).andr(b.dimen).to((function(t){return a.Command.Includegraphics.Attr.Width(t)})),u("height").andr(d("=")).andr(b.dimen).to((function(t){return a.Command.Includegraphics.Attr.Height(t)})))}))})();MathJax.Hub.Insert(i,{environment:{xy:["XY",null]}}),r.ExecutionError=MathJax.Object.Subclass({Init:function(t){this.message=t},toMML:function(){return e.merror(e.mtext(this.message))},texError:!0,xyjaxError:!0}),r.ParseError=MathJax.Object.Subclass({Init:function(t){this.parseResult=t},toMML:function(){var t=this.parseResult.next.pos().lineContents();return e.merror(e.mtext('parse error at or near "'+t+'"'))},texError:!0,xyjaxError:!0}),n.Parse.Augment({XY:function(n){try{var i={lastNoSuccess:void 0,whiteSpaceRegex:r.constants.whiteSpaceRegex},o=t.StringReader(this.string,this.i,i),s=t.Parsers.parse(b.xy(),o);this.i=s.next.offset}catch(t){throw t}if(!s.successful)throw r.ParseError(i.lastNoSuccess);return C?this.Push(a.xypic(s.result)):this.Push(e.merror(r.unsupportedBrowserErrorMessage)),n},Xybox:function(){try{var n={lastNoSuccess:void 0,whiteSpaceRegex:r.constants.whiteSpaceRegex},i=t.StringReader(this.string,this.i,n),o=t.Parsers.parse(b.xybox(),i);this.i=o.next.offset}catch(t){throw t}if(!o.successful)throw r.ParseError(n.lastNoSuccess);C?this.Push(a.xypic(o.result)):this.Push(e.merror(r.unsupportedBrowserErrorMessage))},Xymatrix:function(){try{var n={lastNoSuccess:void 0,whiteSpaceRegex:r.constants.whiteSpaceRegex},i=t.StringReader(this.string,this.i,n),o=t.Parsers.parse(b.xymatrixbox(),i);this.i=o.next.offset}catch(t){throw t}if(!o.successful)throw r.ParseError(n.lastNoSuccess);C?this.Push(a.xypic(o.result)):this.Push(e.merror(r.unsupportedBrowserErrorMessage))},XypicNewdir:function(){try{var n={lastNoSuccess:void 0,whiteSpaceRegex:r.constants.whiteSpaceRegex},i=t.StringReader(this.string,this.i,n),o=t.Parsers.parse(b.newdir(),i);this.i=o.next.offset}catch(t){throw t}if(!o.successful)throw r.ParseError(n.lastNoSuccess);C?this.Push(a.xypic.newdir(o.result)):this.Push(e.merror(r.unsupportedBrowserErrorMessage))},Xyincludegraphics:function(){try{var n={lastNoSuccess:void 0,whiteSpaceRegex:r.constants.whiteSpaceRegex},i=t.StringReader(this.string,this.i,n),o=t.Parsers.parse(b.includegraphics(),i);this.i=o.next.offset}catch(t){throw t}if(!o.successful)throw r.ParseError(n.lastNoSuccess);C?this.Push(a.xypic.includegraphics(o.result)):this.Push(e.merror(r.unsupportedBrowserErrorMessage))}});var C=!1;MathJax.Hub.Browser.Select({Firefox:function(t){C=!0},Safari:function(t){C=!0},Chrome:function(t){C=!0},Opera:function(t){C=!0},MSIE:function(t){MathJax.Hub.Browser.versionAtLeast("9.0")&&document.documentMode>=9&&(C=!0)}}),MathJax.Hub.Startup.signal.Post("TeX Xy-pic Ready")})),MathJax.Hub.Register.StartupHook("HTML-CSS Xy-pic Config Require",(function(){MathJax.Hub.Startup.signal.Post("HTML-CSS Xy-pic Config Ready")})),MathJax.Hub.Register.StartupHook("SVG Xy-pic Config Require",(function(){MathJax.Hub.Startup.signal.Post("SVG Xy-pic Config Ready")})),MathJax.Hub.Register.StartupHook("Device-Independent Xy-pic Require",(function(){var t=MathJax.Extension.fp,e=(MathJax.ElementJax.mml,MathJax.Hub),n=MathJax.Extension.xypic,i=n.AST,a="http://www.w3.org/2000/svg",o=n.memoize;i.xypic.Augment({},{lengthResolution:128,interpolationResolution:5,machinePrecision:1e-12}),n.DirRepository=MathJax.Object.Subclass({Init:function(){this.userDirMap={}},get:function(t){return this.userDirMap[t]},put:function(t,e){this.userDirMap[t]=e}}),n.ModifierRepository=MathJax.Object.Subclass({Init:function(){this.userModifierMap={}},get:function(t){var e=n.ModifierRepository.embeddedModifierMap[t];return void 0!==e?e:this.userModifierMap[t]},put:function(t,e){void 0===n.ModifierRepository.embeddedModifierMap[t]&&(this.userModifierMap[t]=e)}},{embeddedModifierMap:{o:i.Modifier.Shape.Circle(),l:i.Modifier.Shape.L(),r:i.Modifier.Shape.R(),u:i.Modifier.Shape.U(),d:i.Modifier.Shape.D(),c:i.Modifier.Shape.C(),aliceblue:i.Modifier.Shape.ChangeColor("aliceblue"),antiquewhite:i.Modifier.Shape.ChangeColor("antiquewhite"),aqua:i.Modifier.Shape.ChangeColor("aqua"),aquamarine:i.Modifier.Shape.ChangeColor("aquamarine"),azure:i.Modifier.Shape.ChangeColor("azure"),beige:i.Modifier.Shape.ChangeColor("beige"),bisque:i.Modifier.Shape.ChangeColor("bisque"),black:i.Modifier.Shape.ChangeColor("black"),blanchedalmond:i.Modifier.Shape.ChangeColor("blanchedalmond"),blue:i.Modifier.Shape.ChangeColor("blue"),blueviolet:i.Modifier.Shape.ChangeColor("blueviolet"),brown:i.Modifier.Shape.ChangeColor("brown"),burlywood:i.Modifier.Shape.ChangeColor("burlywood"),cadetblue:i.Modifier.Shape.ChangeColor("cadetblue"),chartreuse:i.Modifier.Shape.ChangeColor("chartreuse"),chocolate:i.Modifier.Shape.ChangeColor("chocolate"),coral:i.Modifier.Shape.ChangeColor("coral"),cornflowerblue:i.Modifier.Shape.ChangeColor("cornflowerblue"),cornsilk:i.Modifier.Shape.ChangeColor("cornsilk"),crimson:i.Modifier.Shape.ChangeColor("crimson"),cyan:i.Modifier.Shape.ChangeColor("cyan"),darkblue:i.Modifier.Shape.ChangeColor("darkblue"),darkcyan:i.Modifier.Shape.ChangeColor("darkcyan"),darkgoldenrod:i.Modifier.Shape.ChangeColor("darkgoldenrod"),darkgray:i.Modifier.Shape.ChangeColor("darkgray"),darkgreen:i.Modifier.Shape.ChangeColor("darkgreen"),darkgrey:i.Modifier.Shape.ChangeColor("darkgrey"),darkkhaki:i.Modifier.Shape.ChangeColor("darkkhaki"),darkmagenta:i.Modifier.Shape.ChangeColor("darkmagenta"),darkolivegreen:i.Modifier.Shape.ChangeColor("darkolivegreen"),darkorange:i.Modifier.Shape.ChangeColor("darkorange"),darkorchid:i.Modifier.Shape.ChangeColor("darkorchid"),darkred:i.Modifier.Shape.ChangeColor("darkred"),darksalmon:i.Modifier.Shape.ChangeColor("darksalmon"),darkseagreen:i.Modifier.Shape.ChangeColor("darkseagreen"),darkslateblue:i.Modifier.Shape.ChangeColor("darkslateblue"),darkslategray:i.Modifier.Shape.ChangeColor("darkslategray"),darkslategrey:i.Modifier.Shape.ChangeColor("darkslategrey"),darkturquoise:i.Modifier.Shape.ChangeColor("darkturquoise"),darkviolet:i.Modifier.Shape.ChangeColor("darkviolet"),deeppink:i.Modifier.Shape.ChangeColor("deeppink"),deepskyblue:i.Modifier.Shape.ChangeColor("deepskyblue"),dimgray:i.Modifier.Shape.ChangeColor("dimgray"),dimgrey:i.Modifier.Shape.ChangeColor("dimgrey"),dodgerblue:i.Modifier.Shape.ChangeColor("dodgerblue"),firebrick:i.Modifier.Shape.ChangeColor("firebrick"),floralwhite:i.Modifier.Shape.ChangeColor("floralwhite"),forestgreen:i.Modifier.Shape.ChangeColor("forestgreen"),fuchsia:i.Modifier.Shape.ChangeColor("fuchsia"),gainsboro:i.Modifier.Shape.ChangeColor("gainsboro"),ghostwhite:i.Modifier.Shape.ChangeColor("ghostwhite"),gold:i.Modifier.Shape.ChangeColor("gold"),goldenrod:i.Modifier.Shape.ChangeColor("goldenrod"),gray:i.Modifier.Shape.ChangeColor("gray"),grey:i.Modifier.Shape.ChangeColor("grey"),green:i.Modifier.Shape.ChangeColor("green"),greenyellow:i.Modifier.Shape.ChangeColor("greenyellow"),honeydew:i.Modifier.Shape.ChangeColor("honeydew"),hotpink:i.Modifier.Shape.ChangeColor("hotpink"),indianred:i.Modifier.Shape.ChangeColor("indianred"),indigo:i.Modifier.Shape.ChangeColor("indigo"),ivory:i.Modifier.Shape.ChangeColor("ivory"),khaki:i.Modifier.Shape.ChangeColor("khaki"),lavender:i.Modifier.Shape.ChangeColor("lavender"),lavenderblush:i.Modifier.Shape.ChangeColor("lavenderblush"),lawngreen:i.Modifier.Shape.ChangeColor("lawngreen"),lemonchiffon:i.Modifier.Shape.ChangeColor("lemonchiffon"),lightblue:i.Modifier.Shape.ChangeColor("lightblue"),lightcoral:i.Modifier.Shape.ChangeColor("lightcoral"),lightcyan:i.Modifier.Shape.ChangeColor("lightcyan"),lightgoldenrodyellow:i.Modifier.Shape.ChangeColor("lightgoldenrodyellow"),lightgray:i.Modifier.Shape.ChangeColor("lightgray"),lightgreen:i.Modifier.Shape.ChangeColor("lightgreen"),lightgrey:i.Modifier.Shape.ChangeColor("lightgrey"),lightpink:i.Modifier.Shape.ChangeColor("lightpink"),lightsalmon:i.Modifier.Shape.ChangeColor("lightsalmon"),lightseagreen:i.Modifier.Shape.ChangeColor("lightseagreen"),lightskyblue:i.Modifier.Shape.ChangeColor("lightskyblue"),lightslategray:i.Modifier.Shape.ChangeColor("lightslategray"),lightslategrey:i.Modifier.Shape.ChangeColor("lightslategrey"),lightsteelblue:i.Modifier.Shape.ChangeColor("lightsteelblue"),lightyellow:i.Modifier.Shape.ChangeColor("lightyellow"),lime:i.Modifier.Shape.ChangeColor("lime"),limegreen:i.Modifier.Shape.ChangeColor("limegreen"),linen:i.Modifier.Shape.ChangeColor("linen"),magenta:i.Modifier.Shape.ChangeColor("magenta"),maroon:i.Modifier.Shape.ChangeColor("maroon"),mediumaquamarine:i.Modifier.Shape.ChangeColor("mediumaquamarine"),mediumblue:i.Modifier.Shape.ChangeColor("mediumblue"),mediumorchid:i.Modifier.Shape.ChangeColor("mediumorchid"),mediumpurple:i.Modifier.Shape.ChangeColor("mediumpurple"),mediumseagreen:i.Modifier.Shape.ChangeColor("mediumseagreen"),mediumslateblue:i.Modifier.Shape.ChangeColor("mediumslateblue"),mediumspringgreen:i.Modifier.Shape.ChangeColor("mediumspringgreen"),mediumturquoise:i.Modifier.Shape.ChangeColor("mediumturquoise"),mediumvioletred:i.Modifier.Shape.ChangeColor("mediumvioletred"),midnightblue:i.Modifier.Shape.ChangeColor("midnightblue"),mintcream:i.Modifier.Shape.ChangeColor("mintcream"),mistyrose:i.Modifier.Shape.ChangeColor("mistyrose"),moccasin:i.Modifier.Shape.ChangeColor("moccasin"),navajowhite:i.Modifier.Shape.ChangeColor("navajowhite"),navy:i.Modifier.Shape.ChangeColor("navy"),oldlace:i.Modifier.Shape.ChangeColor("oldlace"),olive:i.Modifier.Shape.ChangeColor("olive"),olivedrab:i.Modifier.Shape.ChangeColor("olivedrab"),orange:i.Modifier.Shape.ChangeColor("orange"),orangered:i.Modifier.Shape.ChangeColor("orangered"),orchid:i.Modifier.Shape.ChangeColor("orchid"),palegoldenrod:i.Modifier.Shape.ChangeColor("palegoldenrod"),palegreen:i.Modifier.Shape.ChangeColor("palegreen"),paleturquoise:i.Modifier.Shape.ChangeColor("paleturquoise"),palevioletred:i.Modifier.Shape.ChangeColor("palevioletred"),papayawhip:i.Modifier.Shape.ChangeColor("papayawhip"),peachpuff:i.Modifier.Shape.ChangeColor("peachpuff"),peru:i.Modifier.Shape.ChangeColor("peru"),pink:i.Modifier.Shape.ChangeColor("pink"),plum:i.Modifier.Shape.ChangeColor("plum"),powderblue:i.Modifier.Shape.ChangeColor("powderblue"),purple:i.Modifier.Shape.ChangeColor("purple"),red:i.Modifier.Shape.ChangeColor("red"),rosybrown:i.Modifier.Shape.ChangeColor("rosybrown"),royalblue:i.Modifier.Shape.ChangeColor("royalblue"),saddlebrown:i.Modifier.Shape.ChangeColor("saddlebrown"),salmon:i.Modifier.Shape.ChangeColor("salmon"),sandybrown:i.Modifier.Shape.ChangeColor("sandybrown"),seagreen:i.Modifier.Shape.ChangeColor("seagreen"),seashell:i.Modifier.Shape.ChangeColor("seashell"),sienna:i.Modifier.Shape.ChangeColor("sienna"),silver:i.Modifier.Shape.ChangeColor("silver"),skyblue:i.Modifier.Shape.ChangeColor("skyblue"),slateblue:i.Modifier.Shape.ChangeColor("slateblue"),slategray:i.Modifier.Shape.ChangeColor("slategray"),slategrey:i.Modifier.Shape.ChangeColor("slategrey"),snow:i.Modifier.Shape.ChangeColor("snow"),springgreen:i.Modifier.Shape.ChangeColor("springgreen"),steelblue:i.Modifier.Shape.ChangeColor("steelblue"),tan:i.Modifier.Shape.ChangeColor("tan"),teal:i.Modifier.Shape.ChangeColor("teal"),thistle:i.Modifier.Shape.ChangeColor("thistle"),tomato:i.Modifier.Shape.ChangeColor("tomato"),turquoise:i.Modifier.Shape.ChangeColor("turquoise"),violet:i.Modifier.Shape.ChangeColor("violet"),wheat:i.Modifier.Shape.ChangeColor("wheat"),white:i.Modifier.Shape.ChangeColor("white"),whitesmoke:i.Modifier.Shape.ChangeColor("whitesmoke"),yellow:i.Modifier.Shape.ChangeColor("yellow"),yellowgreen:i.Modifier.Shape.ChangeColor("yellowgreen")}}),n.repositories=MathJax.Object.Subclass({}),n.repositories.modifierRepository=n.ModifierRepository(),n.repositories.dirRepository=n.DirRepository(),n.Graphics=MathJax.Object.Subclass({},{createElement:function(t){return document.createElementNS(a,t)}}),n.Graphics.SVG=n.Graphics.Subclass({createGroup:function(t){return n.Graphics.SVG.Group(this,t)},createChangeColorGroup:function(t){return n.Graphics.SVG.ChangeColorGroup(this,t)},createSVGElement:function(t,e){var i=n.Graphics.createElement(t);if(e)for(var r in e)e.hasOwnProperty(r)&&("xlink:href"===r?i.setAttributeNS("http://www.w3.org/1999/xlink",r,e[r].toString()):i.setAttribute(r,e[r].toString()));return this.drawArea.appendChild(i),i},appendChild:function(t){return this.drawArea.appendChild(t),t},transformBuilder:function(){return n.Graphics.SVG.Transform()}}),n.Graphics.SVG.World=n.Graphics.SVG.Subclass({Init:function(t,e,i,r,o,s){var h=n.Graphics.createElement("svg");if(h.setAttribute("xmlns",a),h.setAttribute("version","1.1"),s)for(var c in s)s.hasOwnProperty(c)&&h.setAttribute(c,s[c].toString());for(var c in h.style&&(h.style.width=n.Em(i),h.style.height=n.Em(t+e)),s={fill:"none",stroke:o,"stroke-linecap":"round","stroke-width":n.em2px(r)},this.drawArea=n.Graphics.createElement("g"),s)s.hasOwnProperty(c)&&this.drawArea.setAttribute(c,s[c].toString());h.appendChild(this.drawArea),this.svg=h,this.boundingBox=void 0,this.color=o},setHeight:function(t){this.svg.style.height=n.Em(t)},setWidth:function(t){this.svg.style.width=n.Em(t)},setAttribute:function(t,e){this.svg.setAttribute(t,e.toString())},extendBoundingBox:function(t){this.boundingBox=n.Frame.combineRect(this.boundingBox,t)},getOrigin:function(){return{x:0,y:0}},getCurrentColor:function(){return this.color}}),n.Graphics.SVG.Transform=MathJax.Object.Subclass({Init:function(e){this.transform=e||t.List.empty},translate:function(t,e){return n.Graphics.SVG.Transform(this.transform.append(n.Graphics.SVG.Transform.Translate(t,e)))},rotateDegree:function(t){return n.Graphics.SVG.Transform(this.transform.append(n.Graphics.SVG.Transform.Rotate(t/180*Math.PI)))},rotateRadian:function(t){return n.Graphics.SVG.Transform(this.transform.append(n.Graphics.SVG.Transform.Rotate(t)))},toString:function(){var t="";return this.transform.foreach((function(e){t+=e.toTranslateForm()})),t},apply:function(t,e){var n={x:t,y:e};return this.transform.foreach((function(t){n=t.apply(n.x,n.y)})),n}}),n.Graphics.SVG.Transform.Translate=MathJax.Object.Subclass({Init:function(t,e){this.dx=t,this.dy=e},apply:function(t,e){return{x:t-this.dx,y:e+this.dy}},toTranslateForm:function(){return"translate("+n.em2px(this.dx)+","+n.em2px(-this.dy)+") "}}),n.Graphics.SVG.Transform.Rotate=MathJax.Object.Subclass({Init:function(t){this.radian=t},apply:function(t,e){var n=Math.cos(this.radian),i=Math.sin(this.radian);return{x:n*t+i*e,y:-i*t+n*e}},toTranslateForm:function(){return"rotate("+-180*this.radian/Math.PI+") "}}),n.Graphics.SVG.Group=n.Graphics.SVG.Subclass({Init:function(t,e){this.parent=t,this.drawArea=t.createSVGElement("g",void 0===e?{}:{transform:e.toString()});var n=t.getOrigin();this.origin=void 0===e?n:e.apply(n.x,n.y),o(this,"getCurrentColor")},remove:function(){this.drawArea.parentNode.removeChild(this.drawArea)},extendBoundingBox:function(t){this.parent.extendBoundingBox(t)},getOrigin:function(){return this.origin},getCurrentColor:function(){return this.parent.getCurrentColor()}}),n.Graphics.SVG.ChangeColorGroup=n.Graphics.SVG.Subclass({Init:function(t,e){this.parent=t,this.drawArea=t.createSVGElement("g",{stroke:e}),this.color=e,o(this,"getOrigin")},remove:function(){this.drawArea.parentNode.removeChild(this.drawArea)},extendBoundingBox:function(t){this.parent.extendBoundingBox(t)},getOrigin:function(){return this.parent.getOrigin()},getCurrentColor:function(){return this.color}}),n.Graphics.Augment({},{createSVG:function(t,e,i,r,a,o){return n.Graphics.SVG.World(t,e,i,r,a,o)}}),n.DrawingContext=MathJax.Object.Subclass({Init:function(t,e){this.shape=t,this.env=e},duplicateEnv:function(){var t=this.env.duplicate();return n.DrawingContext(this.shape,t)},appendShapeToFront:function(t){t.isNone||(this.shape.isNone?this.shape=t:this.shape=n.Shape.CompositeShape(t,this.shape))},appendShapeToBack:function(t){t.isNone||(this.shape.isNone?this.shape=t:this.shape=n.Shape.CompositeShape(this.shape,t))}}),n.Util=MathJax.Object.Subclass({},{extProd:function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]},sign:function(t){return t<0?-1:t>0?1:0},sign2:function(t){return t<0?-1:1},roundEpsilon:function(t){return Math.abs(t)<i.xypic.machinePrecision?0:t}}),e.Browser.Select({MSIE:function(t){e.Browser.versionAtLeast("9.0")&&document.documentMode>=9&&(n.useSVG=!0)},Firefox:function(t){n.useSVG=!0},Safari:function(t){n.useSVG=!0},Chrome:function(t){n.useSVG=!0},Opera:function(t){n.useSVG=!0}}),n.Frame=MathJax.Object.Subclass({toRect:function(t){return n.Frame.Rect(this.x,this.y,t)},toPoint:function(){return n.Frame.Point(this.x,this.y)},combineRect:function(t){return n.Frame.combineRect(this,t)}},{combineRect:function(t,e){if(void 0===t)return e;if(void 0===e)return t;var n=-(Math.min(t.x-t.l,e.x-e.l)-t.x),i=Math.max(t.x+t.r,e.x+e.r)-t.x,r=-(Math.min(t.y-t.d,e.y-e.d)-t.y),a=Math.max(t.y+t.u,e.y+e.u)-t.y;return t.toRect({l:n,r:i,d:r,u:a})}}),n.Frame.Point=n.Frame.Subclass({Init:function(t,e){this.x=t,this.y=e},l:0,r:0,u:0,d:0,isPoint:function(){return!0},isRect:function(){return!1},isCircle:function(){return!1},edgePoint:function(t,e){return this},proportionalEdgePoint:function(t,e){return this},grow:function(t,e){var n=Math.max(0,t),i=Math.max(0,e);return this.toRect({l:n,r:n,u:i,d:i})},toSize:function(t,e){return this.toRect({l:t/2,r:t/2,u:e/2,d:e/2})},growTo:function(t,e){var n=Math.max(0,t),i=Math.max(0,e);return this.toRect({l:n/2,r:n/2,u:i/2,d:i/2})},shrinkTo:function(t,e){return this},move:function(t,e){return n.Frame.Point(t,e)},shiftFrame:function(t,e){return this},rotate:function(t){return this},contains:function(t){return!1},toString:function(){return"{x:"+this.x+", y:"+this.y+"}"}}),n.Frame.Rect=n.Frame.Subclass({Init:function(t,e,n){this.x=t,this.y=e,this.l=n.l||0,this.r=n.r||0,this.u=n.u||0,this.d=n.d||0},isPoint:function(){return 0===this.l&&0===this.r&&0===this.u&&0===this.d},isRect:function(){return!this.isPoint()},isCircle:function(){return!1},edgePoint:function(t,e){if(this.isPoint())return this;var i,r=t-this.x,a=e-this.y;return r>0?(i=a*this.r/r)>this.u?n.Frame.Point(this.x+this.u*r/a,this.y+this.u):i<-this.d?n.Frame.Point(this.x-this.d*r/a,this.y-this.d):n.Frame.Point(this.x+this.r,this.y+i):r<0?(i=-a*this.l/r)>this.u?n.Frame.Point(this.x+this.u*r/a,this.y+this.u):i<-this.d?n.Frame.Point(this.x-this.d*r/a,this.y-this.d):n.Frame.Point(this.x-this.l,this.y+i):a>0?n.Frame.Point(this.x,this.y+this.u):n.Frame.Point(this.x,this.y-this.d)},proportionalEdgePoint:function(t,e){if(this.isPoint())return this;var r=t-this.x,a=e-this.y;if(Math.abs(r)<i.xypic.machinePrecision&&Math.abs(a)<i.xypic.machinePrecision)return n.Frame.Point(this.x-this.l,this.y+this.u);var o,s=this.l+this.r,h=this.u+this.d,c=Math.PI,u=Math.atan2(a,r);return-3*c/4<u&&u<=-c/4?(o=(u+3*c/4)/(c/2),n.Frame.Point(this.x+this.r-o*s,this.y+this.u)):-c/4<u&&u<=c/4?(o=(u+c/4)/(c/2),n.Frame.Point(this.x-this.l,this.y+this.u-o*h)):c/4<u&&u<=3*c/4?(o=(u-c/4)/(c/2),n.Frame.Point(this.x-this.l+o*s,this.y-this.d)):(o=(u-(u>0?3*c/4:-5*c/4))/(c/2),n.Frame.Point(this.x+this.r,this.y-this.d+o*h))},grow:function(t,e){return this.toRect({l:Math.max(0,this.l+t),r:Math.max(0,this.r+t),u:Math.max(0,this.u+e),d:Math.max(0,this.d+e)})},toSize:function(t,e){var n,i,r,a,o=this.l+this.r,s=this.u+this.d;return 0===o?(a=t/2,r=t/2):(a=t*this.l/o,r=t*this.r/o),0===s?(n=e/2,i=e/2):(n=e*this.u/s,i=e*this.d/s),this.toRect({l:a,r,u:n,d:i})},growTo:function(t,e){var n=this.u,i=this.d,r=this.r,a=this.l,o=a+r,s=n+i;return t>o&&(0===o?(a=t/2,r=t/2):(a=t*this.l/o,r=t*this.r/o)),e>s&&(0===s?(n=e/2,i=e/2):(n=e*this.u/s,i=e*this.d/s)),this.toRect({l:a,r,u:n,d:i})},shrinkTo:function(t,e){var n=this.u,i=this.d,r=this.r,a=this.l,o=a+r,s=n+i;return t<o&&(0===o?(a=t/2,r=t/2):(a=t*this.l/o,r=t*this.r/o)),e<s&&(0===s?(n=e/2,i=e/2):(n=e*this.u/s,i=e*this.d/s)),this.toRect({l:a,r,u:n,d:i})},move:function(t,e){return n.Frame.Rect(t,e,{l:this.l,r:this.r,u:this.u,d:this.d})},shiftFrame:function(t,e){return n.Frame.Rect(this.x,this.y,{l:Math.max(0,this.l-t),r:Math.max(0,this.r+t),u:Math.max(0,this.u+e),d:Math.max(0,this.d-e)})},rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=-this.l,r=this.r,a=this.u,o=-this.d,s={x:i*e-a*n,y:i*n+a*e},h={x:i*e-o*n,y:i*n+o*e},c={x:r*e-a*n,y:r*n+a*e},u={x:r*e-o*n,y:r*n+o*e};return this.toRect({l:-Math.min(s.x,h.x,c.x,u.x),r:Math.max(s.x,h.x,c.x,u.x),u:Math.max(s.y,h.y,c.y,u.y),d:-Math.min(s.y,h.y,c.y,u.y)})},contains:function(t){var e=t.x,n=t.y;return e>=this.x-this.l&&e<=this.x+this.r&&n>=this.y-this.d&&n<=this.y+this.u},toString:function(){return"{x:"+this.x+", y:"+this.y+", l:"+this.l+", r:"+this.r+", u:"+this.u+", d:"+this.d+"}"}}),n.Frame.Ellipse=n.Frame.Subclass({Init:function(t,e,n,i,r,a){this.x=t,this.y=e,this.l=n,this.r=i,this.u=r,this.d=a},isPoint:function(){return 0===this.r&&0===this.l||0===this.u&&0===this.d},isRect:function(){return!1},isCircle:function(){return!this.isPoint()},isPerfectCircle:function(){return this.l===this.r&&this.l===this.u&&this.l===this.d},edgePoint:function(t,e){if(this.isPoint())return this;if(this.isPerfectCircle()){var r,a=t-this.x,o=e-this.y;return r=Math.abs(a)<i.xypic.machinePrecision&&Math.abs(o)<i.xypic.machinePrecision?-Math.PI/2:Math.atan2(o,a),n.Frame.Point(this.x+this.r*Math.cos(r),this.y+this.r*Math.sin(r))}Math.PI;var s=this.l,h=this.r,c=this.u,u=this.d,p=this.x,l=this.y,d=p+(h-s)/2,m=l+(c-u)/2,x=(s+h)/2,f=(c+u)/2,g=-(a=t-p),S=(o=e-l)*x,y=g*f,v=S*S+y*y,b=-(u=S*d+y*m+((a*l-o*p)*x+(x-f)*g*m))/v,C=v*x*x-u*u;if(C<0)return n.Frame.Point(this.x,this.y-this.d);var M=Math.sqrt(C)/v,w=f/x,P=S*b+y*M+d,O=w*(y*b-S*M+m-m)+m,A=S*b-y*M+d,L=w*(y*b+S*M+m-m)+m,E=n.Util.sign;return E(P-d)===E(t-d)&&E(O-m)===E(e-m)?n.Frame.Point(P,O):n.Frame.Point(A,L)},proportionalEdgePoint:function(t,e){if(this.isPoint())return this;if(this.isPerfectCircle()){var r,a=t-this.x,o=e-this.y;return r=Math.abs(a)<i.xypic.machinePrecision&&Math.abs(o)<i.xypic.machinePrecision?-Math.PI/2:Math.atan2(o,a),n.Frame.Point(this.x-this.r*Math.cos(r),this.y-this.r*Math.sin(r))}Math.PI;var s=this.l,h=this.r,c=this.u,u=this.d,p=this.x,l=this.y,d=p+(h-s)/2,m=l+(c-u)/2,x=(s+h)/2,f=(c+u)/2,g=-(a=t-p),S=(o=e-l)*x,y=g*f,v=S*S+y*y,b=-(u=S*d+y*m+((a*l-o*p)*x+(x-f)*g*m))/v,C=v*x*x-u*u;if(C<0)return n.Frame.Point(this.x,this.y-this.d);var M=Math.sqrt(C)/v,w=f/x,P=S*b+y*M+d,O=w*(y*b-S*M+m-m)+m,A=S*b-y*M+d,L=w*(y*b+S*M+m-m)+m;return sign(P-d)===sign(t-d)&&sign(O-m)===sign(e-m)?n.Frame.Point(A,L):n.Frame.Point(P,O)},grow:function(t,e){return n.Frame.Ellipse(this.x,this.y,Math.max(0,this.l+t),Math.max(0,this.r+t),Math.max(0,this.u+e),Math.max(0,this.d+e))},toSize:function(t,e){var i,r,a,o,s=this.l+this.r,h=this.u+this.d;return 0===s?(o=t/2,a=t/2):(o=t*this.l/s,a=t*this.r/s),0===h?(i=e/2,r=e/2):(i=e*this.u/h,r=e*this.d/h),n.Frame.Ellipse(this.x,this.y,o,a,i,r)},growTo:function(t,e){var i=this.u,r=this.d,a=this.r,o=this.l,s=o+a,h=i+r;return t>s&&(0===s?(o=t/2,a=t/2):(o=t*this.l/s,a=t*this.r/s)),e>h&&(0===h?(i=e/2,r=e/2):(i=e*this.u/h,r=e*this.d/h)),n.Frame.Ellipse(this.x,this.y,o,a,i,r)},shrinkTo:function(t,e){var i=this.u,r=this.d,a=this.r,o=this.l,s=o+a,h=i+r;return t<s&&(0===s?(o=t/2,a=t/2):(o=t*this.l/s,a=t*this.r/s)),e<h&&(0===h?(i=e/2,r=e/2):(i=e*this.u/h,r=e*this.d/h)),n.Frame.Ellipse(this.x,this.y,o,a,i,r)},move:function(t,e){return n.Frame.Ellipse(t,e,this.l,this.r,this.u,this.d)},shiftFrame:function(t,e){return n.Frame.Ellipse(this.x,this.y,Math.max(0,this.l-t),Math.max(0,this.r+t),Math.max(0,this.u+e),Math.max(0,this.d-e))},rotate:function(t){return this},contains:function(t){var e=t.x,n=t.y;if(this.isPoint())return!1;var i=this.l,r=this.r,a=this.u,o=this.d,s=(i+r)/2,h=e-(this.x+(r-i)/2),c=(n-(this.y+(a-o)/2))/((a+o)/2/s);return h*h+c*c<=s*s},toString:function(){return"{x:"+this.x+", y:"+this.y+", l:"+this.l+", r:"+this.r+", u:"+this.u+", d:"+this.d+"}"}}),n.Range=MathJax.Object.Subclass({Init:function(t,e){t>e?(this.start=e,this.end=t):(this.start=t,this.end=e)},difference:function(e){var i=t.List.empty,r=this.start,a=this.end,o=e.start,s=e.end;return a<=o||s<=r?i=i.prepend(this):r<o?i=a<=s?i.prepend(n.Range(r,o)):(i=i.prepend(n.Range(r,o))).prepend(n.Range(s,a)):s<a&&(i=i.prepend(n.Range(s,a))),i},differenceRanges:function(e){var n=t.List.empty.prepend(this);return e.foreach((function(t){n=n.flatMap((function(e){return e.difference(t)}))})),n},toString:function(){return"["+this.start+", "+this.end+"]"}}),n.Shape=MathJax.Object.Subclass({isNone:!1}),n.Shape.NoneShape=n.Shape.Subclass({draw:function(t){},getBoundingBox:function(){},toString:function(){return"NoneShape"},isNone:!0}),n.Shape.Augment({},{none:n.Shape.NoneShape()}),n.Shape.InvisibleBoxShape=n.Shape.Subclass({Init:function(t){this.bbox=t},draw:function(t){},getBoundingBox:function(){return this.bbox},toString:function(){return"InvisibleBoxShape[bbox:"+this.bbox.toString()+"]"}}),n.Shape.TranslateShape=n.Shape.Subclass({Init:function(t,e,n){this.dx=t,this.dy=e,this.shape=n,o(this,"getBoundingBox")},draw:function(t){var e=t.createGroup(t.transformBuilder().translate(this.dx,this.dy));this.shape.draw(e)},getBoundingBox:function(){var t=this.shape.getBoundingBox();if(void 0!==t)return n.Frame.Rect(t.x+this.dx,t.y+this.dy,t)},toString:function(){return"TranslateShape[dx:"+this.dx+", dy:"+this.dy+", shape:"+this.shape.toString()+"]"}}),n.Shape.CompositeShape=n.Shape.Subclass({Init:function(t,e){this.foregroundShape=t,this.backgroundShape=e,o(this,"getBoundingBox")},draw:function(t){this.backgroundShape.draw(t),this.foregroundShape.draw(t)},getBoundingBox:function(){return n.Frame.combineRect(this.foregroundShape.getBoundingBox(),this.backgroundShape.getBoundingBox())},toString:function(){return"("+this.foregroundShape.toString()+", "+this.backgroundShape.toString()+")"}}),n.Shape.ChangeColorShape=n.Shape.Subclass({Init:function(t,e){this.color=t,this.shape=e,o(this,"getBoundingBox")},draw:function(t){var e=t.createChangeColorGroup(this.color);this.shape.draw(e)},getBoundingBox:function(){return this.shape.getBoundingBox()},toString:function(){return this.shape+", color:"+this.color}}),n.Shape.CircleSegmentShape=n.Shape.Subclass({Init:function(t,e,n,i,r,a,s,h,c){this.x=t,this.y=e,this.sx=n,this.sy=i,this.r=r,this.large=a,this.flip=s,this.ex=h,this.ey=c,o(this,"getBoundingBox")},draw:function(t){t.createSVGElement("path",{d:"M"+n.em2px(this.sx)+","+n.em2px(-this.sy)+" A"+n.em2px(this.r)+","+n.em2px(this.r)+" 0 "+this.large+","+this.flip+" "+n.em2px(this.ex)+","+n.em2px(-this.ey)})},getBoundingBox:function(){return n.Frame.Ellipse(this.x,this.y,this.r,this.r,this.r,this.r)},toString:function(){return"CircleSegmentShape[x:"+this.x+", y:"+this.y+", sx:"+this.sx+", sy:"+this.sy+", r:"+this.r+", large:"+this.large+", flip:"+this.flip+", ex:"+this.ex+", ey:"+this.ey+"]"}}),n.Shape.FullCircleShape=n.Shape.Subclass({Init:function(t,e,n){this.x=t,this.y=e,this.r=n,o(this,"getBoundingBox")},draw:function(t){t.createSVGElement("circle",{cx:n.em2px(this.x),cy:n.em2px(-this.y),r:n.em2px(this.r)})},getBoundingBox:function(){return n.Frame.Ellipse(this.x,this.y,this.r,this.r,this.r,this.r)},toString:function(){return"FullCircleShape[x:"+this.x+", y:"+this.y+", r:"+this.r+"]"}}),n.Shape.RectangleShape=n.Shape.Subclass({Init:function(t,e,n,i,r,a,s,h,c,u,p,l){this.x=t,this.y=e,this.left=n,this.right=i,this.up=r,this.down=a,this.r=s,this.isDoubled=h,this.color=c,this.dasharray=u,this.fillColor=p,this.hideLine=l||!1,o(this,"getBoundingBox")},draw:function(t){var e;e={x:n.em2px(this.x-this.left),y:-n.em2px(this.y+this.up),width:n.em2px(this.left+this.right),height:n.em2px(this.up+this.down),rx:n.em2px(this.r)},void 0!==this.dasharray&&(e["stroke-dasharray"]=this.dasharray),this.hideLine?e.stroke="none":void 0!==this.color&&(e.stroke=this.color),void 0!==this.fillColor&&(e.fill=this.fillColor),t.createSVGElement("rect",e),this.isDoubled&&(e={x:n.em2px(this.x-this.left+i.xypic.thickness),y:-n.em2px(this.y+this.up-i.xypic.thickness),width:n.em2px(this.left+this.right-2*i.xypic.thickness),height:n.em2px(this.up+this.down-2*i.xypic.thickness),rx:n.em2px(Math.max(this.r-i.xypic.thickness,0))},void 0!==this.dasharray&&(e["stroke-dasharray"]=this.dasharray),this.hideLine?e.stroke="none":void 0!==this.color&&(e.stroke=this.color),void 0!==this.fillColor&&(e.fill=this.fillColor),t.createSVGElement("rect",e))},getBoundingBox:function(){return n.Frame.Rect(this.x,this.y,{l:this.left,r:this.right,u:this.up,d:this.down})},toString:function(){return"RectangleShape[x:"+this.x+", y:"+this.y+", left:"+this.left+", right:"+this.right+", up:"+this.up+", down:"+this.down+", r:"+this.r+", isDouble:"+this.isDouble+", dasharray:"+this.dasharray+"]"}}),n.Shape.EllipseShape=n.Shape.Subclass({Init:function(t,e,n,i,r,a,s,h,c){this.x=t,this.y=e,this.rx=n,this.ry=i,this.isDoubled=r,this.color=a,this.dasharray=s,this.fillColor=h,this.hideLine=c||!1,o(this,"getBoundingBox")},draw:function(t){var e;e={cx:n.em2px(this.x),cy:-n.em2px(this.y),rx:n.em2px(this.rx),ry:n.em2px(this.ry)},void 0!==this.dasharray&&(e["stroke-dasharray"]=this.dasharray),this.hideLine?e.stroke="none":void 0!==this.color&&(e.stroke=this.color),void 0!==this.fillColor&&(e.fill=this.fillColor),t.createSVGElement("ellipse",e),this.isDoubled&&(e={cx:n.em2px(this.x),cy:-n.em2px(this.y),rx:n.em2px(Math.max(this.rx-i.xypic.thickness)),ry:n.em2px(Math.max(this.ry-i.xypic.thickness))},void 0!==this.dasharray&&(e["stroke-dasharray"]=this.dasharray),this.hideLine?e.stroke="none":void 0!==this.color&&(e.stroke=this.color),void 0!==this.fillColor&&(e.fill=this.fillColor),t.createSVGElement("ellipse",e))},getBoundingBox:function(){return n.Frame.Rect(this.x,this.y,{l:this.rx,r:this.rx,u:this.ry,d:this.ry})},toString:function(){return"EllipseShape[x:"+this.x+", y:"+this.y+", rx:"+this.rx+", ry:"+this.ry+", isDoubled:"+this.isDoubled+", dasharray:"+this.dasharray+"]"}}),n.Shape.BoxShadeShape=n.Shape.Subclass({Init:function(t,e,n,i,r,a,s,h){this.x=t,this.y=e,this.left=n,this.right=i,this.up=r,this.down=a,this.depth=s,this.color=h||"currentColor",o(this,"getBoundingBox")},draw:function(t){var e=n.em2px(this.x),i=n.em2px(this.y),r=n.em2px(this.left),a=n.em2px(this.right),o=n.em2px(this.up),s=n.em2px(this.down),h=n.em2px(this.depth);t.createSVGElement("path",{d:"M"+(e-r+h)+","+(-i+s)+"L"+(e+a)+","+(-i+s)+"L"+(e+a)+","+(-i-o+h)+"L"+(e+a+h)+","+(-i-o+h)+"L"+(e+a+h)+","+(-i+s+h)+"L"+(e-r+h)+","+(-i+s+h)+"Z",stroke:this.color,fill:this.color})},getBoundingBox:function(){return n.Frame.Rect(this.x,this.y,{l:this.left,r:this.right+this.depth,u:this.up,d:this.down+this.depth})},toString:function(){return"RectangleShape[x:"+this.x+", y:"+this.y+", left:"+this.left+", right:"+this.right+", up:"+this.up+", down:"+this.down+", depth:"+this.depth+"]"}}),n.Shape.LeftBrace=n.Shape.Subclass({Init:function(t,e,n,i,r,a){this.x=t,this.y=e,this.up=n,this.down=i,this.degree=r,this.color=a||"currentColor",o(this,"getBoundingBox")},draw:function(t){var e,i=n.oneem,r=Math.max(1.41975,this.down/i*1.125)-.660375,a=.660375-Math.max(1.41975,this.up/i*1.125);e="M"+n.em2px(-.0675)+" "+n.em2px(r)+"T"+n.em2px(-.068625)+" "+n.em2px(.07875+r)+"Q"+n.em2px(-.068625)+" "+n.em2px(.190125+r)+" "+n.em2px(-.0585)+" "+n.em2px(.250875+r)+"T"+n.em2px(-.01125)+" "+n.em2px(.387+r)+"Q"+n.em2px(.07425)+" "+n.em2px(.55575+r)+" "+n.em2px(.2475)+" "+n.em2px(.6525+r)+"L"+n.em2px(.262125)+" "+n.em2px(.660375+r)+"L"+n.em2px(.3015)+" "+n.em2px(.660375+r)+"L"+n.em2px(.30825)+" "+n.em2px(.653625+r)+"V"+n.em2px(.622125+r)+"Q"+n.em2px(.30825)+" "+n.em2px(.60975+r)+" "+n.em2px(.2925)+" "+n.em2px(.60075+r)+"Q"+n.em2px(.205875)+" "+n.em2px(.541125+r)+" "+n.em2px(.149625)+" "+n.em2px(.44775+r)+"T"+n.em2px(.07425)+" "+n.em2px(.239625+r)+"Q"+n.em2px(.07425)+" "+n.em2px(.2385+r)+" "+n.em2px(.073125)+" "+n.em2px(.235125+r)+"Q"+n.em2px(.068625)+" "+n.em2px(.203625+r)+" "+n.em2px(.0675)+" "+n.em2px(.041625+r)+"L"+n.em2px(.0675)+" "+n.em2px(.75825)+"Q"+n.em2px(.0675)+" "+n.em2px(.496125)+" "+n.em2px(.066375)+" "+n.em2px(.486)+"Q"+n.em2px(.05625)+" "+n.em2px(.336375)+" "+n.em2px(-.021375)+" "+n.em2px(.212625)+"T"+n.em2px(-.226125)+" "+n.em2px(.010125)+"L"+n.em2px(-.241875)+" 0L"+n.em2px(-.226125)+" "+n.em2px(-.010125)+"Q"+n.em2px(-.106875)+" "+n.em2px(-.084375)+" "+n.em2px(-.025875)+" "+n.em2px(-.207)+"T"+n.em2px(.066375)+" "+n.em2px(-.486)+"Q"+n.em2px(.0675)+" "+n.em2px(-.496125)+" "+n.em2px(.0675)+" "+n.em2px(-.75825)+"L"+n.em2px(.0675)+" "+n.em2px(-.041625+a)+"Q"+n.em2px(.068625)+" "+n.em2px(-.203625+a)+" "+n.em2px(.073125)+" "+n.em2px(-.235125+a)+"Q"+n.em2px(.07425)+" "+n.em2px(-.2385+a)+" "+n.em2px(.07425)+" "+n.em2px(-.239625+a)+"Q"+n.em2px(.093375)+" "+n.em2px(-.354375+a)+" "+n.em2px(.149625)+" "+n.em2px(-.44775+a)+"T"+n.em2px(.2925)+" "+n.em2px(-.60075+a)+"Q"+n.em2px(.30825)+" "+n.em2px(-.60975+a)+" "+n.em2px(.30825)+" "+n.em2px(-.622125+a)+"L"+n.em2px(.30825)+" "+n.em2px(-.653625+a)+"L"+n.em2px(.3015)+" "+n.em2px(-.660375+a)+"L"+n.em2px(.262125)+" "+n.em2px(-.660375+a)+"L"+n.em2px(.2475)+" "+n.em2px(-.6525+a)+"Q"+n.em2px(.07425)+" "+n.em2px(-.55575+a)+" "+n.em2px(-.01125)+" "+n.em2px(-.387+a)+"Q"+n.em2px(-.048375)+" "+n.em2px(-.311625+a)+" "+n.em2px(-.0585)+" "+n.em2px(-.250875+a)+"T"+n.em2px(-.068625)+" "+n.em2px(-.07875+a)+"Q"+n.em2px(-.0675)+" "+n.em2px(a)+" "+n.em2px(-.0675)+" "+n.em2px(a)+"L"+n.em2px(-.0675)+" "+n.em2px(-.759375)+"V"+n.em2px(-.5985)+"Q"+n.em2px(-.0675)+" "+n.em2px(-.47925)+" "+n.em2px(-.075375)+" "+n.em2px(-.41175)+"T"+n.em2px(-.11475)+" "+n.em2px(-.27)+"Q"+n.em2px(-.133875)+" "+n.em2px(-.2205)+" "+n.em2px(-.160875)+" "+n.em2px(-.17775)+"T"+n.em2px(-.212625)+" "+n.em2px(-.106875)+"T"+n.em2px(-.25875)+" "+n.em2px(-.06075)+"T"+n.em2px(-.293625)+" "+n.em2px(-.0315)+"T"+n.em2px(-.307125)+" "+n.em2px(-.02025)+"Q"+n.em2px(-.30825)+" "+n.em2px(-.019125)+" "+n.em2px(-.30825)+" 0T"+n.em2px(-.307125)+" "+n.em2px(.02025)+"Q"+n.em2px(-.307125)+" "+n.em2px(.021375)+" "+n.em2px(-.284625)+" "+n.em2px(.03825)+"T"+n.em2px(-.2295)+" "+n.em2px(.091125)+"T"+n.em2px(-.162)+" "+n.em2px(.176625)+"T"+n.em2px(-.10125)+" "+n.em2px(.30825)+"T"+n.em2px(-.068625)+" "+n.em2px(.482625)+"Q"+n.em2px(-.0675)+" "+n.em2px(.496125)+" "+n.em2px(-.0675)+" "+n.em2px(.759375)+"Z",t.createSVGElement("path",{d:e,fill:this.color,stroke:this.color,"stroke-width":"0pt",transform:"translate("+n.em2px(this.x)+","+n.em2px(-this.y)+") rotate("+-this.degree+") scale("+i/1.125+")"})},getBoundingBox:function(){var t=n.oneem;return n.Frame.Rect(this.x,this.y,{l:.274*t,r:.274*t,u:Math.max(1.41975*t/1.125,this.up),d:Math.max(1.41975*t/1.125,this.down)}).rotate(this.degree*Math.PI/180)},toString:function(){return"LeftBrace[x:"+this.x+", y:"+this.y+", up:"+this.up+", down:"+this.down+"]"}}),n.Shape.LeftParenthesis=n.Shape.Subclass({Init:function(t,e,n,i,r){this.x=t,this.y=e,this.height=n,this.degree=i,this.color=r||"currentColor",o(this,"getBoundingBox")},draw:function(t){var e,i=n.oneem,r=Math.max(.660375,this.height/2/i*1.125)-.660375,a=-r;e="M"+n.em2px(-.0675)+" "+n.em2px(r)+"T"+n.em2px(-.068625)+" "+n.em2px(.07875+r)+"Q"+n.em2px(-.068625)+" "+n.em2px(.190125+r)+" "+n.em2px(-.0585)+" "+n.em2px(.250875+r)+"T"+n.em2px(-.01125)+" "+n.em2px(.387+r)+"Q"+n.em2px(.07425)+" "+n.em2px(.55575+r)+" "+n.em2px(.2475)+" "+n.em2px(.6525+r)+"L"+n.em2px(.262125)+" "+n.em2px(.660375+r)+"L"+n.em2px(.3015)+" "+n.em2px(.660375+r)+"L"+n.em2px(.30825)+" "+n.em2px(.653625+r)+"V"+n.em2px(.622125+r)+"Q"+n.em2px(.30825)+" "+n.em2px(.60975+r)+" "+n.em2px(.2925)+" "+n.em2px(.60075+r)+"Q"+n.em2px(.205875)+" "+n.em2px(.541125+r)+" "+n.em2px(.149625)+" "+n.em2px(.44775+r)+"T"+n.em2px(.07425)+" "+n.em2px(.239625+r)+"Q"+n.em2px(.07425)+" "+n.em2px(.2385+r)+" "+n.em2px(.073125)+" "+n.em2px(.235125+r)+"Q"+n.em2px(.068625)+" "+n.em2px(.203625+r)+" "+n.em2px(.0675)+" "+n.em2px(.041625+r)+"L"+n.em2px(.0675)+" "+n.em2px(-.041625+a)+"Q"+n.em2px(.068625)+" "+n.em2px(-.203625+a)+" "+n.em2px(.073125)+" "+n.em2px(-.235125+a)+"Q"+n.em2px(.07425)+" "+n.em2px(-.2385+a)+" "+n.em2px(.07425)+" "+n.em2px(-.239625+a)+"Q"+n.em2px(.093375)+" "+n.em2px(-.354375+a)+" "+n.em2px(.149625)+" "+n.em2px(-.44775+a)+"T"+n.em2px(.2925)+" "+n.em2px(-.60075+a)+"Q"+n.em2px(.30825)+" "+n.em2px(-.60975+a)+" "+n.em2px(.30825)+" "+n.em2px(-.622125+a)+"L"+n.em2px(.30825)+" "+n.em2px(-.653625+a)+"L"+n.em2px(.3015)+" "+n.em2px(-.660375+a)+"L"+n.em2px(.262125)+" "+n.em2px(-.660375+a)+"L"+n.em2px(.2475)+" "+n.em2px(-.6525+a)+"Q"+n.em2px(.07425)+" "+n.em2px(-.55575+a)+" "+n.em2px(-.01125)+" "+n.em2px(-.387+a)+"Q"+n.em2px(-.048375)+" "+n.em2px(-.311625+a)+" "+n.em2px(-.0585)+" "+n.em2px(-.250875+a)+"T"+n.em2px(-.068625)+" "+n.em2px(-.07875+a)+"Q"+n.em2px(-.0675)+" "+n.em2px(a)+" "+n.em2px(-.0675)+" "+n.em2px(a)+"Z",t.createSVGElement("path",{d:e,fill:this.color,stroke:this.color,"stroke-width":"0pt",transform:"translate("+n.em2px(this.x)+","+n.em2px(-this.y)+") rotate("+-this.degree+") scale("+i/1.125+")"})},getBoundingBox:function(){var t=n.oneem;return n.Frame.Rect(this.x,this.y,{l:.06*t,r:.274*t,u:Math.max(.660375*t/1.125,this.height/2),d:Math.max(.660375*t/1.125,this.height/2)}).rotate(this.degree*Math.PI/180)},toString:function(){return"LeftBrace[x:"+this.x+", y:"+this.y+", up:"+this.up+", down:"+this.down+"]"}}),n.Shape.TextShape=n.Shape.Subclass({Init:function(t,e,n){this.c=t,this.math=e,this.svgForTestLayout=n,this.originalBBox=void 0,o(this,"getBoundingBox"),o(this,"getOriginalReferencePoint")},draw:function(t){this._draw(t,!1)},getBoundingBox:function(){return this._draw(this.svgForTestLayout,!0)},getOriginalReferencePoint:function(){this.getBoundingBox();var t=this.originalBBox,e=this.c,i=t.H,r=t.D;return n.Frame.Point(e.x,e.y-(i-r)/2)},toString:function(){return"TextShape[c:"+this.c.toString()+", math:"+this.math.toString()+"]"}}),n.Shape.ImageShape=n.Shape.Subclass({Init:function(t,e){this.c=t,this.url=e,o(this,"getBoundingBox"),o(this,"getOriginalReferencePoint")},draw:function(t){var e=this.c;t.createSVGElement("image",{x:n.em2px(e.x-e.l),y:n.em2px(-e.y-e.u),width:n.em2px(e.l+e.r),height:n.em2px(e.u+e.d),preserveAspectRatio:"none","xlink:href":this.url})},getBoundingBox:function(){return this.c},getOriginalReferencePoint:function(){return this.c},toString:function(){return"ImageShape[c:"+this.c.toString()+", height:"+this.height+", width:"+this.width+", url:"+this.url+"]"}}),n.Shape.ArrowheadShape=n.Shape.Subclass({draw:function(t){var e=t.createGroup(t.transformBuilder().translate(this.c.x,this.c.y).rotateRadian(this.angle));this.drawDelegate(e)},getBoundingBox:function(){return this.c.toRect(this.getBox()).rotate(this.angle)},toString:function(){return"ArrowheadShape[c:"+this.c.toString()+", angle:"+this.angle+"]"}}),n.Shape.GT2ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:.456*t,r:0,d:.229*t,u:.229*t}},getRadius:function(){return.213*n.oneem},drawDelegate:function(t){var e=n.oneem,i=t.createGroup(t.transformBuilder().rotateDegree(-10)),r=t.createGroup(t.transformBuilder().rotateDegree(10));i.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(-.147*e)}),r.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(.147*e)})}}),n.Shape.GT3ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:.507*t,r:0,d:.268*t,u:.268*t}},getRadius:function(){return.325*n.oneem},drawDelegate:function(t){var e=n.oneem,i=t.createGroup(t.transformBuilder().rotateDegree(-15)),r=t.createGroup(t.transformBuilder().rotateDegree(15));i.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(-.147*e)}),t.createSVGElement("line",{x1:0,y1:0,x2:n.em2px(-.507*e),y2:0}),r.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(.147*e)})}}),n.Shape.UpperGTArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:.489*t,r:0,d:0,u:.147*t}},drawDelegate:function(t){var e=n.oneem;t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(-.147*e)})}}),n.Shape.LowerGTArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:.489*t,r:0,d:.147*t,u:0}},drawDelegate:function(t){var e=n.oneem;t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(.147*e)})}}),n.Shape.GTArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:.489*t,r:0,d:.147*t,u:.147*t}},drawDelegate:function(t){var e=n.oneem;t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(-.147*e)})}}),n.Shape.LT2ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:0,r:.456*t,d:.229*t,u:.229*t}},getRadius:function(){return.213*n.oneem},drawDelegate:function(t){var e=n.oneem,i=t.createGroup(t.transformBuilder().rotateDegree(10)),r=t.createGroup(t.transformBuilder().rotateDegree(-10));i.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(.489*e)+","+n.em2px(-.147*e)}),r.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(.02*e)+" "+n.em2px(.489*e)+","+n.em2px(.147*e)})}}),n.Shape.LT3ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:0,r:.507*t,d:.268*t,u:.268*t}},getRadius:function(){return.325*n.oneem},drawDelegate:function(t){var e=n.oneem,i=t.createGroup(t.transformBuilder().rotateDegree(15)),r=t.createGroup(t.transformBuilder().rotateDegree(-15));i.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(.489*e)+","+n.em2px(-.147*e)}),t.createSVGElement("line",{x1:0,y1:0,x2:n.em2px(.507*e),y2:0}),r.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(.02*e)+" "+n.em2px(.489*e)+","+n.em2px(.147*e)})}}),n.Shape.UpperLTArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:0,r:.489*t,d:0,u:.147*t}},drawDelegate:function(t){var e=n.oneem;t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(.489*e)+","+n.em2px(-.147*e)})}}),n.Shape.LowerLTArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:0,r:.489*t,d:.147*t,u:0}},drawDelegate:function(t){var e=n.oneem;t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(.02*e)+" "+n.em2px(.489*e)+","+n.em2px(.147*e)})}}),n.Shape.LTArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:0,r:.489*t,d:.147*t,u:.147*t}},drawDelegate:function(t){var e=n.oneem;t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(.489*e)+","+n.em2px(-.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(.02*e)+" "+n.em2px(.489*e)+","+n.em2px(.147*e)})}}),n.Shape.UpperColumnArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:0,u:i.xypic.lineElementLength,d:0}},drawDelegate:function(t){var e=n.em2px(i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:0,x2:0,y2:-e})}}),n.Shape.LowerColumnArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:0,u:0,d:i.xypic.lineElementLength}},drawDelegate:function(t){var e=n.em2px(i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:0,x2:0,y2:e})}}),n.Shape.Column2ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:0,u:.5*(i.xypic.lineElementLength+i.xypic.thickness),d:.5*(i.xypic.lineElementLength+i.xypic.thickness)}},drawDelegate:function(t){var e=n.em2px(.5*(i.xypic.lineElementLength+i.xypic.thickness));t.createSVGElement("line",{x1:0,y1:e,x2:0,y2:-e})}}),n.Shape.Column3ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:0,u:.5*i.xypic.lineElementLength+i.xypic.thickness,d:.5*i.xypic.lineElementLength+i.xypic.thickness}},drawDelegate:function(t){var e=n.em2px(.5*i.xypic.lineElementLength+i.xypic.thickness);t.createSVGElement("line",{x1:0,y1:e,x2:0,y2:-e})}}),n.Shape.ColumnArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:0,u:.5*i.xypic.lineElementLength,d:.5*i.xypic.lineElementLength}},drawDelegate:function(t){i.xypic.thickness;var e=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:e,x2:0,y2:-e})}}),n.Shape.UpperLParenArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:.5*i.xypic.lineElementLength,r:0,u:i.xypic.lineElementLength,d:0}},drawDelegate:function(t){i.xypic.thickness;var e=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("path",{d:"M0,0 A "+e+","+e+" 0 0,1 0,"+-2*e})}}),n.Shape.LowerLParenArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:.5*i.xypic.lineElementLength,r:0,u:0,d:i.xypic.lineElementLength}},drawDelegate:function(t){i.xypic.thickness;var e=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("path",{d:"M0,0 A "+e+","+e+" 0 0,0 0,"+2*e})}}),n.Shape.LParenArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:.5*i.xypic.lineElementLength,u:.5*i.xypic.lineElementLength,d:.5*i.xypic.lineElementLength}},drawDelegate:function(t){i.xypic.thickness;var e=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("path",{d:"M"+e+","+-e+" A "+e+","+e+" 0 0,0 "+e+","+e})}}),n.Shape.UpperRParenArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:.5*i.xypic.lineElementLength,u:i.xypic.lineElementLength,d:0}},drawDelegate:function(t){i.xypic.thickness;var e=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("path",{d:"M0,0 A "+e+","+e+" 0 0,0 0,"+-2*e})}}),n.Shape.LowerRParenArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:.5*i.xypic.lineElementLength,u:0,d:i.xypic.lineElementLength}},drawDelegate:function(t){i.xypic.thickness;var e=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("path",{d:"M0,0 A "+e+","+e+" 0 0,1 0,"+2*e})}}),n.Shape.RParenArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:.5*i.xypic.lineElementLength,r:0,u:.5*i.xypic.lineElementLength,d:.5*i.xypic.lineElementLength}},drawDelegate:function(t){i.xypic.thickness;var e=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("path",{d:"M"+-e+","+-e+" A "+e+","+e+" 0 0,1 "+-e+","+e})}}),n.Shape.LowerBackquoteArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:.5*i.xypic.lineElementLength,r:0,u:0,d:.5*i.xypic.lineElementLength}},drawDelegate:function(t){i.xypic.thickness;var e=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("path",{d:"M0,0 A "+e+","+e+" 0 0,0 "+-e+","+e})}}),n.Shape.UpperBackquoteArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:.5*i.xypic.lineElementLength,r:0,u:.5*i.xypic.lineElementLength,d:0}},drawDelegate:function(t){i.xypic.thickness;var e=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("path",{d:"M0,0 A "+e+","+e+" 0 0,1 "+-e+","+-e})}}),n.Shape.LowerQuoteArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:.5*i.xypic.lineElementLength,u:0,d:.5*i.xypic.lineElementLength}},drawDelegate:function(t){i.xypic.thickness;var e=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("path",{d:"M0,0 A "+e+","+e+" 0 0,1 "+e+","+e})}}),n.Shape.UpperQuoteArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:.5*i.xypic.lineElementLength,u:.5*i.xypic.lineElementLength,d:0}},drawDelegate:function(t){i.xypic.thickness;var e=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("path",{d:"M0,0 A "+e+","+e+" 0 0,0 "+e+","+-e})}}),n.Shape.AsteriskArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=0,o(this,"getBoundingBox")},getBox:function(){return{l:i.xypic.thickness,r:i.xypic.thickness,u:i.xypic.thickness,d:i.xypic.thickness}},drawDelegate:function(t){t.createSVGElement("circle",{cx:0,cy:0,r:n.em2px(i.xypic.thickness),fill:"currentColor"})}}),n.Shape.OArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=0,o(this,"getBoundingBox")},getBox:function(){return{l:i.xypic.thickness,r:i.xypic.thickness,u:i.xypic.thickness,d:i.xypic.thickness}},drawDelegate:function(t){t.createSVGElement("circle",{cx:0,cy:0,r:n.em2px(i.xypic.thickness)})}}),n.Shape.PlusArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:.5*i.xypic.lineElementLength,r:.5*i.xypic.lineElementLength,u:.5*i.xypic.lineElementLength,d:.5*i.xypic.lineElementLength}},drawDelegate:function(t){var e=i.xypic.lineElementLength/2,r=n.em2px(e);t.createSVGElement("line",{x1:-r,y1:0,x2:r,y2:0}),t.createSVGElement("line",{x1:0,y1:r,x2:0,y2:-r})}}),n.Shape.XArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e+Math.PI/4,o(this,"getBoundingBox")},getBox:function(){return{l:.5*i.xypic.lineElementLength,r:.5*i.xypic.lineElementLength,u:.5*i.xypic.lineElementLength,d:.5*i.xypic.lineElementLength}},drawDelegate:function(t){var e=i.xypic.lineElementLength/2,r=n.em2px(e);t.createSVGElement("line",{x1:-r,y1:0,x2:r,y2:0}),t.createSVGElement("line",{x1:0,y1:r,x2:0,y2:-r})}}),n.Shape.SlashArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e-Math.PI/10,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:0,u:i.xypic.lineElementLength/2,d:i.xypic.lineElementLength/2}},drawDelegate:function(t){var e=i.xypic.lineElementLength/2,r=n.em2px(e);t.createSVGElement("line",{x1:0,y1:r,x2:0,y2:-r})}}),n.Shape.Line3ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:i.xypic.lineElementLength,u:i.xypic.thickness,d:i.xypic.thickness}},drawDelegate:function(t){var e=n.em2px(i.xypic.lineElementLength),r=n.em2px(i.xypic.thickness);t.createSVGElement("line",{x1:0,y1:r,x2:e,y2:r}),t.createSVGElement("line",{x1:0,y1:0,x2:e,y2:0}),t.createSVGElement("line",{x1:0,y1:-r,x2:e,y2:-r})}}),n.Shape.Line2ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:i.xypic.lineElementLength,u:.5*i.xypic.thickness,d:.5*i.xypic.thickness}},drawDelegate:function(t){var e=n.em2px(.5*i.xypic.thickness),r=n.em2px(i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:e,x2:r,y2:e}),t.createSVGElement("line",{x1:0,y1:-e,x2:r,y2:-e})}}),n.Shape.LineArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:i.xypic.lineElementLength,u:0,d:0}},drawDelegate:function(t){var e=n.em2px(i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:0,x2:e,y2:0})}}),n.Shape.Dot3ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:0,u:i.xypic.thickness,d:i.xypic.thickness}},drawDelegate:function(t){n.oneem;var e=n.em2px(i.xypic.thickness),r=n.em2px(i.xypic.thickness),a=i.xypic.dottedDasharray;t.createSVGElement("line",{x1:0,y1:e,x2:r,y2:e,"stroke-dasharray":a}),t.createSVGElement("line",{x1:0,y1:0,x2:r,y2:0,"stroke-dasharray":a}),t.createSVGElement("line",{x1:0,y1:-e,x2:r,y2:-e,"stroke-dasharray":a})}}),n.Shape.Dot2ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:0,u:.5*i.xypic.thickness,d:.5*i.xypic.thickness}},drawDelegate:function(t){var e=n.em2px(.5*i.xypic.thickness),r=n.em2px(i.xypic.thickness),a=i.xypic.dottedDasharray;t.createSVGElement("line",{x1:0,y1:e,x2:r,y2:e,"stroke-dasharray":a}),t.createSVGElement("line",{x1:0,y1:-e,x2:r,y2:-e,"stroke-dasharray":a})}}),n.Shape.DotArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:0,u:0,d:0}},drawDelegate:function(t){n.oneem;var e=n.em2px(i.xypic.thickness),r=i.xypic.dottedDasharray;t.createSVGElement("line",{x1:0,y1:0,x2:e,y2:0,"stroke-dasharray":r})}}),n.Shape.Tilde3ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:-2*i.xypic.thickness,r:2*i.xypic.thickness,u:2*i.xypic.thickness,d:2*i.xypic.thickness}},drawDelegate:function(t){var e=n.em2px(i.xypic.thickness);t.createSVGElement("path",{d:"M"+-2*e+","+e+" Q"+-e+",0 0,"+e+" T"+2*e+","+e+"M"+-2*e+",0 Q"+-e+","+-e+" 0,0 T"+2*e+",0M"+-2*e+","+-e+" Q"+-e+","+-2*e+" 0,"+-e+" T"+2*e+","+-e})}}),n.Shape.Tilde2ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:-2*i.xypic.thickness,r:2*i.xypic.thickness,u:1.5*i.xypic.thickness,d:1.5*i.xypic.thickness}},drawDelegate:function(t){var e=n.em2px(i.xypic.thickness);t.createSVGElement("path",{d:"M"+-2*e+","+.5*e+" Q"+-e+","+-.5*e+" 0,"+.5*e+" T"+2*e+","+.5*e+"M"+-2*e+","+-.5*e+" Q"+-e+","+-1.5*e+" 0,"+-.5*e+" T"+2*e+","+-.5*e})}}),n.Shape.TildeArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:-2*i.xypic.thickness,r:2*i.xypic.thickness,u:i.xypic.thickness,d:i.xypic.thickness}},drawDelegate:function(t){var e=n.em2px(i.xypic.thickness);t.createSVGElement("path",{d:"M"+-2*e+",0 Q"+-e+","+-e+" 0,0 T"+2*e+",0"})}}),n.Shape.TildeArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:-2*i.xypic.thickness,r:2*i.xypic.thickness,u:i.xypic.thickness,d:i.xypic.thickness}},drawDelegate:function(t){var e=n.em2px(i.xypic.thickness);t.createSVGElement("path",{d:"M"+-2*e+",0 Q"+-e+","+-e+" 0,0 T"+2*e+",0"})}}),n.Shape.GTGTArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:.489*t+2*i.xypic.thickness,r:0,d:.147*t,u:.147*t}},drawDelegate:function(t){var e=n.oneem,r=i.xypic.thickness,a=n.em2px(2*r);t.createSVGElement("path",{d:"M"+-a+",0 Q"+(n.em2px(-.222*e)-a)+","+n.em2px(.02*e)+" "+(n.em2px(-.489*e)-a)+","+n.em2px(.147*e)}),t.createSVGElement("path",{d:"M"+-a+",0 Q"+(n.em2px(-.222*e)-a)+","+n.em2px(-.02*e)+" "+(n.em2px(-.489*e)-a)+","+n.em2px(-.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(-.147*e)})}}),n.Shape.UpperGTGTArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:.489*t+2*i.xypic.thickness,r:0,d:0,u:.147*t}},drawDelegate:function(t){var e=n.oneem,r=i.xypic.thickness,a=n.em2px(2*r);t.createSVGElement("path",{d:"M"+-a+",0 Q"+(n.em2px(-.222*e)-a)+","+n.em2px(-.02*e)+" "+(n.em2px(-.489*e)-a)+","+n.em2px(-.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(-.147*e)})}}),n.Shape.LowerGTGTArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:.489*t+2*i.xypic.thickness,r:0,d:.147*t,u:0}},drawDelegate:function(t){var e=n.oneem,r=i.xypic.thickness,a=n.em2px(2*r);t.createSVGElement("path",{d:"M"+-a+",0 Q"+(n.em2px(-.222*e)-a)+","+n.em2px(.02*e)+" "+(n.em2px(-.489*e)-a)+","+n.em2px(.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(.147*e)})}}),n.Shape.GTGT2ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:.456*t+2*i.xypic.thickness,r:0,d:.229*t,u:.229*t}},getRadius:function(){return.213*n.oneem},drawDelegate:function(t){var e=n.oneem,r=i.xypic.thickness,a=t.createGroup(t.transformBuilder().rotateDegree(-10)),o=t.createGroup(t.transformBuilder().rotateDegree(10));a.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(-.147*e)}),o.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(.147*e)});var s=t.createGroup(t.transformBuilder().translate(-2*r,0).rotateDegree(-10)),h=t.createGroup(t.transformBuilder().translate(-2*r,0).rotateDegree(10));s.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(-.147*e)}),h.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(.147*e)})}}),n.Shape.GTGT3ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:.507*t+2*i.xypic.thickness,r:0,d:.268*t,u:.268*t}},getRadius:function(){return.325*n.oneem},drawDelegate:function(t){var e=n.oneem,r=i.xypic.thickness,a=t.createGroup(t.transformBuilder().rotateDegree(-15)),o=t.createGroup(t.transformBuilder().rotateDegree(15));a.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(-.147*e)}),o.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(.147*e)});var s=t.createGroup(t.transformBuilder().translate(-2*r,0).rotateDegree(-15)),h=t.createGroup(t.transformBuilder().translate(-2*r,0).rotateDegree(15));s.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(-.147*e)}),h.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(.147*e)}),t.createSVGElement("line",{x1:0,y1:0,x2:n.em2px(-.507*e-2*r),y2:0})}}),n.Shape.LTLTArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:0,r:.489*t+2*i.xypic.thickness,d:.147*t,u:.147*t}},drawDelegate:function(t){var e=n.oneem,r=i.xypic.thickness,a=n.em2px(2*r);t.createSVGElement("path",{d:"M"+a+",0 Q"+(n.em2px(.222*e)+a)+","+n.em2px(-.02*e)+" "+(n.em2px(.489*e)+a)+","+n.em2px(-.147*e)}),t.createSVGElement("path",{d:"M"+a+",0 Q"+(n.em2px(.222*e)+a)+","+n.em2px(.02*e)+" "+(n.em2px(.489*e)+a)+","+n.em2px(.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(.489*e)+","+n.em2px(-.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(.02*e)+" "+n.em2px(.489*e)+","+n.em2px(.147*e)})}}),n.Shape.UpperLTLTArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:0,r:.489*t+2*i.xypic.thickness,d:0,u:.147*t}},drawDelegate:function(t){var e=n.oneem,r=i.xypic.thickness,a=n.em2px(2*r);t.createSVGElement("path",{d:"M"+a+",0 Q"+(n.em2px(.222*e)+a)+","+n.em2px(-.02*e)+" "+(n.em2px(.489*e)+a)+","+n.em2px(-.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(.489*e)+","+n.em2px(-.147*e)})}}),n.Shape.LowerLTLTArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:0,r:.489*t+2*i.xypic.thickness,d:.147*t,u:0}},drawDelegate:function(t){var e=n.oneem,r=i.xypic.thickness,a=n.em2px(2*r);t.createSVGElement("path",{d:"M"+a+",0 Q"+(n.em2px(.222*e)+a)+","+n.em2px(.02*e)+" "+(n.em2px(.489*e)+a)+","+n.em2px(.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(.02*e)+" "+n.em2px(.489*e)+","+n.em2px(.147*e)})}}),n.Shape.LTLT2ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:0,r:.456+t+2*i.xypic.thickness,d:.229*t,u:.229*t}},getRadius:function(){return.213*n.oneem},drawDelegate:function(t){var e=n.oneem,r=i.xypic.thickness,a=t.createGroup(t.transformBuilder().translate(2*r,0).rotateDegree(10)),o=t.createGroup(t.transformBuilder().translate(2*r,0).rotateDegree(-10));a.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(.489*e)+","+n.em2px(-.147*e)}),o.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(.02*e)+" "+n.em2px(.489*e)+","+n.em2px(.147*e)});var s=t.createGroup(t.transformBuilder().rotateDegree(10)),h=t.createGroup(t.transformBuilder().rotateDegree(-10));s.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(.489*e)+","+n.em2px(-.147*e)}),h.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(.02*e)+" "+n.em2px(.489*e)+","+n.em2px(.147*e)})}}),n.Shape.LTLT3ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:0,r:.507*t+2*i.xypic.thickness,d:.268*t,u:.268*t}},getRadius:function(){return.325*n.oneem},drawDelegate:function(t){var e=n.oneem,r=i.xypic.thickness,a=t.createGroup(t.transformBuilder().translate(2*r,0).rotateDegree(15)),o=t.createGroup(t.transformBuilder().translate(2*r,0).rotateDegree(-15));a.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(.489*e)+","+n.em2px(-.147*e)}),o.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(.02*e)+" "+n.em2px(.489*e)+","+n.em2px(.147*e)});var s=t.createGroup(t.transformBuilder().rotateDegree(15)),h=t.createGroup(t.transformBuilder().rotateDegree(-15));s.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(.489*e)+","+n.em2px(-.147*e)}),h.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(.02*e)+" "+n.em2px(.489*e)+","+n.em2px(.147*e)}),t.createSVGElement("line",{x1:0,y1:0,x2:n.em2px(.507*e+2*r),y2:0})}}),n.Shape.ColumnColumnArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:i.xypic.thickness,r:0,u:.5*i.xypic.lineElementLength,d:.5*i.xypic.lineElementLength}},drawDelegate:function(t){var e=i.xypic.thickness,r=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:r,x2:0,y2:-r}),t.createSVGElement("line",{x1:-n.em2px(e),y1:r,x2:-n.em2px(e),y2:-r})}}),n.Shape.UpperColumnColumnArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:i.xypic.thickness,r:0,u:i.xypic.lineElementLength,d:0}},drawDelegate:function(t){var e=i.xypic.thickness,r=n.em2px(i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:0,x2:0,y2:-r}),t.createSVGElement("line",{x1:-n.em2px(e),y1:0,x2:-n.em2px(e),y2:-r})}}),n.Shape.LowerColumnColumnArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:i.xypic.thickness,r:0,u:0,d:i.xypic.lineElementLength}},drawDelegate:function(t){var e=i.xypic.thickness,r=n.em2px(i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:0,x2:0,y2:r}),t.createSVGElement("line",{x1:-n.em2px(e),y1:0,x2:-n.em2px(e),y2:r})}}),n.Shape.ColumnColumn2ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:i.xypic.thickness,r:0,u:.5*(i.xypic.lineElementLength+i.xypic.thickness),d:.5*(i.xypic.lineElementLength+i.xypic.thickness)}},drawDelegate:function(t){var e=i.xypic.thickness,r=n.em2px(.5*(i.xypic.lineElementLength+i.xypic.thickness));t.createSVGElement("line",{x1:0,y1:r,x2:0,y2:-r}),t.createSVGElement("line",{x1:-n.em2px(e),y1:r,x2:-n.em2px(e),y2:-r})}}),n.Shape.ColumnColumn3ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:i.xypic.thickness,r:0,u:.5*i.xypic.lineElementLength+i.xypic.thickness,d:.5*i.xypic.lineElementLength+i.xypic.thickness}},drawDelegate:function(t){var e=i.xypic.thickness,r=(e=i.xypic.thickness,n.em2px(.5*i.xypic.lineElementLength+i.xypic.thickness));t.createSVGElement("line",{x1:0,y1:r,x2:0,y2:-r}),t.createSVGElement("line",{x1:-n.em2px(e),y1:r,x2:-n.em2px(e),y2:-r})}}),n.Shape.ColumnLineArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:i.xypic.lineElementLength,u:.5*i.xypic.lineElementLength,d:.5*i.xypic.lineElementLength}},drawDelegate:function(t){var e=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:e,x2:0,y2:-e});var r=n.em2px(i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:0,x2:r,y2:0})}}),n.Shape.UpperColumnLineArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:i.xypic.lineElementLength,u:i.xypic.lineElementLength,d:0}},drawDelegate:function(t){i.xypic.thickness;var e=n.em2px(i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:0,x2:0,y2:-e});var r=n.em2px(i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:0,x2:r,y2:0})}}),n.Shape.LowerColumnLineArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:i.xypic.lineElementLength,u:0,d:i.xypic.lineElementLength}},drawDelegate:function(t){i.xypic.thickness;var e=n.em2px(i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:0,x2:0,y2:e});var r=n.em2px(i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:0,x2:r,y2:0})}}),n.Shape.ColumnLine2ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:i.xypic.lineElementLength,u:.5*(i.xypic.lineElementLength+i.xypic.thickness),d:.5*(i.xypic.lineElementLength+i.xypic.thickness)}},drawDelegate:function(t){var e=i.xypic.thickness,r=n.em2px(.5*(i.xypic.lineElementLength+i.xypic.thickness));t.createSVGElement("line",{x1:0,y1:-r,x2:0,y2:r});var a=n.em2px(.5*e),o=n.em2px(i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:a,x2:o,y2:a}),t.createSVGElement("line",{x1:0,y1:-a,x2:o,y2:-a})}}),n.Shape.ColumnLine3ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:i.xypic.lineElementLength,u:.5*i.xypic.lineElementLength+i.xypic.thickness,d:.5*i.xypic.lineElementLength+i.xypic.thickness}},drawDelegate:function(t){var e=i.xypic.thickness,r=n.em2px(.5*i.xypic.lineElementLength+i.xypic.thickness);t.createSVGElement("line",{x1:0,y1:-r,x2:0,y2:r});var a=n.em2px(i.xypic.lineElementLength),o=n.em2px(e);t.createSVGElement("line",{x1:0,y1:o,x2:a,y2:o}),t.createSVGElement("line",{x1:0,y1:0,x2:a,y2:0}),t.createSVGElement("line",{x1:0,y1:-o,x2:a,y2:-o})}}),n.Shape.GTColumnArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:.489*n.oneem,r:0,u:.5*i.xypic.lineElementLength,d:.5*i.xypic.lineElementLength}},drawDelegate:function(t){var e=n.oneem,r=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:r,x2:0,y2:-r}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(-.147*e)})}}),n.Shape.GTGTColumnArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:.489*n.oneem+2*i.xypic.thickness,r:0,u:.5*i.xypic.lineElementLength,d:.5*i.xypic.lineElementLength}},drawDelegate:function(t){var e=n.oneem,r=i.xypic.thickness,a=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:a,x2:0,y2:-a});var o=n.em2px(2*r);t.createSVGElement("path",{d:"M"+-o+",0 Q"+(n.em2px(-.222*e)-o)+","+n.em2px(.02*e)+" "+(n.em2px(-.489*e)-o)+","+n.em2px(.147*e)}),t.createSVGElement("path",{d:"M"+-o+",0 Q"+(n.em2px(-.222*e)-o)+","+n.em2px(-.02*e)+" "+(n.em2px(-.489*e)-o)+","+n.em2px(-.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(-.147*e)})}}),n.Shape.ColumnLTArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:.489*n.oneem,u:.5*i.xypic.lineElementLength,d:.5*i.xypic.lineElementLength}},drawDelegate:function(t){var e=n.oneem,r=(i.xypic.thickness,n.em2px(.5*i.xypic.lineElementLength));t.createSVGElement("line",{x1:0,y1:r,x2:0,y2:-r}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(.489*e)+","+n.em2px(-.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(.02*e)+" "+n.em2px(.489*e)+","+n.em2px(.147*e)})}}),n.Shape.ColumnLTLTArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return{l:0,r:.489*n.oneem+2*i.xypic.thickness,u:.5*i.xypic.lineElementLength,d:.5*i.xypic.lineElementLength}},drawDelegate:function(t){var e=n.oneem,r=i.xypic.thickness,a=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:a,x2:0,y2:-a});var o=n.em2px(2*r);t.createSVGElement("path",{d:"M"+o+",0 Q"+(n.em2px(.222*e)+o)+","+n.em2px(-.02*e)+" "+(n.em2px(.489*e)+o)+","+n.em2px(-.147*e)}),t.createSVGElement("path",{d:"M"+o+",0 Q"+(n.em2px(.222*e)+o)+","+n.em2px(.02*e)+" "+(n.em2px(.489*e)+o)+","+n.em2px(.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(.489*e)+","+n.em2px(-.147*e)}),t.createSVGElement("path",{d:"M0,0 Q"+n.em2px(.222*e)+","+n.em2px(.02*e)+" "+n.em2px(.489*e)+","+n.em2px(.147*e)})}}),n.Shape.SlashSlashArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e-Math.PI/10,o(this,"getBoundingBox")},getBox:function(){return{l:i.xypic.thickness,r:0,u:.5*i.xypic.lineElementLength,d:.5*i.xypic.lineElementLength}},drawDelegate:function(t){var e=n.em2px(i.xypic.thickness),r=n.em2px(.5*i.xypic.lineElementLength);t.createSVGElement("line",{x1:0,y1:r,x2:0,y2:-r}),t.createSVGElement("line",{x1:-e,y1:r,x2:-e,y2:-r})}}),n.Shape.LineGT2ArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){var t=n.oneem;return{l:i.xypic.lineElementLength,r:i.xypic.lineElementLength,d:.229*t,u:.229*t}},getRadius:function(){return.213*n.oneem},drawDelegate:function(t){var e=n.oneem,r=i.xypic.lineElementLength,a=n.em2px(r),o=.5*i.xypic.thickness,s=n.em2px(o),h=this.getRadius(),c=n.em2px(Math.sqrt(h*h-o*o)),u=t.createGroup(t.transformBuilder().translate(r,0).rotateDegree(-10)),p=t.createGroup(t.transformBuilder().translate(r,0).rotateDegree(10));u.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(-.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(-.147*e)}),p.createSVGElement("path",{d:"M0,0 Q"+n.em2px(-.222*e)+","+n.em2px(.02*e)+" "+n.em2px(-.489*e)+","+n.em2px(.147*e)}),t.createSVGElement("path",{d:"M"+-a+","+s+" L"+(a-c)+","+s+" M"+-a+","+-s+" L"+(a-c)+","+-s})}}),n.Shape.TwocellEqualityArrowheadShape=n.Shape.ArrowheadShape.Subclass({Init:function(t,e){this.c=t,this.angle=e,o(this,"getBoundingBox")},getBox:function(){return n.oneem,{l:i.xypic.lineElementLength,r:i.xypic.lineElementLength,d:.5*i.xypic.thickness,u:.5*i.xypic.thickness}},drawDelegate:function(t){n.oneem;var e=n.em2px(i.xypic.lineElementLength),r=n.em2px(.5*i.xypic.thickness);t.createSVGElement("path",{d:"M"+-e+","+r+" L"+e+","+r+" M"+-e+","+-r+" L"+e+","+-r})}}),n.Shape.LineShape=n.Shape.Subclass({Init:function(e,n,i,r,a){this.line=e,this.object=n,this.main=i,this.variant=r,this.bbox=a,this.holeRanges=t.List.empty},sliceHole:function(t){this.holeRanges=this.holeRanges.prepend(t)},draw:function(t){this.line.drawLine(t,this.object,this.main,this.variant,this.holeRanges)},getBoundingBox:function(){return this.bbox},toString:function(){return"LineShape[line:"+this.line+", object:"+this.object+", main:"+this.main+", variant:"+this.variant+"]"}}),n.Shape.CurveShape=n.Shape.Subclass({Init:function(e,n,i,r){this.curve=e,this.objectForDrop=n,this.objectForConnect=i,this.bbox=r,this.holeRanges=t.List.empty},sliceHole:function(t){this.holeRanges=this.holeRanges.prepend(t)},draw:function(t){this.curve.drawCurve(t,this.objectForDrop,this.objectForConnect,this.holeRanges)},getBoundingBox:function(){return this.bbox},toString:function(){return"CurveShape[curve"+this.curve+", objectForDrop:"+(void 0!==this.objectForDrop?this.objectForDrop.toString():"null")+", objectForConnect:"+(void 0!==this.objectForConnect?this.objectForConnect.toString():"null")+"]"}}),n.Curve=MathJax.Object.Subclass({velocity:function(t){var e=this.dpx(t),n=this.dpy(t);return Math.sqrt(e*e+n*n)},length:function(t){if(t<0||t>1)throw n.ExecutionError("illegal cubic Bezier parameter t:"+t);this.buildLengthArray();var e=t*i.xypic.lengthResolution,r=Math.floor(e),a=Math.ceil(e);if(r===a)return this.lengthArray[r];var o=this.lengthArray[r];return o+(this.lengthArray[a]-o)/(a-r)*(e-r)},tOfLength:function(t){this.buildLengthArray();var e,n,r,a=this.lengthArray;if(t<a[0])return 0;if(t>a[a.length-1])return 1;for(var o=0,s=a.length-2;o<=s&&(n=a[e=o+s>>1],r=a[e+1],!(t>=n&&t<=r));)t<n?s=e-1:o=e+1;var h=i.xypic.lengthResolution;return n===r?e/h:(e+(t-n)/(r-n))/h},tOfShavedStart:function(t){if(t.isPoint())return 0;var e=this.tOfIntersections(t);return 0!=e.length?Math.min.apply(Math,e):void 0},tOfShavedEnd:function(t){if(t.isPoint())return 1;var e=this.tOfIntersections(t);return 0!=e.length?Math.max.apply(Math,e):void 0},shaveStart:function(t){if(t.isPoint())return this;var e=this.tOfIntersections(t);if(0!=e.length){var n=Math.min.apply(Math,e);return this.divide(n)[1]}},shaveEnd:function(t){if(t.isPoint())return this;var e=this.tOfIntersections(t);if(0!=e.length){var n=Math.max.apply(Math,e);return this.divide(n)[0]}},buildLengthArray:function(){if(void 0===this.lengthArray){var t=i.xypic.lengthResolution,e=new Array(t+1),n=0,r=.5/t,a=0,o=r/3;for(e[0]=0,n=this.velocity(0)+4*this.velocity(r),lastv=this.velocity(2*r),e[1]=o*(n+lastv),a=2;a<=t;a++)n+=2*lastv+4*this.velocity((2*a-1)*r),lastv=this.velocity(2*a*r),e[a]=o*(n+lastv);this.lengthArray=e}},drawParallelCurve:function(t,e){var r,a,o,s,h,c,u,p,l=this.countOfSegments()*i.xypic.interpolationResolution,d=new Array(l+1),m=new Array(l+1),x=new Array(l+1),f=new Array(l+1),g=new Array(l+1),S=Math.PI/2,y=e;for(r=0;r<=l;r++)a=r/l,d[r]=a,o=this.angle(a),h=(s=this.position(a)).x,c=s.y,u=y*Math.cos(o+S),p=y*Math.sin(o+S),m[r]=h+u,x[r]=c+p,f[r]=h-u,g[r]=c-p;n.Curve.CubicBeziers.interpolation(d,m,x).drawPrimitive(t,"none"),n.Curve.CubicBeziers.interpolation(d,f,g).drawPrimitive(t,"none")},drawParallelDottedCurve:function(t,e,i){var r=1/n.em,a=r/2,o=r+e,s=this.length(1),h=Math.floor((s-r)/o),c=i;if(h>=0){var u,p=Math.PI/2,l=this.startPosition();for(this.endPosition(),u=0;u<=h;u++){l=a+u*o;var d=this.tOfLength(l),m=this.angle(d),x=this.position(d),f=x.x,g=x.y,S=c*Math.cos(m+p),y=c*Math.sin(m+p);t.createSVGElement("circle",{cx:n.em2px(f+S),cy:-n.em2px(g+y),r:.12,fill:"currentColor"}),t.createSVGElement("circle",{cx:n.em2px(f-S),cy:-n.em2px(g-y),r:.12,fill:"currentColor"})}}},drawParallelDashedCurve:function(t,e,i){var r,a,o,s,h,c,u,p,l=this.length(1),d=Math.floor((l-e)/(2*e)),m=2*d+1,x=(l-e)/2-d*e,f=new Array(d+1),g=new Array(d+1),S=new Array(d+1),y=new Array(d+1),v=new Array(d+1),b=Math.PI/2,C=i;for(r=0;r<=m;r++)a=this.tOfLength(x+r*e),f[r]=a,o=this.angle(a),h=(s=this.position(a)).x,c=s.y,u=C*Math.cos(o+b),p=C*Math.sin(o+b),g[r]=h+u,S[r]=c+p,y[r]=h-u,v[r]=c-p;n.Curve.CubicBeziers.interpolation(f,g,S).drawSkipped(t),n.Curve.CubicBeziers.interpolation(f,y,v).drawSkipped(t)},drawSquigCurve:function(t,e){var i=n.length2em("0.15em"),r=this.length(1),a=4*i,o=i;if(r>=a){var s,h,c,u,p,l,d,m,x,f=Math.floor(r/a),g=(r-f*a)/2,S=Math.PI/2;switch(e){case"3":s=g,h=this.tOfLength(s),c=this.position(h),u=this.angle(h),p=o*Math.cos(u+S),l=o*Math.sin(u+S),d="M"+n.em2px(c.x+p)+","+n.em2px(-c.y-l),m="M"+n.em2px(c.x)+","+n.em2px(-c.y),x="M"+n.em2px(c.x-p)+","+n.em2px(-c.y+l);for(var y=0;y<f;y++)s=g+a*y+i,h=this.tOfLength(s),c=this.position(h),u=this.angle(h),p=o*Math.cos(u+S),l=o*Math.sin(u+S),d+=" Q"+n.em2px(c.x+2*p)+","+n.em2px(-c.y-2*l),m+=" Q"+n.em2px(c.x+p)+","+n.em2px(-c.y-l),x+=" Q"+n.em2px(c.x)+","+n.em2px(-c.y),s=g+a*y+2*i,h=this.tOfLength(s),c=this.position(h),u=this.angle(h),p=o*Math.cos(u+S),l=o*Math.sin(u+S),d+=" "+n.em2px(c.x+p)+","+n.em2px(-c.y-l),m+=" "+n.em2px(c.x)+","+n.em2px(-c.y),x+=" "+n.em2px(c.x-p)+","+n.em2px(-c.y+l),s=g+a*y+3*i,h=this.tOfLength(s),c=this.position(h),u=this.angle(h),p=o*Math.cos(u+S),l=o*Math.sin(u+S),d+=" Q"+n.em2px(c.x)+","+n.em2px(-c.y),m+=" Q"+n.em2px(c.x-p)+","+n.em2px(-c.y+l),x+=" "+n.em2px(c.x-2*p)+","+n.em2px(-c.y+2*l),s=g+a*(y+1),h=this.tOfLength(s),c=this.position(h),u=this.angle(h),p=o*Math.cos(u+S),l=o*Math.sin(u+S),d+=" "+n.em2px(c.x+p)+","+n.em2px(-c.y-l),m+=" "+n.em2px(c.x)+","+n.em2px(-c.y),x+=" "+n.em2px(c.x-p)+","+n.em2px(-c.y+l);t.createSVGElement("path",{d}),t.createSVGElement("path",{d:m}),t.createSVGElement("path",{d:x});break;case"2":for(s=g,h=this.tOfLength(s),c=this.position(h),u=this.angle(h),p=o*Math.cos(u+S)/2,l=o*Math.sin(u+S)/2,d="M"+n.em2px(c.x+p)+","+n.em2px(-c.y-l),m="M"+n.em2px(c.x-p)+","+n.em2px(-c.y+l),y=0;y<f;y++)s=g+a*y+i,h=this.tOfLength(s),c=this.position(h),u=this.angle(h),p=o*Math.cos(u+S)/2,l=o*Math.sin(u+S)/2,d+=" Q"+n.em2px(c.x+3*p)+","+n.em2px(-c.y-3*l),m+=" Q"+n.em2px(c.x+p)+","+n.em2px(-c.y-l),s=g+a*y+2*i,h=this.tOfLength(s),c=this.position(h),u=this.angle(h),p=o*Math.cos(u+S)/2,l=o*Math.sin(u+S)/2,d+=" "+n.em2px(c.x+p)+","+n.em2px(-c.y-l),m+=" "+n.em2px(c.x-p)+","+n.em2px(-c.y+l),s=g+a*y+3*i,h=this.tOfLength(s),c=this.position(h),u=this.angle(h),p=o*Math.cos(u+S)/2,l=o*Math.sin(u+S)/2,d+=" Q"+n.em2px(c.x-p)+","+n.em2px(-c.y+l),m+=" Q"+n.em2px(c.x-3*p)+","+n.em2px(-c.y+3*l),s=g+a*(y+1),h=this.tOfLength(s),c=this.position(h),u=this.angle(h),p=o*Math.cos(u+S)/2,l=o*Math.sin(u+S)/2,d+=" "+n.em2px(c.x+p)+","+n.em2px(-c.y-l),m+=" "+n.em2px(c.x-p)+","+n.em2px(-c.y+l);t.createSVGElement("path",{d}),t.createSVGElement("path",{d:m});break;default:for(s=g,h=this.tOfLength(s),c=this.position(h),d="M"+n.em2px(c.x)+","+n.em2px(-c.y),y=0;y<f;y++)s=g+a*y+i,h=this.tOfLength(s),c=this.position(h),u=this.angle(h),p=o*Math.cos(u+S),l=o*Math.sin(u+S),d+=" Q"+n.em2px(c.x+p)+","+n.em2px(-c.y-l),s=g+a*y+2*i,h=this.tOfLength(s),c=this.position(h),d+=" "+n.em2px(c.x)+","+n.em2px(-c.y),s=g+a*y+3*i,h=this.tOfLength(s),c=this.position(h),u=this.angle(h),p=o*Math.cos(u+S),l=o*Math.sin(u+S),d+=" Q"+n.em2px(c.x-p)+","+n.em2px(-c.y+l),s=g+a*(y+1),h=this.tOfLength(s),c=this.position(h),d+=" "+n.em2px(c.x)+","+n.em2px(-c.y);t.createSVGElement("path",{d})}}},drawDashSquigCurve:function(t,e){var r=i.xypic.thickness,a=this.length(1),o=4*r,s=r;if(a>=o){var h,c,u,p,l,d,m,x,f,g=Math.floor((a-o)/2/o),S=(a-o)/2-g*o,y=Math.PI/2;switch(e){case"3":m=x=f="";for(var v=0;v<=g;v++)h=S+o*v*2,c=this.tOfLength(h),u=this.position(c),p=this.angle(c),l=s*Math.cos(p+y),d=s*Math.sin(p+y),m+=" M"+n.em2px(u.x+l)+","+n.em2px(-u.y-d),x+=" M"+n.em2px(u.x)+","+n.em2px(-u.y),f+=" M"+n.em2px(u.x-l)+","+n.em2px(-u.y+d),h=S+o*v*2+r,c=this.tOfLength(h),u=this.position(c),p=this.angle(c),l=s*Math.cos(p+y),d=s*Math.sin(p+y),m+=" Q"+n.em2px(u.x+2*l)+","+n.em2px(-u.y-2*d),x+=" Q"+n.em2px(u.x+l)+","+n.em2px(-u.y-d),f+=" Q"+n.em2px(u.x)+","+n.em2px(-u.y),h=S+o*v*2+2*r,c=this.tOfLength(h),u=this.position(c),p=this.angle(c),l=s*Math.cos(p+y),d=s*Math.sin(p+y),m+=" "+n.em2px(u.x+l)+","+n.em2px(-u.y-d),x+=" "+n.em2px(u.x)+","+n.em2px(-u.y),f+=" "+n.em2px(u.x-l)+","+n.em2px(-u.y+d),h=S+o*v*2+3*r,c=this.tOfLength(h),u=this.position(c),p=this.angle(c),l=s*Math.cos(p+y),d=s*Math.sin(p+y),m+=" Q"+n.em2px(u.x)+","+n.em2px(-u.y),x+=" Q"+n.em2px(u.x-l)+","+n.em2px(-u.y+d),f+=" "+n.em2px(u.x-2*l)+","+n.em2px(-u.y+2*d),h=S+o*(2*v+1),c=this.tOfLength(h),u=this.position(c),p=this.angle(c),l=s*Math.cos(p+y),d=s*Math.sin(p+y),m+=" "+n.em2px(u.x+l)+","+n.em2px(-u.y-d),x+=" "+n.em2px(u.x)+","+n.em2px(-u.y),f+=" "+n.em2px(u.x-l)+","+n.em2px(-u.y+d);t.createSVGElement("path",{d:m}),t.createSVGElement("path",{d:x}),t.createSVGElement("path",{d:f});break;case"2":for(m=x="",v=0;v<=g;v++)h=S+o*v*2,c=this.tOfLength(h),u=this.position(c),p=this.angle(c),l=s*Math.cos(p+y)/2,d=s*Math.sin(p+y)/2,m+=" M"+n.em2px(u.x+l)+","+n.em2px(-u.y-d),x+=" M"+n.em2px(u.x-l)+","+n.em2px(-u.y+d),h=S+o*v*2+r,c=this.tOfLength(h),u=this.position(c),p=this.angle(c),l=s*Math.cos(p+y)/2,d=s*Math.sin(p+y)/2,m+=" Q"+n.em2px(u.x+3*l)+","+n.em2px(-u.y-3*d),x+=" Q"+n.em2px(u.x+l)+","+n.em2px(-u.y-d),h=S+o*v*2+2*r,c=this.tOfLength(h),u=this.position(c),p=this.angle(c),l=s*Math.cos(p+y)/2,d=s*Math.sin(p+y)/2,m+=" "+n.em2px(u.x+l)+","+n.em2px(-u.y-d),x+=" "+n.em2px(u.x-l)+","+n.em2px(-u.y+d),h=S+o*v*2+3*r,c=this.tOfLength(h),u=this.position(c),p=this.angle(c),l=s*Math.cos(p+y)/2,d=s*Math.sin(p+y)/2,m+=" Q"+n.em2px(u.x-l)+","+n.em2px(-u.y+d),x+=" Q"+n.em2px(u.x-3*l)+","+n.em2px(-u.y+3*d),h=S+o*(2*v+1),c=this.tOfLength(h),u=this.position(c),p=this.angle(c),l=s*Math.cos(p+y)/2,d=s*Math.sin(p+y)/2,m+=" "+n.em2px(u.x+l)+","+n.em2px(-u.y-d),x+=" "+n.em2px(u.x-l)+","+n.em2px(-u.y+d);t.createSVGElement("path",{d:m}),t.createSVGElement("path",{d:x});break;default:for(m="",v=0;v<=g;v++)h=S+o*v*2,c=this.tOfLength(h),u=this.position(c),m+=" M"+n.em2px(u.x)+","+n.em2px(-u.y),h=S+o*v*2+r,c=this.tOfLength(h),u=this.position(c),p=this.angle(c),l=s*Math.cos(p+y),d=s*Math.sin(p+y),m+=" Q"+n.em2px(u.x+l)+","+n.em2px(-u.y-d),h=S+o*v*2+2*r,c=this.tOfLength(h),u=this.position(c),m+=" "+n.em2px(u.x)+","+n.em2px(-u.y),h=S+o*v*2+3*r,c=this.tOfLength(h),u=this.position(c),p=this.angle(c),l=s*Math.cos(p+y),d=s*Math.sin(p+y),m+=" Q"+n.em2px(u.x-l)+","+n.em2px(-u.y+d),h=S+o*(2*v+1),c=this.tOfLength(h),u=this.position(c),m+=" "+n.em2px(u.x)+","+n.em2px(-u.y);t.createSVGElement("path",{d:m})}}},drawCurve:function(t,e,i,r){if(r.isEmpty)this._drawCurve(t,e,i);else{var a=n.Range(0,1).differenceRanges(r),o=this;a.foreach((function(n){o.slice(n.start,n.end)._drawCurve(t,e,i)}))}},_drawCurve:function(t,e,r){var a,o=n.length2em("0.15em");if(void 0!==r){var s=r.dirMain(),h=r.dirVariant();switch(s){case"=":s="-",h="2";break;case"==":s="--",h="2";break;case":":case"::":s=".",h="2"}switch(s){case"":break;case"-":switch(h){case"2":a=o/2,this.drawParallelCurve(t,a);break;case"3":a=o,this.drawParallelCurve(t,a),this.drawPrimitive(t,"none");break;default:a=0,this.drawPrimitive(t,"none")}break;case".":case"..":switch(h){case"2":a=o/2,this.drawParallelDottedCurve(t,o,a);break;case"3":a=o,this.drawParallelDottedCurve(t,o,a),this.drawPrimitive(t,i.xypic.dottedDasharray);break;default:a=0,this.drawPrimitive(t,i.xypic.dottedDasharray)}break;case"--":var c=3*o;if((v=this.length(1))>=c)switch(h){case"2":a=o/2,this.drawParallelDashedCurve(t,c,a);break;case"3":a=o,this.drawParallelDashedCurve(t,c,a);var u=(v-c)/2-Math.floor((v-c)/2/c)*c,p=this.tOfLength(u);this.divide(p)[1].drawPrimitive(t,n.em2px(c)+" "+n.em2px(c));break;default:a=0,u=(v-c)/2-Math.floor((v-c)/2/c)*c,p=this.tOfLength(u),this.divide(p)[1].drawPrimitive(t,n.em2px(c)+" "+n.em2px(c))}break;case"~":switch(this.drawSquigCurve(t,h),h){case"2":a=1.5*o;break;case"3":a=2*o;break;default:a=0}break;case"~~":switch(this.drawDashSquigCurve(t,h),h){case"2":a=1.5*o;break;case"3":a=2*o;break;default:a=0}break;default:(C=n.Env()).c=n.Env.originPosition;var l=n.DrawingContext(n.Shape.none,C),d=r.boundingBox(l);if(null==d)return;var m,x,f=d.l,g=f+d.r;if(void 0!==e){var S=e.boundingBox(l);void 0!==S&&(m=(x=S.l)+S.r)}else m=0;var y=g+m;0==y&&(y=i.xypic.strokeWidth);var v=this.length(1);if(0==(P=Math.floor(v/y)))return;u=(v-P*y)/2,l=n.DrawingContext(n.Shape.none,C);for(var b=0;b<P;b++)L=u+b*y,void 0!==e&&(E=this.tOfLength(L+x),C.c=this.position(E),C.angle=this.angle(E),e.toDropShape(l).draw(t)),E=this.tOfLength(L+m+f),C.c=this.position(E),C.angle=this.angle(E),bbox=r.toDropShape(l).draw(t)}}else{var C;(C=n.Env()).c=n.Env.originPosition,l=n.DrawingContext(n.Shape.none,C);var M=e,w=M.boundingBox(l);if(void 0===w)return;var P,O=w.l+w.r,A=O;if(0==A&&(A=i.xypic.strokeWidth),v=this.length(1),0==(P=Math.floor(v/A)))return;for(u=(v-P*A+A-O)/2+w.l,l=n.DrawingContext(n.Shape.none,C),b=0;b<P;b++){var L=u+b*A,E=this.tOfLength(L);C.c=this.position(E),C.angle=0,M.toDropShape(l).draw(t)}}},toShape:function(t,e,r){var a,o=t.env,s=n.length2em("0.15em"),h=n.Shape.none;if(void 0!==r){var c=r.dirMain(),u=r.dirVariant();switch(c){case"=":c="-",u="2";break;case"==":c="--",u="2";break;case":":case"::":c=".",u="2"}switch(c){case"":a=0;break;case"-":case".":case"..":switch(u){case"2":a=s/2;break;case"3":a=s;break;default:a=0}break;case"--":var p=3*s;if((g=this.length(1))>=p)switch(u){case"2":a=s/2;break;case"3":a=s;break;default:a=0}break;case"~":case"~~":switch(u){case"2":a=1.5*s;break;case"3":a=2*s;break;default:a=0}break;default:var l=r.boundingBox(t);if(null==l)return o.angle=0,o.lastCurve=n.LastCurve.none,n.Shape.none;a=Math.max(l.u,l.d);var d,m=l.l+l.r;if(void 0!==e){var x=e.boundingBox(t);void 0!==x&&(d=x.l+x.r,a=Math.max(a,x.u,x.d))}else d=0;var f=m+d;0==f&&(f=i.xypic.strokeWidth);var g=this.length(1);return 0==Math.floor(g/f)?(o.angle=0,o.lastCurve=n.LastCurve.none,n.Shape.none):(h=n.Shape.CurveShape(this,e,r,this.boundingBox(a)),t.appendShapeToFront(h),h)}return void 0===a?n.Shape.none:(h=n.Shape.CurveShape(this,e,r,this.boundingBox(a)),t.appendShapeToFront(h),h)}if(void 0!==e){var S=e.boundingBox(t);if(null==S)return o.angle=0,o.lastCurve=n.LastCurve.none,n.Shape.none;var y=S.l+S.r;return 0==y&&(y=i.xypic.strokeWidth),g=this.length(1),0==Math.floor(g/y)?(o.angle=0,o.lastCurve=n.LastCurve.none,n.Shape.none):(a=Math.max(S.u,S.d),h=n.Shape.CurveShape(this,e,r,this.boundingBox(a)),t.appendShapeToFront(h),h)}return h}},{sign:function(t){return t>0?1:0===t?0:-1},solutionsOfCubicEq:function(t,e,i,r){if(0===t)return n.Curve.solutionsOfQuadEq(e,i,r);var a=e/3/t,o=i/t,s=a*a-o/3,h=-r/t/2+o*a/2-a*a*a,c=h*h-s*s*s;if(0===c){var u=2*(x=Math.pow(h,1/3))-a,p=-x-a;return n.Curve.filterByIn0to1([u,p])}if(c>0){var l=h+n.Curve.sign(h)*Math.sqrt(c),d=(m=n.Curve.sign(l)*Math.pow(Math.abs(l),1/3))+(x=s/m)-a;return n.Curve.filterByIn0to1([d])}var m=2*Math.sqrt(s),x=Math.acos(2*h/s/m),f=(u=m*Math.cos(x/3)-a,p=m*Math.cos((x+2*Math.PI)/3)-a,m*Math.cos((x+4*Math.PI)/3)-a);return n.Curve.filterByIn0to1([u,p,f])},solutionsOfQuadEq:function(t,e,i){if(0===t)return n.Curve.solutionsOfLinearEq(e,i);var r=e*e-4*i*t;if(r>=0){var a=Math.sqrt(r),o=(-e+a)/2/t,s=(-e-a)/2/t;return n.Curve.filterByIn0to1([o,s])}return[]},solutionsOfLinearEq:function(t,e){return 0===t?0===e?0:[]:n.Curve.filterByIn0to1([-e/t])},filterByIn0to1:function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];i>=0&&i<=1&&e.push(i)}return e}}),n.Curve.QuadBezier=n.Curve.Subclass({Init:function(t,e,n){this.cp0=t,this.cp1=e,this.cp2=n;var i=t.x,r=2*(e.x-t.x),a=n.x-2*e.x+t.x;this.px=function(t){return i+t*r+t*t*a},this.dpx=function(t){return r+2*t*a};var o=t.y,s=2*(e.y-t.y),h=n.y-2*e.y+t.y;this.py=function(t){return o+t*s+t*t*h},this.dpy=function(t){return s+2*t*h}},startPosition:function(){return this.cp0},endPosition:function(){return this.cp2},position:function(t){return n.Frame.Point(this.px(t),this.py(t))},derivative:function(t){return n.Frame.Point(this.dpx(t),this.dpy(t))},angle:function(t){return Math.atan2(this.dpy(t),this.dpx(t))},boundingBox:function(t){var e=this.maxMin(this.cp0.x,this.cp1.x,this.cp2.x,t),i=this.maxMin(this.cp0.y,this.cp1.y,this.cp2.y,t);if(0===t)return n.Frame.Rect(this.cp0.x,this.cp0.y,{l:this.cp0.x-e.min,r:e.max-this.cp0.x,u:i.max-this.cp0.y,d:this.cp0.y-i.min});var r=Math.PI/2,a=this.cp0.x,o=this.cp0.y,s=this.cp2.x,h=this.cp2.y,c=this.angle(0)+r,u=this.angle(1)+r,p=t*Math.cos(c),l=t*Math.sin(c),d=t*Math.cos(u),m=t*Math.sin(u),x=Math.min(e.min,a+p,a-p,s+d,s-d),f=Math.max(e.max,a+p,a-p,s+d,s-d),g=Math.min(i.min,o+l,o-l,h+m,h-m),S=Math.max(i.max,o+l,o-l,h+m,h-m);return n.Frame.Rect(a,o,{l:a-x,r:f-a,u:S-o,d:o-g})},maxMin:function(t,e,i,r){var a,o;t>i?(a=t,o=i):(a=i,o=t);var s,h,c=n.Util.roundEpsilon,u=c(t),p=c(e-t),l=c(i-2*e+t);return 0!=l&&(h=-p/l)>0&&h<1&&(s=function(t){return u+2*t*p+t*t*l}(h),a=Math.max(a,s+r,s-r),o=Math.min(o,s+r,s-r)),{min:o,max:a}},divide:function(t){if(t<0||t>1)throw n.ExecutionError("illegal quadratic Bezier parameter t:"+t);var e=this.cp0.x,i=this.cp1.x,r=this.cp2.x,a=this.cp0.y,o=this.cp1.y,s=this.cp2.y,h=this.px(t),c=this.py(t),u=this.cp0,p=n.Frame.Point(e+t*(i-e),a+t*(o-a)),l=n.Frame.Point(h,c),d=l,m=n.Frame.Point(i+t*(r-i),o+t*(s-o)),x=this.cp2;return[n.Curve.QuadBezier(u,p,l),n.Curve.QuadBezier(d,m,x)]},slice:function(t,e){if(!(t>=e)){if(t<0&&(t=0),e>1&&(e=1),0===t&&1===e)return this;this.cp0.x;var i=this.cp1.x,r=this.cp2.x,a=(this.cp0.y,this.cp1.y),o=this.cp2.y,s=this.px(t),h=this.py(t),c=i+t*(r-i),u=a+t*(o-a),p=n.Frame.Point(s,h),l=n.Frame.Point(s+e*(c-s),h+e*(u-h)),d=n.Frame.Point(this.px(e),this.py(e));return n.Curve.QuadBezier(p,l,d)}},tOfIntersections:function(t){if(t.isPoint())return[];if(t.isRect()){var e,i=t.x+t.r,r=t.x-t.l,a=t.y+t.u,o=t.y-t.d,s=n.Util.roundEpsilon,h=this.cp0.x,c=this.cp1.x,u=this.cp2.x,p=s(h),l=s(2*(c-h)),d=s(u-2*c+h),m=function(t){return p+t*l+t*t*d},x=this.cp0.y,f=this.cp1.y,g=this.cp2.y,S=s(x),y=s(2*(f-x)),v=s(g-2*f+x),b=function(t){return S+t*y+t*t*v},C=[];e=(e=n.Curve.solutionsOfQuadEq(d,l,p-i)).concat(n.Curve.solutionsOfQuadEq(d,l,p-r));for(var M=0;M<e.length;M++)(O=b(X=e[M]))>=o&&O<=a&&C.push(X);for(e=(e=n.Curve.solutionsOfQuadEq(v,y,S-a)).concat(n.Curve.solutionsOfQuadEq(v,y,S-o)),M=0;M<e.length;M++)(P=m(X=e[M]))>=r&&P<=i&&C.push(X);return C}if(t.isCircle()){var w=Math.PI,P=t.x,O=t.y,A=t.l,L=t.r,E=t.u,B=t.d,j=P+(L-A)/2,D=O+(E-B)/2,k=(i=(A+L)/2,(E+B)/2),I=w/180,T=n.CurveSegment.Arc(j,D,i,k,-w-I,-w/2+I),F=n.CurveSegment.Arc(j,D,i,k,-w/2-I,0+I),R=n.CurveSegment.Arc(j,D,i,k,0-I,w/2+I),G=n.CurveSegment.Arc(j,D,i,k,w/2-I,w+I),V=n.CurveSegment.QuadBezier(this,0,1),J=[];for(J=(J=(J=(J=J.concat(n.CurveSegment.findIntersections(T,V))).concat(n.CurveSegment.findIntersections(F,V))).concat(n.CurveSegment.findIntersections(R,V))).concat(n.CurveSegment.findIntersections(G,V)),C=[],M=0;M<J.length;M++){var X=(J[M][1].min+J[M][1].max)/2;C.push(X)}return C}},countOfSegments:function(){return 1},drawPrimitive:function(t,e){var i=this.cp0,r=this.cp1,a=this.cp2;t.createSVGElement("path",{d:"M"+n.em2px(i.x)+","+n.em2px(-i.y)+" Q"+n.em2px(r.x)+","+n.em2px(-r.y)+" "+n.em2px(a.x)+","+n.em2px(-a.y),"stroke-dasharray":e})},toString:function(){return"QuadBezier("+this.cp0.x+", "+this.cp0.y+")-("+this.cp1.x+", "+this.cp1.y+")-("+this.cp2.x+", "+this.cp2.y+")"}}),n.Curve.CubicBezier=n.Curve.Subclass({Init:function(t,e,n,i){this.cp0=t,this.cp1=e,this.cp2=n,this.cp3=i;var r=t.x,a=3*(e.x-t.x),o=3*(n.x-2*e.x+t.x),s=i.x-3*n.x+3*e.x-t.x;this.px=function(t){return r+t*a+t*t*o+t*t*t*s},this.dpx=function(t){return a+2*t*o+3*t*t*s};var h=t.y,c=3*(e.y-t.y),u=3*(n.y-2*e.y+t.y),p=i.y-3*n.y+3*e.y-t.y;this.py=function(t){return h+t*c+t*t*u+t*t*t*p},this.dpy=function(t){return c+2*t*u+3*t*t*p}},startPosition:function(){return this.cp0},endPosition:function(){return this.cp3},position:function(t){return n.Frame.Point(this.px(t),this.py(t))},derivative:function(t){return n.Frame.Point(this.dpx(t),this.dpy(t))},angle:function(t){return Math.atan2(this.dpy(t),this.dpx(t))},boundingBox:function(t){var e=this.maxMin(this.cp0.x,this.cp1.x,this.cp2.x,this.cp3.x,t),i=this.maxMin(this.cp0.y,this.cp1.y,this.cp2.y,this.cp3.y,t);if(0===t)return n.Frame.Rect(this.cp0.x,this.cp0.y,{l:this.cp0.x-e.min,r:e.max-this.cp0.x,u:i.max-this.cp0.y,d:this.cp0.y-i.min});var r=Math.PI/2,a=this.cp0.x,o=this.cp0.y,s=this.cp3.x,h=this.cp3.y,c=this.angle(0)+r,u=this.angle(1)+r,p=t*Math.cos(c),l=t*Math.sin(c),d=t*Math.cos(u),m=t*Math.sin(u),x=Math.min(e.min,a+p,a-p,s+d,s-d),f=Math.max(e.max,a+p,a-p,s+d,s-d),g=Math.min(i.min,o+l,o-l,h+m,h-m),S=Math.max(i.max,o+l,o-l,h+m,h-m);return n.Frame.Rect(a,o,{l:a-x,r:f-a,u:S-o,d:o-g})},maxMin:function(t,e,i,r,a){var o,s;t>r?(o=t,s=r):(o=r,s=t);var h,c=n.Util.roundEpsilon,u=c(t),p=c(e-t),l=c(i-2*e+t),d=c(r-3*i+3*e-t),m=function(t){t>0&&t<1&&(h=function(t){return u+3*t*p+3*t*t*l+t*t*t*d}(t),o=Math.max(o,h+a,h-a),s=Math.min(s,h+a,h-a))};if(0==d)0!=l&&m(-p/l/2);else{var x=l*l-p*d;x>0?(m((-l+Math.sqrt(x))/d),m((-l-Math.sqrt(x))/d)):0==x&&m(-l/d)}return{min:s,max:o}},divide:function(t){if(t<0||t>1)throw n.ExecutionError("illegal cubic Bezier parameter t:"+t);var e=this.cp0.x,i=this.cp1.x,r=this.cp2.x,a=this.cp3.x,o=this.cp0.y,s=this.cp1.y,h=this.cp2.y,c=this.cp3.y,u=this.px(t),p=this.py(t),l=this.cp0,d=n.Frame.Point(e+t*(i-e),o+t*(s-o)),m=n.Frame.Point(e+2*t*(i-e)+t*t*(r-2*i+e),o+2*t*(s-o)+t*t*(h-2*s+o)),x=n.Frame.Point(u,p),f=x,g=n.Frame.Point(i+2*t*(r-i)+t*t*(a-2*r+i),s+2*t*(h-s)+t*t*(c-2*h+s)),S=n.Frame.Point(r+t*(a-r),h+t*(c-h)),y=this.cp3;return[n.Curve.CubicBezier(l,d,m,x),n.Curve.CubicBezier(f,g,S,y)]},slice:function(t,e){if(!(t>=e)){if(t<0&&(t=0),e>1&&(e=1),0===t&&1===e)return this;this.cp0.x;var i=this.cp1.x,r=this.cp2.x,a=this.cp3.x,o=(this.cp0.y,this.cp1.y),s=this.cp2.y,h=this.cp3.y,c=this.px(t),u=this.py(t),p=i+2*t*(r-i)+t*t*(a-2*r+i),l=o+2*t*(s-o)+t*t*(h-2*s+o),d=r+t*(a-r),m=s+t*(h-s),x=n.Frame.Point(c,u),f=n.Frame.Point(c+e*(p-c),u+e*(l-u)),g=n.Frame.Point(c+2*e*(p-c)+e*e*(d-2*p+c),u+2*e*(l-u)+e*e*(m-2*l+u)),S=n.Frame.Point(this.px(e),this.py(e));return n.Curve.CubicBezier(x,f,g,S)}},tOfIntersections:function(t){if(t.isPoint())return[];if(t.isRect()){var e,i=t.x+t.r,r=t.x-t.l,a=t.y+t.u,o=t.y-t.d,s=n.Util.roundEpsilon,h=this.cp0.x,c=this.cp1.x,u=this.cp2.x,p=this.cp3.x,l=this.cp0.y,d=this.cp1.y,m=this.cp2.y,x=this.cp3.y,f=s(h),g=s(3*(c-h)),S=s(3*(u-2*c+h)),y=s(p-3*u+3*c-h),v=function(t){return f+t*g+t*t*S+t*t*t*y},b=s(l),C=s(3*(d-l)),M=s(3*(m-2*d+l)),w=s(x-3*m+3*d-l),P=function(t){return b+t*C+t*t*M+t*t*t*w},O=[];e=(e=n.Curve.solutionsOfCubicEq(y,S,g,f-i)).concat(n.Curve.solutionsOfCubicEq(y,S,g,f-r));for(var A=0;A<e.length;A++)(B=P(U=e[A]))>=o&&B<=a&&O.push(U);for(e=(e=n.Curve.solutionsOfCubicEq(w,M,C,b-a)).concat(n.Curve.solutionsOfCubicEq(w,M,C,b-o)),A=0;A<e.length;A++)(E=v(U=e[A]))>=r&&E<=i&&O.push(U);return O}if(t.isCircle()){var L=Math.PI,E=t.x,B=t.y,j=t.l,D=t.r,k=t.u,I=t.d,T=E+(D-j)/2,F=B+(k-I)/2,R=(i=(j+D)/2,(k+I)/2),G=L/180,V=n.CurveSegment.Arc(T,F,i,R,-L-G,-L/2+G),J=n.CurveSegment.Arc(T,F,i,R,-L/2-G,0+G),X=n.CurveSegment.Arc(T,F,i,R,0-G,L/2+G),z=n.CurveSegment.Arc(T,F,i,R,L/2-G,L+G),H=n.CurveSegment.CubicBezier(this,0,1),Q=[];for(Q=(Q=(Q=(Q=Q.concat(n.CurveSegment.findIntersections(V,H))).concat(n.CurveSegment.findIntersections(J,H))).concat(n.CurveSegment.findIntersections(X,H))).concat(n.CurveSegment.findIntersections(z,H)),O=[],A=0;A<Q.length;A++){var U=(Q[A][1].min+Q[A][1].max)/2;O.push(U)}return O}},countOfSegments:function(){return 1},drawPrimitive:function(t,e){var i=this.cp0,r=this.cp1,a=this.cp2,o=this.cp3;t.createSVGElement("path",{d:"M"+n.em2px(i.x)+","+n.em2px(-i.y)+" C"+n.em2px(r.x)+","+n.em2px(-r.y)+" "+n.em2px(a.x)+","+n.em2px(-a.y)+" "+n.em2px(o.x)+","+n.em2px(-o.y),"stroke-dasharray":e})},toString:function(){return"CubicBezier("+this.cp0.x+", "+this.cp0.y+")-("+this.cp1.x+", "+this.cp1.y+")-("+this.cp2.x+", "+this.cp2.y+")-("+this.cp3.x+", "+this.cp3.y+")"}}),n.Curve.CubicBeziers=n.Curve.Subclass({Init:function(t){this.cbs=t;var e=this.cbs.length;this.delegate=0==e?function(t,e,n){return n}:function(n,i,r){var a=n*e,o=Math.floor(a);o<0&&(o=0),o>=e&&(o=e-1);var s=a-o;return i(t[o],s)}},startPosition:function(){return this.cbs[0].cp0},endPosition:function(){return this.cbs[this.cbs.length-1].cp3},position:function(t){return this.delegate(t,(function(t,e){return t.position(e)}),void 0)},derivative:function(t){return this.delegate(t,(function(t,e){return t.derivative(e)}),void 0)},angle:function(t){return this.delegate(t,(function(t,e){return t.angle(e)}),0)},velocity:function(t){var e=this.cbs.length;return this.delegate(t,(function(t,n){return e*t.velocity(n)}),0)},boundingBox:function(t){if(0!=this.cbs.length){var e,n=this.cbs[0].boundingBox(t),i=this.cbs.length;for(e=1;e<i;e++)n=n.combineRect(this.cbs[e].boundingBox(t));return n}},tOfIntersections:function(t){var e=[],n=0,i=this.cbs.length;for(n=0;n<i;n++){var r=this.cbs[n];for(unnormalizedTs=r.tOfIntersections(t),j=0;j<unnormalizedTs.length;j++)e.push((unnormalizedTs[j]+n)/i)}return e},divide:function(t){if(t<0||t>1)throw n.ExecutionError("illegal cubic Bezier parameter t:"+t);if(0===t)return[n.Curve.CubicBeziers([]),this];if(1===t)return[this,n.Curve.CubicBeziers([])];var e=this.cbs.length,i=t*e,r=Math.floor(i);r===e&&(r=e-1);var a=i-r,o=this.cbs.slice(0,r),s=this.cbs.slice(r+1),h=this.cbs[r].divide(a);return o.push(h[0]),s.unshift(h[1]),[n.Curve.CubicBeziers(o),n.Curve.CubicBeziers(s)]},slice:function(t,e){if(!(t>=e)){if(t<0&&(t=0),e>1&&(e=1),0===t&&1===e)return this;var i=this.cbs.length,r=t*i,a=e*i,o=Math.floor(r),s=Math.floor(a);o===i&&(o=i-1),s===i&&(s=i-1);var h,c=r-o,u=a-s;return o===s?h=[this.cbs[o].slice(c,u)]:((h=this.cbs.slice(o+1,s)).push(this.cbs[s].slice(0,u)),h.unshift(this.cbs[o].slice(c,1))),n.Curve.CubicBeziers(h)}},countOfSegments:function(){return this.cbs.length},drawPrimitive:function(t,e){for(var i=this.cbs.length,r=this.cbs,a=r[0],o=a.cp0,s=a.cp1,h=a.cp2,c=a.cp3,u="M"+n.em2px(o.x)+","+n.em2px(-o.y)+" C"+n.em2px(s.x)+","+n.em2px(-s.y)+" "+n.em2px(h.x)+","+n.em2px(-h.y)+" "+n.em2px(c.x)+","+n.em2px(-c.y),p=1;p<i;p++)h=(a=r[p]).cp2,c=a.cp3,u+=" S"+n.em2px(h.x)+","+n.em2px(-h.y)+" "+n.em2px(c.x)+","+n.em2px(-c.y);t.createSVGElement("path",{d:u,"stroke-dasharray":e})},drawSkipped:function(t){for(var e=this.cbs.length,i=this.cbs,r="",a=0;a<e;a+=2){var o=i[a],s=o.cp0,h=o.cp1,c=o.cp2,u=o.cp3;r+="M"+n.em2px(s.x)+","+n.em2px(-s.y)+" C"+n.em2px(h.x)+","+n.em2px(-h.y)+" "+n.em2px(c.x)+","+n.em2px(-c.y)+" "+n.em2px(u.x)+","+n.em2px(-u.y)}t.createSVGElement("path",{d:r})}},{interpolation:function(t,e,i){var r,a=n.Curve.CubicBeziers.cubicSplineInterpolation(t,e),o=a[0],s=a[1],h=n.Curve.CubicBeziers.cubicSplineInterpolation(t,i),c=h[0],u=h[1],p=t.length,l=new Array(p-1);for(r=0;r<p-1;r++)l[r]=n.Curve.CubicBezier(n.Frame.Point(e[r],i[r]),n.Frame.Point(o[r],c[r]),n.Frame.Point(s[r],u[r]),n.Frame.Point(e[r+1],i[r+1]));return n.Curve.CubicBeziers(l)},cubicSplineInterpolation:function(t,e){var n,i=t.length-1,r=new Array(i);for(n=0;n<i;n++)r[n]=t[n+1]-t[n];var a=new Array(i);for(n=1;n<i;n++)a[n]=3*(e[n+1]-e[n])/r[n]-3*(e[n]-e[n-1])/r[n-1];var o=new Array(i+1),s=new Array(i+1),h=new Array(i+1);for(o[0]=1,s[0]=0,h[0]=0,n=1;n<i;n++)o[n]=2*(t[n+1]-t[n-1])-r[n-1]*s[n-1],s[n]=r[n]/o[n],h[n]=(a[n]-r[n-1]*h[n-1])/o[n];o[i]=1,h[i]=0;var c=new Array(i),u=new Array(i+1);for(u[i]=0,n=i-1;n>=0;n--){var p=r[n],l=u[n+1],d=p*p*h[n]-s[n]*l;u[n]=d,c[n]=e[n+1]-e[n]-(l+2*d)/3}var m=new Array(i),x=new Array(i);for(n=0;n<i;n++){var f=e[n],g=c[n],S=u[n];m[n]=f+g/3,x[n]=f+(2*g+S)/3}return[m,x]}}),n.Curve.CubicBSpline=MathJax.Object.Subclass({Init:function(t,e,i){if(e.length<1)throw n.ExecutionError("the number of internal control points of cubic B-spline must be greater than or equal to 1");var r=[];r.push(t);for(var a=0,o=e.length;a<o;a++)r.push(e[a]);r.push(i),this.cps=r;var s=this.cps.length-1,h=function(t){return t<0?r[0]:t>s?r[s]:r[t]},c=function(t){var e=Math.abs(t);return e<=1?(3*e*e*e-6*e*e+4)/6:e<=2?-(e-2)*(e-2)*(e-2)/6:0};this.px=function(t){for(var e=(s+2)*t-1,n=Math.ceil(e-2),i=Math.floor(e+2),r=0,a=n;a<=i;a++)r+=c(e-a)*h(a).x;return r},this.py=function(t){for(var e=(s+2)*t-1,n=Math.ceil(e-2),i=Math.floor(e+2),r=0,a=n;a<=i;a++)r+=c(e-a)*h(a).y;return r};var u=function(t){var e=t>0?1:t<0?-1:0,n=Math.abs(t);return n<=1?e*(3*n*n-4*n)/2:n<=2?-e*(n-2)*(n-2)/2:0};this.dpx=function(t){for(var e=(s+2)*t-1,n=Math.ceil(e-2),i=Math.floor(e+2),r=0,a=n;a<=i;a++)r+=u(e-a)*h(a).x;return r},this.dpy=function(t){for(var e=(s+2)*t-1,n=Math.ceil(e-2),i=Math.floor(e+2),r=0,a=n;a<=i;a++)r+=u(e-a)*h(a).y;return r}},position:function(t){return n.Frame.Point(this.px(t),this.py(t))},angle:function(t){return Math.atan2(this.dpy(t),this.dpx(t))},toCubicBeziers:function(){var t=[],e=this.cps,i=e[0],r=e[1],a=e[2],o=i.x,s=i.y,h=o+(r.x-o)/3,c=s+(r.y-s)/3,u=o+2*(r.x-o)/3,p=s+2*(r.y-s)/3,l=r.x+(a.x-r.x)/3,d=r.y+(a.y-r.y)/3,m=(u+l)/2,x=(p+d)/2,f=i,g=n.Frame.Point(h,c),S=n.Frame.Point(u,p),y=n.Frame.Point(m,x),v=n.Curve.CubicBezier(f,g,S,y);t.push(v);for(var b=this.cps.length-1,C=2;C<b;C++)i=r,r=a,a=e[C+1],o=m,s=x,h=2*m-u,c=2*x-p,u=i.x+2*(r.x-i.x)/3,p=i.y+2*(r.y-i.y)/3,m=(u+(l=r.x+(a.x-r.x)/3))/2,x=(p+(d=r.y+(a.y-r.y)/3))/2,f=y,g=n.Frame.Point(h,c),S=n.Frame.Point(u,p),y=n.Frame.Point(m,x),v=n.Curve.CubicBezier(f,g,S,y),t.push(v);return i=r,r=a,o=m,s=x,h=2*m-u,c=2*x-p,u=i.x+2*(r.x-i.x)/3,p=i.y+2*(r.y-i.y)/3,m=r.x,x=r.y,f=y,g=n.Frame.Point(h,c),S=n.Frame.Point(u,p),y=n.Frame.Point(m,x),v=n.Curve.CubicBezier(f,g,S,y),t.push(v),t},countOfSegments:function(){return this.cps.length-1}}),n.Curve.Line=MathJax.Object.Subclass({Init:function(t,e){this.s=t,this.e=e},position:function(t){return n.Frame.Point(this.s.x+t*(this.e.x-this.s.x),this.s.y+t*(this.e.y-this.s.y))},slice:function(t,e){if(!(t>=e)){if(t<0&&(t=0),e>1&&(e=1),0===t&&1===e)return this;var i=this.s,r=this.e,a=r.x-i.x,o=r.y-i.y,s=n.Frame.Point(i.x+t*a,i.y+t*o),h=n.Frame.Point(i.x+e*a,i.y+e*o);return n.Curve.Line(s,h)}},tOfIntersections:function(t){if(t.isPoint())return[];var e=this.s,i=this.e;if(t.isRect()){var r,a=t.x+t.r,o=t.x-t.l,s=t.y+t.u,h=t.y-t.d,c=e.x,u=e.y,p=i.x-c,l=i.y-u,d=function(t){return c+t*p},m=function(t){return u+t*l},x=[];r=(r=n.Curve.solutionsOfLinearEq(p,c-a)).concat(n.Curve.solutionsOfLinearEq(p,c-o));for(var f=0;f<r.length;f++){var g=m(S=r[f]);g>=h&&g<=s&&x.push(S)}for(r=(r=n.Curve.solutionsOfLinearEq(l,u-s)).concat(n.Curve.solutionsOfLinearEq(l,u-h)),f=0;f<r.length;f++){var S,y=d(S=r[f]);y>=o&&y<=a&&x.push(S)}return x}if(t.isCircle()){Math.PI;var v=t.l,b=t.r,C=t.u,M=t.d,w=t.x+(b-v)/2,P=t.y+(C-M)/2,O=(a=(v+b)/2,(C+M)/2),A=e.x,L=e.y,E=i.x-A,B=-E,j=(h=i.y-L)*a,D=B*O,k=j*j+D*D,I=(i=-(M=j*w+D*P+((E*L-h*A)*a+(a-O)*B*P))/k,k*a*a-M*M);if(I<0)return[];var T,F,R=Math.sqrt(I)/k,G=O/a,V=j*i+D*R+w,J=G*(D*i-j*R+P-P)+P,X=j*i-D*R+w,z=G*(D*i+j*R+P-P)+P;return Math.abs(E)>Math.abs(h)?(T=(V-A)/E,F=(X-A)/E):(T=(J-L)/h,F=(z-L)/h),x=[],T>=0&&T<=1&&x.push(T),F>=0&&F<=1&&x.push(F),x}},toShape:function(t,e,r,a){var o=t.env,s=i.xypic.thickness,h=this.s,c=this.e;if(h.x!==c.x||h.y!==c.y){var u,p=c.x-h.x,l=c.y-h.y,d=Math.atan2(l,p),m=n.Shape.none;switch(r){case"=":r="-",a="2";break;case"==":r="--",a="2";break;case":":case"::":r=".",a="2"}switch(r){case"":return o.angle=d,o.lastCurve=n.LastCurve.Line(h,c,o.p,o.c,void 0),m;case"-":case".":case"..":switch(a){case"2":u=s/2;break;case"3":u=s;break;default:u=0}break;case"--":var x=3*s;if((S=Math.sqrt(p*p+l*l))>=x)switch(a){case"2":u=s/2;break;case"3":u=s;break;default:u=0}break;case"~":case"~~":switch(a){case"2":u=1.5*s;break;case"3":u=2*s;break;default:u=0}break;default:var f=e.boundingBox(t);if(null==f)return o.angle=0,o.lastCurve=n.LastCurve.none,n.Shape.none;var g=f.l+f.r;0==g&&(g=i.xypic.strokeWidth);var S=Math.sqrt(p*p+l*l);if(0==Math.floor(S/g))return o.angle=0,o.lastCurve=n.LastCurve.none,n.Shape.none;u=Math.max(f.u,f.d)}if(void 0!==u){var y=this.boundingBox(u);return m=n.Shape.LineShape(this,e,r,a,y),t.appendShapeToFront(m),o.angle=d,o.lastCurve=n.LastCurve.Line(h,c,o.p,o.c,m),m}}return o.angle=0,o.lastCurve=n.LastCurve.none,n.Shape.none},boundingBox:function(t){var e=this.s,i=this.e,r=i.x-e.x,a=i.y-e.y,o=Math.atan2(a,r),s=t*Math.cos(o+Math.PI/2),h=t*Math.sin(o+Math.PI/2);return n.Frame.Rect(e.x,e.y,{l:e.x-Math.min(e.x+s,e.x-s,i.x+s,i.x-s),r:Math.max(e.x+s,e.x-s,i.x+s,i.x-s)-e.x,u:Math.max(e.y+h,e.y-h,i.y+h,i.y-h)-e.y,d:e.y-Math.min(e.y+h,e.y-h,i.y+h,i.y-h)})},drawLine:function(t,e,i,r,a){if(a.isEmpty)this._drawLine(t,e,i,r);else{var o=n.Range(0,1).differenceRanges(a),s=this;o.foreach((function(n){s.slice(n.start,n.end)._drawLine(t,e,i,r)}))}},_drawLine:function(t,e,r,a){var o=i.xypic.thickness,s=this.s,h=this.e;if(s.x!==h.x||s.y!==h.y){var c=h.x-s.x,u=h.y-s.y,p=Math.atan2(u,c),l={x:0,y:0};switch(r){case"":break;case"-":this.drawStraightLine(t,s,h,l,p,o,a,"");break;case"=":this.drawStraightLine(t,s,h,l,p,o,"2","");break;case".":case"..":this.drawStraightLine(t,s,h,l,p,o,a,i.xypic.dottedDasharray);break;case":":case"::":this.drawStraightLine(t,s,h,l,p,o,"2",i.xypic.dottedDasharray);break;case"--":case"==":var d=3*o;(L=Math.sqrt(c*c+u*u))>=d&&(l={x:(E=(L-d)/2-Math.floor((L-d)/2/d)*d)*Math.cos(p),y:E*Math.sin(p)},this.drawStraightLine(t,s,h,l,p,o,"=="===r?"2":a,n.em2px(d)+" "+n.em2px(d)));break;case"~":if((L=Math.sqrt(c*c+u*u))>=(C=4*o)){l={x:(E=(L-(A=Math.floor(L/C))*C)/2)*Math.cos(p),y:E*Math.sin(p)};for(var m=o*Math.cos(p+Math.PI/2),x=o*Math.sin(p+Math.PI/2),f=o*Math.cos(p),g=o*Math.sin(p),S=s.x+l.x,y=-s.y-l.y,v="M"+n.em2px(S)+","+n.em2px(y)+" Q"+n.em2px(S+f+m)+","+n.em2px(y-g-x)+" "+n.em2px(S+2*f)+","+n.em2px(y-2*g)+" T"+n.em2px(S+4*f)+","+n.em2px(y-4*g),b=1;b<A;b++)v+=" T"+n.em2px(S+(4*b+2)*f)+","+n.em2px(y-(4*b+2)*g)+" T"+n.em2px(S+(4*b+4)*f)+","+n.em2px(y-(4*b+4)*g);this.drawSquigglyLineShape(t,v,s,h,m,x,a)}break;case"~~":var C;if((L=Math.sqrt(c*c+u*u))>=(C=4*o)){for(l={x:(E=(L-C)/2-(A=Math.floor((L-C)/2/C))*C)*Math.cos(p),y:E*Math.sin(p)},m=o*Math.cos(p+Math.PI/2),x=o*Math.sin(p+Math.PI/2),f=o*Math.cos(p),g=o*Math.sin(p),S=s.x+l.x,y=-s.y-l.y,v="",b=0;b<=A;b++)v+=" M"+n.em2px(S+8*b*f)+","+n.em2px(y-8*b*g)+" Q"+n.em2px(S+(8*b+1)*f+m)+","+n.em2px(y-(8*b+1)*g-x)+" "+n.em2px(S+(8*b+2)*f)+","+n.em2px(y-(8*b+2)*g)+" T"+n.em2px(S+(8*b+4)*f)+","+n.em2px(y-(8*b+4)*g);this.drawSquigglyLineShape(t,v,s,h,m,x,a)}break;default:var M=n.Env();M.c=n.Env.originPosition;var w=n.DrawingContext(n.Shape.none,M),P=e.boundingBox(w);if(null==P)return;var O=P.l+P.r;0==O&&(O=i.xypic.strokeWidth);var A,L=Math.sqrt(c*c+u*u);if(0==(A=Math.floor(L/O)))return;var E=(L-A*O)/2,B=Math.cos(p),j=Math.sin(p),D=O*B,k=O*j,I=s.x+(E+P.l)*B,T=s.y+(E+P.l)*j;for(w=n.DrawingContext(n.Shape.none,M),b=0;b<A;b++)M.c=n.Frame.Point(I+b*D,T+b*k),M.angle=p,e.toDropShape(w).draw(t)}}},drawStraightLine:function(t,e,i,r,a,o,s,h){if("3"===s){var c=o*Math.cos(a+Math.PI/2),u=o*Math.sin(a+Math.PI/2);t.createSVGElement("line",{x1:n.em2px(e.x+r.x),y1:-n.em2px(e.y+r.y),x2:n.em2px(i.x),y2:-n.em2px(i.y),"stroke-dasharray":h}),t.createSVGElement("line",{x1:n.em2px(e.x+c+r.x),y1:-n.em2px(e.y+u+r.y),x2:n.em2px(i.x+c),y2:-n.em2px(i.y+u),"stroke-dasharray":h}),t.createSVGElement("line",{x1:n.em2px(e.x-c+r.x),y1:-n.em2px(e.y-u+r.y),x2:n.em2px(i.x-c),y2:-n.em2px(i.y-u),"stroke-dasharray":h})}else"2"===s?(c=o*Math.cos(a+Math.PI/2)/2,u=o*Math.sin(a+Math.PI/2)/2,t.createSVGElement("line",{x1:n.em2px(e.x+c+r.x),y1:-n.em2px(e.y+u+r.y),x2:n.em2px(i.x+c),y2:-n.em2px(i.y+u),"stroke-dasharray":h}),t.createSVGElement("line",{x1:n.em2px(e.x-c+r.x),y1:-n.em2px(e.y-u+r.y),x2:n.em2px(i.x-c),y2:-n.em2px(i.y-u),"stroke-dasharray":h})):t.createSVGElement("line",{x1:n.em2px(e.x+r.x),y1:-n.em2px(e.y+r.y),x2:n.em2px(i.x),y2:-n.em2px(i.y),"stroke-dasharray":h})},drawSquigglyLineShape:function(t,e,n,i,r,a,o){"3"===o?(t.createSVGElement("path",{d:e}),t.createGroup(t.transformBuilder().translate(r,a)).createSVGElement("path",{d:e}),t.createGroup(t.transformBuilder().translate(-r,-a)).createSVGElement("path",{d:e})):"2"===o?(t.createGroup(t.transformBuilder().translate(r/2,a/2)).createSVGElement("path",{d:e}),t.createGroup(t.transformBuilder().translate(-r/2,-a/2)).createSVGElement("path",{d:e})):t.createSVGElement("path",{d:e})}}),n.CurveSegment=MathJax.Object.Subclass({bezierFatLine:function(t){var e,n,i,r=this.cps[0],a=this.cps[t];if(r.x!==a.x||r.y!==a.y)e=r.y-a.y,n=a.x-r.x,l=Math.sqrt(e*e+n*n),e/=l,n/=l,i=(r.x*a.y-r.y*a.x)/l;else{var o=this.bezier.angle(this.tmin);e=-Math.sin(o),n=Math.cos(o),i=-e*this.cp0.x-n*this.cp0.y}for(var s=i,h=i,c=1;c<t;c++){var u=-e*this.cps[c].x-n*this.cps[c].y;u>h?h=u:u<s&&(s=u)}return{min:[e,n,s],max:[e,n,h]}},clippedLineRange:function(t,e,i){for(var r,a,o,s,h=t.length-1,c=new Array(h+1),u=n.Util.extProd,p=0;p<=h;p++)c[p]=[p/h,-e[0]*t[p].x-e[1]*t[p].y-e[2],1];if(c[0][1]<0){var l=!0;for(p=1;p<=h;p++){var d=u(c[0],c[p]);v=-d[2]/d[0],v>0&&v<1&&(void 0===r||v<r)&&(r=v),c[p][1]>=0&&(l=!1)}if(l)return}else r=0;if(c[h][1]<0)for(p=0;p<h;p++){var m=u(c[h],c[p]);v=-m[2]/m[0],v>0&&v<1&&(void 0===a||v>a)&&(a=v)}else a=1;for(p=0;p<=h;p++)c[p]=[p/h,i[0]*t[p].x+i[1]*t[p].y+i[2],1];if(c[0][1]<0){var x=!0;for(p=1;p<=h;p++)d=u(c[0],c[p]),v=-d[2]/d[0],v>0&&v<1&&(void 0===o||v<o)&&(o=v),c[p][1]>=0&&(x=!1);if(x)return}else o=0;if(c[h][1]<0)for(p=0;p<h;p++)m=u(c[h],c[p]),v=-m[2]/m[0],v>0&&v<1&&(void 0===s||v>s)&&(s=v);else s=1;var f=Math.max(r,o),g=Math.min(a,s);return{min:this.tmin+f*(this.tmax-this.tmin),max:this.tmin+g*(this.tmax-this.tmin)}}},{findIntersections:function(t,e){for(var i=n.CurveSegment.maxIterations,r=n.CurveSegment.goalAccuracy,a=[[t,e,!1]],o=0,s=[];o<i&&a.length>0;){o++;var h=a.shift(),c=(t=h[0],e=h[1],h[2]),u=t.fatLine(),p=e.clippedRange(u.min,u.max);if(null!=p){var l=p.min,d=p.max,m=d-l;if(m<r&&t.paramLength()<r)c?s.push([e.clip(l,d).paramRange(),t.paramRange()]):s.push([t.paramRange(),e.clip(l,d).paramRange()]);else if(m<=.8*e.paramLength())a.push([e.clip(l,d),t,!c]);else if(m>t.paramLength()){var x=(d+l)/2;a.push([e.clip(l,x),t,!c]),a.push([e.clip(x,d),t,!c])}else{var f=e.clip(l,d),g=t.paramRange(),S=(g.min+g.max)/2;a.push([f,t.clip(g.min,S),!c]),a.push([f,t.clip(S,g.max),!c])}}}return s},maxIterations:30,goalAccuracy:1e-4}),n.CurveSegment.Line=n.CurveSegment.Subclass({Init:function(t,e,n,i){this.p0=t,this.p1=e,this.tmin=n,this.tmax=i},paramRange:function(){return{min:this.tmin,max:this.tmax}},paramLength:function(){return this.tmax-this.tmin},containsParam:function(t){return t>=this.tmin&&t<=this.tmax},position:function(t){return{x:this.p0.x+t*(this.p1.x-this.p0.x),y:this.p0.y+t*(this.p1.y-this.p0.y)}},fatLine:function(){var t=this.p1.y-this.p0.y,e=this.p0.x-this.p1.x,n=this.p1.x*this.p0.y-this.p0.x*this.p1.y,i=Math.sqrt(t*t+e*e);return 0===i?(t=1,e=0):(t/=i,e/=i,n/=i),{min:[t,e,n],max:[t,e,n]}},clip:function(t,e){return n.CurveSegment.Line(this.p0,this.p1,t,e)},clippedRange:function(t,e){var n=new Array(2);return n[0]=this.position(this.tmin),n[1]=this.position(this.tmax),this.clippedLineRange(n,t,e)},drawFatLine:function(){this.fatLine().min;var t=function(t,e){return-(t*e[0]+e[2])/e[1]},e=this.p0.x,i=this.p1.x;n.svgForDebug.createSVGElement("line",{x1:n.em2px(e),y1:-n.em2px(t(e,lmax)),x2:n.em2px(i),y2:-n.em2px(t(i,lmax)),"stroke-width":n.em2px(.02*n.oneem),stroke:"red"})}}),n.CurveSegment.QuadBezier=n.CurveSegment.Subclass({Init:function(t,e,i){this.bezier=t,this.tmin=e,this.tmax=i,this.cp0=t.position(e),this.cp1=n.Frame.Point((1-i)*(1-e)*t.cp0.x+(e+i-2*e*i)*t.cp1.x+e*i*t.cp2.x,(1-i)*(1-e)*t.cp0.y+(e+i-2*e*i)*t.cp1.y+e*i*t.cp2.y),this.cp2=t.position(i),this.cps=[this.cp0,this.cp1,this.cp2]},paramRange:function(){return{min:this.tmin,max:this.tmax}},paramLength:function(){return this.tmax-this.tmin},fatLine:function(){return this.bezierFatLine(2)},clip:function(t,e){return n.CurveSegment.QuadBezier(this.bezier,t,e)},clippedRange:function(t,e){return this.clippedLineRange(this.cps,t,e)},drawFatLine:function(){var t=this.fatLine(),e=t.min,i=t.max,r=function(t,e){return-(t*e[0]+e[2])/e[1]},a=this.cp0.x,o=this.cp2.x;n.svgForDebug.createSVGElement("line",{x1:n.em2px(a),y1:-n.em2px(r(a,e)),x2:n.em2px(o),y2:-n.em2px(r(o,e)),"stroke-width":n.em2px(.02*n.oneem),stroke:"blue"}),n.svgForDebug.createSVGElement("line",{x1:n.em2px(a),y1:-n.em2px(r(a,i)),x2:n.em2px(o),y2:-n.em2px(r(o,i)),"stroke-width":n.em2px(.02*n.oneem),stroke:"red"})}}),n.CurveSegment.CubicBezier=n.CurveSegment.Subclass({Init:function(t,e,i){this.bezier=t,this.tmin=e,this.tmax=i,this.cp0=t.position(e),this.cp1=n.Frame.Point((1-i)*(1-e)*(1-e)*t.cp0.x+(1-e)*(2*e+i-3*e*i)*t.cp1.x+e*(2*i+e-3*e*i)*t.cp2.x+e*e*i*t.cp3.x,(1-i)*(1-e)*(1-e)*t.cp0.y+(1-e)*(2*e+i-3*e*i)*t.cp1.y+e*(2*i+e-3*e*i)*t.cp2.y+e*e*i*t.cp3.y),this.cp2=n.Frame.Point((1-e)*(1-i)*(1-i)*t.cp0.x+(1-i)*(2*i+e-3*e*i)*t.cp1.x+i*(2*e+i-3*e*i)*t.cp2.x+e*i*i*t.cp3.x,(1-e)*(1-i)*(1-i)*t.cp0.y+(1-i)*(2*i+e-3*e*i)*t.cp1.y+i*(2*e+i-3*e*i)*t.cp2.y+e*i*i*t.cp3.y),this.cp3=t.position(i),this.cps=[this.cp0,this.cp1,this.cp2,this.cp3]},paramRange:function(){return{min:this.tmin,max:this.tmax}},paramLength:function(){return this.tmax-this.tmin},fatLine:function(){return this.bezierFatLine(3)},clip:function(t,e){return n.CurveSegment.CubicBezier(this.bezier,t,e)},clippedRange:function(t,e){return this.clippedLineRange(this.cps,t,e)},drawFatLine:function(){var t=this.fatLine(),e=t.min,i=t.max,r=function(t,e){return-(t*e[0]+e[2])/e[1]},a=this.cp0.x,o=this.cp3.x;n.svgForDebug.createSVGElement("line",{x1:n.em2px(a),y1:-n.em2px(r(a,e)),x2:n.em2px(o),y2:-n.em2px(r(o,e)),"stroke-width":n.em2px(.02*n.oneem),stroke:"blue"}),n.svgForDebug.createSVGElement("line",{x1:n.em2px(a),y1:-n.em2px(r(a,i)),x2:n.em2px(o),y2:-n.em2px(r(o,i)),"stroke-width":n.em2px(.02*n.oneem),stroke:"red"})}}),n.CurveSegment.Arc=n.CurveSegment.Subclass({Init:function(t,e,n,i,r,a){this.x=t,this.y=e,this.rx=n,this.ry=i,this.angleMin=r,this.angleMax=a},paramRange:function(){return{min:this.angleMin,max:this.angleMax}},paramLength:function(){return this.angleMax-this.angleMin},normalizeAngle:function(t){return(t=t%2*Math.PI)>Math.PI?t-2*Math.PI:t<-Math.PI?t+2*Math.PI:t},containsParam:function(t){return t>=this.angleMin&&t<=this.angleMax},fatLine:function(){var t=this.rx,e=this.ry,n=(this.angleMax+this.angleMin)/2,r=(this.angleMax-this.angleMin)/2,a=Math.cos(n),o=Math.sin(n),s=Math.sqrt(t*t*o*o+e*e*a*a);if(s<i.xypic.machinePrecision)var h=[1,0,this.x*e*a+this.y*t*o+t*e*Math.cos(r)],c=[1,0,this.x*e*a+this.y*t*o+t*e];else{var u=t/s,p=e/s;h=[-p*a,-u*o,this.x*p*a+this.y*u*o+t*e/s*Math.cos(r)],c=[-p*a,-u*o,this.x*p*a+this.y*u*o+t*e/s]}return{min:h,max:c}},clip:function(t,e){return n.CurveSegment.Arc(this.x,this.y,this.rx,this.ry,t,e)},toCircleLine:function(t,e,n,r,a){var o=t[0],s=t[1],h=o*r,c=s*a,u=t[2]*r+(r-a)*s*n,p=Math.sqrt(h*h+c*c);return p<i.xypic.machinePrecision?(h=1,c=0):(h/=p,c/=p,u/=p),[h,c,u]},clippedRange:function(t,e){var i=this.x,r=this.y,a=this.rx,o=this.ry,s=this.toCircleLine(t,i,r,a,o),h=this.toCircleLine(e,i,r,a,o),c=a,u=this.angleMin,p=this.angleMax,l=-(s[0]*i+s[1]*r+s[2]),d=(n.Util.sign2,[]);if(c*c-l*l>=0){var m=s[0]*l-s[1]*Math.sqrt(c*c-l*l),x=s[1]*l+s[0]*Math.sqrt(c*c-l*l),f=s[0]*l+s[1]*Math.sqrt(c*c-l*l),g=s[1]*l-s[0]*Math.sqrt(c*c-l*l),S=Math.atan2(x,m),y=Math.atan2(g,f);this.containsParam(S)&&d.push(S),this.containsParam(y)&&d.push(y)}var v,b,C,M,w=-(s[0]*(i+c*Math.cos(u))+s[1]*(r+c*Math.sin(u))+s[2]),P=-(s[0]*(i+c*Math.cos(p))+s[1]*(r+c*Math.sin(p))+s[2]);if(w<0){if(0==d.length)return;v=Math.min.apply(Math,d)}else v=this.angleMin;if(P<0){if(0==d.length)return;b=Math.max.apply(Math,d)}else b=this.angleMax;if(d=[],c*c-(l=h[0]*i+h[1]*r+h[2])*l>=0&&(m=-s[0]*l+s[1]*Math.sqrt(c*c-l*l),x=-s[1]*l-s[0]*Math.sqrt(c*c-l*l),f=-s[0]*l-s[1]*Math.sqrt(c*c-l*l),g=-s[1]*l+s[0]*Math.sqrt(c*c-l*l),S=Math.atan2(x,m),y=Math.atan2(g,f),this.containsParam(S)&&d.push(S),this.containsParam(y)&&d.push(y)),w=h[0]*(i+c*Math.cos(u))+h[1]*(r+c*Math.sin(u))+h[2],P=h[0]*(i+c*Math.cos(p))+h[1]*(r+c*Math.sin(p))+h[2],w<0){if(0==d.length)return;C=Math.min.apply(Math,d)}else C=this.angleMin;if(P<0){if(0==d.length)return;M=Math.max.apply(Math,d)}else M=this.angleMax;return{min:Math.max(v,C),max:Math.min(b,M)}},drawFatLine:function(){var t=this.fatLine(),e=t.min,i=t.max,r=function(t,e){return-(t*e[0]+e[2])/e[1]},a=this.x+this.r*Math.cos(this.angleMin),o=this.x+this.r*Math.cos(this.angleMax);n.svgForDebug.createSVGElement("line",{x1:n.em2px(a),y1:-n.em2px(r(a,e)),x2:n.em2px(o),y2:-n.em2px(r(o,e)),"stroke-width":n.em2px(.02*n.oneem),stroke:"blue"}),n.svgForDebug.createSVGElement("line",{x1:n.em2px(a),y1:-n.em2px(r(a,i)),x2:n.em2px(o),y2:-n.em2px(r(o,i)),"stroke-width":n.em2px(.02*n.oneem),stroke:"red"})}}),n.LastCurve=MathJax.Object.Subclass({}),n.LastCurve.None=n.LastCurve.Subclass({Init:function(){},isDefined:!1,segments:function(){return[]},angle:function(){return 0}}),n.LastCurve.Augment({},{none:n.LastCurve.None()}),n.LastCurve.Line=n.LastCurve.Subclass({Init:function(t,e,n,i,r){this.start=t,this.end=e,this.p=n,this.c=i,this.lineShape=r},isDefined:!0,position:function(t){return n.Frame.Point(this.p.x+t*(this.c.x-this.p.x),this.p.y+t*(this.c.y-this.p.y))},derivative:function(t){return n.Frame.Point(this.c.x-this.p.x,this.c.y-this.p.y)},angle:function(t){var e=this.c.x-this.p.x,n=this.c.y-this.p.y;return 0===e&&0===n?0:Math.atan2(n,e)},tOfPlace:function(t,e,n,i){var r=t?this.start:this.p,a=e?this.end:this.c;if(r.x===a.x&&r.y===a.y)return 0;var o,s,h=a.x-r.x,c=a.y-r.y,u=Math.sqrt(h*h+c*c);n>.5?(o=a.x-(1-n)*h+i*h/u,s=a.y-(1-n)*c+i*c/u):(o=r.x+n*h+i*h/u,s=r.y+n*c+i*c/u);var p=this.c.x-this.p.x,l=this.c.y-this.p.y;return 0===p&&0===l?0:Math.abs(p)>Math.abs(l)?(o-this.p.x)/p:(s-this.p.y)/l},sliceHole:function(t,e){if(void 0!==this.lineShape&&!t.isPoint()){var i=this.lineShape,r=i.line,a=r.tOfIntersections(t);a.push(0),a.push(1),a.sort();for(var o=a[0],s=1;s<a.length;s++){var h=a[s],c=r.position((h+o)/2);if(t.contains(c)){var u=n.Range(o,h);i.sliceHole(u)}o=h}}},segments:function(){return[n.CurveSegment.Line(this.p,this.c,0,1)]}}),n.LastCurve.QuadBezier=n.LastCurve.Subclass({Init:function(t,e,i,r){this.origBezier=t,this.tOfShavedStart=e,this.tOfShavedEnd=i,r.isNone||(this.curveShape=r,e>0&&r.sliceHole(n.Range(0,e)),i<1&&r.sliceHole(n.Range(i,1)))},isDefined:!0,position:function(t){return this.origBezier.position(t)},derivative:function(t){return this.origBezier.derivative(t)},angle:function(t){return this.origBezier.angle(t)},tOfPlace:function(t,e,n,i){var r,a;t?(r=this.tOfShavedStart,a=e?this.tOfShavedEnd-this.tOfShavedStart:1-this.tOfShavedStart):(r=0,a=e?this.tOfShavedEnd:1);var o=this.origBezier,s=r+a*n;if(0!==i){var h=o.length(s);s=o.tOfLength(h+i)}return s},sliceHole:function(t,e){var i=this.curveShape;if(void 0!==i&&!t.isPoint()){var r=i.curve,a=r.tOfIntersections(t);a.push(0),a.push(1),a.sort();for(var o=a[0],s=1;s<a.length;s++){var h=a[s];if(o<=e&&e<=h){var c=r.position((h+o)/2);if(t.contains(c)){var u=n.Range(o,h);i.sliceHole(u)}}o=h}}},segments:function(){return[n.CurveSegment.QuadBezier(this.origBezier,0,1)]}}),n.LastCurve.CubicBezier=n.LastCurve.Subclass({Init:function(t,e,i,r){this.origBezier=t,this.tOfShavedStart=e,this.tOfShavedEnd=i,r.isNone||(this.curveShape=r,e>0&&r.sliceHole(n.Range(0,e)),i<1&&r.sliceHole(n.Range(i,1)))},originalLine:function(){return this.originalLine},isDefined:!0,position:function(t){return this.origBezier.position(t)},derivative:function(t){return this.origBezier.derivative(t)},angle:function(t){return this.origBezier.angle(t)},tOfPlace:function(t,e,n,i){var r,a;t?(r=this.tOfShavedStart,a=e?this.tOfShavedEnd-this.tOfShavedStart:1-this.tOfShavedStart):(r=0,a=e?this.tOfShavedEnd:1);var o=this.origBezier,s=r+a*n;if(0!==i){var h=o.length(s);s=o.tOfLength(h+i)}return s},sliceHole:function(t,e){var i=this.curveShape;if(void 0!==i&&!t.isPoint()){var r=i.curve,a=r.tOfIntersections(t);a.push(0),a.push(1),a.sort();for(var o=a[0],s=1;s<a.length;s++){var h=a[s];if(o<=e&&e<=h){var c=r.position((h+o)/2);if(t.contains(c)){var u=n.Range(o,h);i.sliceHole(u)}}o=h}}},segments:function(){return[n.CurveSegment.CubicBezier(this.origBezier,0,1)]}}),n.LastCurve.CubicBSpline=n.LastCurve.Subclass({Init:function(t,e,i,r,a,o){this.s=t,this.e=e,this.origBeziers=i,this.tOfShavedStart=r,this.tOfShavedEnd=a,o.isNone||(this.curveShape=o,r>0&&o.sliceHole(n.Range(0,r)),a<1&&o.sliceHole(n.Range(a,1)))},isDefined:!0,position:function(t){return this.origBeziers.position(t)},derivative:function(t){return this.origBeziers.derivative(t)},angle:function(t){return this.origBeziers.angle(t)},tOfPlace:function(t,e,n,i){var r,a;t?(r=this.tOfShavedStart,a=e?this.tOfShavedEnd-this.tOfShavedStart:1-this.tOfShavedStart):(r=0,a=e?this.tOfShavedEnd:1);var o=this.origBeziers,s=r+a*n;if(0!==i){var h=o.length(s);s=o.tOfLength(h+i)}return s},sliceHole:function(t,e){var i=this.curveShape;if(void 0!==i&&!t.isPoint()){var r=i.curve,a=r.tOfIntersections(t);a.push(0),a.push(1),a.sort();for(var o=a[0],s=1;s<a.length;s++){var h=a[s];if(o<=e&&e<=h){var c=r.position((h+o)/2);if(t.contains(c)){var u=n.Range(o,h);i.sliceHole(u)}}o=h}}},segments:function(){for(var t=new Array(this.origBeziers.length),e=t.length,i=0;i<e;i++)t[i]=n.CurveSegment.CubicBezier(this.origBezier,i/e,(i+1)/e);return t}}),n.Saving=MathJax.Object.Subclass({}),n.Saving.Position=MathJax.Object.Subclass({Init:function(t){this.pos=t},position:function(t){return this.pos},toString:function(){return this.pos.toString()}}),n.Saving.Macro=MathJax.Object.Subclass({Init:function(t){this.macro=t},position:function(t){return env.c=this.macro.position(t),env.c},toString:function(){return this.macro.toString()}}),n.Saving.Base=MathJax.Object.Subclass({Init:function(t,e,n){this.origin=t,this.xBase=e,this.yBase=n},position:function(t){var e=t.env;return e.origin=this.origin,e.xBase=this.xBase,e.yBase=this.yBase,e.c},toString:function(){return"origin:"+this.origin+", xBase:"+this.xBase+", yBase:"+this.yBase}}),n.Saving.Stack=MathJax.Object.Subclass({Init:function(t){this.stack=t},position:function(t){var e=t.env;return this.stack.isEmpty||(this.stack.tail.reverse().foreach((function(t){e.capturePosition(t)})),e.c=this.stack.head),e.c},toString:function(){return this.stack.toString()}}),n.Env=MathJax.Object.Subclass({Init:function(){var e=n.length2em("1mm");this.origin={x:0,y:0},this.xBase={x:e,y:0},this.yBase={x:0,y:e},this.savedPosition={},this.stateStack=t.List.empty,this.stackFrames=t.List.empty,this.stack=t.List.empty,this.angle=0,this.lastCurve=n.LastCurve.none,this.p=this.c=n.Env.originPosition,this.shouldCapturePos=!1,this.capturedPositions=t.List.empty,this.objectmargin=i.xypic.objectmargin,this.objectheight=i.xypic.objectheight,this.objectwidth=i.xypic.objectwidth,this.labelmargin=i.xypic.labelmargin},duplicate:function(){var t=n.Env();return n.Env.copyFields(this,t),t},saveState:function(){var t=this.duplicate();this.stateStack=this.stateStack.prepend(t)},restoreState:function(){if(!this.stateStack.isEmpty){var t=this.stateStack.head;this.stateStack=this.stateStack.tail,n.Env.copyFields(t,this)}},absVector:function(t,e){return{x:this.origin.x+t*this.xBase.x+e*this.yBase.x,y:this.origin.y+t*this.xBase.y+e*this.yBase.y}},inverseAbsVector:function(t,e){var n=this.xBase.x,i=this.xBase.y,r=this.yBase.x,a=this.yBase.y,o=n*a-i*r,s=t-this.origin.x,h=e-this.origin.y;return{x:(a*s-r*h)/o,y:(-i*s+n*h)/o}},setOrigin:function(t,e){this.origin={x:t,y:e}},setXBase:function(t,e){this.xBase={x:t,y:e}},setYBase:function(t,e){this.yBase={x:t,y:e}},swapPAndC:function(){var t=this.p;this.p=this.c,this.c=t},enterStackFrame:function(){this.stackFrames=this.stackFrames.prepend(this.stack),this.initStack()},leaveStackFrame:function(){this.stackFrames.isEmpty?this.initStack():(this.stack=this.stackFrames.head,this.stackFrames=this.stackFrames.tail)},savePos:function(t,e){this.savedPosition[t]=e},startCapturePositions:function(){this.shouldCapturePos=!0,this.capturedPositions=t.List.empty},endCapturePositions:function(){this.shouldCapturePos=!1;var e=this.capturedPositions;return this.capturedPositions=t.List.empty,e},capturePosition:function(t){this.shouldCapturePos&&void 0!==t&&(this.capturedPositions=this.capturedPositions.prepend(t))},pushPos:function(t){void 0!==t&&(this.stack=this.stack.prepend(t))},popPos:function(){if(this.stack.isEmpty)throw n.ExecutionError("cannot pop from the empty stack");var t=this.stack.head;return this.stack=this.stack.tail,t},initStack:function(){this.stack=t.List.empty},setStack:function(t){this.stack=t},stackAt:function(t){return this.stack.at(t)},lookupPos:function(t,e){var i=this.savedPosition[t];if(void 0===i)throw void 0!==e?n.ExecutionError(e):n.ExecutionError('<pos> "'+t+'" not defined.');return i},toString:function(){var t="";for(var e in this.savedPosition)this.savedPosition.hasOwnProperty(e)&&(t.length>0&&(t+=", "),t+=e.toString()+":"+this.savedPosition[e]);return"Env\n  p:"+this.p+"\n  c:"+this.c+"\n  angle:"+this.angle+"\n  lastCurve:"+this.lastCurve+"\n  savedPosition:{"+t+"}\n  origin:{x:"+this.origin.x+", y:"+this.origin.y+"}\n  xBase:{x:"+this.xBase.x+", y:"+this.xBase.y+"}\n  yBase:{x:"+this.yBase.x+", y:"+this.yBase.y+"}\n  stackFrames:"+this.stackFrames+"\n  stack:"+this.stack+"\n  shouldCapturePos:"+this.shouldCapturePos+"\n  capturedPositions:"+this.capturedPositions}},{originPosition:n.Frame.Point(0,0),copyFields:function(t,e){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);for(var i in e.savedPosition={},t.savedPosition)t.savedPosition.hasOwnProperty(i)&&(e.savedPosition[i]=t.savedPosition[i])}}),i.PosDecor.Augment({toShape:function(t){this.pos.toShape(t),this.decor.toShape(t)}}),i.Pos.Coord.Augment({toShape:function(t){t.env.c=this.coord.position(t),this.pos2s.foreach((function(e){e.toShape(t)}))}}),i.Pos.Plus.Augment({toShape:function(t){var e=t.env,n=this.coord.position(t);e.c=n.move(e.c.x+n.x,e.c.y+n.y)}}),i.Pos.Minus.Augment({toShape:function(t){var e=t.env,n=this.coord.position(t);e.c=n.move(e.c.x-n.x,e.c.y-n.y)}}),i.Pos.Skew.Augment({toShape:function(t){var e=t.env,i=this.coord.position(t),r=n.Frame.Point(i.x+e.c.x,i.y+e.c.y);e.c=r.combineRect(e.c)}}),i.Pos.Cover.Augment({toShape:function(t){var e=t.env,n=this.coord.position(t);e.c=e.c.combineRect(n)}}),i.Pos.Then.Augment({toShape:function(t){var e=t.env;e.capturePosition(e.c),e.c=this.coord.position(t)}}),i.Pos.SwapPAndC.Augment({toShape:function(t){var e=t.env;e.swapPAndC(),e.c=this.coord.position(t)}}),i.Pos.SetBase.Augment({toShape:function(t){var e=t.env,n=e.p,i=e.c.x-n.x,r=e.c.y-n.y;e.setOrigin(n.x,n.y),e.setXBase(i,r),e.setYBase(-r,i),e.c=this.coord.position(t)}}),i.Pos.SetYBase.Augment({toShape:function(t){var e=t.env;e.setYBase(e.c.x-e.origin.x,e.c.y-e.origin.y),e.c=this.coord.position(t)}}),i.Pos.ConnectObject.Augment({toShape:function(t){this.object.toConnectShape(t)}}),i.Pos.DropObject.Augment({toShape:function(t){this.object.toDropShape(t)}}),i.Pos.Place.Augment({toShape:function(t){var e=t.env;if(e.lastCurve.isDefined){var r,a=this.place,o=a.shaveP>0,s=a.shaveC>0,h=o?a.shaveP-1:0,c=s?a.shaveC-1:0;if(o&&(r=0),s&&(r=1),o==s&&(r=.5),void 0!==a.factor)if(a.factor.isIntercept){if(s=o=!1,void 0===(r=a.factor.value(t)))return}else r=a.factor.value(t);var u=n.length2em(a.slide.dimen.getOrElse("0"))+(h-c)*i.xypic.jot,p=e.lastCurve.tOfPlace(o,s,r,u),l=e.lastCurve.position(p),d=e.lastCurve.angle(p);return e.c=l,e.angle=d,p}}}),i.Pos.PushCoord.Augment({toShape:function(t){var e=t.env,n=this.coord.position(t);e.pushPos(n)}}),i.Pos.EvalCoordThenPop.Augment({toShape:function(t){var e=t.env;e.c=this.coord.position(t),e.popPos()}}),i.Pos.LoadStack.Augment({toShape:function(t){var e=t.env;e.startCapturePositions(),this.coord.position(t);var n=e.endCapturePositions();e.setStack(n),e.pushPos(e.c)}}),i.Pos.DoCoord.Augment({toShape:function(t){var e=t.env,n=this.coord;e.stack.reverse().foreach((function(i){e.c=i,n.position(t)}))}}),i.Pos.InitStack.Augment({toShape:function(t){t.env.initStack()}}),i.Pos.EnterFrame.Augment({toShape:function(t){t.env.enterStackFrame()}}),i.Pos.LeaveFrame.Augment({toShape:function(t){t.env.leaveStackFrame()}}),i.Place.Factor.Augment({value:function(t){return this.factor}}),i.Place.Intercept.Augment({value:function(t){var e=t.env;if(e.lastCurve.isDefined){var i=e.duplicate();i.angle=0,i.lastCurve=n.LastCurve.none,i.p=i.c=n.Env.originPosition;var r=n.DrawingContext(n.Shape.none,i);this.pos.toShape(r),t.appendShapeToFront(r.shape),i.lastCurve.isDefined||(i.lastCurve=n.LastCurve.Line(i.p,i.c,i.p,i.c,void 0));for(var a=[],o=e.lastCurve.segments(),s=i.lastCurve.segments(),h=0;h<o.length;h++)for(var c=0;c<s.length;c++)a=a.concat(n.CurveSegment.findIntersections(o[h],s[c]));if(0===a.length){console.log("perhaps no curve intersection.");for(var u=e.lastCurve,p=i.lastCurve,l=1e-5,d=0,m=2,x=0,f=0,g=function(t){return 1/(1+Math.exp(-t))},S=function(t){var e=Math.exp(-t);return e/(1+e)/(1+e)},y=g(x),v=g(f),b=S(x),C=S(f),M=u.derivative(y),w=p.derivative(v),P=M.x*b,O=-w.x*C,A=M.y*b,L=-w.y*C,E=P*P+A*A,B=P*O+A*L,j=O*P+L*A,D=O*O+L*L,k=u.position(y),I=p.position(v),T=k.x-I.x,F=k.y-I.y,R=P*T+A*F,G=O*T+L*F,V=Math.sqrt(R*R+G*G)<l,J=.001*Math.max(E,D);!V&&d<100;){d++;do{var X=D+J,z=(E+J)*X-B*j,H=(X*R-B*G)/z,Q=(-j*R+E*G)/z;if(H*H+Q*Q<1.0000000000000002e-10*(x*x+f*f))V=!0;else{var U=x-H,N=f-Q,q=g(U),W=g(N),_=u.position(q),Z=p.position(W),Y=_.x-Z.x,$=_.y-Z.y,K=(T*T+F*F-(Y*Y+$*$))/(H*(J*H+R)+Q*(J*Q+G));if(K>0){f=N,y=q,v=W,b=S(x=U),C=S(f),M=u.derivative(y),w=p.derivative(v),P=M.x*b,O=-w.x*C,E=P*P+(A=M.y*b)*A,B=P*O+A*(L=-w.y*C),j=O*P+L*A,D=O*O+L*L,R=P*(T=Y)+A*(F=$),G=O*T+L*F,V=Math.sqrt(R*R+G*G)<l;var tt=2*K-1;J+=Math.max(1/3,1-tt*tt*tt),m=2}else J*=m,m*=2}}while(!(V||void 0!==K&&K>0))}return g(x)}var et=(a[0][0].min+a[0][0].max)/2;for(h=1;h<a.length;h++){var nt=(a[h][0].min+a[h][0].max)/2;et>nt&&(et=nt)}return et}}}),i.Pos.SavePos.Augment({toShape:function(t){var e=t.env;e.savePos(this.id,n.Saving.Position(e.c))}}),i.Pos.SaveMacro.Augment({toShape:function(t){t.env.savePos(this.id,n.Saving.Macro(this.macro))}}),i.Pos.SaveBase.Augment({toShape:function(t){var e=t.env;e.savePos(this.id,n.Saving.Base(e.origin,e.xBase,e.yBase))}}),i.Pos.SaveStack.Augment({toShape:function(t){var e=t.env;e.savePos(this.id,n.Saving.Stack(e.stack))}}),i.Object.Augment({toDropShape:function(e){var i=e.env;if(void 0===i.c)return n.Shape.none;var r=this.modifiers;if(r.isEmpty)return this.object.toDropShape(e);var a=i.duplicate(),o=n.DrawingContext(n.Shape.none,a),s=t.List.empty;r.foreach((function(t){t.preprocess(o,s),s=s.prepend(t)}));var h=this.object.toDropShape(o),c=a.c;if(void 0===c)return n.Shape.none;var u=a.originalReferencePoint;return(a=i.duplicate()).c=c,a.originalReferencePoint=u,o=n.DrawingContext(n.Shape.none,a),h=r.head.modifyShape(o,h,r.tail),e.appendShapeToFront(h),i.c=a.c.move(i.c.x,i.c.y),h},toConnectShape:function(e){var i=e.env;if(void 0===i.c)return n.Shape.none;var r=this.modifiers;if(r.isEmpty)return this.object.toConnectShape(e);var a=i.duplicate(),o=n.DrawingContext(n.Shape.none,a),s=t.List.empty;r.foreach((function(t){t.preprocess(o,s),s=s.prepend(t)}));var h=this.object.toConnectShape(o);i.angle=a.angle,i.lastCurve=a.lastCurve;var c=a.c;if(void 0===c)return n.Shape.none;var u=a.originalReferencePoint;return(a=i.duplicate()).c=c,a.originalReferencePoint=u,o=n.DrawingContext(n.Shape.none,a),h=r.head.modifyShape(o,h,r.tail),e.appendShapeToFront(h),i.c=a.c.move(i.c.x,i.c.y),h},boundingBox:function(t){var e=t.duplicateEnv(),i=e.env;return i.angle=0,i.p=i.c=n.Env.originPosition,e.shape=n.Shape.none,this.toDropShape(e).getBoundingBox()}}),i.ObjectBox.Augment({toConnectShape:function(t){var e=(r=t.env).c,r=t.env,a=(i.xypic.thickness,r.p.edgePoint(r.c.x,r.c.y)),o=r.c.edgePoint(r.p.x,r.p.y);if(a.x!==o.x||a.y!==o.y){var s=n.Curve.Line(a,o).toShape(t,this,"196883","");return r.originalReferencePoint=e,s}return r.angle=0,r.lastCurve=n.LastCurve.none,r.originalReferencePoint=e,n.Shape.none},boundingBox:function(t){var e=t.duplicateEnv(),i=e.env;return i.angle=0,i.p=i.c=n.Env.originPosition,e.shape=n.Shape.none,this.toDropShape(e).getBoundingBox()}}),i.ObjectBox.WrapUpObject.Augment({toDropShape:function(t){var e=t.env,n=this.object.toDropShape(t);return e.originalReferencePoint=e.c,n},toConnectShape:function(t){var e=t.env,n=this.object.toConnectShape(t);return e.originalReferencePoint=e.c,n}}),i.ObjectBox.CompositeObject.Augment({toDropShape:function(t){var e=t.env,i=e.c;if(void 0===i)return n.Shape.none;var r=i,a=e.duplicate(),o=n.DrawingContext(n.Shape.none,a);this.objects.foreach((function(t){a.c=i;var e=t.toDropShape(o);r=n.Frame.combineRect(r,a.c),r=n.Frame.combineRect(r,e.getBoundingBox().toPoint())})),e.c=r;var s=o.shape;return t.appendShapeToFront(s),e.originalReferencePoint=i,s}}),i.ObjectBox.Xybox.Augment({toDropShape:function(t){var e=t.env,i=e.c;if(void 0===i)return n.Shape.none;var r=n.Env(),a=n.DrawingContext(n.Shape.none,r);this.posDecor.toShape(a);var o=a.shape,s=o.getBoundingBox();if(void 0===s)return n.Shape.none;var h=Math.max(0,s.l-s.x),c=Math.max(0,s.r+s.x),u=Math.max(0,s.u+s.y),p=Math.max(0,s.d-s.y);e.c=n.Frame.Rect(i.x,i.y,{l:h,r:c,u,d:p}),e.originalReferencePoint=i;var l=n.Shape.TranslateShape(i.x,i.y,o);return t.appendShapeToFront(l),l}}),i.ObjectBox.Xymatrix.Augment({toDropShape:function(t){var e=t.env,n=e.c,i=this.xymatrix.toShape(t);return e.originalReferencePoint=n,i}}),i.ObjectBox.Text.Augment({toDropShape:function(t){var e=t.env,i=n.Shape.TextShape(e.c,this.math,n.svgForTestLayout);return t.appendShapeToFront(i),e.c=i.getBoundingBox(),e.originalReferencePoint=i.getOriginalReferencePoint(),i}}),i.ObjectBox.Empty.Augment({toDropShape:function(t){var e=t.env;return e.originalReferencePoint=e.c,e.c=n.Frame.Point(e.c.x,e.c.y),n.Shape.none}}),i.ObjectBox.Txt.Augment({toDropShape:function(t){var e=t.env;if(void 0===e.c)return n.Shape.none;var i=this.textObject.toDropShape(t);return e.originalReferencePoint=e.c,i}}),i.ObjectBox.Txt.Width.Vector.Augment({width:function(t){return this.vector.xy().x}}),i.ObjectBox.Txt.Width.Vector.Augment({width:function(t){var e=t.env.c;return e.r+e.l}}),i.ObjectBox.Cir.Augment({toDropShape:function(t){var e=t.env;if(void 0===e.c)return n.Shape.none;e.originalReferencePoint=e.c;var i=this.radius.radius(t),r=e.c.x,a=e.c.y,o=this.cir.toDropShape(t,r,a,i);return e.c=n.Frame.Ellipse(r,a,i,i,i,i),o},toConnectShape:function(t){var e=t.env;return e.originalReferencePoint=e.c,n.Shape.none}}),i.ObjectBox.Cir.Radius.Vector.Augment({radius:function(t){return this.vector.xy(t).x}}),i.ObjectBox.Cir.Radius.Default.Augment({radius:function(t){return t.env.c.r}}),i.ObjectBox.Cir.Cir.Segment.Augment({toDropShape:function(t,e,i,r){t.env;var a,o,s=this.startPointDegree(t),h=this.endPointDegree(t,s),c=h-s;if(0===(c=c<0?c+360:c))return n.Shape.none;"^"===this.orient?(a=c>180?"1":"0",o="0"):(a=c>180?"0":"1",o="1");var u=Math.PI/180,p=e+r*Math.cos(s*u),l=i+r*Math.sin(s*u),d=e+r*Math.cos(h*u),m=i+r*Math.sin(h*u),x=n.Shape.CircleSegmentShape(e,i,p,l,r,a,o,d,m);return t.appendShapeToFront(x),x},startPointDegree:function(t){var e=this.startDiag.toString();return"^"===this.orient?this.diagToAngleACW(e):this.diagToAngleCW(e)},endPointDegree:function(t,e){var n=this.endDiag.toString();return"^"===this.orient?this.diagToAngleACW(n,e):this.diagToAngleCW(n,e)},diagToAngleACW:function(t,e){switch(t){case"l":return 90;case"r":return-90;case"d":return 180;case"u":return 0;case"dl":case"ld":return 135;case"dr":case"rd":return-135;case"ul":case"lu":return 45;case"ur":case"ru":return-45;default:return void 0!==e?e+180:0}},diagToAngleCW:function(t,e){switch(t){case"l":return-90;case"r":return 90;case"d":return 0;case"u":return 180;case"dl":case"ld":return-45;case"dr":case"rd":return 45;case"ul":case"lu":return-135;case"ur":case"ru":return 135;default:return void 0!==e?e+180:0}}}),i.ObjectBox.Cir.Cir.Full.Augment({toDropShape:function(t,e,i,r){var a=n.Shape.FullCircleShape(e,i,r);return t.appendShapeToFront(a),a}}),i.ObjectBox.Frame.Augment({toDropShape:function(t){var e=t.env;return e.originalReferencePoint=e.c,this.toDropFilledShape(t,"currentColor",!1)},toDropFilledShape:function(t,e,r){var a=t.env.c;if(void 0===a)return n.Shape.none;var o=i.xypic.thickness,s=a.x,h=a.y,c=a.l,u=a.r,p=a.u,l=a.d,d=n.Shape.none;switch(this.main){case"--":var m=3*o;if(r){var x=this.radius.xy(t);d=n.Shape.EllipseShape(s+(u-c)/2,h+(p-l)/2,x.x,x.y,!1,e,n.em2px(m)+" "+n.em2px(m))}else{var f=this.radius.radius(t);d=n.Shape.RectangleShape(s,h,c,u,p,l,f,!1,e,n.em2px(m)+" "+n.em2px(m))}break;case"==":m=3*o,r?(x=this.radius.xy(t),d=n.Shape.EllipseShape(s+(u-c)/2,h+(p-l)/2,x.x,x.y,!0,e,n.em2px(m)+" "+n.em2px(m))):(f=this.radius.radius(t),d=n.Shape.RectangleShape(s,h,c,u,p,l,f,!0,e,n.em2px(m)+" "+n.em2px(m)));break;case"o-":m=3*o,f=i.xypic.lineElementLength,d=n.Shape.RectangleShape(s,h,c,u,p,l,f,!1,e,n.em2px(m)+" "+n.em2px(m));break;case"oo":var g=(x=this.radius.xy(t)).x;d=n.Shape.EllipseShape(s+(u-c)/2,h+(p-l)/2,g,g,!0,e,void 0);break;case"ee":x=this.radius.xy(t),d=n.Shape.EllipseShape(s+(u-c)/2,h+(p-l)/2,x.x,x.y,!0,e,void 0);break;case"-,":var S=this.radius.depth(t);f=this.radius.radius(t),d=n.Shape.CompositeShape(n.Shape.RectangleShape(s,h,c,u,p,l,f,!1,e,void 0),n.Shape.BoxShadeShape(s,h,c,u,p,l,S));break;case".o":g=(x=this.radius.xy(t)).x,d=n.Shape.EllipseShape(s+(u-c)/2,h+(p-l)/2,g,g,!1,e,i.xypic.dottedDasharray);break;case"-o":m=3*o,g=(x=this.radius.xy(t)).x,d=n.Shape.EllipseShape(s+(u-c)/2,h+(p-l)/2,g,g,!1,e,n.em2px(m)+" "+n.em2px(m));break;case".e":x=this.radius.xy(t),d=n.Shape.EllipseShape(s+(u-c)/2,h+(p-l)/2,x.x,x.y,!1,e,i.xypic.dottedDasharray);break;case"-e":m=3*o,x=this.radius.xy(t),d=n.Shape.EllipseShape(s+(u-c)/2,h+(p-l)/2,x.x,x.y,!1,e,n.em2px(m)+" "+n.em2px(m));break;case"-":r?(x=this.radius.xy(t),d=n.Shape.EllipseShape(s+(u-c)/2,h+(p-l)/2,x.x,x.y,!1,e,void 0)):(f=this.radius.radius(t),d=n.Shape.RectangleShape(s,h,c,u,p,l,f,!1,e,void 0));break;case"=":r?(x=this.radius.xy(t),d=n.Shape.EllipseShape(s+(u-c)/2,h+(p-l)/2,x.x,x.y,!0,e,void 0)):(f=this.radius.radius(t),d=n.Shape.RectangleShape(s,h,c,u,p,l,f,!0,e,void 0));break;case".":r?(x=this.radius.xy(t),d=n.Shape.EllipseShape(s+(u-c)/2,h+(p-l)/2,x.x,x.y,!1,e,i.xypic.dottedDasharray)):(f=this.radius.radius(t),d=n.Shape.RectangleShape(s,h,c,u,p,l,f,!1,e,i.xypic.dottedDasharray));break;case",":S=this.radius.depth(t),d=n.Shape.BoxShadeShape(s,h,c,u,p,l,S,e);break;case"o":g=(x=this.radius.xy(t)).x,d=n.Shape.EllipseShape(s+(u-c)/2,h+(p-l)/2,g,g,!1,e,void 0);break;case"e":x=this.radius.xy(t),d=n.Shape.EllipseShape(s+(u-c)/2,h+(p-l)/2,x.x,x.y,!1,e,void 0);break;case"\\{":d=n.Shape.LeftBrace(s-c,h,p,l,0,e);break;case"\\}":d=n.Shape.LeftBrace(s+u,h,l,p,180,e);break;case"^\\}":case"^\\{":d=n.Shape.LeftBrace(s,h+p,u,c,270,e);break;case"_\\{":case"_\\}":d=n.Shape.LeftBrace(s,h-l,c,u,90,e);break;case"(":d=n.Shape.LeftParenthesis(s-c,h+(p-l)/2,p+l,0,e);break;case")":d=n.Shape.LeftParenthesis(s+u,h+(p-l)/2,p+l,180,e);break;case"^(":case"^)":d=n.Shape.LeftParenthesis(s+(u-c)/2,h+p,c+u,270,e);break;case"_(":case"_)":d=n.Shape.LeftParenthesis(s+(u-c)/2,h-l,c+u,90,e);break;case"*":a.isCircle()?(x=this.radius.xy(t),d=n.Shape.EllipseShape(s+(u-c)/2,h+(p-l)/2,x.x,x.y,!1,"currentColor",void 0,e,!0)):(f=this.radius.radius(t),d=n.Shape.RectangleShape(s,h,c,u,p,l,f,!1,"currentColor",void 0,e,!0));break;case"**":a.isCircle()?(x=this.radius.xy(t),d=n.Shape.EllipseShape(s+(u-c)/2,h+(p-l)/2,x.x,x.y,!1,"currentColor",void 0,e,!1)):(f=this.radius.radius(t),d=n.Shape.RectangleShape(s,h,c,u,p,l,f,!1,"currentColor",void 0,e,!1));break;default:return n.Shape.none}return t.appendShapeToFront(d),d},toConnectShape:function(t){var e=t.env,i=e.c,r=e.p;void 0!==i&&void 0!==r||n.Shape.none,e.originalReferencePoint=i;var a=e.duplicate();a.c=r.combineRect(i);var o=n.DrawingContext(n.Shape.none,a),s=this.toDropShape(o);return t.appendShapeToFront(s),s}}),i.ObjectBox.Frame.Radius.Vector.Augment({radius:function(t){return this.vector.xy(t).x},depth:function(t){return this.vector.xy(t).x},xy:function(t){return this.vector.xy(t)}}),i.ObjectBox.Frame.Radius.Default.Augment({radius:function(t){return 0},depth:function(t){return i.xypic.thickness/2},xy:function(t){var e=t.env.c;return{x:(e.l+e.r)/2,y:(e.u+e.d)/2}}}),i.ObjectBox.Dir.Augment({toDropShape:function(t){var e=t.env,r=e.c;e.originalReferencePoint=r;var a=e.angle;if(void 0===r)return n.Shape.none;e.c=n.Frame.Point(r.x,r.y),i.xypic.thickness;var o=n.Shape.none;switch(this.main){case"":return n.Shape.none;case">":switch(this.variant){case"2":var s=(o=n.Shape.GT2ArrowheadShape(r,a)).getRadius();e.c=n.Frame.Ellipse(r.x,r.y,s,s,s,s);break;case"3":s=(o=n.Shape.GT3ArrowheadShape(r,a)).getRadius(),e.c=n.Frame.Ellipse(r.x,r.y,s,s,s,s);break;default:o="^"===this.variant?n.Shape.UpperGTArrowheadShape(r,a):"_"===this.variant?n.Shape.LowerGTArrowheadShape(r,a):n.Shape.GTArrowheadShape(r,a)}break;case"<":switch(this.variant){case"2":s=(o=n.Shape.LT2ArrowheadShape(r,a)).getRadius(),e.c=n.Frame.Ellipse(r.x,r.y,s,s,s,s);break;case"3":s=(o=n.Shape.LT3ArrowheadShape(r,a)).getRadius(),e.c=n.Frame.Ellipse(r.x,r.y,s,s,s,s);break;default:o="^"===this.variant?n.Shape.UpperLTArrowheadShape(r,a):"_"===this.variant?n.Shape.LowerLTArrowheadShape(r,a):n.Shape.LTArrowheadShape(r,a)}break;case"|":switch(this.variant){case"^":o=n.Shape.UpperColumnArrowheadShape(r,a);break;case"_":o=n.Shape.LowerColumnArrowheadShape(r,a);break;case"2":o=n.Shape.Column2ArrowheadShape(r,a);break;case"3":o=n.Shape.Column3ArrowheadShape(r,a);break;default:o=n.Shape.ColumnArrowheadShape(r,a)}break;case"(":switch(this.variant){case"^":o=n.Shape.UpperLParenArrowheadShape(r,a);break;case"_":o=n.Shape.LowerLParenArrowheadShape(r,a);break;default:o=n.Shape.LParenArrowheadShape(r,a)}break;case")":switch(this.variant){case"^":o=n.Shape.UpperRParenArrowheadShape(r,a);break;case"_":o=n.Shape.LowerRParenArrowheadShape(r,a);break;default:o=n.Shape.RParenArrowheadShape(r,a)}break;case"`":o="_"===this.variant?n.Shape.LowerBackquoteArrowheadShape(r,a):n.Shape.UpperBackquoteArrowheadShape(r,a);break;case"'":o="_"===this.variant?n.Shape.LowerQuoteArrowheadShape(r,a):n.Shape.UpperQuoteArrowheadShape(r,a);break;case"*":o=n.Shape.AsteriskArrowheadShape(r,0);break;case"o":o=n.Shape.OArrowheadShape(r,0);break;case"+":o=n.Shape.PlusArrowheadShape(r,a);break;case"x":o=n.Shape.XArrowheadShape(r,a);break;case"/":o=n.Shape.SlashArrowheadShape(r,a);break;case"-":case"--":i.xypic.lineElementLength,o="3"===this.variant?n.Shape.Line3ArrowheadShape(r,a):"2"===this.variant?n.Shape.Line2ArrowheadShape(r,a):n.Shape.LineArrowheadShape(r,a);break;case"=":case"==":o=n.Shape.Line2ArrowheadShape(r,a);break;case".":case"..":o="3"===this.variant?n.Shape.Dot3ArrowheadShape(r,a):"2"===this.variant?n.Shape.Dot2ArrowheadShape(r,a):n.Shape.DotArrowheadShape(r,a);break;case":":case"::":o=n.Shape.Dot2ArrowheadShape(r,a);break;case"~":case"~~":o="3"===this.variant?n.Shape.Tilde3ArrowheadShape(r,a):"2"===this.variant?n.Shape.Tilde2ArrowheadShape(r,a):n.Shape.TildeArrowheadShape(r,a);break;case">>":switch(this.variant){case"^":o=n.Shape.UpperGTGTArrowheadShape(r,a);break;case"_":o=n.Shape.LowerGTGTArrowheadShape(r,a);break;case"2":s=(o=n.Shape.GTGT2ArrowheadShape(r,a)).getRadius(),e.c=n.Frame.Ellipse(r.x,r.y,s,s,s,s);break;case"3":s=(o=n.Shape.GTGT3ArrowheadShape(r,a)).getRadius(),e.c=n.Frame.Ellipse(r.x,r.y,s,s,s,s);break;default:o=n.Shape.GTGTArrowheadShape(r,a)}break;case"<<":switch(this.variant){case"^":o=n.Shape.UpperLTLTArrowheadShape(r,a);break;case"_":o=n.Shape.LowerLTLTArrowheadShape(r,a);break;case"2":s=(o=n.Shape.LTLT2ArrowheadShape(r,a)).getRadius(),e.c=n.Frame.Ellipse(r.x,r.y,s,s,s,s);break;case"3":s=(o=n.Shape.LTLT3ArrowheadShape(r,a)).getRadius(),e.c=n.Frame.Ellipse(r.x,r.y,s,s,s,s);break;default:o=n.Shape.LTLTArrowheadShape(r,a)}break;case"||":switch(this.variant){case"^":o=n.Shape.UpperColumnColumnArrowheadShape(r,a);break;case"_":o=n.Shape.LowerColumnColumnArrowheadShape(r,a);break;case"2":o=n.Shape.ColumnColumn2ArrowheadShape(r,a);break;case"3":o=n.Shape.ColumnColumn3ArrowheadShape(r,a);break;default:o=n.Shape.ColumnColumnArrowheadShape(r,a)}break;case"|-":switch(this.variant){case"^":o=n.Shape.UpperColumnLineArrowheadShape(r,a);break;case"_":o=n.Shape.LowerColumnLineArrowheadShape(r,a);break;case"2":o=n.Shape.ColumnLine2ArrowheadShape(r,a);break;case"3":o=n.Shape.ColumnLine3ArrowheadShape(r,a);break;default:o=n.Shape.ColumnLineArrowheadShape(r,a)}break;case">|":o=n.Shape.GTColumnArrowheadShape(r,a);break;case">>|":o=n.Shape.GTGTColumnArrowheadShape(r,a);break;case"|<":o=n.Shape.ColumnLTArrowheadShape(r,a);break;case"|<<":o=n.Shape.ColumnLTLTArrowheadShape(r,a);break;case"//":o=n.Shape.SlashSlashArrowheadShape(r,a);break;case"=>":o=n.Shape.LineGT2ArrowheadShape(r,a);break;default:var h=n.repositories.dirRepository.get(this.main);if(void 0===h)throw n.ExecutionError("\\dir "+this.variant+"{"+this.main+"} not defined.");o=h.toDropShape(t)}return t.appendShapeToFront(o),o},toConnectShape:function(t){var e=t.env;e.originalReferencePoint=e.c,i.xypic.thickness;var r=e.p.edgePoint(e.c.x,e.c.y),a=e.c.edgePoint(e.p.x,e.p.y);return r.x!==a.x||r.y!==a.y?n.Curve.Line(r,a).toShape(t,this,this.main,this.variant):(e.angle=0,e.lastCurve=n.LastCurve.none,n.Shape.none)}}),i.ObjectBox.Curve.Augment({toDropShape:function(t){var e=t.env;return e.originalReferencePoint=e.c,n.Shape.none},toConnectShape:function(e){var r=e.env;r.originalReferencePoint=r.c;var a=void 0,o=void 0;this.objects.foreach((function(t){a=t.objectForDrop(a),o=t.objectForConnect(o)})),void 0===a&&void 0===o&&(o=i.Object(t.List.empty,i.ObjectBox.Dir("","-"))),i.xypic.thickness;var s=r.c,h=r.p,c=[];this.poslist.foreach((function(t){t.addPositions(c,e)})),r.c=s,r.p=h;var u=n.Shape.none,p=h,l=s;switch(c.length){case 0:return p.x===l.x&&p.y===l.y?(r.lastCurve=n.LastCurve.none,r.angle=0,n.Shape.none):void 0!==o?o.toConnectShape(e):a.toConnectShape(e);case 1:var d=(x=n.Curve.QuadBezier(p,c[0],l)).tOfShavedStart(p),m=x.tOfShavedEnd(l);if(void 0===d||void 0===m||d>=m)return r.angle=0,r.lastCurve=n.LastCurve.none,n.Shape.none;u=x.toShape(e,a,o),r.lastCurve=n.LastCurve.QuadBezier(x,d,m,u),r.angle=Math.atan2(l.y-p.y,l.x-p.x);break;case 2:var x;if(d=(x=n.Curve.CubicBezier(p,c[0],c[1],l)).tOfShavedStart(p),m=x.tOfShavedEnd(l),void 0===d||void 0===m||d>=m)return r.angle=0,r.lastCurve=n.LastCurve.none,n.Shape.none;u=x.toShape(e,a,o),r.lastCurve=n.LastCurve.CubicBezier(x,d,m,u),r.angle=Math.atan2(l.y-p.y,l.x-p.x);break;default:var f=n.Curve.CubicBSpline(p,c,l),g=n.Curve.CubicBeziers(f.toCubicBeziers());if(d=g.tOfShavedStart(p),m=g.tOfShavedEnd(l),void 0===d||void 0===m||d>=m)return r.angle=0,r.lastCurve=n.LastCurve.none,n.Shape.none;u=g.toShape(e,a,o),r.lastCurve=n.LastCurve.CubicBSpline(p,l,g,d,m,u),r.angle=Math.atan2(l.y-p.y,l.x-p.x)}return u}}),i.ObjectBox.Curve.Object.Drop.Augment({objectForDrop:function(t){return this.object},objectForConnect:function(t){return t}}),i.ObjectBox.Curve.Object.Connect.Augment({objectForDrop:function(t){return t},objectForConnect:function(t){return this.object}}),i.ObjectBox.Curve.PosList.CurPos.Augment({addPositions:function(t,e){var n=e.env;t.push(n.c)}}),i.ObjectBox.Curve.PosList.Pos.Augment({addPositions:function(t,e){var n=e.env;this.pos.toShape(e),t.push(n.c)}}),i.ObjectBox.Curve.PosList.AddStack.Augment({addPositions:function(t,e){e.env.stack.reverse().foreach((function(e){t.push(e)}))}}),i.Coord.C.Augment({position:function(t){return t.env.c}}),i.Coord.P.Augment({position:function(t){return t.env.p}}),i.Coord.X.Augment({position:function(t){var e=t.env,r=e.p,a=e.c,o=e.origin,s=e.xBase,h=a.y-r.y,c=r.x-a.x,u=a.x*r.y-a.y*r.x,p=s.y,l=-s.x,d=s.x*o.y-s.y*o.x,m=h*l-p*c;if(Math.abs(m)<i.xypic.machinePrecision)return console.log("there is no intersection point."),n.Env.originPosition;var x=-(l*u-c*d)/m,f=(p*u-h*d)/m;return n.Frame.Point(x,f)}}),i.Coord.Y.Augment({position:function(t){var e=t.env,r=e.p,a=e.c,o=e.origin,s=e.yBase,h=a.y-r.y,c=r.x-a.x,u=a.x*r.y-a.y*r.x,p=s.y,l=-s.x,d=s.x*o.y-s.y*o.x,m=h*l-p*c;if(Math.abs(m)<i.xypic.machinePrecision)return console.log("there is no intersection point."),n.Env.originPosition;var x=-(l*u-c*d)/m,f=(p*u-h*d)/m;return n.Frame.Point(x,f)}}),i.Coord.Vector.Augment({position:function(t){var e=this.vector.xy(t);return n.Frame.Point(e.x,e.y)}}),i.Coord.Id.Augment({position:function(t){return t.env.lookupPos(this.id).position(t)}}),i.Coord.Group.Augment({position:function(t){var e=t.env,n=e.origin,i=e.xBase,r=e.yBase,a=e.p;return this.posDecor.toShape(t),e.p=a,e.origin=n,e.xBase=i,e.yBase=r,e.c}}),i.Coord.StackPosition.Augment({position:function(t){return t.env.stackAt(this.number)}}),i.Coord.DeltaRowColumn.Augment({position:function(t){var e=t.env,i=e.xymatrixRow,r=e.xymatrixCol;if(void 0===i||void 0===r)throw n.ExecutionError("xymatrix rows and columns not found for "+this.toSring());var a=this.prefix+(i+this.dr)+","+(r+this.dc);return t.env.lookupPos(a,'in entry "'+e.xymatrixRow+","+e.xymatrixCol+'": No '+this+" (is "+a+") from here.").position(t)}}),i.Coord.Hops.Augment({position:function(t){var e=t.env,i=e.xymatrixRow,r=e.xymatrixCol;if(void 0===i||void 0===r)throw n.ExecutionError("xymatrix rows and columns not found for "+this.toSring());this.hops.foreach((function(t){switch(t){case"u":i-=1;break;case"d":i+=1;break;case"l":r-=1;break;case"r":r+=1}}));var a=this.prefix+i+","+r;return t.env.lookupPos(a,'in entry "'+e.xymatrixRow+","+e.xymatrixCol+'": No '+this+" (is "+a+") from here.").position(t)}}),i.Coord.HopsWithPlace.Augment({position:function(t){var e=t.env,i=e.xymatrixRow,r=e.xymatrixCol;if(void 0===i||void 0===r)throw n.ExecutionError("xymatrix rows and columns not found for "+this.toSring());this.hops.foreach((function(t){switch(t){case"u":i-=1;break;case"d":i+=1;break;case"l":r-=1;break;case"r":r+=1}}));var a=this.prefix+i+","+r,o=t.env.lookupPos(a,'in entry "'+e.xymatrixRow+","+e.xymatrixCol+'": No '+this+" (is "+a+") from here.").position(t),s=(e.c,e.duplicate());s.p=e.c,s.c=o;var h,c=s.c.x-s.p.x,u=s.c.y-s.p.y;h=0===c&&0===u?0:Math.atan2(u,c),s.angle=h;var p=s.p.edgePoint(s.c.x,s.c.y),l=s.c.edgePoint(s.p.x,s.p.y);s.lastCurve=n.LastCurve.Line(p,l,s.p,s.c,void 0);var d=n.DrawingContext(n.Shape.none,s),m=this.place.toShape(d);return s.lastCurve.position(m)}}),i.Vector.InCurBase.Augment({xy:function(t){return t.env.absVector(this.x,this.y)},angle:function(t){var e=t.env.absVector(this.x,this.y);return Math.atan2(e.y,e.x)}}),i.Vector.Abs.Augment({xy:function(t){return{x:n.length2em(this.x),y:n.length2em(this.y)}},angle:function(t){var e=this.xy(t);return Math.atan2(e.y,e.x)}}),i.Vector.Angle.Augment({xy:function(t){var e=Math.PI/180*this.degree;return t.env.absVector(Math.cos(e),Math.sin(e))},angle:function(t){return Math.PI/180*this.degree}}),i.Vector.Dir.Augment({xy:function(t){var e=n.length2em(this.dimen),i=this.dir.angle(t);return{x:e*Math.cos(i),y:e*Math.sin(i)}},angle:function(t){return this.dir.angle(t)}}),i.Vector.Corner.Augment({xy:function(t){var e=this.corner.xy(t);return{x:e.x*this.factor,y:e.y*this.factor}},angle:function(t){return this.corner.angle(t)}}),i.Corner.L.Augment({xy:function(t){return{x:-t.env.c.l,y:0}},angle:function(t){return Math.PI}}),i.Corner.R.Augment({xy:function(t){return{x:t.env.c.r,y:0}},angle:function(t){return 0}}),i.Corner.D.Augment({xy:function(t){return{x:0,y:-t.env.c.d}},angle:function(t){return-Math.PI/2}}),i.Corner.U.Augment({xy:function(t){return{x:0,y:t.env.c.u}},angle:function(t){return Math.PI/2}}),i.Corner.CL.Augment({xy:function(t){var e=t.env.c;return{x:-e.l,y:(e.u-e.d)/2}},angle:function(t){var e=this.xy(t);return Math.atan2(e.y,e.x)}}),i.Corner.CR.Augment({xy:function(t){var e=t.env.c;return{x:e.r,y:(e.u-e.d)/2}},angle:function(t){var e=this.xy(t);return Math.atan2(e.y,e.x)}}),i.Corner.CD.Augment({xy:function(t){var e=t.env.c;return{x:(e.r-e.l)/2,y:-e.d}},angle:function(t){var e=this.xy(t);return Math.atan2(e.y,e.x)}}),i.Corner.CU.Augment({xy:function(t){var e=t.env.c;return{x:(e.r-e.l)/2,y:e.u}},angle:function(t){var e=this.xy(t);return Math.atan2(e.y,e.x)}}),i.Corner.LU.Augment({xy:function(t){var e=t.env.c;return{x:-e.l,y:e.u}},angle:function(t){var e=this.xy(t);return Math.atan2(e.y,e.x)}}),i.Corner.LD.Augment({xy:function(t){var e=t.env.c;return{x:-e.l,y:-e.d}},angle:function(t){var e=this.xy(t);return Math.atan2(e.y,e.x)}}),i.Corner.RU.Augment({xy:function(t){var e=t.env.c;return{x:e.r,y:e.u}},angle:function(t){var e=this.xy(t);return Math.atan2(e.y,e.x)}}),i.Corner.RD.Augment({xy:function(t){var e=t.env.c;return{x:e.r,y:-e.d}},angle:function(t){var e=this.xy(t);return Math.atan2(e.y,e.x)}}),i.Corner.NearestEdgePoint.Augment({xy:function(t){var e=t.env,n=e.c,i=n.edgePoint(e.p.x,e.p.y);return{x:i.x-n.x,y:i.y-n.y}},angle:function(t){var e=this.xy(t);return Math.atan2(e.y,e.x)}}),i.Corner.PropEdgePoint.Augment({xy:function(t){var e=t.env,n=e.c,i=n.proportionalEdgePoint(e.p.x,e.p.y);return{x:i.x-n.x,y:i.y-n.y}},angle:function(t){var e=this.xy(t);return Math.atan2(e.y,e.x)}}),i.Corner.Axis.Augment({xy:function(t){return{x:0,y:i.xypic.axisHeightLength}},angle:function(t){return Math.PI/2}}),i.Modifier.Augment({proceedModifyShape:function(t,e,n){return n.isEmpty?e:n.head.modifyShape(t,e,n.tail)}}),i.Modifier.Vector.Augment({preprocess:function(t,e){},modifyShape:function(t,e,i){var r=this.vector.xy(t),a=t.env;return a.c=a.c.shiftFrame(-r.x,-r.y),e=n.Shape.TranslateShape(-r.x,-r.y,e),this.proceedModifyShape(t,e,i)}}),i.Modifier.RestoreOriginalRefPoint.Augment({preprocess:function(t,e){},modifyShape:function(t,e,i){var r=t.env,a=r.originalReferencePoint;if(void 0!==a){var o=r.c.x-a.x,s=r.c.y-a.y;r.c=r.c.shiftFrame(o,s),e=n.Shape.TranslateShape(o,s,e)}return this.proceedModifyShape(t,e,i)}}),i.Modifier.Shape.Point.Augment({preprocess:function(t,e){},modifyShape:function(t,e,i){var r=t.env.c;return t.env.c=n.Frame.Point(r.x,r.y),this.proceedModifyShape(t,e,i)}}),i.Modifier.Shape.Rect.Augment({preprocess:function(t,e){},modifyShape:function(t,e,i){var r=t.env.c;return t.env.c=n.Frame.Rect(r.x,r.y,{l:r.l,r:r.r,u:r.u,d:r.d}),this.proceedModifyShape(t,e,i)}}),i.Modifier.Shape.Circle.Augment({preprocess:function(t,e){},modifyShape:function(t,e,i){var r=t.env.c;return t.env.c=n.Frame.Ellipse(r.x,r.y,r.l,r.r,r.u,r.d),this.proceedModifyShape(t,e,i)}}),i.Modifier.Shape.L.Augment({preprocess:function(t,e){},modifyShape:function(t,e,i){var r=t.env,a=r.c;if(void 0!==a){var o,s,h=a.r+a.l,c=a.u+a.d;h<c?(o=(a.l-a.r)/2,s=(a.d-a.u)/2):(o=-a.r+c/2,s=(a.d-a.u)/2),r.c=r.c.shiftFrame(o,s),e=n.Shape.TranslateShape(o,s,e)}return this.proceedModifyShape(t,e,i)}}),i.Modifier.Shape.R.Augment({preprocess:function(t,e){},modifyShape:function(t,e,i){var r=t.env,a=r.c;if(void 0!==a){var o,s,h=a.r+a.l,c=a.u+a.d;h<c?(o=(a.l-a.r)/2,s=(a.d-a.u)/2):(o=a.l-c/2,s=(a.d-a.u)/2),r.c=r.c.shiftFrame(o,s),e=n.Shape.TranslateShape(o,s,e)}return this.proceedModifyShape(t,e,i)}}),i.Modifier.Shape.U.Augment({preprocess:function(t,e){},modifyShape:function(t,e,i){var r=t.env,a=r.c;if(void 0!==a){var o,s,h=a.r+a.l;h>a.u+a.d?(o=(a.l-a.r)/2,s=(a.d-a.u)/2):(o=(a.l-a.r)/2,s=a.d-h/2),r.c=r.c.shiftFrame(o,s),e=n.Shape.TranslateShape(o,s,e)}return this.proceedModifyShape(t,e,i)}}),i.Modifier.Shape.D.Augment({preprocess:function(t,e){},modifyShape:function(t,e,i){var r=t.env,a=r.c;if(void 0!==a){var o,s,h=a.r+a.l;h>a.u+a.d?(o=(a.l-a.r)/2,s=(a.d-a.u)/2):(o=(a.l-a.r)/2,s=-a.u+h/2),r.c=r.c.shiftFrame(o,s),e=n.Shape.TranslateShape(o,s,e)}return this.proceedModifyShape(t,e,i)}}),i.Modifier.Shape.C.Augment({preprocess:function(t,e){},modifyShape:function(t,e,i){var r,a,o=t.env,s=o.c;return void 0!==s&&(r=(s.l-s.r)/2,a=(s.d-s.u)/2,o.c=o.c.shiftFrame(r,a),e=n.Shape.TranslateShape(r,a,e)),this.proceedModifyShape(t,e,i)}}),i.Modifier.Shape.ChangeColor.Augment({preprocess:function(t,e){},modifyShape:function(t,e,i){return e=this.proceedModifyShape(t,e,i),n.Shape.ChangeColorShape(this.colorName,e)}}),i.Modifier.Shape.Alphabets.Augment({preprocess:function(t,e){var i=n.repositories.modifierRepository.get(this.alphabets);if(void 0!==i)return i.preprocess(t,e)},modifyShape:function(t,e,i){var r=n.repositories.modifierRepository.get(this.alphabets);if(void 0!==r)return r.modifyShape(t,e,i)}}),i.Modifier.Shape.DefineShape.Augment({preprocess:function(t,e){var r=e.reverse();n.repositories.modifierRepository.put(this.shape,i.Modifier.Shape.CompositeModifiers(r))},modifyShape:function(t,e,n){return this.proceedModifyShape(t,e,n)}}),i.Modifier.Shape.CompositeModifiers.Augment({preprocess:function(t,e){this.modifiers.foreach((function(n){n.preprocess(t,e),e=e.prepend(n)}))},modifyShape:function(t,e,n){return e=this.proceedModifyShape(t,e,this.modifiers),this.proceedModifyShape(t,e,n)}}),i.Modifier.Invisible.Augment({preprocess:function(t,e){},modifyShape:function(t,e,i){return e=this.proceedModifyShape(t,e,i),n.Shape.none}}),i.Modifier.Hidden.Augment({preprocess:function(t,e){},modifyShape:function(t,e,n){return this.proceedModifyShape(t,e,n)}}),i.Modifier.Direction.Augment({preprocess:function(t,e){t.env.angle=this.direction.angle(t)},modifyShape:function(t,e,n){return t.env.angle=this.direction.angle(t),this.proceedModifyShape(t,e,n)}}),i.Modifier.AddOp.Augment({preprocess:function(t,e){},modifyShape:function(t,e,i){var r=t.env.c;return t.env.c=this.op.apply(this.size,r,t),t.appendShapeToFront(n.Shape.InvisibleBoxShape(t.env.c)),this.proceedModifyShape(t,e,i)}}),i.Modifier.AddOp.Grow.Augment({apply:function(t,e,n){var i=n.env,r=t.isDefault?{x:2*i.objectmargin,y:2*i.objectmargin}:t.vector.xy(n),a=Math.abs(r.x/2),o=Math.abs(r.y/2);return e.grow(a,o)},applyToDimen:function(t,e){return t+e}}),i.Modifier.AddOp.Shrink.Augment({apply:function(t,e,n){var i=n.env,r=t.isDefault?{x:2*i.objectmargin,y:2*i.objectmargin}:t.vector.xy(n),a=-Math.abs(r.x/2),o=-Math.abs(r.y/2);return e.grow(a,o)},applyToDimen:function(t,e){return t-e}}),i.Modifier.AddOp.Set.Augment({apply:function(t,e,n){var i=n.env,r=t.isDefault?{x:i.objectwidth,y:i.objectheight}:t.vector.xy(n),a=Math.abs(r.x),o=Math.abs(r.y);return e.toSize(a,o)},applyToDimen:function(t,e){return e}}),i.Modifier.AddOp.GrowTo.Augment({apply:function(t,e,n){var i=Math.max(e.l+e.r,e.u+e.d),r=t.isDefault?{x:i,y:i}:t.vector.xy(n),a=Math.abs(r.x),o=Math.abs(r.y);return e.growTo(a,o)},applyToDimen:function(t,e){return Math.max(Math.max(t,e),0)}}),i.Modifier.AddOp.ShrinkTo.Augment({apply:function(t,e,n){var i=Math.min(e.l+e.r,e.u+e.d),r=t.isDefault?{x:i,y:i}:t.vector.xy(n),a=Math.abs(r.x),o=Math.abs(r.y);return e.shrinkTo(a,o)},applyToDimen:function(t,e){return Math.max(Math.min(t,e),0)}}),i.Modifier.Shape.Frame.Augment({preprocess:function(t,e){},modifyShape:function(t,e,r){var a=t.env;if(void 0!==a.c){this.main;var o=i.ObjectBox.Frame.Radius.Default(),s="currentColor";this.options.foreach((function(t){o=t.getRadius(o)})),this.options.foreach((function(t){s=t.getColorName(s)}));var h=a.duplicate(),c=n.DrawingContext(n.Shape.none,h),u=i.ObjectBox.Frame(o,this.main).toDropFilledShape(c,s,a.c.isCircle());e=n.Shape.CompositeShape(e,u)}return this.proceedModifyShape(t,e,r)}}),i.Modifier.Shape.Frame.Radius.Augment({getRadius:function(t){return i.ObjectBox.Frame.Radius.Vector(this.vector)},getColorName:function(t){return t}}),i.Modifier.Shape.Frame.Color.Augment({getRadius:function(t){return t},getColorName:function(t){return this.colorName}}),i.Direction.Compound.Augment({angle:function(t){var e=this.dir.angle(t);return this.rots.foreach((function(n){e=n.rotate(e,t)})),e}}),i.Direction.Diag.Augment({angle:function(t){return this.diag.angle(t)}}),i.Direction.Vector.Augment({angle:function(t){return this.vector.angle(t)}}),i.Direction.ConstructVector.Augment({angle:function(t){var e=t.env,n=e.origin,i=e.xBase,r=e.yBase,a=e.p,o=e.c;this.posDecor.toShape(t);var s=Math.atan2(e.c.y-e.p.y,e.c.x-e.p.x);return e.c=o,e.p=a,e.origin=n,e.xBase=i,e.yBase=r,s}}),i.Direction.RotVector.Augment({rotate:function(t,e){return t+this.vector.angle(e)}}),i.Direction.RotCW.Augment({rotate:function(t,e){return t+Math.PI/2}}),i.Direction.RotAntiCW.Augment({rotate:function(t,e){return t-Math.PI/2}}),i.Diag.Default.Augment({isEmpty:!0,angle:function(t){return t.env.angle}}),i.Diag.Angle.Augment({isEmpty:!1,angle:function(t){return this.ang}}),i.Decor.Augment({toShape:function(t){this.commands.foreach((function(e){e.toShape(t)}))}}),i.Command.Save.Augment({toShape:function(t){t.env.saveState(),this.pos.toShape(t)}}),i.Command.Restore.Augment({toShape:function(t){t.env.restoreState()}}),i.Command.Pos.Augment({toShape:function(t){this.pos.toShape(t)}}),i.Command.AfterPos.Augment({toShape:function(t){this.pos.toShape(t),this.decor.toShape(t)}}),i.Command.Drop.Augment({toShape:function(t){this.object.toDropShape(t)}}),i.Command.Connect.Augment({toShape:function(t){this.object.toConnectShape(t)}}),i.Command.Relax.Augment({toShape:function(t){}}),i.Command.Ignore.Augment({toShape:function(t){}}),i.Command.ShowAST.Augment({toShape:function(t){console.log(this.pos.toString()+" "+this.decor)}}),i.Command.Ar.Augment({toShape:function(e){var n=e.env,r=n.origin,a=n.xBase,o=n.yBase,s=n.p,h=n.c;n.pathActionForBeforeSegment=t.Option.empty,n.pathActionForAfterSegment=t.Option.empty,n.labelsForNextSegmentOnly=t.Option.empty,n.labelsForLastSegmentOnly=t.Option.empty,n.labelsForEverySegment=t.Option.empty,n.segmentSlideEm=t.Option.empty,n.lastTurnDiag=t.Option.empty,n.arrowVariant="",n.tailTip=i.Command.Ar.Form.Tip.Tipchars(""),n.headTip=i.Command.Ar.Form.Tip.Tipchars(">"),n.stemConn=i.Command.Ar.Form.Conn.Connchars("-"),n.reverseAboveAndBelow=!1,n.arrowObjectModifiers=t.List.empty,this.forms.foreach((function(t){t.toShape(e)})),n.pathActionForBeforeSegment.isDefined||(n.pathActionForBeforeSegment=t.Option.Some(i.PosDecor(i.Pos.Coord(i.Coord.C(),t.List.empty.append(i.Pos.ConnectObject(i.Object(n.arrowObjectModifiers,n.stemConn.getObject(e))))),i.Decor(t.List.empty)))),n.labelsForNextSegmentOnly=t.Option.Some(i.Command.Path.Labels(t.List.empty.append(i.Command.Path.Label.At(i.Pos.Place(i.Place(1,1,i.Place.Factor(0),i.Slide(t.Option.empty))),n.tailTip.getObject(e),t.Option.empty)))),n.labelsForLastSegmentOnly=t.Option.Some(i.Command.Path.Labels(t.List.empty.append(i.Command.Path.Label.At(i.Pos.Place(i.Place(1,1,i.Place.Factor(1),i.Slide(t.Option.empty))),n.headTip.getObject(e),t.Option.empty)))),this.path.toShape(e),n.c=h,n.p=s,n.origin=r,n.xBase=a,n.yBase=o}}),i.Command.Ar.Form.BuildArrow.Augment({toShape:function(t){var e=t.env;e.arrowVariant=this.variant,e.tailTip=this.tailTip,e.stemConn=this.stemConn,e.headTip=this.headTip}}),i.Command.Ar.Form.ChangeVariant.Augment({toShape:function(t){t.env.arrowVariant=this.variant}}),i.Command.Ar.Form.ChangeStem.Augment({toShape:function(t){t.env.stemConn=i.Command.Ar.Form.Conn.Connchars(this.connchar)}}),i.Command.Ar.Form.DashArrowStem.Augment({toShape:function(t){}}),i.Command.Ar.Form.CurveArrow.Augment({toShape:function(e){var r=e.env,a=n.em2length(2*n.length2em(this.dist));r.pathActionForBeforeSegment=t.Option.Some(i.PosDecor(i.Pos.Coord(i.Coord.C(),t.List.empty.append(i.Pos.ConnectObject(i.Object(r.arrowObjectModifiers,i.ObjectBox.Curve(t.List.empty,t.List.empty.append(i.ObjectBox.Curve.Object.Connect(r.stemConn.getObject(e))),t.List.empty.append(i.ObjectBox.Curve.PosList.Pos(i.Pos.Coord(i.Coord.Group(i.PosDecor(i.Pos.Coord(i.Coord.C(),t.List.empty.append(i.Pos.ConnectObject(i.Object(t.List.empty,i.ObjectBox.Dir("","")))).append(i.Pos.Place(i.Place(0,0,void 0,i.Slide(t.Option.empty)))).append(i.Pos.Plus(i.Coord.Vector(i.Vector.Dir(this.direction,a))))),i.Decor(t.List.empty))),t.List.empty)))))))),i.Decor(t.List.empty)))}}),i.Command.Ar.Form.CurveFitToDirection.Augment({toShape:function(e){var n=e.env;n.pathActionForBeforeSegment=t.Option.Some(i.PosDecor(i.Pos.Coord(i.Coord.C(),t.List.empty.append(i.Pos.ConnectObject(i.Object(n.arrowObjectModifiers,i.ObjectBox.Curve(t.List.empty,t.List.empty.append(i.ObjectBox.Curve.Object.Connect(n.stemConn.getObject(e))),t.List.empty.append(i.ObjectBox.Curve.PosList.Pos(i.Pos.Coord(i.Coord.C(),t.List.empty.append(i.Pos.SwapPAndC(i.Coord.C())).append(i.Pos.Plus(i.Coord.Vector(i.Vector.Dir(this.outDirection,"3pc"))))))).append(i.ObjectBox.Curve.PosList.Pos(i.Pos.Coord(i.Coord.C(),t.List.empty.append(i.Pos.SwapPAndC(i.Coord.C())).append(i.Pos.Plus(i.Coord.Vector(i.Vector.Dir(this.inDirection,"3pc")))))))))))),i.Decor(t.List.empty)))}}),i.Command.Ar.Form.CurveWithControlPoints.Augment({toShape:function(e){var r=e.env;tmpEnv=r.duplicate(),tmpEnv.startCapturePositions();var a=n.DrawingContext(n.Shape.none,tmpEnv);this.coord.position(a);var o=tmpEnv.endCapturePositions();o=o.append(tmpEnv.c);var s=t.List.empty;o.reverse().foreach((function(e){var n=r.inverseAbsVector(e.x,e.y);s=s.prepend(i.ObjectBox.Curve.PosList.Pos(i.Pos.Coord(i.Coord.Vector(i.Vector.InCurBase(n.x,n.y)),t.List.empty)))})),r.pathActionForBeforeSegment=t.Option.Some(i.PosDecor(i.Pos.Coord(i.Coord.C(),t.List.empty.append(i.Pos.ConnectObject(i.Object(r.arrowObjectModifiers,i.ObjectBox.Curve(t.List.empty,t.List.empty.append(i.ObjectBox.Curve.Object.Connect(r.stemConn.getObject(e))),s))))),i.Decor(t.List.empty)))}}),i.Command.Ar.Form.AddShape.Augment({toShape:function(e){e.env.arrowObjectModifiers=t.List.empty.append(this.shape)}}),i.Command.Ar.Form.AddModifiers.Augment({toShape:function(t){t.env.arrowObjectModifiers=this.modifiers}}),i.Command.Ar.Form.Slide.Augment({toShape:function(e){e.env.segmentSlideEm=t.Option.Some(n.length2em(this.slideDimen))}}),i.Command.Ar.Form.LabelAt.Augment({toShape:function(e){e.env.labelsForEverySegment=t.Option.Some(i.Command.Path.Labels(t.List.empty.append(i.Command.Path.Label.At(i.Pos.Place(this.anchor),this.it,t.Option.empty))))}}),i.Command.Ar.Form.LabelAbove.Augment({toShape:function(e){var n,r=e.env;n=r.reverseAboveAndBelow?i.Command.Path.Label.Below(i.Pos.Place(this.anchor),this.it,t.Option.empty):i.Command.Path.Label.Above(i.Pos.Place(this.anchor),this.it,t.Option.empty),r.labelsForEverySegment=t.Option.Some(i.Command.Path.Labels(t.List.empty.append(n)))}}),i.Command.Ar.Form.LabelBelow.Augment({toShape:function(e){var n,r=e.env;n=r.reverseAboveAndBelow?i.Command.Path.Label.Above(i.Pos.Place(this.anchor),this.it,t.Option.empty):i.Command.Path.Label.Below(i.Pos.Place(this.anchor),this.it,t.Option.empty),r.labelsForEverySegment=t.Option.Some(i.Command.Path.Labels(t.List.empty.append(n)))}}),i.Command.Ar.Form.ReverseAboveAndBelow.Augment({toShape:function(t){t.env.reverseAboveAndBelow=!0}}),i.Command.Ar.Form.Conn.Connchars.Augment({getObject:function(t){var e=t.env,n=i.ObjectBox.Dir(e.arrowVariant,this.connchars);return i.Object(e.arrowObjectModifiers,n)}}),i.Command.Ar.Form.Conn.Object.Augment({getObject:function(t){var e=t.env.arrowObjectModifiers.concat(this.object.modifiers);return i.Object(e,this.object.object)}}),i.Command.Ar.Form.Conn.Dir.Augment({getObject:function(t){var e=t.env,n=this.dir,r=n;return""===n.variant&&""!==e.arrowVariant&&(r=i.ObjectBox.Dir(e.arrowVariant,n.main)),i.Object(e.arrowObjectModifiers,r)}}),i.Command.Ar.Form.Tip.Tipchars.Augment({getObject:function(t){var e=t.env,n=i.ObjectBox.Dir(e.arrowVariant,this.tipchars);return i.Object(e.arrowObjectModifiers,n)}}),i.Command.Ar.Form.Tip.Object.Augment({getObject:function(t){var e=t.env.arrowObjectModifiers.concat(this.object.modifiers);return i.Object(e,this.object.object)}}),i.Command.Ar.Form.Tip.Dir.Augment({getObject:function(t){var e=t.env,n=this.dir,r=n;return""===n.variant&&""!==e.arrowVariant&&(r=i.ObjectBox.Dir(e.arrowVariant,n.main)),i.Object(e.arrowObjectModifiers,r)}}),i.Command.Path.Augment({toShape:function(e){var n=e.env,i=n.origin,r=n.xBase,a=n.yBase,o=n.p,s=n.c;n.pathActionForBeforeSegment=t.Option.empty,n.pathActionForAfterSegment=t.Option.empty,n.labelsForNextSegmentOnly=t.Option.empty,n.labelsForLastSegmentOnly=t.Option.empty,n.labelsForEverySegment=t.Option.empty,n.segmentSlideEm=t.Option.empty,n.lastTurnDiag=t.Option.empty,this.path.toShape(e),n.c=s,n.p=o,n.origin=i,n.xBase=r,n.yBase=a}}),i.Command.AfterPath.Augment({toShape:function(t){this.path.toShape(t),this.decor.toShape(t)}}),i.Command.Path.Path.Augment({toShape:function(t){this.pathElements.foreach((function(e){e.toShape(t)}))}}),i.Command.Path.SetBeforeAction.Augment({toShape:function(e){e.env.pathActionForBeforeSegment=t.Option.Some(this.posDecor)}}),i.Command.Path.SetAfterAction.Augment({toShape:function(e){e.env.pathActionForAfterSegment=t.Option.Some(this.posDecor)}}),i.Command.Path.AddLabelNextSegmentOnly.Augment({toShape:function(e){e.env.labelsForNextSegmentOnly=t.Option.Some(this.labels)}}),i.Command.Path.AddLabelLastSegmentOnly.Augment({toShape:function(e){e.env.labelsForLastSegmentOnly=t.Option.Some(this.labels)}}),i.Command.Path.AddLabelEverySegment.Augment({toShape:function(e){e.env.labelsForEverySegment=t.Option.Some(this.labels)}}),i.Command.Path.StraightSegment.Augment({toShape:function(e){var n=e.env;this.segment.setupPositions(e);var i=n.c;n.pathActionForBeforeSegment.foreach((function(t){t.toShape(e)})),n.labelsForNextSegmentOnly.foreach((function(i){i.toShape(e),n.labelsForNextSegmentOnly=t.Option.empty})),n.labelsForEverySegment.foreach((function(t){t.toShape(e)})),n.c=i,n.pathActionForAfterSegment.foreach((function(t){t.toShape(e)})),this.segment.toLabelsShape(e)}}),i.Command.Path.LastSegment.Augment({toShape:function(e){var n=e.env;this.segment.setupPositions(e);var i=n.c;n.pathActionForBeforeSegment.foreach((function(t){t.toShape(e)})),n.labelsForNextSegmentOnly.foreach((function(i){i.toShape(e),n.labelsForNextSegmentOnly=t.Option.empty})),n.labelsForLastSegmentOnly.foreach((function(i){i.toShape(e),n.labelsForNextSegmentOnly=t.Option.empty})),n.labelsForEverySegment.foreach((function(t){t.toShape(e)})),n.c=i,n.pathActionForAfterSegment.foreach((function(t){t.toShape(e)})),this.segment.toLabelsShape(e)}}),i.Command.Path.TurningSegment.Augment({toShape:function(e){var r=e.env,a=r.c;this.segment.pos.toShape(e),r.p=a;var o=this.turn.explicitizedCircle(e),s=this.turn.radius.radius(e);r.lastTurnDiag=t.Option.Some(o.endDiag);var h=o.startVector(e),c=o.endVector(e),u=r.segmentSlideEm.getOrElse(0);this.segment.slide.dimen.foreach((function(e){u=n.length2em(e),r.segmentSlideEm=t.Option.Some(u)})),0!==u&&(r.p=r.p.move(r.p.x-u*h.y,r.p.y+u*h.x),r.c=r.c.move(r.c.x-u*c.y,r.c.y+u*c.x),s="^"===o.orient?Math.max(0,s-u):Math.max(0,s+u));var p,l=r.p.edgePoint(r.p.x+h.x,r.p.y+h.y),d=r.c,m=o.relativeStartPoint(e,s),x=o.relativeEndPoint(e,s),f=o.relativeEndPoint(e,s+("^"===o.orient?u:-u)),g=h.x*c.y-h.y*c.x;if(Math.abs(g)<i.xypic.machinePrecision)p=0;else{var S=d.x-l.x+m.x-x.x,y=d.y-l.y+m.y-x.y;(p=(c.y*S-c.x*y)/g)<0&&(p=0)}var v=l.x-m.x+p*h.x,b=l.y-m.y+p*h.y,C=(o.toDropShape(e,v,b,s),n.Frame.Point(v+f.x,b+f.y));r.c=n.Frame.Point(v+m.x,b+m.y),r.pathActionForBeforeSegment.foreach((function(t){t.toShape(e)})),r.labelsForNextSegmentOnly.foreach((function(n){n.toShape(e),r.labelsForNextSegmentOnly=t.Option.empty})),r.labelsForEverySegment.foreach((function(t){t.toShape(e)})),r.c=C,r.pathActionForAfterSegment.foreach((function(t){t.toShape(e)})),this.segment.toLabelsShape(e)}}),i.Command.Path.Turn.Cir.Augment({explicitizedCircle:function(t){var e,n,r,a=t.env;return e=this.cir.startDiag.isEmpty?a.lastTurnDiag.getOrElse(i.Diag.R()):this.cir.startDiag,n=this.cir.orient,r=this.cir.endDiag.isEmpty?e.turn(n):this.cir.endDiag,i.ObjectBox.Cir.Cir.Segment(e,n,r)}}),i.ObjectBox.Cir.Cir.Segment.Augment({startVector:function(t){var e=this.startDiag.angle(t);return{x:Math.cos(e),y:Math.sin(e)}},endVector:function(t){var e=this.endDiag.angle(t);return{x:Math.cos(e),y:Math.sin(e)}},relativeStartPointAngle:function(t){return this.startPointDegree(t)/180*Math.PI},relativeStartPoint:function(t,e){var n=this.startPointDegree(t)/180*Math.PI;return{x:e*Math.cos(n),y:e*Math.sin(n)}},relativeEndPoint:function(t,e){var n;return n=this.endPointDegree(t,this.relativeStartPointAngle(t))/180*Math.PI,{x:e*Math.cos(n),y:e*Math.sin(n)}}}),i.Command.Path.Turn.Diag.Augment({explicitizedCircle:function(t){var e,n,r,a=t.env,o=(e=this.diag.isEmpty?a.lastTurnDiag.getOrElse(i.Diag.R()):this.diag).angle(t);return n=(a.c.x-a.p.x)*Math.sin(o)-(a.c.y-a.p.y)*Math.cos(o)<0?"^":"_",r=e.turn(n),i.ObjectBox.Cir.Cir.Segment(e,n,r)}}),i.Command.Path.TurnRadius.Default.Augment({radius:function(t){return i.xypic.turnradius}}),i.Command.Path.TurnRadius.Dimen.Augment({radius:function(t){return n.length2em(this.dimen)}}),i.Command.Path.Segment.Augment({setupPositions:function(e){var i=e.env;i.p=i.c,this.pos.toShape(e);var r=i.p,a=i.c,o=a.x-r.x,s=a.y-r.y,h=Math.atan2(s,o)+Math.PI/2,c=i.segmentSlideEm.getOrElse(0);this.slide.dimen.foreach((function(e){c=n.length2em(e),i.segmentSlideEm=t.Option.Some(c)})),0!==c&&(r=r.move(r.x+c*Math.cos(h),r.y+c*Math.sin(h)),a=a.move(a.x+c*Math.cos(h),a.y+c*Math.sin(h))),i.p=r,i.c=a},toLabelsShape:function(t){var e=t.env,n=e.c,i=e.p;this.labels.toShape(t),e.c=n,e.p=i}}),i.Command.Path.Labels.Augment({toShape:function(t){this.labels.foreach((function(e){e.toShape(t)}))}}),i.Command.Path.Label.Augment({toShape:function(t){var e=t.env,i=e.p,r=e.c,a=this.anchor.toShape(t),o=this.getLabelMargin(t);if(0!==o){var s;s=(b=e.lastCurve).isNone?Math.atan2(r.y-i.y,r.x-i.x)+Math.PI/2:b.angle(a)+Math.PI/2+(o>0?0:Math.PI),r=e.c;var h=n.DrawingContext(n.Shape.none,e);this.it.toDropShape(h);var c=h.shape,u=c.getBoundingBox();if(void 0!==u){var p=u.x-r.x,l=u.y-r.y,d=u.l,m=u.r,x=u.u,f=u.d,g=Math.cos(s),S=Math.sin(s),y=Math.min((p-d)*g+(l-f)*S,(p-d)*g+(l+x)*S,(p+m)*g+(l-f)*S,(p+m)*g+(l+x)*S),v=Math.abs(o)-y;e.c=e.c.move(r.x+v*g,r.y+v*S),t.appendShapeToFront(n.Shape.TranslateShape(v*g,v*S,c))}}else this.it.toDropShape(t);var b=e.lastCurve;this.shouldSliceHole&&b.isDefined&&void 0!==a&&b.sliceHole(e.c,a),this.aliasOption.foreach((function(t){e.savePos(t,n.Saving.Position(e.c))}))}}),i.Command.Path.Label.Above.Augment({getLabelMargin:function(t){return t.env.labelmargin},shouldSliceHole:!1}),i.Command.Path.Label.Below.Augment({getLabelMargin:function(t){return-t.env.labelmargin},shouldSliceHole:!1}),i.Command.Path.Label.At.Augment({getLabelMargin:function(t){return 0},shouldSliceHole:!0}),i.Command.Xymatrix.Augment({toShape:function(e){var i=e.env;if(void 0===i.c)return n.Shape.none;var a=i.duplicate(),o=n.DrawingContext(n.Shape.none,a);a.xymatrixPrefix="",a.xymatrixRowSepEm=n.length2em("2pc"),a.xymatrixColSepEm=n.length2em("2pc"),a.xymatrixPretendEntryHeight=t.Option.empty,a.xymatrixPretendEntryWidth=t.Option.empty,a.xymatrixFixedRow=!1,a.xymatrixFixedCol=!1,a.xymatrixOrientationAngle=0,a.xymatrixEntryModifiers=t.List.empty,this.setup.foreach((function(t){t.toShape(o)}));var s,h,c=a.xymatrixOrientationAngle,p=0,m=0,x=n.Xymatrix(this.rows.map((function(t){m+=1,h=0;var e=n.Xymatrix.Row(t.entries.map((function(t){h+=1;var e=a.duplicate();e.origin={x:0,y:0},e.p=e.c=n.Env.originPosition,e.angle=0,e.lastCurve=n.LastCurve.none,e.xymatrixRow=m,e.xymatrixCol=h;var i,r,o,s,c=n.DrawingContext(n.Shape.none,e),u=t.toShape(c),p=e.c;if(a.xymatrixPretendEntryHeight.isDefined){var l=a.xymatrixPretendEntryHeight.get;o=l/2,s=l/2}else o=p.u,s=p.d;if(a.xymatrixPretendEntryWidth.isDefined){var d=a.xymatrixPretendEntryWidth.get;i=d/2,r=d/2}else i=p.l,r=p.r;var x=n.Frame.Rect(0,0,{l:i,r,u:o,d:s});return n.Xymatrix.Entry(e.c,u,t.decor,x)})),c);return p=Math.max(p,h),e})),c);if(0===(s=m))return n.Shape.none;x.rows.foreach((function(t){h=0,t.entries.foreach((function(t){h+=1,x.getColumn(h).addEntry(t)}))}));var f=a.xymatrixColSepEm,g=[],S=i.c.x;if(g.push(S),a.xymatrixFixedCol){var y=0,v=0;x.columns.foreach((function(t){y=Math.max(y,t.getL()),v=Math.max(v,t.getR())})),x.columns.tail.foreach((function(t){S=S+v+f+y,g.push(S)})),l=y,r=g[g.length-1]+v}else{var b=x.columns.head;x.columns.tail.foreach((function(t){S=S+b.getR()+f+t.getL(),g.push(S),b=t})),l=x.columns.head.getL(),r=S+x.columns.at(p-1).getR()-g[0]}var C=a.xymatrixRowSepEm,M=[],w=i.c.y;if(M.push(w),a.xymatrixFixedRow){var P=0,O=0;x.rows.foreach((function(t){P=Math.max(P,t.getU()),O=Math.max(O,t.getD())})),x.rows.tail.foreach((function(t){w-=O+C+P,M.push(w)})),u=P,d=M[0]-M[M.length-1]+O}else{var A=x.rows.head;x.rows.tail.foreach((function(t){w-=A.getD()+C+t.getU(),M.push(w),A=t})),u=x.rows.head.getU(),d=M[0]-w+x.rows.at(s-1).getD()}i.c=n.Frame.Rect(i.c.x,i.c.y,{l,r,u,d});var L=a.xymatrixPrefix,E=Math.cos(c),B=Math.sin(c),j=0;x.rows.foreach((function(t){colIndex=0,t.entries.foreach((function(t){var e=g[colIndex],i=M[j],r=e*E-i*B,o=e*B+i*E,s=colIndex+1,h=j+1,c=n.Saving.Position(t.c.move(r,o));a.savePos(h+","+s,c),a.savePos(L+h+","+s,c),colIndex+=1})),j+=1})),o=n.DrawingContext(n.Shape.none,a),j=0,x.rows.foreach((function(t){colIndex=0,t.entries.foreach((function(t){var e=g[colIndex],i=M[j],r=e*E-i*B,s=e*B+i*E,h=colIndex+1,c=j+1,u=n.Shape.TranslateShape(r,s,t.objectShape);o.appendShapeToFront(u),a.c=t.c.move(r,s),a.xymatrixRow=c,a.xymatrixCol=h,t.decor.toShape(o),colIndex+=1})),j+=1}));var D=o.shape;return e.appendShapeToFront(D),i.savedPosition=a.savedPosition,D}}),n.Xymatrix=MathJax.Object.Subclass({Init:function(e,n){this.rows=e,this.columns=t.List.empty,this.orientation=n},getColumn:function(t){if(this.columns.length()>=t)return this.columns.at(t-1);var e=n.Xymatrix.Column(this.orientation);return this.columns=this.columns.append(e),e},toString:function(){return"Xymatrix{\n"+this.rows.mkString("\\\\\n")+"\n}"}}),n.Xymatrix.Row=MathJax.Object.Subclass({Init:function(t,e){this.entries=t,this.orientation=e,o(this,"getU"),o(this,"getD")},getU:function(){var t=this.orientation,e=0;return this.entries.foreach((function(n){e=Math.max(e,n.getU(t))})),e},getD:function(){var t=this.orientation,e=0;return this.entries.foreach((function(n){e=Math.max(e,n.getD(t))})),e},toString:function(){return this.entries.mkString(" & ")}}),n.Xymatrix.Column=MathJax.Object.Subclass({Init:function(e){this.entries=t.List.empty,this.orientation=e,o(this,"getL"),o(this,"getR")},addEntry:function(t){this.entries=this.entries.append(t),this.getL.reset,this.getR.reset},getL:function(){var t=this.orientation,e=0;return this.entries.foreach((function(n){e=Math.max(e,n.getL(t))})),e},getR:function(){var t=this.orientation,e=0;return this.entries.foreach((function(n){e=Math.max(e,n.getR(t))})),e},toString:function(){return this.entries.mkString(" \\\\ ")}}),n.Xymatrix.Entry=MathJax.Object.Subclass({Init:function(t,e,n,i){this.c=t,this.objectShape=e,this.decor=n,this.frame=i},getDistanceToEdgePoint:function(t,e){var n=t.edgePoint(t.x+Math.cos(e),t.y+Math.sin(e)),i=n.x-t.x,r=n.y-t.y;return Math.sqrt(i*i+r*r)},getU:function(t){return 0===t?this.frame.u:this.getDistanceToEdgePoint(this.frame,t+Math.PI/2)},getD:function(t){return 0===t?this.frame.d:this.getDistanceToEdgePoint(this.frame,t-Math.PI/2)},getL:function(t){return 0===t?this.frame.l:this.getDistanceToEdgePoint(this.frame,t+Math.PI)},getR:function(t){return 0===t?this.frame.r:this.getDistanceToEdgePoint(this.frame,t)},toString:function(){return this.objectShape.toString()+" "+this.decor}}),i.Command.Xymatrix.Setup.Prefix.Augment({toShape:function(t){t.env.xymatrixPrefix=this.prefix}}),i.Command.Xymatrix.Setup.ChangeSpacing.Row.Augment({toShape:function(t){var e=t.env;e.xymatrixRowSepEm=this.addop.applyToDimen(e.xymatrixRowSepEm,n.length2em(this.dimen))}}),i.Command.Xymatrix.Setup.ChangeSpacing.Column.Augment({toShape:function(t){var e=t.env;e.xymatrixColSepEm=this.addop.applyToDimen(e.xymatrixColSepEm,n.length2em(this.dimen))}}),i.Command.Xymatrix.Setup.ChangeSpacing.RowAndColumn.Augment({toShape:function(t){var e=t.env,i=this.addop.applyToDimen(e.xymatrixRowSepEm,n.length2em(this.dimen));e.xymatrixRowSepEm=i,e.xymatrixColSepEm=i}}),i.Command.Xymatrix.Setup.PretendEntrySize.Height.Augment({toShape:function(e){e.env.xymatrixPretendEntryHeight=t.Option.Some(n.length2em(this.dimen))}}),i.Command.Xymatrix.Setup.PretendEntrySize.Width.Augment({toShape:function(e){e.env.xymatrixPretendEntryWidth=t.Option.Some(n.length2em(this.dimen))}}),i.Command.Xymatrix.Setup.PretendEntrySize.HeightAndWidth.Augment({toShape:function(e){var i=t.Option.Some(n.length2em(this.dimen));e.env.xymatrixPretendEntryHeight=i,e.env.xymatrixPretendEntryWidth=i}}),i.Command.Xymatrix.Setup.FixGrid.Row.Augment({toShape:function(t){t.env.xymatrixFixedRow=!0}}),i.Command.Xymatrix.Setup.FixGrid.Column.Augment({toShape:function(t){t.env.xymatrixFixedCol=!0}}),i.Command.Xymatrix.Setup.FixGrid.RowAndColumn.Augment({toShape:function(t){t.env.xymatrixFixedRow=!0,t.env.xymatrixFixedCol=!0}}),i.Command.Xymatrix.Setup.AdjustEntrySize.Margin.Augment({toShape:function(t){var e=t.env;e.objectmargin=this.addop.applyToDimen(e.objectmargin,n.length2em(this.dimen))}}),i.Command.Xymatrix.Setup.AdjustEntrySize.Width.Augment({toShape:function(t){var e=t.env;e.objectwidth=this.addop.applyToDimen(e.objectwidth,n.length2em(this.dimen))}}),i.Command.Xymatrix.Setup.AdjustEntrySize.Height.Augment({toShape:function(t){var e=t.env;e.objectheight=this.addop.applyToDimen(e.objectheight,n.length2em(this.dimen))}}),i.Command.Xymatrix.Setup.AdjustLabelSep.Augment({toShape:function(t){var e=t.env;e.labelmargin=this.addop.applyToDimen(e.labelmargin,n.length2em(this.dimen))}}),i.Command.Xymatrix.Setup.SetOrientation.Augment({toShape:function(t){t.env.xymatrixOrientationAngle=this.direction.angle(t)}}),i.Command.Xymatrix.Setup.AddModifier.Augment({toShape:function(t){var e=t.env;e.xymatrixEntryModifiers=e.xymatrixEntryModifiers.prepend(this.modifier)}}),i.Command.Xymatrix.Entry.SimpleEntry.Augment({toShape:function(t){var e=t.env,r=n.em2length(e.objectmargin+e.objectwidth),a=n.em2length(e.objectmargin+e.objectheight),o=i.Modifier.AddOp(i.Modifier.AddOp.GrowTo(),i.Modifier.AddOp.VactorSize(i.Vector.Abs(r,a))),s=n.em2length(e.objectmargin),h=i.Modifier.AddOp(i.Modifier.AddOp.Grow(),i.Modifier.AddOp.VactorSize(i.Vector.Abs(s,s))),c=this.modifiers.concat(e.xymatrixEntryModifiers).prepend(o).prepend(h);return i.Object(c,this.objectbox).toDropShape(t)}}),i.Command.Xymatrix.Entry.EmptyEntry.Augment({toShape:function(t){var e=t.env,r=n.em2length(e.objectmargin+e.objectwidth),a=n.em2length(e.objectmargin+e.objectheight),o=i.Modifier.AddOp(i.Modifier.AddOp.GrowTo(),i.Modifier.AddOp.VactorSize(i.Vector.Abs(r,a))),s=n.em2length(e.objectmargin),h=i.Modifier.AddOp(i.Modifier.AddOp.Grow(),i.Modifier.AddOp.VactorSize(i.Vector.Abs(s,s))),c=e.xymatrixEntryModifiers.prepend(o).prepend(h);return i.Object(c,i.ObjectBox.Empty()).toDropShape(t)}}),i.Command.Xymatrix.Entry.ObjectEntry.Augment({toShape:function(t){return this.object.toDropShape(t)}}),i.Command.Twocell.Augment({toShape:function(e){var r=e.env;if(void 0===r.c)return n.Shape.none;var a=r.duplicate(),o=n.DrawingContext(n.Shape.none,a);a.twocellmodmapobject=r.twocellmodmapobject||i.Object(t.List.empty,i.ObjectBox.Dir("","|")),a.twocellhead=r.twocellhead||i.Object(t.List.empty,i.ObjectBox.Dir("",">")),a.twocelltail=r.twocelltail||i.Object(t.List.empty,i.ObjectBox.Dir("","")),a.twocellarrowobject=r.twocellarrowobject||i.Object(t.List.empty,i.ObjectBox.Dir("","=>")),a.twocellUpperCurveObjectSpacer=r.twocellUpperCurveObjectSpacer,a.twocellUpperCurveObject=r.twocellUpperCurveObject,a.twocellLowerCurveObjectSpacer=r.twocellLowerCurveObjectSpacer,a.twocellLowerCurveObject=r.twocellLowerCurveObject,a.twocellUpperLabel=t.Option.empty,a.twocellLowerLabel=t.Option.empty,a.twocellCurvatureEm=t.Option.empty,a.twocellShouldDrawCurve=!0,a.twocellShouldDrawModMap=!1,this.switches.foreach((function(t){t.setup(o)})),this.twocell.toShape(o,this.arrow),e.appendShapeToFront(o.shape)}}),i.Command.Twocell.Hops2cell.Augment({toShape:function(e,r){var a=e.env,o=a.c,s=a.angle,h=a.c,c=this.targetPosition(e);if(void 0!==h&&void 0!==c){var u=c.x-h.x,p=c.y-h.y;if(0!==u||0!==p){var l=n.Frame.Point(h.x+.5*u,h.y+.5*p),d=Math.atan2(p,u),m=d+Math.PI/2,x=a.twocellCurvatureEm.getOrElse(this.getDefaultCurvature()),f=Math.cos(m),g=Math.sin(m),S=this.getUpperControlPoint(h,c,l,x,f,g),y=this.getLowerControlPoint(h,c,l,x,f,g);if(a.twocellShouldDrawCurve){var v,b;if(b=void 0===(v=a.twocellUpperCurveObjectSpacer)?i.Object(t.List.empty,i.ObjectBox.Dir("","-")):void 0!==a.twocellUpperCurveObject?a.twocellUpperCurveObject.getOrElse(void 0):void 0,this.toUpperCurveShape(e,h,S,c,v,b),a.lastCurve.isDefined){a.angle=d;var C=this.getUpperLabelPosition(h,c,l,x,f,g),M=this.getUpperLabelAngle(m,h,c,l,x,f,g);a.twocellUpperLabel.foreach((function(t){t.toShape(e,C,Math.cos(M),Math.sin(M),d)})),this.hasUpperTips&&r.toUpperTipsShape(e)}if(b=void 0===(v=a.twocellLowerCurveObjectSpacer)?i.Object(t.List.empty,i.ObjectBox.Dir("","-")):void 0!==a.twocellLowerCurveObject?a.twocellLowerCurveObject.getOrElse(void 0):void 0,this.toLowerCurveShape(e,h,y,c,v,b),a.lastCurve.isDefined){a.angle=d;var w=this.getLowerLabelPosition(h,c,l,x,f,g),P=this.getLowerLabelAngle(m,h,c,l,x,f,g);a.twocellLowerLabel.foreach((function(t){t.toShape(e,w,Math.cos(P),Math.sin(P),d)})),this.hasLowerTips&&r.toLowerTipsShape(e)}}a.c=this.getDefaultArrowPoint(h,c,l,x,f,g),a.angle=m+Math.PI;var O=l;r.toArrowShape(e,O),a.c=o,a.angle=s}}},_toCurveShape:function(t,e,i,r,a,o){var s=t.env,h=n.Curve.QuadBezier(e,i,r),c=h.tOfShavedStart(e),u=h.tOfShavedEnd(r);if(void 0===c||void 0===u||c>=u)s.lastCurve=n.LastCurve.none;else{var p=h.toShape(t,a,o);s.lastCurve=n.LastCurve.QuadBezier(h,c,u,p)}},targetPosition:function(t){var e=t.env,i=e.xymatrixRow,r=e.xymatrixCol;if(void 0===i||void 0===r)throw n.ExecutionError("rows and columns not found for hops ["+this.hops+"]");for(var a=0;a<this.hops.length;a++)switch(this.hops[a]){case"u":i-=1;break;case"d":i+=1;break;case"l":r-=1;break;case"r":r+=1}var o=i+","+r;return t.env.lookupPos(o,'in entry "'+e.xymatrixRow+","+e.xymatrixCol+'": No '+this+" (is "+o+") from here.").position(t)}}),i.Command.Twocell.Twocell.Augment({getUpperControlPoint:function(t,e,i,r,a,o){return n.Frame.Point(i.x+r*a,i.y+r*o)},getLowerControlPoint:function(t,e,i,r,a,o){return n.Frame.Point(i.x-r*a,i.y-r*o)},getUpperLabelPosition:function(t,e,i,r,a,o){return n.Frame.Point(i.x+.5*r*a,i.y+.5*r*o)},getLowerLabelPosition:function(t,e,i,r,a,o){return n.Frame.Point(i.x-.5*r*a,i.y-.5*r*o)},getUpperLabelAngle:function(t,e,n,i,r,a,o){return t+(r<0?Math.PI:0)},getLowerLabelAngle:function(t,e,n,i,r,a,o){return t+(r<0?0:Math.PI)},getDefaultArrowPoint:function(t,e,n,i,r,a){return n},toUpperCurveShape:function(t,e,n,i,r,a){this._toCurveShape(t,e,n,i,r,a)},toLowerCurveShape:function(t,e,n,i,r,a){this._toCurveShape(t,e,n,i,r,a)},getDefaultCurvature:function(){return 3.5*i.xypic.lineElementLength},hasUpperTips:!0,hasLowerTips:!0}),i.Command.Twocell.UpperTwocell.Augment({getUpperControlPoint:function(t,e,i,r,a,o){return n.Frame.Point(i.x+r*a,i.y+r*o)},getLowerControlPoint:function(t,e,n,i,r,a){return n},getUpperLabelPosition:function(t,e,i,r,a,o){return n.Frame.Point(i.x+.5*r*a,i.y+.5*r*o)},getLowerLabelPosition:function(t,e,n,i,r,a){return n},getUpperLabelAngle:function(t,e,n,i,r,a,o){return t+(r<0?Math.PI:0)},getLowerLabelAngle:function(t,e,n,i,r,a,o){return t+(r<0?0:Math.PI)},getDefaultArrowPoint:function(t,e,i,r,a,o){return n.Frame.Point(i.x+.25*r*a,i.y+.25*r*o)},toUpperCurveShape:function(t,e,n,i,r,a){this._toCurveShape(t,e,n,i,r,a)},toLowerCurveShape:function(t,e,i,r,a,o){var s=e.edgePoint(r.x,r.y),h=r.edgePoint(e.x,e.y);s.x!==h.x||s.y!==h.y?t.env.lastCurve=n.LastCurve.Line(s,h,e,r,void 0):t.env.lastCurve=n.LastCurve.none},getDefaultCurvature:function(){return 7*i.xypic.lineElementLength},hasUpperTips:!0,hasLowerTips:!1}),i.Command.Twocell.LowerTwocell.Augment({getUpperControlPoint:function(t,e,n,i,r,a){return n},getLowerControlPoint:function(t,e,i,r,a,o){return n.Frame.Point(i.x+r*a,i.y+r*o)},getUpperLabelPosition:function(t,e,n,i,r,a){return n},getLowerLabelPosition:function(t,e,i,r,a,o){return n.Frame.Point(i.x+.5*r*a,i.y+.5*r*o)},getUpperLabelAngle:function(t,e,n,i,r,a,o){return t+(r<0?0:Math.PI)},getLowerLabelAngle:function(t,e,n,i,r,a,o){return t+(r<0?Math.PI:0)},getDefaultArrowPoint:function(t,e,i,r,a,o){return n.Frame.Point(i.x+.25*r*a,i.y+.25*r*o)},toUpperCurveShape:function(t,e,i,r,a,o){var s=e.edgePoint(r.x,r.y),h=r.edgePoint(e.x,e.y);s.x!==h.x||s.y!==h.y?t.env.lastCurve=n.LastCurve.Line(s,h,e,r,void 0):t.env.lastCurve=n.LastCurve.none},toLowerCurveShape:function(t,e,n,i,r,a){this._toCurveShape(t,e,n,i,r,a)},getDefaultCurvature:function(){return-7*i.xypic.lineElementLength},hasUpperTips:!1,hasLowerTips:!0}),i.Command.Twocell.CompositeMap.Augment({getUpperControlPoint:function(t,e,i,r,a,o){var s=this.getMidBoxSize();return n.Frame.Ellipse(i.x+r*a,i.y+r*o,s,s,s,s)},getLowerControlPoint:function(t,e,i,r,a,o){var s=this.getMidBoxSize();return n.Frame.Ellipse(i.x+r*a,i.y+r*o,s,s,s,s)},getUpperLabelPosition:function(t,e,i,r,a,o){var s=i.x+r*a-e.x,h=i.y+r*o-e.y;return Math.sqrt(s*s+h*h),n.Frame.Point(e.x+.5*s,e.y+.5*h)},getLowerLabelPosition:function(t,e,i,r,a,o){var s=i.x+r*a-t.x,h=i.y+r*o-t.y;return Math.sqrt(s*s+h*h),n.Frame.Point(t.x+.5*s,t.y+.5*h)},getUpperLabelAngle:function(t,e,n,i,r,a,o){var s=n.x-i.x+r*a,h=n.y-i.y+r*o,c=Math.atan2(h,s),u=r<0?Math.PI:0;return c+Math.PI/2+u},getLowerLabelAngle:function(t,e,n,i,r,a,o){var s=i.x+r*a-e.x,h=i.y+r*o-e.y,c=Math.atan2(h,s),u=r<0?Math.PI:0;return c+Math.PI/2+u},getDefaultArrowPoint:function(t,e,n,i,r,a){return n},toUpperCurveShape:function(t,e,i,r,a,o){var s=t.env,h=e,c=i,u=h.edgePoint(c.x,c.y),p=c.edgePoint(h.x,h.y),l=s.p,d=s.c;s.p=h,s.c=c,n.Curve.Line(u,p).toShape(t,void 0,"-",""),s.p=l,s.c=d},toLowerCurveShape:function(t,e,i,r,a,o){var s=t.env,h=i,c=r,u=h.edgePoint(c.x,c.y),p=c.edgePoint(h.x,h.y),l=s.p,d=s.c;s.p=h,s.c=c,n.Curve.Line(u,p).toShape(t,void 0,"-",""),s.p=l,s.c=d},getMidBoxSize:function(){return.5*i.xypic.lineElementLength},getDefaultCurvature:function(){return 3.5*i.xypic.lineElementLength},hasUpperTips:!0,hasLowerTips:!0}),i.Command.Twocell.Switch.UpperLabel.Augment({setup:function(e){e.env.twocellUpperLabel=t.Option.Some(this)},toShape:function(t,e,n,i,r){this.label.toShape(t,e,n,i,r)}}),i.Command.Twocell.Switch.LowerLabel.Augment({setup:function(e){e.env.twocellLowerLabel=t.Option.Some(this)},toShape:function(t,e,n,i,r){this.label.toShape(t,e,n,i,r)}}),i.Command.Twocell.Switch.SetCurvature.Augment({setup:function(e){var n=e.env;this.nudge.isOmit?n.twocellShouldDrawCurve=!1:n.twocellCurvatureEm=t.Option.Some(this.nudge.number*i.xypic.lineElementLength)}}),i.Command.Twocell.Switch.DoNotSetCurvedArrows.Augment({setup:function(t){t.env.twocellShouldDrawCurve=!1}}),i.Command.Twocell.Switch.PlaceModMapObject.Augment({setup:function(t){t.env.twocellShouldDrawModMap=!0}}),i.Command.Twocell.Switch.ChangeHeadTailObject.Augment({setup:function(t){var e=t.env;switch(this.what){case"`":e.twocelltail=this.object;break;case"'":e.twocellhead=this.object}}}),i.Command.Twocell.Switch.ChangeCurveObject.Augment({setup:function(t){var e=t.env;switch(this.what){case"":e.twocellUpperCurveObjectSpacer=this.spacer,e.twocellUpperCurveObject=this.maybeObject,e.twocellLowerCurveObjectSpacer=this.spacer,e.twocellLowerCurveObject=this.maybeObject;break;case"^":e.twocellUpperCurveObjectSpacer=this.spacer,e.twocellUpperCurveObject=this.maybeObject;break;case"_":e.twocellLowerCurveObjectSpacer=this.spacer,e.twocellLowerCurveObject=this.maybeObject}}}),i.Command.Twocell.Label.Augment({toShape:function(t,e,r,a,o){var s,h=this.maybeNudge;if(h.isDefined){var c=h.get;if(c.isOmit)return;s=c.number*i.xypic.lineElementLength}else s=this.getDefaultLabelOffset();var u=t.env,p=u.c;u.c=n.Frame.Point(e.x+s*r,e.y+s*a),this.labelObject.toDropShape(t),u.c=p},getDefaultLabelOffset:function(){return i.xypic.lineElementLength}}),i.Command.Twocell.Nudge.Number.Augment({isOmit:!1}),i.Command.Twocell.Nudge.Omit.Augment({isOmit:!0}),i.Command.Twocell.Arrow.Augment({toTipsShape:function(t,e,n){var i=t.env,r=i.lastCurve,a=i.c,o=i.angle,s=e?Math.PI:0,h=r.tOfPlace(!0,!0,e?0:1,0);i.c=r.position(h),i.angle=r.angle(h)+s,i.twocellhead.toDropShape(t),h=r.tOfPlace(!0,!0,e?1:0,0),i.c=r.position(h),i.angle=r.angle(h)+s,n?i.twocellhead.toDropShape(t):i.twocelltail.toDropShape(t),i.twocellShouldDrawModMap&&(h=r.tOfPlace(!1,!1,.5,0),i.c=r.position(h),i.angle=r.angle(h)+s,i.twocellmodmapobject.toDropShape(t)),i.c=a,i.angle=o}}),i.Command.Twocell.Arrow.WithOrientation.Augment({toUpperTipsShape:function(t){switch(this.tok){case"":case"^":case"_":case"=":case"\\omit":case"'":this.toTipsShape(t,!1,!1);break;case"`":this.toTipsShape(t,!0,!1);break;case'"':this.toTipsShape(t,!1,!0)}},toLowerTipsShape:function(t){switch(this.tok){case"":case"^":case"_":case"=":case"\\omit":case"`":this.toTipsShape(t,!1,!1);break;case"'":this.toTipsShape(t,!0,!1);break;case'"':this.toTipsShape(t,!1,!0)}},toArrowShape:function(t,e){var r=t.env,a=r.c;switch(this.tok){case"^":var o=r.angle;r.angle=o+Math.PI,r.twocellarrowobject.toDropShape(t),r.c=n.Frame.Point(a.x+i.xypic.lineElementLength*Math.cos(o-Math.PI/2),a.y+i.xypic.lineElementLength*Math.sin(o-Math.PI/2)),this.labelObject.toDropShape(t),r.angle=o;break;case"":case"_":o=r.angle,r.twocellarrowobject.toDropShape(t),r.c=n.Frame.Point(a.x+i.xypic.lineElementLength*Math.cos(o+Math.PI/2),a.y+i.xypic.lineElementLength*Math.sin(o+Math.PI/2)),this.labelObject.toDropShape(t);break;case"=":o=r.angle;var s=n.Shape.TwocellEqualityArrowheadShape(r.c,r.angle);t.appendShapeToFront(s),r.c=n.Frame.Point(a.x+i.xypic.lineElementLength*Math.cos(o+Math.PI/2),a.y+i.xypic.lineElementLength*Math.sin(o+Math.PI/2)),this.labelObject.toDropShape(t);break;default:this.labelObject.toDropShape(t)}r.c=a}}),i.Command.Twocell.Arrow.WithPosition.Augment({toUpperTipsShape:function(t){this.toTipsShape(t,!1,!1)},toLowerTipsShape:function(t){this.toTipsShape(t,!1,!1)},toArrowShape:function(t,e){var r,a=t.env,o=a.c,s=a.angle,h=this.nudge;if(h.isOmit)r=o;else{var c=h.number*i.xypic.lineElementLength;r=n.Frame.Point(e.x+c*Math.cos(s),e.y+c*Math.sin(s))}a.c=r,a.twocellarrowobject.toDropShape(t),h.isOmit||(a.c=n.Frame.Point(r.x+i.xypic.lineElementLength*Math.cos(s+Math.PI/2),r.y+i.xypic.lineElementLength*Math.sin(s+Math.PI/2)),this.labelObject.toDropShape(t)),a.c=o}}),i.Pos.Xyimport.TeXCommand.Augment({toShape:function(t){var e=t.env;if(void 0===e.c)return n.Shape.none;var i=e.duplicate(),r=n.DrawingContext(n.Shape.none,i),a=this.graphics.toDropShape(r),o=this.width,s=this.height;if(0===o||0===s)throw n.ExecutionError("the 'width' and 'height' attributes of the \\xyimport should be non-zero.");var h=i.c,c=h.l+h.r,u=h.u+h.d;if(0===c||0===u)throw n.ExecutionError("the width and height of the graphics to import should be non-zero.");var p=this.xOffset,l=this.yOffset;e.c=h.toRect({u:u/s*(s-l),d:u/s*l,l:c/o*p,r:c/o*(o-p)}),e.setXBase(c/o,0),e.setYBase(0,u/s);var d=h.l-e.c.l,m=h.d-e.c.d;a=n.Shape.TranslateShape(d,m,r.shape),t.appendShapeToFront(a)}}),i.Pos.Xyimport.Graphics.Augment({toShape:function(t){var e=t.env;if(void 0===e.c)return n.Shape.none;var i=e.duplicate(),r=n.DrawingContext(n.Shape.none,i),a=this.width,o=this.height;if(0===a||0===o)throw n.ExecutionError("the 'width' and 'height' attributes of the \\xyimport should be non-zero.");var s=this.graphics;if(s.setup(r),!i.includegraphicsWidth.isDefined||!i.includegraphicsHeight.isDefined)throw n.ExecutionError("the 'width' and 'height' attributes of the \\includegraphics are required.");var h=i.includegraphicsWidth.get,c=i.includegraphicsHeight.get;if(0===h||0===c)throw n.ExecutionError("the 'width' and 'height' attributes of the \\includegraphics should be non-zero.");var u=this.xOffset,p=this.yOffset;e.c=i.c.toRect({u:c/o*(o-p),d:c/o*p,l:h/a*u,r:h/a*(a-u)}),e.setXBase(h/a,0),e.setYBase(0,c/o);var l=n.Shape.ImageShape(e.c,s.filepath);t.appendShapeToFront(l)}}),i.Command.Includegraphics.Augment({setup:function(e){var n=e.env;n.includegraphicsWidth=t.Option.empty,n.includegraphicsHeight=t.Option.empty,this.attributeList.foreach((function(t){t.setup(e)}))}}),i.Command.Includegraphics.Attr.Width.Augment({setup:function(e){e.env.includegraphicsWidth=t.Option.Some(n.length2em(this.dimen))}}),i.Command.Includegraphics.Attr.Height.Augment({setup:function(e){e.env.includegraphicsHeight=t.Option.Some(n.length2em(this.dimen))}}),MathJax.Hub.Startup.signal.Post("Device-Independent Xy-pic Ready")})),MathJax.Hub.Register.StartupHook("HTML-CSS Xy-pic Require",(function(){MathJax.Extension.fp,MathJax.ElementJax.mml;var t=MathJax.OutputJax["HTML-CSS"],e=(MathJax.Hub,MathJax.Extension.xypic),n=e.AST,i=function(){e.length2em=function(e){return t.length2em(e)},e.oneem=e.length2em("1em"),e.em2length=function(t){return t/e.oneem+"em"},e.Em=function(e){return t.Em(e)},e.em=t.em,e.em2px=function(e){return Math.round(e*t.em*100)/100},e.axis_height=t.TeX.axis_height,n.xypic.strokeWidth=e.length2em("0.04em"),n.xypic.thickness=e.length2em("0.15em"),n.xypic.jot=e.length2em("3pt"),n.xypic.objectmargin=e.length2em("3pt"),n.xypic.objectwidth=e.length2em("0pt"),n.xypic.objectheight=e.length2em("0pt"),n.xypic.labelmargin=e.length2em("2.5pt"),n.xypic.turnradius=e.length2em("10pt"),n.xypic.lineElementLength=e.length2em("5pt"),n.xypic.axisHeightLength=e.axis_height*e.length2em("10pt"),n.xypic.dottedDasharray=e.oneem+" "+e.em2px(n.xypic.thickness)};n.xypic.Augment({toHTML:function(r){if(!e.useSVG)return r;i();var a=[],o=e.length2em("0.2em"),s=n.xypic.strokeWidth;r=this.HTMLcreateSpan(r);var h=t.createStack(r);e.Shape.TextShape.Augment({_draw:function(n,i){var r,o,s=this.math;s.setTeXclass();var c=e.length2em("0.1em"),u=t.Element("span",{className:"MathJax",style:{"text-align":"center",role:"textbox","aria-readonly":"true",position:"absolute",color:n.getCurrentColor()}});h.appendChild(u);var p=function(t){if(t&&(t.hasOwnProperty("spanID")&&delete t.spanID,t.data))for(var e=0,n=t.data.length;e<n;e++)p(t.data[e])};p(s);var l=s.HTMLcreateSpan(u);r=t.createStack(l),o=t.createBox(r),s.HTMLmeasureChild(0,o);var d=o.bbox.h+c,m=o.bbox.d+c,x=o.bbox.w+2*c,f=t.createFrame(r,d+m,0,x,0,"none");f.id="MathJax-frame-"+s.spanID+t.idPostfix,t.addBox(r,f),r.insertBefore(f,o),f.style.width=e.em2px(x),f.style.height=e.em2px(d+m),t.placeBox(f,0,-m,!0),t.placeBox(o,c,0),s.HTMLhandleSpace(l),s.HTMLhandleColor(l),l.offsetHeight;var g=(d+m)/2,S=x/2,y=this.c;if(this.originalBBox={H:d,D:m,W:x},i)h.removeChild(u);else{var v=n.getOrigin();u.setAttribute("x",y.x-S-v.x),u.setAttribute("y",-y.y-g-v.y-r.offsetTop/t.em+d),a.push(u)}return y.toRect({u:g,d:g,l:S,r:S})}});var c,u={h:1,d:0,w:1,lw:0,rw:1},p=u.h,l=u.d,d=u.w,m=t.createFrame(h,p+l,0,d,s,"none");m.id="MathJax-frame-"+this.spanID+t.idPostfix,c=e.Graphics.createSVG(p,l,d,s,"black",{viewBox:[0,-e.em2px(p+l),e.em2px(d),e.em2px(p+l)].join(" "),overflow:"visible"}),e.svgForDebug=c,e.svgForTestLayout=c;var x=t.createBox(h);x.appendChild(c.svg);var f=this.cmd;if(f){var g=e.Env(),S=e.DrawingContext(e.Shape.none,g);f.toShape(S);var y=S.shape;y.draw(c);var v=y.getBoundingBox();if(void 0!==v){v=e.Frame.Rect(0,0,{l:Math.max(0,-(v.x-v.l)),r:Math.max(0,v.x+v.r),u:Math.max(0,v.y+v.u),d:Math.max(0,-(v.y-v.d))}),c.setWidth(v.l+v.r+2*o),c.setHeight(v.u+v.d+2*o),c.setAttribute("viewBox",[e.em2px(v.x-v.l-o),-e.em2px(v.y+v.u+o),e.em2px(v.l+v.r+2*o),e.em2px(v.u+v.d+2*o)].join(" "));for(var b=a.length,C=0;C<b;C++){var M=a[C],w=parseFloat(M.getAttribute("x")),P=parseFloat(M.getAttribute("y"));M.style.left=e.em2px(w+v.l+o*e.oneem)+"px",M.style.top=e.em2px(P-e.axis_height)+"px"}u={h:v.u+o,d:v.d+o,w:v.l+v.r+2*o,lw:0,rw:v.l+v.r+2*o},r.bbox=u,l=v.d+o,d=v.l+v.r+2*o,p=v.h+o,t.placeBox(x,0,e.axis_height-l,!0),m.style.width=e.Em(d),m.style.height=e.Em(p+l),t.addBox(h,m),t.placeBox(m,d-1,-l,!0),this.HTMLhandleSpace(r),this.HTMLhandleColor(r)}else(r=r.parentNode).removeChild(r.firstChild)}else(r=r.parentNode).removeChild(r.firstChild);return r}}),n.xypic.newdir.Augment({toHTML:function(t){var n=this.cmd;return e.repositories.dirRepository.put(n.dirMain,n.compositeObject),t}}),n.xypic.includegraphics.Augment({toHTML:function(n){i();var r=this.cmd,a=e.Env(),o=e.DrawingContext(e.Shape.none,a);if(r.setup(o),!a.includegraphicsWidth.isDefined||!a.includegraphicsHeight.isDefined)throw e.ExecutionError("the 'width' and 'height' attributes of the \\includegraphics are required.");var s=a.includegraphicsWidth.get,h=a.includegraphicsHeight.get;n=this.HTMLcreateSpan(n);var c=t.createStack(n),u=t.createBox(c),p=new Image;p.src=r.filepath,p.style.width=t.Em(s),p.style.height=t.Em(h),u.appendChild(p);var l={h,d:0,w:s,rw:s,lw:0,exactW:!0};p.bbox=l;var d=h,m=s;t.Measured(p);var x=t.createFrame(c,d+0,0,m,0,"none");return x.id="MathJax-frame-"+this.spanID,t.addBox(c,x),c.insertBefore(x,u),x.style.width=t.Em(m-0-0),x.style.height=t.Em(d+0-0-0),t.placeBox(x,0,0,!0),t.placeBox(u,0,0),this.HTMLhandleSpace(n),this.HTMLhandleColor(n),n}}),MathJax.Hub.Startup.signal.Post("HTML-CSS Xy-pic Ready")})),MathJax.Hub.Register.StartupHook("SVG Xy-pic Require",(function(){MathJax.Extension.fp,MathJax.ElementJax.mml;var t=MathJax.OutputJax.SVG,e=t.BBOX,n=(MathJax.Hub,MathJax.Extension.xypic),i=n.AST;n.memoize,e.PPATH=e.Subclass({type:"path",removeable:!1,Init:function(t,e,n,i,r,a,o){null==o&&(o={}),o.fill="none",a&&(o.stroke=a),o["stroke-width"]=r.toFixed(2).replace(/\.?0+$/,""),o.d=i,this.SUPER(arguments).Init.call(this,o),this.w=this.r=n,this.h=this.H=t+e,this.d=this.D=this.l=0,this.y=-e}}),e.XYPIC=e.Subclass({type:"g",removeable:!1,Init:function(t,e,n,i){this.element=i,this.x=e,this.y=n,this.r=t.r,this.l=t.l,this.h=t.h,this.d=t.d,this.w=t.w,this.H=t.h,this.D=t.d,this.scale=1,this.n=1}});var r=function(e,r){n.length2em=function(n){return t.length2em(n,e,1/t.em)*r},n.oneem=n.length2em("1em"),n.em2length=function(t){return t/n.oneem+"em"},n.Em=function(e){return t.Em(e)},n.em=t.em,n.em2px=function(e){return Math.round(e*t.em*100)/100},n.axis_height=t.TeX.axis_height,i.xypic.strokeWidth=n.length2em("0.04em"),i.xypic.thickness=n.length2em("0.15em"),i.xypic.jot=n.length2em("3pt"),i.xypic.objectmargin=n.length2em("3pt"),i.xypic.objectwidth=n.length2em("0pt"),i.xypic.objectheight=n.length2em("0pt"),i.xypic.labelmargin=n.length2em("2.5pt"),i.xypic.turnradius=n.length2em("10pt"),i.xypic.lineElementLength=n.length2em("5pt"),i.xypic.axisHeightLength=n.axis_height*n.length2em("1em")/1e3,i.xypic.dottedDasharray=n.oneem+" "+n.em2px(i.xypic.thickness)};i.xypic.Augment({toSVG:function(a,o){this.SVGgetStyles();var s=this.SVG();this.SVGhandleSpace(s);var h=this.SVGgetMu(s),c=this.SVGgetScale();r(h,c);var u=n.length2em("0.2em"),p=i.xypic.strokeWidth,l=s;n.Shape.TextShape.Augment({_draw:function(i,r){var a=this.math,o=n.length2em("0.1em"),s=this.c;a.setTeXclass(),a.SVGgetStyles(),a.SVGhandleSpace(l);var h=a.data[0].toSVG(),c=s.x-h.w/2,u=(s.y,h.h,h.d,h.d,n.axis_height,h.h+o),p=h.d+o,d=h.w+2*o;this.originalBBox={H:u,D:p,W:d};var m=(u+p)/2,x=d/2;if(!r){i.getOrigin();var f=i.getCurrentColor(),g=e.G({stroke:f,fill:f,"stroke-thickness":0,transform:"scale("+t.em+") matrix(1 0 0 -1 0 0) translate("+n.em2px(c/t.em)+", "+n.em2px((s.y-(u-p)/2)/t.em)+")"}).With({removeable:!1});g.Add(h,0,0,!0,!0),g.ic=h.ic,g.Clean(),a.SVGhandleColor(g),a.SVGsaveData(g),i.appendChild(g.element)}return s.toRect({u:m,d:m,l:x,r:x})}});var d={h:n.oneem,d:0,w:n.oneem,lw:0,rw:n.oneem},m=d.h,x=d.d,f=d.w,g=n.Graphics.createSVG(m,x,f,p,"black",{viewBox:[0,-n.em2px(m+x),n.em2px(f),n.em2px(m+x)].join(" "),overflow:"visible"});n.svgForDebug=g,n.svgForTestLayout=g;var S=this.cmd;if(S){var y=n.Env(),v=n.DrawingContext(n.Shape.none,y);S.toShape(v);var b=v.shape;b.draw(g);var C=b.getBoundingBox();if(void 0!==C){var M=n.Frame.Rect(0,0,{l:Math.max(0,-(C.x-C.l)),r:Math.max(0,C.x+C.r),u:Math.max(0,C.y+C.u),d:Math.max(0,-(C.y-C.d))});d={h:M.u+u+n.axis_height,d:M.d+u-n.axis_height,w:M.r+M.l+2*u,l:-M.l-u,r:M.r+u},this.SVGhandleSpace(s);var w=e.XYPIC(d,0,0,g.drawArea);w.element.setAttribute("transform","scale("+1/t.em+") matrix(1 0 0 -1 0 0) translate(0,"+n.em2px(-n.axis_height)+")"),s.Add(w),s.x+=M.l+u,s.w-=M.l+u,this.SVGhandleColor(s),this.SVGsaveData(s)}}return s}}),i.xypic.newdir.Augment({toSVG:function(){var t=this.cmd;return n.repositories.dirRepository.put(t.dirMain,t.compositeObject),this.SVG()}}),i.xypic.includegraphics.Augment({toSVG:function(a,o){this.SVGgetStyles();var s=this.SVG();this.SVGhandleSpace(s);var h=this.SVGgetMu(s),c=this.SVGgetScale();r(h,c);var u=i.xypic.strokeWidth,p=(w={h:n.oneem,d:0,w:n.oneem,lw:0,rw:n.oneem}).h,l=w.d,d=w.w,m=n.Graphics.createSVG(p,l,d,u,"black",{viewBox:[0,-n.em2px(p+l),n.em2px(d),n.em2px(p+l)].join(" "),overflow:"visible"});n.svgForDebug=m,n.svgForTestLayout=m;var x=n.Env(),f=n.DrawingContext(n.Shape.none,x),g=this.cmd;if(g.setup(f),!x.includegraphicsWidth.isDefined||!x.includegraphicsHeight.isDefined)throw n.ExecutionError("the 'width' and 'height' attributes of the \\includegraphics are required.");var S=x.includegraphicsWidth.get,y=x.includegraphicsHeight.get,v=x.c;v=v.toRect({u:y-n.axis_height,d:n.axis_height,l:0,r:S});var b=n.Shape.ImageShape(v,g.filepath);b.draw(m);var C=b.getBoundingBox(),M=n.Frame.Rect(0,0,{l:Math.max(0,-(C.x-C.l)),r:Math.max(0,C.x+C.r),u:Math.max(0,C.y+C.u),d:Math.max(0,-(C.y-C.d))}),w={h:M.u+n.axis_height,d:M.d-n.axis_height,w:M.r+M.l,l:-M.l,r:M.r};this.SVGhandleSpace(s);var P=e.XYPIC(w,0,0,m.drawArea);return P.element.setAttribute("transform","scale("+1/t.em+") matrix(1 0 0 -1 0 0) translate(0,"+n.em2px(-n.axis_height)+")"),s.Add(P),s.x+=M.l,s.w-=M.l,this.SVGhandleColor(s),this.SVGsaveData(s),s}}),MathJax.Hub.Startup.signal.Post("SVG Xy-pic Ready")})),MathJax.Ajax.loadComplete(window.xypicURL);