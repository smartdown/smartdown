const smartdown=window.smartdown;function calcWikidataImageUtil(e,a,n,t){var s=n=decodeURIComponent(n);if(0===n.indexOf("[")){var r=JSON.parse(n);Array.isArray(r)&&(s="",r.forEach((function(e,a){s+=e,a<r.length-1&&(s+="|")})))}var i=new XMLHttpRequest;i.addEventListener("load",(function(){var a=this.responseText,n=JSON.parse(a).query.pages,s=[];n.forEach((function(a){e&&a.thumbnail?s.push(a.thumbnail.source):!e&&a.original&&s.push(a.original.source)})),s.elementType="image",t(s)}));var o="https://en.wikipedia.org/w/api.php?action=query&prop=pageimages%7Cpageterms&format=json&origin=*&wbptterms=description&redirects=&formatversion=2";o+="&titles="+encodeURI(s),o+="&piprop=thumbnail%7Cname%7Coriginal&pithumbsize=300",i.open("GET",o),i.send()}function calcWikidataImages(e,a,n){return calcWikidataImageUtil(!1,e,a,n)}function calcWikidataThumbs(e,a,n){return calcWikidataImageUtil(!0,e,a,n)}function calcWikidata(e,a,n){var t=a=decodeURIComponent(a);if(0===a.indexOf("[")){var s=JSON.parse(a);Array.isArray(s)&&(t="",s.forEach((function(e,a){t+=e,a<s.length-1&&(t+="|")})))}var r=new XMLHttpRequest;r.addEventListener("load",(function(){var e=this.responseText,a=JSON.parse(e).query.pages,t=[];window.lodashEach(a,(function(e){t.push({title:e.displaytitle,url:e.canonicalurl})})),t.elementType="title/url",n(t)}));var i="https://en.wikipedia.org/w/api.php?action=query&format=json&prop=info&origin=*&redirects=";i+="&titles="+encodeURI(t),i+="&inprop=displaytitle%7Curl",r.open("GET",i),r.send()}const tsvCalcHandlerCache={};function calcTSV(e,a,n){0===(a=decodeURIComponent(a)).indexOf("/http")&&(a=a.slice(1));const t=smartdown.expandHrefWithLinkRules(a);if(smartdown.d3){const a="CACHE_"+e+"_"+t;let s=tsvCalcHandlerCache[a];s?s.inProgressHandlers.length>0?s.inProgressHandlers.push(n):n(s.cachedResult):(s=tsvCalcHandlerCache[a]={inProgressHandlers:[n],cachedResult:null},smartdown.axios.get(t).then((function(e){const a=smartdown.d3.tsvParseRows(e.data);for(s.cachedResult=a;s.inProgressHandlers.length>0;)s.inProgressHandlers.pop()(a)})).catch((function(e){console.log("err",e)})))}else smartdown.ensureExtension("d3",(function(){calcTSV(e,t,n)}))}const csvCalcHandlerCache={};function calcCSV(e,a,n){0===(a=decodeURIComponent(a)).indexOf("/http")&&(a=a.slice(1));const t=smartdown.expandHrefWithLinkRules(a);if(smartdown.d3){const a="CACHE_"+e+"_"+t;let s=csvCalcHandlerCache[a];s?s.inProgressHandlers.length>0?(console.log("MISS cacheKey adding handler",a),s.inProgressHandlers.push(n)):n(s.cachedResult):(console.log("MISS cacheKey",a),s=csvCalcHandlerCache[a]={inProgressHandlers:[n],cachedResult:null},smartdown.axios.get(t).then((function(e){const a=smartdown.d3.csvParseRows(e.data);for(s.cachedResult=a;s.inProgressHandlers.length>0;)s.inProgressHandlers.pop()(a)})).catch((function(e){console.log("err",e)})))}else smartdown.ensureExtension("d3",(function(){calcCSV(e,t,n)}))}smartdown.defaultCalcHandlers={wikidataImages:calcWikidataImages,wikidataThumbs:calcWikidataThumbs,wikidata:calcWikidata,tsv:calcTSV,csv:calcCSV};